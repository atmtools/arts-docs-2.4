<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.20"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>ARTS: linefunctions.cc Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">ARTS
   &#160;<span id="projectnumber">2.4.0(git:4fb77825)</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.20 -->
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',false,false,'search.php','Search');
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('linefunctions_8cc_source.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<div class="header">
  <div class="headertitle">
<div class="title">linefunctions.cc</div>  </div>
</div><!--header-->
<div class="contents">
<a href="linefunctions_8cc.html">Go to the documentation of this file.</a><div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;<span class="comment">/* Copyright (C) 2017</span></div>
<div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;<span class="comment"> * Richard Larsson &lt;ric.larsson@gmail.com&gt;</span></div>
<div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;<span class="comment"> * </span></div>
<div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;<span class="comment"> * This program is free software; you can redistribute it and/or modify it</span></div>
<div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;<span class="comment"> * under the terms of the GNU General Public License as published by the</span></div>
<div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;<span class="comment"> * Free Software Foundation; either version 2, or (at your option) any</span></div>
<div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;<span class="comment"> * later version.</span></div>
<div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;<span class="comment"> * </span></div>
<div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;<span class="comment"> * This program is distributed in the hope that it will be useful,</span></div>
<div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;<span class="comment"> * but WITHOUT ANY WARRANTY; without even the implied warranty of</span></div>
<div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;<span class="comment"> * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the</span></div>
<div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;<span class="comment"> * GNU General Public License for more details.</span></div>
<div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160;<span class="comment"> * </span></div>
<div class="line"><a name="l00014"></a><span class="lineno">   14</span>&#160;<span class="comment"> * You should have received a copy of the GNU General Public License</span></div>
<div class="line"><a name="l00015"></a><span class="lineno">   15</span>&#160;<span class="comment"> * along with this program; if not, write to the Free Software</span></div>
<div class="line"><a name="l00016"></a><span class="lineno">   16</span>&#160;<span class="comment"> * Foundation, Inc., 59 Temple Place - Suite 330, Boston, MA 02111-1307,</span></div>
<div class="line"><a name="l00017"></a><span class="lineno">   17</span>&#160;<span class="comment"> * USA. */</span></div>
<div class="line"><a name="l00018"></a><span class="lineno">   18</span>&#160; </div>
<div class="line"><a name="l00035"></a><span class="lineno">   35</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="linefunctions_8h.html">linefunctions.h</a>&quot;</span></div>
<div class="line"><a name="l00036"></a><span class="lineno">   36</span>&#160;<span class="preprocessor">#include &lt;Eigen/Core&gt;</span></div>
<div class="line"><a name="l00037"></a><span class="lineno">   37</span>&#160;<span class="preprocessor">#include &lt;Faddeeva/Faddeeva.hh&gt;</span></div>
<div class="line"><a name="l00038"></a><span class="lineno">   38</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="constants_8h.html">constants.h</a>&quot;</span></div>
<div class="line"><a name="l00039"></a><span class="lineno">   39</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="linescaling_8h.html">linescaling.h</a>&quot;</span></div>
<div class="line"><a name="l00040"></a><span class="lineno">   40</span>&#160; </div>
<div class="line"><a name="l00042"></a><span class="lineno"><a class="line" href="linefunctions_8cc.html#a3b4555133ea360cd068890a3e3cefaf5">   42</a></span>&#160;<span class="keyword">inline</span> <a class="code" href="complex_8h.html#aff1205001edf41e8e0032f18b98875e1">Complex</a> <a class="code" href="linefunctions_8cc.html#a3b4555133ea360cd068890a3e3cefaf5">w</a>(<a class="code" href="complex_8h.html#aff1205001edf41e8e0032f18b98875e1">Complex</a> z) noexcept { <span class="keywordflow">return</span> <a class="code" href="linefunctions_8cc.html#a3b4555133ea360cd068890a3e3cefaf5">Faddeeva::w</a>(z); }</div>
<div class="line"><a name="l00043"></a><span class="lineno">   43</span>&#160; </div>
<div class="line"><a name="l00045"></a><span class="lineno"><a class="line" href="linefunctions_8cc.html#a08f2b520b433833c0d7ca264f305380e">   45</a></span>&#160;constexpr <a class="code" href="complex_8h.html#aff1205001edf41e8e0032f18b98875e1">Complex</a> <a class="code" href="linefunctions_8cc.html#a08f2b520b433833c0d7ca264f305380e">dw</a>(<a class="code" href="complex_8h.html#aff1205001edf41e8e0032f18b98875e1">Complex</a> z, <a class="code" href="complex_8h.html#aff1205001edf41e8e0032f18b98875e1">Complex</a> <a class="code" href="linefunctions_8cc.html#a3b4555133ea360cd068890a3e3cefaf5">w</a>) noexcept {</div>
<div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160;  <span class="keywordflow">return</span> <a class="code" href="complex_8h.html#aff1205001edf41e8e0032f18b98875e1">Complex</a>(0, 2) * (Constant::inv_sqrt_pi - z * <a class="code" href="linefunctions_8cc.html#a3b4555133ea360cd068890a3e3cefaf5">w</a>);</div>
<div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160;}</div>
<div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160; </div>
<div class="line"><a name="l00050"></a><span class="lineno"><a class="line" href="linefunctions_8cc.html#aac6918584a4f0ae9c7b2ff900eb047a4">   50</a></span>&#160;constexpr <a class="code" href="complex_8h.html#aff1205001edf41e8e0032f18b98875e1">Complex</a> <a class="code" href="linefunctions_8cc.html#aac6918584a4f0ae9c7b2ff900eb047a4">pCqSDHC_to_arts</a>(<a class="code" href="complex_8h.html#aff1205001edf41e8e0032f18b98875e1">Complex</a> <a class="code" href="namespaceARTS_1_1Var.html#aeb141694315061634800e0ddc30701ca">x</a>) noexcept {</div>
<div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160;  <span class="keyword">using</span> Constant::c;</div>
<div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160;  <span class="keyword">using</span> <a class="code" href="namespaceConstant.html#a7f485605d9dab3fde05d52f03ca9f36e">Constant::pow2</a>;</div>
<div class="line"><a name="l00053"></a><span class="lineno">   53</span>&#160;  <span class="keyword">using</span> <a class="code" href="namespaceConversion.html#ab3b90aebe088aed47dd11985613b3799">Conversion::hitran2arts_linestrength</a>;</div>
<div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160;  </div>
<div class="line"><a name="l00055"></a><span class="lineno">   55</span>&#160;  <span class="keywordflow">return</span> <a class="code" href="complex_8h.html#a428a624f5d3e190e8961223d885b44b4">conj</a>(<a class="code" href="namespaceConversion.html#ab3b90aebe088aed47dd11985613b3799">hitran2arts_linestrength</a>(<a class="code" href="namespaceARTS_1_1Var.html#aeb141694315061634800e0ddc30701ca">x</a>) / <a class="code" href="namespaceConstant.html#a7f485605d9dab3fde05d52f03ca9f36e">pow2</a>(c));</div>
<div class="line"><a name="l00056"></a><span class="lineno">   56</span>&#160;}</div>
<div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160; </div>
<div class="line"><a name="l00059"></a><span class="lineno"><a class="line" href="linefunctions_8cc.html#a9e4c2622d7fda9ecb3bd1ed9a074c756">   59</a></span>&#160;constexpr <a class="code" href="complex_8h.html#aff1205001edf41e8e0032f18b98875e1">Complex</a> <a class="code" href="linefunctions_8cc.html#a9e4c2622d7fda9ecb3bd1ed9a074c756">pCqSDHC_to_arts_freq_deriv</a>(<a class="code" href="complex_8h.html#aff1205001edf41e8e0032f18b98875e1">Complex</a> <a class="code" href="namespaceARTS_1_1Var.html#aeb141694315061634800e0ddc30701ca">x</a>) noexcept {</div>
<div class="line"><a name="l00060"></a><span class="lineno">   60</span>&#160;  <span class="keyword">using</span> Constant::c;</div>
<div class="line"><a name="l00061"></a><span class="lineno">   61</span>&#160;  <span class="keyword">using</span> <a class="code" href="namespaceConstant.html#a9b0ce133f5cf1a3d76c2ae3dc7aca0b8">Constant::pow4</a>;</div>
<div class="line"><a name="l00062"></a><span class="lineno">   62</span>&#160;  <span class="keyword">using</span> <a class="code" href="namespaceConversion.html#ab3b90aebe088aed47dd11985613b3799">Conversion::hitran2arts_linestrength</a>;</div>
<div class="line"><a name="l00063"></a><span class="lineno">   63</span>&#160;  </div>
<div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160;  <span class="keywordflow">return</span> <a class="code" href="namespaceConversion.html#ab3b90aebe088aed47dd11985613b3799">hitran2arts_linestrength</a>(<a class="code" href="namespaceConversion.html#ab3b90aebe088aed47dd11985613b3799">hitran2arts_linestrength</a>(<a class="code" href="namespaceARTS_1_1Var.html#aeb141694315061634800e0ddc30701ca">x</a>)) / <a class="code" href="namespaceConstant.html#a9b0ce133f5cf1a3d76c2ae3dc7aca0b8">pow4</a>(c);</div>
<div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160;}</div>
<div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160; </div>
<div class="line"><a name="l00068"></a><span class="lineno"><a class="line" href="linefunctions_8cc.html#a691ec5192a5f391467f8c39cb05559fd">   68</a></span>&#160;constexpr <a class="code" href="complex_8h.html#aff1205001edf41e8e0032f18b98875e1">Complex</a> <a class="code" href="linefunctions_8cc.html#a691ec5192a5f391467f8c39cb05559fd">pCqSDHC_to_arts_G2_deriv</a>(<a class="code" href="complex_8h.html#aff1205001edf41e8e0032f18b98875e1">Complex</a> <a class="code" href="namespaceARTS_1_1Var.html#aeb141694315061634800e0ddc30701ca">x</a>) noexcept {</div>
<div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160;  <span class="keyword">using</span> Constant::c;</div>
<div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160;  <span class="keyword">using</span> <a class="code" href="namespaceConstant.html#a9b0ce133f5cf1a3d76c2ae3dc7aca0b8">Constant::pow4</a>;</div>
<div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160;  <span class="keyword">using</span> <a class="code" href="namespaceConversion.html#ab3b90aebe088aed47dd11985613b3799">Conversion::hitran2arts_linestrength</a>;</div>
<div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160;  </div>
<div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160;  <span class="keywordflow">return</span> <a class="code" href="complex_8h.html#aff1205001edf41e8e0032f18b98875e1">Complex</a>(0, -1) *</div>
<div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160;  <a class="code" href="namespaceConversion.html#ab3b90aebe088aed47dd11985613b3799">hitran2arts_linestrength</a>(<a class="code" href="namespaceConversion.html#ab3b90aebe088aed47dd11985613b3799">hitran2arts_linestrength</a>(<a class="code" href="namespaceARTS_1_1Var.html#aeb141694315061634800e0ddc30701ca">x</a>)) / <a class="code" href="namespaceConstant.html#a9b0ce133f5cf1a3d76c2ae3dc7aca0b8">pow4</a>(c);</div>
<div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160;}</div>
<div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160; </div>
<div class="line"><a name="l00078"></a><span class="lineno"><a class="line" href="linefunctions_8cc.html#aab6895ad5809bc8a42a1ae2eab7e61d2">   78</a></span>&#160;constexpr <a class="code" href="complex_8h.html#aff1205001edf41e8e0032f18b98875e1">Complex</a> <a class="code" href="linefunctions_8cc.html#aab6895ad5809bc8a42a1ae2eab7e61d2">pCqSDHC_to_arts_D2_deriv</a>(<a class="code" href="complex_8h.html#aff1205001edf41e8e0032f18b98875e1">Complex</a> <a class="code" href="namespaceARTS_1_1Var.html#aeb141694315061634800e0ddc30701ca">x</a>) noexcept {</div>
<div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160;  <span class="keyword">using</span> Constant::c;</div>
<div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160;  <span class="keyword">using</span> <a class="code" href="namespaceConstant.html#a9b0ce133f5cf1a3d76c2ae3dc7aca0b8">Constant::pow4</a>;</div>
<div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160;  <span class="keyword">using</span> <a class="code" href="namespaceConversion.html#ab3b90aebe088aed47dd11985613b3799">Conversion::hitran2arts_linestrength</a>;</div>
<div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160;  </div>
<div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160;  <span class="keywordflow">return</span> <a class="code" href="complex_8h.html#aff1205001edf41e8e0032f18b98875e1">Complex</a>(0, 1) * <a class="code" href="namespaceConversion.html#ab3b90aebe088aed47dd11985613b3799">hitran2arts_linestrength</a>(<a class="code" href="namespaceConversion.html#ab3b90aebe088aed47dd11985613b3799">hitran2arts_linestrength</a>(<a class="code" href="namespaceARTS_1_1Var.html#aeb141694315061634800e0ddc30701ca">x</a>)) /</div>
<div class="line"><a name="l00084"></a><span class="lineno">   84</span>&#160;  <a class="code" href="namespaceConstant.html#a9b0ce133f5cf1a3d76c2ae3dc7aca0b8">pow4</a>(c);</div>
<div class="line"><a name="l00085"></a><span class="lineno">   85</span>&#160;}</div>
<div class="line"><a name="l00086"></a><span class="lineno">   86</span>&#160; </div>
<div class="line"><a name="l00087"></a><span class="lineno"><a class="line" href="namespaceLinefunctions.html#a5968ad913cffc2a38859e107aa8e43d6">   87</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="namespaceLinefunctions.html#a5968ad913cffc2a38859e107aa8e43d6">Linefunctions::set_lineshape</a>(</div>
<div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160;    Eigen::Ref&lt;Eigen::VectorXcd&gt; F,</div>
<div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160;    <span class="keyword">const</span> Eigen::Ref&lt;const Eigen::VectorXd&gt; <a class="code" href="namespaceARTS_1_1Var.html#a656f34b4c40189bd3c971e2d3dbe3b95">f_grid</a>,</div>
<div class="line"><a name="l00090"></a><span class="lineno">   90</span>&#160;    <span class="keyword">const</span> <a class="code" href="classAbsorption_1_1SingleLine.html">Absorption::SingleLine</a>&amp; line,</div>
<div class="line"><a name="l00091"></a><span class="lineno">   91</span>&#160;    <span class="keyword">const</span> <a class="code" href="matpack_8h.html#ad9a8dbb27c0bbea7271d916036122f6a">Numeric</a>&amp; temperature,</div>
<div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160;    <span class="keyword">const</span> <a class="code" href="matpack_8h.html#ad9a8dbb27c0bbea7271d916036122f6a">Numeric</a>&amp; zeeman_df,</div>
<div class="line"><a name="l00093"></a><span class="lineno">   93</span>&#160;    <span class="keyword">const</span> <a class="code" href="matpack_8h.html#ad9a8dbb27c0bbea7271d916036122f6a">Numeric</a>&amp; magnetic_magnitude,</div>
<div class="line"><a name="l00094"></a><span class="lineno">   94</span>&#160;    <span class="keyword">const</span> <a class="code" href="matpack_8h.html#ad9a8dbb27c0bbea7271d916036122f6a">Numeric</a>&amp; doppler_constant,</div>
<div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160;    <span class="keyword">const</span> <a class="code" href="structLineShape_1_1Output.html">LineShape::Output</a>&amp; X,</div>
<div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160;    <span class="keyword">const</span> <a class="code" href="namespaceLineShape.html#a14ae23ee5f35836ee9ca4d3d90c4e14d">LineShape::Type</a> lineshape_type,</div>
<div class="line"><a name="l00097"></a><span class="lineno">   97</span>&#160;    <span class="keyword">const</span> <a class="code" href="namespaceAbsorption.html#a5141982a7f8f641008a0b481aedeefcd">Absorption::MirroringType</a> mirroring_type,</div>
<div class="line"><a name="l00098"></a><span class="lineno">   98</span>&#160;    <span class="keyword">const</span> <a class="code" href="namespaceAbsorption.html#ae579c0918cccbeb83040cf46fad87965">Absorption::NormalizationType</a> norm_type)</div>
<div class="line"><a name="l00099"></a><span class="lineno">   99</span>&#160;{</div>
<div class="line"><a name="l00100"></a><span class="lineno">  100</span>&#160;  Eigen::MatrixXcd dF(0, 0), <a class="code" href="arts__api__classes_8cc.html#a126b511d17f5ccbef11bde3a65df2430">data</a>(F.size(), <a class="code" href="namespaceLinefunctions.html#a38c90914bad76caa9d40c7dc0053924e">Linefunctions::ExpectedDataSize</a>());</div>
<div class="line"><a name="l00101"></a><span class="lineno">  101</span>&#160; </div>
<div class="line"><a name="l00102"></a><span class="lineno">  102</span>&#160;  <span class="keywordflow">switch</span> (lineshape_type) {</div>
<div class="line"><a name="l00103"></a><span class="lineno">  103</span>&#160;    <span class="keywordflow">case</span> <a class="code" href="namespaceLineShape.html#a14ae23ee5f35836ee9ca4d3d90c4e14dae2fca8135c2fadca093abd79a6b1c0d2">LineShape::Type::HTP</a>:</div>
<div class="line"><a name="l00104"></a><span class="lineno">  104</span>&#160;    <span class="keywordflow">case</span> LineShape::Type::SDVP:</div>
<div class="line"><a name="l00105"></a><span class="lineno">  105</span>&#160;      <a class="code" href="namespaceLinefunctions.html#aa63d54039a4b96c9ca7f74524c1baa73">set_htp</a>(F,</div>
<div class="line"><a name="l00106"></a><span class="lineno">  106</span>&#160;              dF,</div>
<div class="line"><a name="l00107"></a><span class="lineno">  107</span>&#160;              <a class="code" href="namespaceARTS_1_1Var.html#a656f34b4c40189bd3c971e2d3dbe3b95">f_grid</a>,</div>
<div class="line"><a name="l00108"></a><span class="lineno">  108</span>&#160;              zeeman_df,</div>
<div class="line"><a name="l00109"></a><span class="lineno">  109</span>&#160;              magnetic_magnitude,</div>
<div class="line"><a name="l00110"></a><span class="lineno">  110</span>&#160;              line.<a class="code" href="classAbsorption_1_1SingleLine.html#a842d8319d70a0804efb38c4d78b6123d">F0</a>(),</div>
<div class="line"><a name="l00111"></a><span class="lineno">  111</span>&#160;              doppler_constant,</div>
<div class="line"><a name="l00112"></a><span class="lineno">  112</span>&#160;              X);</div>
<div class="line"><a name="l00113"></a><span class="lineno">  113</span>&#160;      <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00114"></a><span class="lineno">  114</span>&#160;    <span class="keywordflow">case</span> LineShape::Type::VP:</div>
<div class="line"><a name="l00115"></a><span class="lineno">  115</span>&#160;      <a class="code" href="namespaceLinefunctions.html#a9bab2edaa2740b7379fb568376859121">set_voigt</a>(F,</div>
<div class="line"><a name="l00116"></a><span class="lineno">  116</span>&#160;                dF,</div>
<div class="line"><a name="l00117"></a><span class="lineno">  117</span>&#160;                <a class="code" href="arts__api__classes_8cc.html#a126b511d17f5ccbef11bde3a65df2430">data</a>,</div>
<div class="line"><a name="l00118"></a><span class="lineno">  118</span>&#160;                <a class="code" href="namespaceARTS_1_1Var.html#a656f34b4c40189bd3c971e2d3dbe3b95">f_grid</a>,</div>
<div class="line"><a name="l00119"></a><span class="lineno">  119</span>&#160;                zeeman_df,</div>
<div class="line"><a name="l00120"></a><span class="lineno">  120</span>&#160;                magnetic_magnitude,</div>
<div class="line"><a name="l00121"></a><span class="lineno">  121</span>&#160;                line.<a class="code" href="classAbsorption_1_1SingleLine.html#a842d8319d70a0804efb38c4d78b6123d">F0</a>(),</div>
<div class="line"><a name="l00122"></a><span class="lineno">  122</span>&#160;                doppler_constant,</div>
<div class="line"><a name="l00123"></a><span class="lineno">  123</span>&#160;                X);</div>
<div class="line"><a name="l00124"></a><span class="lineno">  124</span>&#160;      <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00125"></a><span class="lineno">  125</span>&#160;    <span class="keywordflow">case</span> LineShape::Type::DP:</div>
<div class="line"><a name="l00126"></a><span class="lineno">  126</span>&#160;      <a class="code" href="namespaceLinefunctions.html#a5f38e52b80fafd947d2df8d1a3f082ef">set_doppler</a>(F,</div>
<div class="line"><a name="l00127"></a><span class="lineno">  127</span>&#160;                  dF,</div>
<div class="line"><a name="l00128"></a><span class="lineno">  128</span>&#160;                  <a class="code" href="arts__api__classes_8cc.html#a126b511d17f5ccbef11bde3a65df2430">data</a>,</div>
<div class="line"><a name="l00129"></a><span class="lineno">  129</span>&#160;                  <a class="code" href="namespaceARTS_1_1Var.html#a656f34b4c40189bd3c971e2d3dbe3b95">f_grid</a>,</div>
<div class="line"><a name="l00130"></a><span class="lineno">  130</span>&#160;                  zeeman_df,</div>
<div class="line"><a name="l00131"></a><span class="lineno">  131</span>&#160;                  magnetic_magnitude,</div>
<div class="line"><a name="l00132"></a><span class="lineno">  132</span>&#160;                  line.<a class="code" href="classAbsorption_1_1SingleLine.html#a842d8319d70a0804efb38c4d78b6123d">F0</a>(),</div>
<div class="line"><a name="l00133"></a><span class="lineno">  133</span>&#160;                  doppler_constant);</div>
<div class="line"><a name="l00134"></a><span class="lineno">  134</span>&#160;      <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00135"></a><span class="lineno">  135</span>&#160;    <span class="keywordflow">case</span> LineShape::Type::LP:</div>
<div class="line"><a name="l00136"></a><span class="lineno">  136</span>&#160;      <a class="code" href="namespaceLinefunctions.html#a21f46f004118c4c6c1b41e87ade1ed3c">set_lorentz</a>(</div>
<div class="line"><a name="l00137"></a><span class="lineno">  137</span>&#160;          F, dF, <a class="code" href="arts__api__classes_8cc.html#a126b511d17f5ccbef11bde3a65df2430">data</a>, <a class="code" href="namespaceARTS_1_1Var.html#a656f34b4c40189bd3c971e2d3dbe3b95">f_grid</a>, zeeman_df, magnetic_magnitude, line.<a class="code" href="classAbsorption_1_1SingleLine.html#a842d8319d70a0804efb38c4d78b6123d">F0</a>(), X);</div>
<div class="line"><a name="l00138"></a><span class="lineno">  138</span>&#160;      <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00139"></a><span class="lineno">  139</span>&#160;  }</div>
<div class="line"><a name="l00140"></a><span class="lineno">  140</span>&#160; </div>
<div class="line"><a name="l00141"></a><span class="lineno">  141</span>&#160;  <span class="keywordflow">switch</span> (mirroring_type) {</div>
<div class="line"><a name="l00142"></a><span class="lineno">  142</span>&#160;    <span class="keywordflow">case</span> Absorption::MirroringType::None:</div>
<div class="line"><a name="l00143"></a><span class="lineno">  143</span>&#160;    <span class="keywordflow">case</span> <a class="code" href="namespaceAbsorption.html#a5141982a7f8f641008a0b481aedeefcda6adf97f83acf6453d4a6a4b1070f3754">Absorption::MirroringType::Manual</a>:</div>
<div class="line"><a name="l00144"></a><span class="lineno">  144</span>&#160;      <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00145"></a><span class="lineno">  145</span>&#160;    <span class="keywordflow">case</span> Absorption::MirroringType::Lorentz: {</div>
<div class="line"><a name="l00146"></a><span class="lineno">  146</span>&#160;      <span class="comment">// Set the mirroring computational vectors and size them as needed</span></div>
<div class="line"><a name="l00147"></a><span class="lineno">  147</span>&#160;      Eigen::VectorXcd Fm(F.size());</div>
<div class="line"><a name="l00148"></a><span class="lineno">  148</span>&#160; </div>
<div class="line"><a name="l00149"></a><span class="lineno">  149</span>&#160;      <a class="code" href="namespaceLinefunctions.html#a21f46f004118c4c6c1b41e87ade1ed3c">set_lorentz</a>(Fm,</div>
<div class="line"><a name="l00150"></a><span class="lineno">  150</span>&#160;                  dF,</div>
<div class="line"><a name="l00151"></a><span class="lineno">  151</span>&#160;                  <a class="code" href="arts__api__classes_8cc.html#a126b511d17f5ccbef11bde3a65df2430">data</a>,</div>
<div class="line"><a name="l00152"></a><span class="lineno">  152</span>&#160;                  <a class="code" href="namespaceARTS_1_1Var.html#a656f34b4c40189bd3c971e2d3dbe3b95">f_grid</a>,</div>
<div class="line"><a name="l00153"></a><span class="lineno">  153</span>&#160;                  -zeeman_df,</div>
<div class="line"><a name="l00154"></a><span class="lineno">  154</span>&#160;                  magnetic_magnitude,</div>
<div class="line"><a name="l00155"></a><span class="lineno">  155</span>&#160;                  -line.<a class="code" href="classAbsorption_1_1SingleLine.html#a842d8319d70a0804efb38c4d78b6123d">F0</a>(),</div>
<div class="line"><a name="l00156"></a><span class="lineno">  156</span>&#160;                  <a class="code" href="namespaceLineShape.html#a26c4f90566ac48b736e82edb6625880b">LineShape::mirroredOutput</a>(X));</div>
<div class="line"><a name="l00157"></a><span class="lineno">  157</span>&#160; </div>
<div class="line"><a name="l00158"></a><span class="lineno">  158</span>&#160;      <span class="comment">// Apply mirroring;  FIXME: Add conjugate?</span></div>
<div class="line"><a name="l00159"></a><span class="lineno">  159</span>&#160;      F.noalias() += Fm;</div>
<div class="line"><a name="l00160"></a><span class="lineno">  160</span>&#160;    } <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00161"></a><span class="lineno">  161</span>&#160;    <span class="keywordflow">case</span> Absorption::MirroringType::SameAsLineShape: {</div>
<div class="line"><a name="l00162"></a><span class="lineno">  162</span>&#160;      <span class="comment">// Set the mirroring computational vectors and size them as needed</span></div>
<div class="line"><a name="l00163"></a><span class="lineno">  163</span>&#160;      Eigen::VectorXcd Fm(F.size());</div>
<div class="line"><a name="l00164"></a><span class="lineno">  164</span>&#160; </div>
<div class="line"><a name="l00165"></a><span class="lineno">  165</span>&#160;      <span class="keywordflow">switch</span> (lineshape_type) {</div>
<div class="line"><a name="l00166"></a><span class="lineno">  166</span>&#160;        <span class="keywordflow">case</span> LineShape::Type::DP:</div>
<div class="line"><a name="l00167"></a><span class="lineno">  167</span>&#160;          <a class="code" href="namespaceLinefunctions.html#a5f38e52b80fafd947d2df8d1a3f082ef">set_doppler</a>(Fm,</div>
<div class="line"><a name="l00168"></a><span class="lineno">  168</span>&#160;                      dF,</div>
<div class="line"><a name="l00169"></a><span class="lineno">  169</span>&#160;                      <a class="code" href="arts__api__classes_8cc.html#a126b511d17f5ccbef11bde3a65df2430">data</a>,</div>
<div class="line"><a name="l00170"></a><span class="lineno">  170</span>&#160;                      <a class="code" href="namespaceARTS_1_1Var.html#a656f34b4c40189bd3c971e2d3dbe3b95">f_grid</a>,</div>
<div class="line"><a name="l00171"></a><span class="lineno">  171</span>&#160;                      -zeeman_df,</div>
<div class="line"><a name="l00172"></a><span class="lineno">  172</span>&#160;                      magnetic_magnitude,</div>
<div class="line"><a name="l00173"></a><span class="lineno">  173</span>&#160;                      -line.<a class="code" href="classAbsorption_1_1SingleLine.html#a842d8319d70a0804efb38c4d78b6123d">F0</a>(),</div>
<div class="line"><a name="l00174"></a><span class="lineno">  174</span>&#160;                      -doppler_constant);</div>
<div class="line"><a name="l00175"></a><span class="lineno">  175</span>&#160;          <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00176"></a><span class="lineno">  176</span>&#160;        <span class="keywordflow">case</span> LineShape::Type::LP:</div>
<div class="line"><a name="l00177"></a><span class="lineno">  177</span>&#160;          <a class="code" href="namespaceLinefunctions.html#a21f46f004118c4c6c1b41e87ade1ed3c">set_lorentz</a>(Fm,</div>
<div class="line"><a name="l00178"></a><span class="lineno">  178</span>&#160;                      dF,</div>
<div class="line"><a name="l00179"></a><span class="lineno">  179</span>&#160;                      <a class="code" href="arts__api__classes_8cc.html#a126b511d17f5ccbef11bde3a65df2430">data</a>,</div>
<div class="line"><a name="l00180"></a><span class="lineno">  180</span>&#160;                      <a class="code" href="namespaceARTS_1_1Var.html#a656f34b4c40189bd3c971e2d3dbe3b95">f_grid</a>,</div>
<div class="line"><a name="l00181"></a><span class="lineno">  181</span>&#160;                      -zeeman_df,</div>
<div class="line"><a name="l00182"></a><span class="lineno">  182</span>&#160;                      magnetic_magnitude,</div>
<div class="line"><a name="l00183"></a><span class="lineno">  183</span>&#160;                      -line.<a class="code" href="classAbsorption_1_1SingleLine.html#a842d8319d70a0804efb38c4d78b6123d">F0</a>(),</div>
<div class="line"><a name="l00184"></a><span class="lineno">  184</span>&#160;                      <a class="code" href="namespaceLineShape.html#a26c4f90566ac48b736e82edb6625880b">LineShape::mirroredOutput</a>(X));</div>
<div class="line"><a name="l00185"></a><span class="lineno">  185</span>&#160;          <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00186"></a><span class="lineno">  186</span>&#160;        <span class="keywordflow">case</span> LineShape::Type::VP:</div>
<div class="line"><a name="l00187"></a><span class="lineno">  187</span>&#160;          <a class="code" href="namespaceLinefunctions.html#a9bab2edaa2740b7379fb568376859121">set_voigt</a>(Fm,</div>
<div class="line"><a name="l00188"></a><span class="lineno">  188</span>&#160;                    dF,</div>
<div class="line"><a name="l00189"></a><span class="lineno">  189</span>&#160;                    <a class="code" href="arts__api__classes_8cc.html#a126b511d17f5ccbef11bde3a65df2430">data</a>,</div>
<div class="line"><a name="l00190"></a><span class="lineno">  190</span>&#160;                    <a class="code" href="namespaceARTS_1_1Var.html#a656f34b4c40189bd3c971e2d3dbe3b95">f_grid</a>,</div>
<div class="line"><a name="l00191"></a><span class="lineno">  191</span>&#160;                    -zeeman_df,</div>
<div class="line"><a name="l00192"></a><span class="lineno">  192</span>&#160;                    magnetic_magnitude,</div>
<div class="line"><a name="l00193"></a><span class="lineno">  193</span>&#160;                    -line.<a class="code" href="classAbsorption_1_1SingleLine.html#a842d8319d70a0804efb38c4d78b6123d">F0</a>(),</div>
<div class="line"><a name="l00194"></a><span class="lineno">  194</span>&#160;                    -doppler_constant,</div>
<div class="line"><a name="l00195"></a><span class="lineno">  195</span>&#160;                    <a class="code" href="namespaceLineShape.html#a26c4f90566ac48b736e82edb6625880b">LineShape::mirroredOutput</a>(X));</div>
<div class="line"><a name="l00196"></a><span class="lineno">  196</span>&#160;          <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00197"></a><span class="lineno">  197</span>&#160;        <span class="keywordflow">case</span> <a class="code" href="namespaceLineShape.html#a14ae23ee5f35836ee9ca4d3d90c4e14dae2fca8135c2fadca093abd79a6b1c0d2">LineShape::Type::HTP</a>:</div>
<div class="line"><a name="l00198"></a><span class="lineno">  198</span>&#160;        <span class="keywordflow">case</span> LineShape::Type::SDVP:</div>
<div class="line"><a name="l00199"></a><span class="lineno">  199</span>&#160;          <span class="comment">// WARNING: This mirroring is not tested and it might require, e.g., FVC to be treated differently</span></div>
<div class="line"><a name="l00200"></a><span class="lineno">  200</span>&#160;          <a class="code" href="namespaceLinefunctions.html#aa63d54039a4b96c9ca7f74524c1baa73">set_htp</a>(Fm,</div>
<div class="line"><a name="l00201"></a><span class="lineno">  201</span>&#160;                  dF,</div>
<div class="line"><a name="l00202"></a><span class="lineno">  202</span>&#160;                  <a class="code" href="namespaceARTS_1_1Var.html#a656f34b4c40189bd3c971e2d3dbe3b95">f_grid</a>,</div>
<div class="line"><a name="l00203"></a><span class="lineno">  203</span>&#160;                  -zeeman_df,</div>
<div class="line"><a name="l00204"></a><span class="lineno">  204</span>&#160;                  magnetic_magnitude,</div>
<div class="line"><a name="l00205"></a><span class="lineno">  205</span>&#160;                  -line.<a class="code" href="classAbsorption_1_1SingleLine.html#a842d8319d70a0804efb38c4d78b6123d">F0</a>(),</div>
<div class="line"><a name="l00206"></a><span class="lineno">  206</span>&#160;                  -doppler_constant,</div>
<div class="line"><a name="l00207"></a><span class="lineno">  207</span>&#160;                  <a class="code" href="namespaceLineShape.html#a26c4f90566ac48b736e82edb6625880b">LineShape::mirroredOutput</a>(X));</div>
<div class="line"><a name="l00208"></a><span class="lineno">  208</span>&#160;          <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00209"></a><span class="lineno">  209</span>&#160;      }</div>
<div class="line"><a name="l00210"></a><span class="lineno">  210</span>&#160; </div>
<div class="line"><a name="l00211"></a><span class="lineno">  211</span>&#160;      F.noalias() += Fm;</div>
<div class="line"><a name="l00212"></a><span class="lineno">  212</span>&#160;      <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00213"></a><span class="lineno">  213</span>&#160;    }</div>
<div class="line"><a name="l00214"></a><span class="lineno">  214</span>&#160;  }</div>
<div class="line"><a name="l00215"></a><span class="lineno">  215</span>&#160; </div>
<div class="line"><a name="l00216"></a><span class="lineno">  216</span>&#160;  <span class="comment">// Line normalization if necessary</span></div>
<div class="line"><a name="l00217"></a><span class="lineno">  217</span>&#160;  <span class="comment">// The user sets this by setting LSM LNT followed by a type</span></div>
<div class="line"><a name="l00218"></a><span class="lineno">  218</span>&#160;  <span class="comment">// that is internally interpreted to mean some kind of lineshape normalization</span></div>
<div class="line"><a name="l00219"></a><span class="lineno">  219</span>&#160;  <span class="keywordflow">switch</span> (norm_type) {</div>
<div class="line"><a name="l00220"></a><span class="lineno">  220</span>&#160;    <span class="keywordflow">case</span> Absorption::NormalizationType::None:</div>
<div class="line"><a name="l00221"></a><span class="lineno">  221</span>&#160;      <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00222"></a><span class="lineno">  222</span>&#160;    <span class="keywordflow">case</span> Absorption::NormalizationType::VVH:</div>
<div class="line"><a name="l00223"></a><span class="lineno">  223</span>&#160;      <a class="code" href="namespaceLinefunctions.html#ae5c4fd8eada1c26b407af64b27cc6413">apply_VVH_scaling</a>(F, dF, <a class="code" href="arts__api__classes_8cc.html#a126b511d17f5ccbef11bde3a65df2430">data</a>, <a class="code" href="namespaceARTS_1_1Var.html#a656f34b4c40189bd3c971e2d3dbe3b95">f_grid</a>, line.<a class="code" href="classAbsorption_1_1SingleLine.html#a842d8319d70a0804efb38c4d78b6123d">F0</a>(), temperature);</div>
<div class="line"><a name="l00224"></a><span class="lineno">  224</span>&#160;      <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00225"></a><span class="lineno">  225</span>&#160;    <span class="keywordflow">case</span> Absorption::NormalizationType::VVW:</div>
<div class="line"><a name="l00226"></a><span class="lineno">  226</span>&#160;      <a class="code" href="namespaceLinefunctions.html#a5505c9892e2f020db13b06845baf639b">apply_VVW_scaling</a>(F, dF, <a class="code" href="namespaceARTS_1_1Var.html#a656f34b4c40189bd3c971e2d3dbe3b95">f_grid</a>, line.<a class="code" href="classAbsorption_1_1SingleLine.html#a842d8319d70a0804efb38c4d78b6123d">F0</a>());</div>
<div class="line"><a name="l00227"></a><span class="lineno">  227</span>&#160;      <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00228"></a><span class="lineno">  228</span>&#160;    <span class="keywordflow">case</span> <a class="code" href="namespaceAbsorption.html#ae579c0918cccbeb83040cf46fad87965a6adf97f83acf6453d4a6a4b1070f3754">Absorption::NormalizationType::RosenkranzQuadratic</a>:</div>
<div class="line"><a name="l00229"></a><span class="lineno">  229</span>&#160;      <a class="code" href="namespaceLinefunctions.html#ae6818a5213b049a8a8e1464040531b7c">apply_rosenkranz_quadratic_scaling</a>(F, dF, <a class="code" href="namespaceARTS_1_1Var.html#a656f34b4c40189bd3c971e2d3dbe3b95">f_grid</a>, line.<a class="code" href="classAbsorption_1_1SingleLine.html#a842d8319d70a0804efb38c4d78b6123d">F0</a>(), temperature);</div>
<div class="line"><a name="l00230"></a><span class="lineno">  230</span>&#160;      <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00231"></a><span class="lineno">  231</span>&#160;  }</div>
<div class="line"><a name="l00232"></a><span class="lineno">  232</span>&#160;}</div>
<div class="line"><a name="l00233"></a><span class="lineno">  233</span>&#160; </div>
<div class="line"><a name="l00234"></a><span class="lineno"><a class="line" href="namespaceLinefunctions.html#a21f46f004118c4c6c1b41e87ade1ed3c">  234</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="namespaceLinefunctions.html#a21f46f004118c4c6c1b41e87ade1ed3c">Linefunctions::set_lorentz</a>(</div>
<div class="line"><a name="l00235"></a><span class="lineno">  235</span>&#160;    Eigen::Ref&lt;Eigen::VectorXcd&gt; F,</div>
<div class="line"><a name="l00236"></a><span class="lineno">  236</span>&#160;    Eigen::Ref&lt;Eigen::MatrixXcd&gt; dF,</div>
<div class="line"><a name="l00237"></a><span class="lineno">  237</span>&#160;    Eigen::Ref&lt;<a class="code" href="namespaceoem.html#a6dead99de47f1704cff777837f5044e9">Eigen::Matrix</a>&lt;<a class="code" href="complex_8h.html#aff1205001edf41e8e0032f18b98875e1">Complex</a>, Eigen::Dynamic, <a class="code" href="namespaceLinefunctions.html#a38c90914bad76caa9d40c7dc0053924e">ExpectedDataSize</a>()&gt;&gt; <a class="code" href="arts__api__classes_8cc.html#a126b511d17f5ccbef11bde3a65df2430">data</a>,</div>
<div class="line"><a name="l00238"></a><span class="lineno">  238</span>&#160;    <span class="keyword">const</span> Eigen::Ref&lt;const Eigen::VectorXd&gt; <a class="code" href="namespaceARTS_1_1Var.html#a656f34b4c40189bd3c971e2d3dbe3b95">f_grid</a>,</div>
<div class="line"><a name="l00239"></a><span class="lineno">  239</span>&#160;    <span class="keyword">const</span> <a class="code" href="matpack_8h.html#ad9a8dbb27c0bbea7271d916036122f6a">Numeric</a>&amp; zeeman_df,</div>
<div class="line"><a name="l00240"></a><span class="lineno">  240</span>&#160;    <span class="keyword">const</span> <a class="code" href="matpack_8h.html#ad9a8dbb27c0bbea7271d916036122f6a">Numeric</a>&amp; magnetic_magnitude,</div>
<div class="line"><a name="l00241"></a><span class="lineno">  241</span>&#160;    <span class="keyword">const</span> <a class="code" href="matpack_8h.html#ad9a8dbb27c0bbea7271d916036122f6a">Numeric</a>&amp; F0_noshift,</div>
<div class="line"><a name="l00242"></a><span class="lineno">  242</span>&#160;    <span class="keyword">const</span> <a class="code" href="structLineShape_1_1Output.html">LineShape::Output</a>&amp; lso,</div>
<div class="line"><a name="l00243"></a><span class="lineno">  243</span>&#160;    <span class="keyword">const</span> <a class="code" href="classAbsorption_1_1Lines.html">AbsorptionLines</a>&amp; band,</div>
<div class="line"><a name="l00244"></a><span class="lineno">  244</span>&#160;    <span class="keyword">const</span> <a class="code" href="matpack_8h.html#aedca4b4670b166565b5b40c700d65a7c">Index</a>&amp; line_ind,</div>
<div class="line"><a name="l00245"></a><span class="lineno">  245</span>&#160;    <span class="keyword">const</span> <a class="code" href="classArray.html">ArrayOfRetrievalQuantity</a>&amp; derivatives_data,</div>
<div class="line"><a name="l00246"></a><span class="lineno">  246</span>&#160;    <span class="keyword">const</span> <a class="code" href="classArray.html">ArrayOfIndex</a>&amp; derivatives_data_position,</div>
<div class="line"><a name="l00247"></a><span class="lineno">  247</span>&#160;    <span class="keyword">const</span> <a class="code" href="structLineShape_1_1Output.html">LineShape::Output</a>&amp; dT,</div>
<div class="line"><a name="l00248"></a><span class="lineno">  248</span>&#160;    <span class="keyword">const</span> <a class="code" href="structLineShape_1_1Output.html">LineShape::Output</a>&amp; dVMR) {</div>
<div class="line"><a name="l00249"></a><span class="lineno">  249</span>&#160;  constexpr <a class="code" href="complex_8h.html#aff1205001edf41e8e0032f18b98875e1">Complex</a> cpi(0, Constant::pi);</div>
<div class="line"><a name="l00250"></a><span class="lineno">  250</span>&#160;  constexpr <a class="code" href="complex_8h.html#aff1205001edf41e8e0032f18b98875e1">Complex</a> iz(0.0, 1.0);</div>
<div class="line"><a name="l00251"></a><span class="lineno">  251</span>&#160; </div>
<div class="line"><a name="l00252"></a><span class="lineno">  252</span>&#160;  <span class="comment">// Size of the problem</span></div>
<div class="line"><a name="l00253"></a><span class="lineno">  253</span>&#160;  <span class="keyword">auto</span> nppd = derivatives_data_position.<a class="code" href="classArray.html#a90ce1cf3f99646da9d0efd6e8a661369">nelem</a>();</div>
<div class="line"><a name="l00254"></a><span class="lineno">  254</span>&#160; </div>
<div class="line"><a name="l00255"></a><span class="lineno">  255</span>&#160;  <span class="comment">// The central frequency</span></div>
<div class="line"><a name="l00256"></a><span class="lineno">  256</span>&#160;  <span class="keyword">const</span> <a class="code" href="matpack_8h.html#ad9a8dbb27c0bbea7271d916036122f6a">Numeric</a> <a class="code" href="arts__api__classes_8cc.html#afa1d4d1245df45b0d97cf72f5a58120d">F0</a> = F0_noshift + lso.<a class="code" href="structLineShape_1_1Output.html#a27e680e79ddf308a7fd460fb6fa4260b">D0</a> + zeeman_df * magnetic_magnitude + lso.<a class="code" href="structLineShape_1_1Output.html#aa05967f3fcfed19e4136b4b08ce4f3d9">DV</a>;</div>
<div class="line"><a name="l00257"></a><span class="lineno">  257</span>&#160; </div>
<div class="line"><a name="l00258"></a><span class="lineno">  258</span>&#160;  <span class="comment">// Naming req data blocks</span></div>
<div class="line"><a name="l00259"></a><span class="lineno">  259</span>&#160;  <span class="keyword">auto</span> z = <a class="code" href="arts__api__classes_8cc.html#a126b511d17f5ccbef11bde3a65df2430">data</a>.col(0);</div>
<div class="line"><a name="l00260"></a><span class="lineno">  260</span>&#160;  <span class="keyword">auto</span> <a class="code" href="linefunctions_8cc.html#a08f2b520b433833c0d7ca264f305380e">dw</a> = <a class="code" href="arts__api__classes_8cc.html#a126b511d17f5ccbef11bde3a65df2430">data</a>.col(1);</div>
<div class="line"><a name="l00261"></a><span class="lineno">  261</span>&#160; </div>
<div class="line"><a name="l00262"></a><span class="lineno">  262</span>&#160;  z.noalias() =</div>
<div class="line"><a name="l00263"></a><span class="lineno">  263</span>&#160;      (Constant::pi * <a class="code" href="complex_8h.html#aff1205001edf41e8e0032f18b98875e1">Complex</a>(lso.<a class="code" href="structLineShape_1_1Output.html#a54962db9fb1d03de52eb33fe6fbc4bce">G0</a>, <a class="code" href="arts__api__classes_8cc.html#afa1d4d1245df45b0d97cf72f5a58120d">F0</a>) - cpi * <a class="code" href="namespaceARTS_1_1Var.html#a656f34b4c40189bd3c971e2d3dbe3b95">f_grid</a>.array()).matrix();</div>
<div class="line"><a name="l00264"></a><span class="lineno">  264</span>&#160;  F.noalias() = z.cwiseInverse();</div>
<div class="line"><a name="l00265"></a><span class="lineno">  265</span>&#160; </div>
<div class="line"><a name="l00266"></a><span class="lineno">  266</span>&#160;  <span class="keywordflow">if</span> (nppd) {</div>
<div class="line"><a name="l00267"></a><span class="lineno">  267</span>&#160;    <a class="code" href="linefunctions_8cc.html#a08f2b520b433833c0d7ca264f305380e">dw</a>.noalias() = -Constant::pi * F.array().square().matrix();</div>
<div class="line"><a name="l00268"></a><span class="lineno">  268</span>&#160; </div>
<div class="line"><a name="l00269"></a><span class="lineno">  269</span>&#160;    <span class="keywordflow">for</span> (<span class="keyword">auto</span> iq = 0; iq &lt; nppd; iq++) {</div>
<div class="line"><a name="l00270"></a><span class="lineno">  270</span>&#160;      <span class="keyword">const</span> <span class="keyword">auto</span>&amp; deriv = derivatives_data[derivatives_data_position[iq]];</div>
<div class="line"><a name="l00271"></a><span class="lineno">  271</span>&#160; </div>
<div class="line"><a name="l00272"></a><span class="lineno">  272</span>&#160;      <span class="keywordflow">if</span> (deriv == JacPropMatType::Temperature)</div>
<div class="line"><a name="l00273"></a><span class="lineno">  273</span>&#160;        dF.col(iq).noalias() = <a class="code" href="complex_8h.html#aff1205001edf41e8e0032f18b98875e1">Complex</a>(dT.<a class="code" href="structLineShape_1_1Output.html#a54962db9fb1d03de52eb33fe6fbc4bce">G0</a>, dT.<a class="code" href="structLineShape_1_1Output.html#a27e680e79ddf308a7fd460fb6fa4260b">D0</a> + dT.<a class="code" href="structLineShape_1_1Output.html#aa05967f3fcfed19e4136b4b08ce4f3d9">DV</a>) * <a class="code" href="linefunctions_8cc.html#a08f2b520b433833c0d7ca264f305380e">dw</a>;</div>
<div class="line"><a name="l00274"></a><span class="lineno">  274</span>&#160;      <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="jacobian_8cc.html#ad59138aabb0d611ff16659b4fd93858a">is_frequency_parameter</a>(deriv))</div>
<div class="line"><a name="l00275"></a><span class="lineno">  275</span>&#160;        dF.col(iq).noalias() = -iz * <a class="code" href="linefunctions_8cc.html#a08f2b520b433833c0d7ca264f305380e">dw</a>;</div>
<div class="line"><a name="l00276"></a><span class="lineno">  276</span>&#160;      <span class="keywordflow">else</span> <span class="keywordflow">if</span> ((deriv == JacPropMatType::LineCenter or</div>
<div class="line"><a name="l00277"></a><span class="lineno">  277</span>&#160;                <a class="code" href="jacobian_8h.html#a3474c8d090490d53760e68212355300e">is_pressure_broadening_DV</a>(deriv)) and</div>
<div class="line"><a name="l00278"></a><span class="lineno">  278</span>&#160;                <a class="code" href="namespaceAbsorption.html#a1554ecf51c40489e7f2a9f77a3314511">Absorption::id_in_line</a>(band, deriv.<a class="code" href="classAbsorption_1_1Lines.html#acadb529b972003acc1e782d855bdaa08">QuantumIdentity</a>(), line_ind))</div>
<div class="line"><a name="l00279"></a><span class="lineno">  279</span>&#160;        dF.col(iq).noalias() = iz * <a class="code" href="linefunctions_8cc.html#a08f2b520b433833c0d7ca264f305380e">dw</a>;</div>
<div class="line"><a name="l00280"></a><span class="lineno">  280</span>&#160;      <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="jacobian_8h.html#a4bea1e519152d28026876d006f372ac4">is_pressure_broadening_G0</a>(deriv) and</div>
<div class="line"><a name="l00281"></a><span class="lineno">  281</span>&#160;        <a class="code" href="namespaceAbsorption.html#a1554ecf51c40489e7f2a9f77a3314511">Absorption::id_in_line</a>(band, deriv.<a class="code" href="classAbsorption_1_1Lines.html#acadb529b972003acc1e782d855bdaa08">QuantumIdentity</a>(), line_ind))</div>
<div class="line"><a name="l00282"></a><span class="lineno">  282</span>&#160;        dF.col(iq).noalias() = <a class="code" href="linefunctions_8cc.html#a08f2b520b433833c0d7ca264f305380e">dw</a>;</div>
<div class="line"><a name="l00283"></a><span class="lineno">  283</span>&#160;      <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="jacobian_8h.html#a10cc5eb98e966a4d466ae1f56a7356a4">is_pressure_broadening_D0</a>(deriv) and</div>
<div class="line"><a name="l00284"></a><span class="lineno">  284</span>&#160;        <a class="code" href="namespaceAbsorption.html#a1554ecf51c40489e7f2a9f77a3314511">Absorption::id_in_line</a>(band, deriv.<a class="code" href="classAbsorption_1_1Lines.html#acadb529b972003acc1e782d855bdaa08">QuantumIdentity</a>(), line_ind))</div>
<div class="line"><a name="l00285"></a><span class="lineno">  285</span>&#160;        dF.col(iq).noalias() = iz * <a class="code" href="linefunctions_8cc.html#a08f2b520b433833c0d7ca264f305380e">dw</a>;</div>
<div class="line"><a name="l00286"></a><span class="lineno">  286</span>&#160;      <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="jacobian_8cc.html#a5ad6fcd20dc6e691e408d497934760d8">is_magnetic_parameter</a>(deriv))</div>
<div class="line"><a name="l00287"></a><span class="lineno">  287</span>&#160;        dF.col(iq).noalias() = iz * zeeman_df * <a class="code" href="linefunctions_8cc.html#a08f2b520b433833c0d7ca264f305380e">dw</a>;</div>
<div class="line"><a name="l00288"></a><span class="lineno">  288</span>&#160;      <span class="keywordflow">else</span> <span class="keywordflow">if</span> (deriv == JacPropMatType::VMR) {</div>
<div class="line"><a name="l00289"></a><span class="lineno">  289</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="namespaceAbsorption.html#a1554ecf51c40489e7f2a9f77a3314511">Absorption::id_in_line</a>(band, deriv.<a class="code" href="classAbsorption_1_1Lines.html#acadb529b972003acc1e782d855bdaa08">QuantumIdentity</a>(), line_ind))</div>
<div class="line"><a name="l00290"></a><span class="lineno">  290</span>&#160;          dF.col(iq).noalias() = <a class="code" href="complex_8h.html#aff1205001edf41e8e0032f18b98875e1">Complex</a>(dVMR.<a class="code" href="structLineShape_1_1Output.html#a54962db9fb1d03de52eb33fe6fbc4bce">G0</a>, dVMR.<a class="code" href="structLineShape_1_1Output.html#a27e680e79ddf308a7fd460fb6fa4260b">D0</a> + dVMR.<a class="code" href="structLineShape_1_1Output.html#aa05967f3fcfed19e4136b4b08ce4f3d9">DV</a>) * <a class="code" href="linefunctions_8cc.html#a08f2b520b433833c0d7ca264f305380e">dw</a>;</div>
<div class="line"><a name="l00291"></a><span class="lineno">  291</span>&#160;        <span class="keywordflow">else</span></div>
<div class="line"><a name="l00292"></a><span class="lineno">  292</span>&#160;          dF.col(iq).setZero();</div>
<div class="line"><a name="l00293"></a><span class="lineno">  293</span>&#160;      }</div>
<div class="line"><a name="l00294"></a><span class="lineno">  294</span>&#160;    }</div>
<div class="line"><a name="l00295"></a><span class="lineno">  295</span>&#160;  }</div>
<div class="line"><a name="l00296"></a><span class="lineno">  296</span>&#160;}</div>
<div class="line"><a name="l00297"></a><span class="lineno">  297</span>&#160; </div>
<div class="line"><a name="l00298"></a><span class="lineno"><a class="line" href="namespaceLinefunctions.html#a9bab2edaa2740b7379fb568376859121">  298</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="namespaceLinefunctions.html#a9bab2edaa2740b7379fb568376859121">Linefunctions::set_voigt</a>(</div>
<div class="line"><a name="l00299"></a><span class="lineno">  299</span>&#160;    Eigen::Ref&lt;Eigen::VectorXcd&gt; F,</div>
<div class="line"><a name="l00300"></a><span class="lineno">  300</span>&#160;    Eigen::Ref&lt;Eigen::MatrixXcd&gt; dF,</div>
<div class="line"><a name="l00301"></a><span class="lineno">  301</span>&#160;    Eigen::Ref&lt;<a class="code" href="namespaceoem.html#a6dead99de47f1704cff777837f5044e9">Eigen::Matrix</a>&lt;<a class="code" href="complex_8h.html#aff1205001edf41e8e0032f18b98875e1">Complex</a>, Eigen::Dynamic, <a class="code" href="namespaceLinefunctions.html#a38c90914bad76caa9d40c7dc0053924e">ExpectedDataSize</a>()&gt;&gt; <a class="code" href="arts__api__classes_8cc.html#a126b511d17f5ccbef11bde3a65df2430">data</a>,</div>
<div class="line"><a name="l00302"></a><span class="lineno">  302</span>&#160;    <span class="keyword">const</span> Eigen::Ref&lt;const Eigen::VectorXd&gt; <a class="code" href="namespaceARTS_1_1Var.html#a656f34b4c40189bd3c971e2d3dbe3b95">f_grid</a>,</div>
<div class="line"><a name="l00303"></a><span class="lineno">  303</span>&#160;    <span class="keyword">const</span> <a class="code" href="matpack_8h.html#ad9a8dbb27c0bbea7271d916036122f6a">Numeric</a>&amp; zeeman_df,</div>
<div class="line"><a name="l00304"></a><span class="lineno">  304</span>&#160;    <span class="keyword">const</span> <a class="code" href="matpack_8h.html#ad9a8dbb27c0bbea7271d916036122f6a">Numeric</a>&amp; magnetic_magnitude,</div>
<div class="line"><a name="l00305"></a><span class="lineno">  305</span>&#160;    <span class="keyword">const</span> <a class="code" href="matpack_8h.html#ad9a8dbb27c0bbea7271d916036122f6a">Numeric</a>&amp; F0_noshift,</div>
<div class="line"><a name="l00306"></a><span class="lineno">  306</span>&#160;    <span class="keyword">const</span> <a class="code" href="matpack_8h.html#ad9a8dbb27c0bbea7271d916036122f6a">Numeric</a>&amp; GD_div_F0,</div>
<div class="line"><a name="l00307"></a><span class="lineno">  307</span>&#160;    <span class="keyword">const</span> <a class="code" href="structLineShape_1_1Output.html">LineShape::Output</a>&amp; lso,</div>
<div class="line"><a name="l00308"></a><span class="lineno">  308</span>&#160;    <span class="keyword">const</span> <a class="code" href="classAbsorption_1_1Lines.html">AbsorptionLines</a>&amp; band,</div>
<div class="line"><a name="l00309"></a><span class="lineno">  309</span>&#160;    <span class="keyword">const</span> <a class="code" href="matpack_8h.html#aedca4b4670b166565b5b40c700d65a7c">Index</a>&amp; line_ind,</div>
<div class="line"><a name="l00310"></a><span class="lineno">  310</span>&#160;    <span class="keyword">const</span> <a class="code" href="classArray.html">ArrayOfRetrievalQuantity</a>&amp; derivatives_data,</div>
<div class="line"><a name="l00311"></a><span class="lineno">  311</span>&#160;    <span class="keyword">const</span> <a class="code" href="classArray.html">ArrayOfIndex</a>&amp; derivatives_data_position,</div>
<div class="line"><a name="l00312"></a><span class="lineno">  312</span>&#160;    <span class="keyword">const</span> <a class="code" href="matpack_8h.html#ad9a8dbb27c0bbea7271d916036122f6a">Numeric</a>&amp; dGD_div_F0_dT,</div>
<div class="line"><a name="l00313"></a><span class="lineno">  313</span>&#160;    <span class="keyword">const</span> <a class="code" href="structLineShape_1_1Output.html">LineShape::Output</a>&amp; dT,</div>
<div class="line"><a name="l00314"></a><span class="lineno">  314</span>&#160;    <span class="keyword">const</span> <a class="code" href="structLineShape_1_1Output.html">LineShape::Output</a>&amp; dVMR) {</div>
<div class="line"><a name="l00315"></a><span class="lineno">  315</span>&#160;  constexpr <a class="code" href="complex_8h.html#aff1205001edf41e8e0032f18b98875e1">Complex</a> iz(0.0, 1.0);</div>
<div class="line"><a name="l00316"></a><span class="lineno">  316</span>&#160; </div>
<div class="line"><a name="l00317"></a><span class="lineno">  317</span>&#160;  <span class="comment">// Size of problem</span></div>
<div class="line"><a name="l00318"></a><span class="lineno">  318</span>&#160;  <span class="keyword">auto</span> nppd = derivatives_data_position.<a class="code" href="classArray.html#a90ce1cf3f99646da9d0efd6e8a661369">nelem</a>();</div>
<div class="line"><a name="l00319"></a><span class="lineno">  319</span>&#160; </div>
<div class="line"><a name="l00320"></a><span class="lineno">  320</span>&#160;  <span class="comment">// Doppler broadening and line center</span></div>
<div class="line"><a name="l00321"></a><span class="lineno">  321</span>&#160;  <span class="keyword">const</span> <a class="code" href="matpack_8h.html#ad9a8dbb27c0bbea7271d916036122f6a">Numeric</a> <a class="code" href="arts__api__classes_8cc.html#afa1d4d1245df45b0d97cf72f5a58120d">F0</a> = F0_noshift + zeeman_df * magnetic_magnitude + lso.<a class="code" href="structLineShape_1_1Output.html#a27e680e79ddf308a7fd460fb6fa4260b">D0</a> + lso.<a class="code" href="structLineShape_1_1Output.html#aa05967f3fcfed19e4136b4b08ce4f3d9">DV</a>;</div>
<div class="line"><a name="l00322"></a><span class="lineno">  322</span>&#160;  <span class="keyword">const</span> <a class="code" href="matpack_8h.html#ad9a8dbb27c0bbea7271d916036122f6a">Numeric</a> GD = GD_div_F0 * <a class="code" href="arts__api__classes_8cc.html#afa1d4d1245df45b0d97cf72f5a58120d">F0</a>;</div>
<div class="line"><a name="l00323"></a><span class="lineno">  323</span>&#160;  <span class="keyword">const</span> <a class="code" href="matpack_8h.html#ad9a8dbb27c0bbea7271d916036122f6a">Numeric</a> invGD = 1.0 / GD;</div>
<div class="line"><a name="l00324"></a><span class="lineno">  324</span>&#160;  <span class="keyword">const</span> <a class="code" href="matpack_8h.html#ad9a8dbb27c0bbea7271d916036122f6a">Numeric</a> dGD_dT = dGD_div_F0_dT * <a class="code" href="arts__api__classes_8cc.html#afa1d4d1245df45b0d97cf72f5a58120d">F0</a> - GD_div_F0 * (dT.<a class="code" href="structLineShape_1_1Output.html#a27e680e79ddf308a7fd460fb6fa4260b">D0</a> + dT.<a class="code" href="structLineShape_1_1Output.html#aa05967f3fcfed19e4136b4b08ce4f3d9">DV</a>);</div>
<div class="line"><a name="l00325"></a><span class="lineno">  325</span>&#160; </div>
<div class="line"><a name="l00326"></a><span class="lineno">  326</span>&#160;  <span class="comment">// constant normalization factor for Voigt</span></div>
<div class="line"><a name="l00327"></a><span class="lineno">  327</span>&#160;  <span class="keyword">const</span> <a class="code" href="matpack_8h.html#ad9a8dbb27c0bbea7271d916036122f6a">Numeric</a> <a class="code" href="math__funcs_8cc.html#a3847133ed1eefacef21795b055b6cfff">fac</a> = Constant::inv_sqrt_pi * invGD;</div>
<div class="line"><a name="l00328"></a><span class="lineno">  328</span>&#160; </div>
<div class="line"><a name="l00329"></a><span class="lineno">  329</span>&#160;  <span class="comment">// Naming req data blocks</span></div>
<div class="line"><a name="l00330"></a><span class="lineno">  330</span>&#160;  <span class="keyword">auto</span> z = <a class="code" href="arts__api__classes_8cc.html#a126b511d17f5ccbef11bde3a65df2430">data</a>.col(0);</div>
<div class="line"><a name="l00331"></a><span class="lineno">  331</span>&#160;  <span class="keyword">auto</span> <a class="code" href="linefunctions_8cc.html#a08f2b520b433833c0d7ca264f305380e">dw</a> = <a class="code" href="arts__api__classes_8cc.html#a126b511d17f5ccbef11bde3a65df2430">data</a>.col(1);</div>
<div class="line"><a name="l00332"></a><span class="lineno">  332</span>&#160; </div>
<div class="line"><a name="l00333"></a><span class="lineno">  333</span>&#160;  <span class="comment">// Frequency grid</span></div>
<div class="line"><a name="l00334"></a><span class="lineno">  334</span>&#160;  z.noalias() = invGD * (<a class="code" href="complex_8h.html#aff1205001edf41e8e0032f18b98875e1">Complex</a>(-<a class="code" href="arts__api__classes_8cc.html#afa1d4d1245df45b0d97cf72f5a58120d">F0</a>, lso.<a class="code" href="structLineShape_1_1Output.html#a54962db9fb1d03de52eb33fe6fbc4bce">G0</a>) + <a class="code" href="namespaceARTS_1_1Var.html#a656f34b4c40189bd3c971e2d3dbe3b95">f_grid</a>.array()).matrix();</div>
<div class="line"><a name="l00335"></a><span class="lineno">  335</span>&#160; </div>
<div class="line"><a name="l00336"></a><span class="lineno">  336</span>&#160;  <span class="comment">// Line shape</span></div>
<div class="line"><a name="l00337"></a><span class="lineno">  337</span>&#160;  F.noalias() = <a class="code" href="math__funcs_8cc.html#a3847133ed1eefacef21795b055b6cfff">fac</a> * z.unaryExpr(&amp;<a class="code" href="linefunctions_8cc.html#a3b4555133ea360cd068890a3e3cefaf5">w</a>);</div>
<div class="line"><a name="l00338"></a><span class="lineno">  338</span>&#160; </div>
<div class="line"><a name="l00339"></a><span class="lineno">  339</span>&#160;  <span class="keywordflow">if</span> (nppd) {</div>
<div class="line"><a name="l00340"></a><span class="lineno">  340</span>&#160;    <a class="code" href="linefunctions_8cc.html#a08f2b520b433833c0d7ca264f305380e">dw</a>.noalias() = 2 * (<a class="code" href="complex_8h.html#aff1205001edf41e8e0032f18b98875e1">Complex</a>(0, <a class="code" href="math__funcs_8cc.html#a3847133ed1eefacef21795b055b6cfff">fac</a> * Constant::inv_sqrt_pi) -</div>
<div class="line"><a name="l00341"></a><span class="lineno">  341</span>&#160;                        z.cwiseProduct(F).array())</div>
<div class="line"><a name="l00342"></a><span class="lineno">  342</span>&#160;                           .matrix();</div>
<div class="line"><a name="l00343"></a><span class="lineno">  343</span>&#160; </div>
<div class="line"><a name="l00344"></a><span class="lineno">  344</span>&#160;    <span class="keywordflow">for</span> (<span class="keyword">auto</span> iq = 0; iq &lt; nppd; iq++) {</div>
<div class="line"><a name="l00345"></a><span class="lineno">  345</span>&#160;      <span class="keyword">const</span> <span class="keyword">auto</span>&amp; deriv = derivatives_data[derivatives_data_position[iq]];</div>
<div class="line"><a name="l00346"></a><span class="lineno">  346</span>&#160; </div>
<div class="line"><a name="l00347"></a><span class="lineno">  347</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="jacobian_8cc.html#ad59138aabb0d611ff16659b4fd93858a">is_frequency_parameter</a>(deriv))</div>
<div class="line"><a name="l00348"></a><span class="lineno">  348</span>&#160;        dF.col(iq).noalias() = invGD * <a class="code" href="linefunctions_8cc.html#a08f2b520b433833c0d7ca264f305380e">dw</a>;</div>
<div class="line"><a name="l00349"></a><span class="lineno">  349</span>&#160;      <span class="keywordflow">else</span> <span class="keywordflow">if</span> (deriv == JacPropMatType::Temperature)</div>
<div class="line"><a name="l00350"></a><span class="lineno">  350</span>&#160;        dF.col(iq).noalias() =</div>
<div class="line"><a name="l00351"></a><span class="lineno">  351</span>&#160;            <a class="code" href="linefunctions_8cc.html#a08f2b520b433833c0d7ca264f305380e">dw</a> * <a class="code" href="complex_8h.html#aff1205001edf41e8e0032f18b98875e1">Complex</a>(-dT.<a class="code" href="structLineShape_1_1Output.html#a27e680e79ddf308a7fd460fb6fa4260b">D0</a> - dT.<a class="code" href="structLineShape_1_1Output.html#aa05967f3fcfed19e4136b4b08ce4f3d9">DV</a>, dT.<a class="code" href="structLineShape_1_1Output.html#a54962db9fb1d03de52eb33fe6fbc4bce">G0</a>) * invGD -</div>
<div class="line"><a name="l00352"></a><span class="lineno">  352</span>&#160;            F * dGD_dT * invGD - <a class="code" href="linefunctions_8cc.html#a08f2b520b433833c0d7ca264f305380e">dw</a>.cwiseProduct(z) * dGD_dT * invGD;</div>
<div class="line"><a name="l00353"></a><span class="lineno">  353</span>&#160;      <span class="keywordflow">else</span> <span class="keywordflow">if</span> ((deriv == JacPropMatType::LineCenter or</div>
<div class="line"><a name="l00354"></a><span class="lineno">  354</span>&#160;                <a class="code" href="jacobian_8h.html#a3474c8d090490d53760e68212355300e">is_pressure_broadening_DV</a>(deriv)) and</div>
<div class="line"><a name="l00355"></a><span class="lineno">  355</span>&#160;               <a class="code" href="namespaceAbsorption.html#a1554ecf51c40489e7f2a9f77a3314511">Absorption::id_in_line</a>(band, deriv.<a class="code" href="classAbsorption_1_1Lines.html#acadb529b972003acc1e782d855bdaa08">QuantumIdentity</a>(), line_ind))</div>
<div class="line"><a name="l00356"></a><span class="lineno">  356</span>&#160;        dF.col(iq).noalias() = -F / <a class="code" href="arts__api__classes_8cc.html#afa1d4d1245df45b0d97cf72f5a58120d">F0</a> - <a class="code" href="linefunctions_8cc.html#a08f2b520b433833c0d7ca264f305380e">dw</a> * invGD - <a class="code" href="linefunctions_8cc.html#a08f2b520b433833c0d7ca264f305380e">dw</a>.cwiseProduct(z) / <a class="code" href="arts__api__classes_8cc.html#afa1d4d1245df45b0d97cf72f5a58120d">F0</a>;</div>
<div class="line"><a name="l00357"></a><span class="lineno">  357</span>&#160;      <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="jacobian_8h.html#a4bea1e519152d28026876d006f372ac4">is_pressure_broadening_G0</a>(deriv) and</div>
<div class="line"><a name="l00358"></a><span class="lineno">  358</span>&#160;               <a class="code" href="namespaceAbsorption.html#a1554ecf51c40489e7f2a9f77a3314511">Absorption::id_in_line</a>(band, deriv.<a class="code" href="classAbsorption_1_1Lines.html#acadb529b972003acc1e782d855bdaa08">QuantumIdentity</a>(), line_ind))</div>
<div class="line"><a name="l00359"></a><span class="lineno">  359</span>&#160;        dF.col(iq).noalias() = iz * <a class="code" href="linefunctions_8cc.html#a08f2b520b433833c0d7ca264f305380e">dw</a> * invGD;</div>
<div class="line"><a name="l00360"></a><span class="lineno">  360</span>&#160;      <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="jacobian_8h.html#a10cc5eb98e966a4d466ae1f56a7356a4">is_pressure_broadening_D0</a>(deriv) and</div>
<div class="line"><a name="l00361"></a><span class="lineno">  361</span>&#160;               <a class="code" href="namespaceAbsorption.html#a1554ecf51c40489e7f2a9f77a3314511">Absorption::id_in_line</a>(band, deriv.<a class="code" href="classAbsorption_1_1Lines.html#acadb529b972003acc1e782d855bdaa08">QuantumIdentity</a>(), line_ind))</div>
<div class="line"><a name="l00362"></a><span class="lineno">  362</span>&#160;        dF.col(iq).noalias() = -<a class="code" href="linefunctions_8cc.html#a08f2b520b433833c0d7ca264f305380e">dw</a> * invGD;</div>
<div class="line"><a name="l00363"></a><span class="lineno">  363</span>&#160;      <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="jacobian_8cc.html#a5ad6fcd20dc6e691e408d497934760d8">is_magnetic_parameter</a>(deriv))</div>
<div class="line"><a name="l00364"></a><span class="lineno">  364</span>&#160;        dF.col(iq).noalias() = <a class="code" href="linefunctions_8cc.html#a08f2b520b433833c0d7ca264f305380e">dw</a> * (-zeeman_df * invGD);</div>
<div class="line"><a name="l00365"></a><span class="lineno">  365</span>&#160;      <span class="keywordflow">else</span> <span class="keywordflow">if</span> (deriv == JacPropMatType::VMR and</div>
<div class="line"><a name="l00366"></a><span class="lineno">  366</span>&#160;               <a class="code" href="namespaceAbsorption.html#a1554ecf51c40489e7f2a9f77a3314511">Absorption::id_in_line</a>(band, deriv.<a class="code" href="classAbsorption_1_1Lines.html#acadb529b972003acc1e782d855bdaa08">QuantumIdentity</a>(), line_ind))</div>
<div class="line"><a name="l00367"></a><span class="lineno">  367</span>&#160;        dF.col(iq).noalias() =</div>
<div class="line"><a name="l00368"></a><span class="lineno">  368</span>&#160;            <a class="code" href="linefunctions_8cc.html#a08f2b520b433833c0d7ca264f305380e">dw</a> * <a class="code" href="complex_8h.html#aff1205001edf41e8e0032f18b98875e1">Complex</a>(-dVMR.<a class="code" href="structLineShape_1_1Output.html#a27e680e79ddf308a7fd460fb6fa4260b">D0</a> - dVMR.<a class="code" href="structLineShape_1_1Output.html#aa05967f3fcfed19e4136b4b08ce4f3d9">DV</a>, dVMR.<a class="code" href="structLineShape_1_1Output.html#a54962db9fb1d03de52eb33fe6fbc4bce">G0</a>) * invGD;</div>
<div class="line"><a name="l00369"></a><span class="lineno">  369</span>&#160;      <span class="keywordflow">else</span></div>
<div class="line"><a name="l00370"></a><span class="lineno">  370</span>&#160;        dF.col(iq).setZero();</div>
<div class="line"><a name="l00371"></a><span class="lineno">  371</span>&#160;    }</div>
<div class="line"><a name="l00372"></a><span class="lineno">  372</span>&#160;  }</div>
<div class="line"><a name="l00373"></a><span class="lineno">  373</span>&#160;}</div>
<div class="line"><a name="l00374"></a><span class="lineno">  374</span>&#160; </div>
<div class="line"><a name="l00375"></a><span class="lineno"><a class="line" href="namespaceLinefunctions.html#a5f38e52b80fafd947d2df8d1a3f082ef">  375</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="namespaceLinefunctions.html#a5f38e52b80fafd947d2df8d1a3f082ef">Linefunctions::set_doppler</a>(</div>
<div class="line"><a name="l00376"></a><span class="lineno">  376</span>&#160;    Eigen::Ref&lt;Eigen::VectorXcd&gt; F,</div>
<div class="line"><a name="l00377"></a><span class="lineno">  377</span>&#160;    Eigen::Ref&lt;Eigen::MatrixXcd&gt; dF,</div>
<div class="line"><a name="l00378"></a><span class="lineno">  378</span>&#160;    Eigen::Ref&lt;<a class="code" href="namespaceoem.html#a6dead99de47f1704cff777837f5044e9">Eigen::Matrix</a>&lt;<a class="code" href="complex_8h.html#aff1205001edf41e8e0032f18b98875e1">Complex</a>, Eigen::Dynamic, <a class="code" href="namespaceLinefunctions.html#a38c90914bad76caa9d40c7dc0053924e">ExpectedDataSize</a>()&gt;&gt; <a class="code" href="arts__api__classes_8cc.html#a126b511d17f5ccbef11bde3a65df2430">data</a>,</div>
<div class="line"><a name="l00379"></a><span class="lineno">  379</span>&#160;    <span class="keyword">const</span> Eigen::Ref&lt;const Eigen::VectorXd&gt; <a class="code" href="namespaceARTS_1_1Var.html#a656f34b4c40189bd3c971e2d3dbe3b95">f_grid</a>,</div>
<div class="line"><a name="l00380"></a><span class="lineno">  380</span>&#160;    <span class="keyword">const</span> <a class="code" href="matpack_8h.html#ad9a8dbb27c0bbea7271d916036122f6a">Numeric</a>&amp; zeeman_df,</div>
<div class="line"><a name="l00381"></a><span class="lineno">  381</span>&#160;    <span class="keyword">const</span> <a class="code" href="matpack_8h.html#ad9a8dbb27c0bbea7271d916036122f6a">Numeric</a>&amp; magnetic_magnitude,</div>
<div class="line"><a name="l00382"></a><span class="lineno">  382</span>&#160;    <span class="keyword">const</span> <a class="code" href="matpack_8h.html#ad9a8dbb27c0bbea7271d916036122f6a">Numeric</a>&amp; F0_noshift,</div>
<div class="line"><a name="l00383"></a><span class="lineno">  383</span>&#160;    <span class="keyword">const</span> <a class="code" href="matpack_8h.html#ad9a8dbb27c0bbea7271d916036122f6a">Numeric</a>&amp; GD_div_F0,</div>
<div class="line"><a name="l00384"></a><span class="lineno">  384</span>&#160;    <span class="keyword">const</span> <a class="code" href="classAbsorption_1_1Lines.html">AbsorptionLines</a>&amp; band,</div>
<div class="line"><a name="l00385"></a><span class="lineno">  385</span>&#160;    <span class="keyword">const</span> <a class="code" href="matpack_8h.html#aedca4b4670b166565b5b40c700d65a7c">Index</a>&amp; line_ind,</div>
<div class="line"><a name="l00386"></a><span class="lineno">  386</span>&#160;    <span class="keyword">const</span> <a class="code" href="classArray.html">ArrayOfRetrievalQuantity</a>&amp; derivatives_data,</div>
<div class="line"><a name="l00387"></a><span class="lineno">  387</span>&#160;    <span class="keyword">const</span> <a class="code" href="classArray.html">ArrayOfIndex</a>&amp; derivatives_data_position,</div>
<div class="line"><a name="l00388"></a><span class="lineno">  388</span>&#160;    <span class="keyword">const</span> <a class="code" href="matpack_8h.html#ad9a8dbb27c0bbea7271d916036122f6a">Numeric</a>&amp; dGD_div_F0_dT) {</div>
<div class="line"><a name="l00389"></a><span class="lineno">  389</span>&#160;  <span class="keyword">auto</span> nppd = derivatives_data_position.<a class="code" href="classArray.html#a90ce1cf3f99646da9d0efd6e8a661369">nelem</a>();</div>
<div class="line"><a name="l00390"></a><span class="lineno">  390</span>&#160; </div>
<div class="line"><a name="l00391"></a><span class="lineno">  391</span>&#160;  <span class="comment">// Doppler broadening and line center</span></div>
<div class="line"><a name="l00392"></a><span class="lineno">  392</span>&#160;  <span class="keyword">const</span> <a class="code" href="matpack_8h.html#ad9a8dbb27c0bbea7271d916036122f6a">Numeric</a> <a class="code" href="arts__api__classes_8cc.html#afa1d4d1245df45b0d97cf72f5a58120d">F0</a> = F0_noshift + zeeman_df * magnetic_magnitude;</div>
<div class="line"><a name="l00393"></a><span class="lineno">  393</span>&#160;  <span class="keyword">const</span> <a class="code" href="matpack_8h.html#ad9a8dbb27c0bbea7271d916036122f6a">Numeric</a> invGD = 1.0 / (GD_div_F0 * <a class="code" href="arts__api__classes_8cc.html#afa1d4d1245df45b0d97cf72f5a58120d">F0</a>);</div>
<div class="line"><a name="l00394"></a><span class="lineno">  394</span>&#160; </div>
<div class="line"><a name="l00395"></a><span class="lineno">  395</span>&#160;  <span class="comment">// Naming data blocks</span></div>
<div class="line"><a name="l00396"></a><span class="lineno">  396</span>&#160;  <span class="keyword">auto</span> <a class="code" href="namespaceARTS_1_1Var.html#aeb141694315061634800e0ddc30701ca">x</a> = <a class="code" href="arts__api__classes_8cc.html#a126b511d17f5ccbef11bde3a65df2430">data</a>.col(0);</div>
<div class="line"><a name="l00397"></a><span class="lineno">  397</span>&#160;  <span class="keyword">auto</span> mx2 = <a class="code" href="arts__api__classes_8cc.html#a126b511d17f5ccbef11bde3a65df2430">data</a>.col(1);</div>
<div class="line"><a name="l00398"></a><span class="lineno">  398</span>&#160; </div>
<div class="line"><a name="l00399"></a><span class="lineno">  399</span>&#160;  <a class="code" href="namespaceARTS_1_1Var.html#aeb141694315061634800e0ddc30701ca">x</a>.noalias() = (<a class="code" href="namespaceARTS_1_1Var.html#a656f34b4c40189bd3c971e2d3dbe3b95">f_grid</a>.array() - <a class="code" href="arts__api__classes_8cc.html#afa1d4d1245df45b0d97cf72f5a58120d">F0</a>).matrix() * invGD;</div>
<div class="line"><a name="l00400"></a><span class="lineno">  400</span>&#160;  mx2.noalias() = -<a class="code" href="arts__api__classes_8cc.html#a126b511d17f5ccbef11bde3a65df2430">data</a>.col(0).cwiseAbs2();</div>
<div class="line"><a name="l00401"></a><span class="lineno">  401</span>&#160;  F.noalias() = invGD * Constant::inv_sqrt_pi * mx2.array().exp().matrix();</div>
<div class="line"><a name="l00402"></a><span class="lineno">  402</span>&#160; </div>
<div class="line"><a name="l00403"></a><span class="lineno">  403</span>&#160;  <span class="keywordflow">for</span> (<span class="keyword">auto</span> iq = 0; iq &lt; nppd; iq++) {</div>
<div class="line"><a name="l00404"></a><span class="lineno">  404</span>&#160;    <span class="keyword">const</span> <span class="keyword">auto</span>&amp; deriv = derivatives_data[derivatives_data_position[iq]];</div>
<div class="line"><a name="l00405"></a><span class="lineno">  405</span>&#160; </div>
<div class="line"><a name="l00406"></a><span class="lineno">  406</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="jacobian_8cc.html#ad59138aabb0d611ff16659b4fd93858a">is_frequency_parameter</a>(deriv))</div>
<div class="line"><a name="l00407"></a><span class="lineno">  407</span>&#160;      dF.col(iq).noalias() = -2 * invGD * F.cwiseProduct(<a class="code" href="namespaceARTS_1_1Var.html#aeb141694315061634800e0ddc30701ca">x</a>);</div>
<div class="line"><a name="l00408"></a><span class="lineno">  408</span>&#160;    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (deriv == JacPropMatType::Temperature)</div>
<div class="line"><a name="l00409"></a><span class="lineno">  409</span>&#160;      dF.col(iq).noalias() =</div>
<div class="line"><a name="l00410"></a><span class="lineno">  410</span>&#160;          -dGD_div_F0_dT * <a class="code" href="arts__api__classes_8cc.html#afa1d4d1245df45b0d97cf72f5a58120d">F0</a> * invGD * (2.0 * F.cwiseProduct(mx2) + F);</div>
<div class="line"><a name="l00411"></a><span class="lineno">  411</span>&#160;    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (deriv == JacPropMatType::LineCenter and</div>
<div class="line"><a name="l00412"></a><span class="lineno">  412</span>&#160;             <a class="code" href="namespaceAbsorption.html#a1554ecf51c40489e7f2a9f77a3314511">Absorption::id_in_line</a>(band, deriv.<a class="code" href="classAbsorption_1_1Lines.html#acadb529b972003acc1e782d855bdaa08">QuantumIdentity</a>(), line_ind))</div>
<div class="line"><a name="l00413"></a><span class="lineno">  413</span>&#160;      dF.col(iq).noalias() = -F.cwiseProduct(mx2) * (2 / <a class="code" href="arts__api__classes_8cc.html#afa1d4d1245df45b0d97cf72f5a58120d">F0</a>) +</div>
<div class="line"><a name="l00414"></a><span class="lineno">  414</span>&#160;                             F.cwiseProduct(<a class="code" href="namespaceARTS_1_1Var.html#aeb141694315061634800e0ddc30701ca">x</a>) * 2 * (invGD - 1 / <a class="code" href="arts__api__classes_8cc.html#afa1d4d1245df45b0d97cf72f5a58120d">F0</a>);</div>
<div class="line"><a name="l00415"></a><span class="lineno">  415</span>&#160;    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (deriv == JacPropMatType::VMR)</div>
<div class="line"><a name="l00416"></a><span class="lineno">  416</span>&#160;      dF.col(iq).setZero();  <span class="comment">// Must reset incase other lineshapes are mixed in</span></div>
<div class="line"><a name="l00417"></a><span class="lineno">  417</span>&#160;  }</div>
<div class="line"><a name="l00418"></a><span class="lineno">  418</span>&#160;}</div>
<div class="line"><a name="l00419"></a><span class="lineno">  419</span>&#160; </div>
<div class="line"><a name="l00420"></a><span class="lineno"><a class="line" href="namespaceLinefunctions.html#a22f91962a7c5766ac5e07b245ad04577">  420</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="namespaceLinefunctions.html#a22f91962a7c5766ac5e07b245ad04577">Linefunctions::apply_linemixing_scaling_and_mirroring</a>(</div>
<div class="line"><a name="l00421"></a><span class="lineno">  421</span>&#160;    Eigen::Ref&lt;Eigen::VectorXcd&gt; F,</div>
<div class="line"><a name="l00422"></a><span class="lineno">  422</span>&#160;    Eigen::Ref&lt;Eigen::MatrixXcd&gt; dF,</div>
<div class="line"><a name="l00423"></a><span class="lineno">  423</span>&#160;    <span class="keyword">const</span> Eigen::Ref&lt;Eigen::VectorXcd&gt; Fm,</div>
<div class="line"><a name="l00424"></a><span class="lineno">  424</span>&#160;    <span class="keyword">const</span> Eigen::Ref&lt;Eigen::MatrixXcd&gt; dFm,</div>
<div class="line"><a name="l00425"></a><span class="lineno">  425</span>&#160;    <span class="keyword">const</span> <a class="code" href="structLineShape_1_1Output.html">LineShape::Output</a>&amp; X,</div>
<div class="line"><a name="l00426"></a><span class="lineno">  426</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">bool</span> with_mirroring,</div>
<div class="line"><a name="l00427"></a><span class="lineno">  427</span>&#160;    <span class="keyword">const</span> <a class="code" href="classAbsorption_1_1Lines.html">AbsorptionLines</a>&amp; band,</div>
<div class="line"><a name="l00428"></a><span class="lineno">  428</span>&#160;    <span class="keyword">const</span> <a class="code" href="matpack_8h.html#aedca4b4670b166565b5b40c700d65a7c">Index</a>&amp; line_ind,</div>
<div class="line"><a name="l00429"></a><span class="lineno">  429</span>&#160;    <span class="keyword">const</span> <a class="code" href="classArray.html">ArrayOfRetrievalQuantity</a>&amp; derivatives_data,</div>
<div class="line"><a name="l00430"></a><span class="lineno">  430</span>&#160;    <span class="keyword">const</span> <a class="code" href="classArray.html">ArrayOfIndex</a>&amp; derivatives_data_position,</div>
<div class="line"><a name="l00431"></a><span class="lineno">  431</span>&#160;    <span class="keyword">const</span> <a class="code" href="structLineShape_1_1Output.html">LineShape::Output</a>&amp; dT,</div>
<div class="line"><a name="l00432"></a><span class="lineno">  432</span>&#160;    <span class="keyword">const</span> <a class="code" href="structLineShape_1_1Output.html">LineShape::Output</a>&amp; dVMR) {</div>
<div class="line"><a name="l00433"></a><span class="lineno">  433</span>&#160;  <span class="keyword">auto</span> nppd = derivatives_data_position.<a class="code" href="classArray.html#a90ce1cf3f99646da9d0efd6e8a661369">nelem</a>();</div>
<div class="line"><a name="l00434"></a><span class="lineno">  434</span>&#160; </div>
<div class="line"><a name="l00435"></a><span class="lineno">  435</span>&#160;  <span class="keyword">const</span> <a class="code" href="complex_8h.html#aff1205001edf41e8e0032f18b98875e1">Complex</a> <a class="code" href="namespaceoem.html#a5572926b564f0e50c8c63ddc36f68bb1">LM</a> = <a class="code" href="complex_8h.html#aff1205001edf41e8e0032f18b98875e1">Complex</a>(1.0 + X.<a class="code" href="structLineShape_1_1Output.html#a60a928857c168614b0a378d0b97854ce">G</a>, -X.<a class="code" href="structLineShape_1_1Output.html#a2ae27c5abb4edad723c2089f7edcc599">Y</a>);</div>
<div class="line"><a name="l00436"></a><span class="lineno">  436</span>&#160; </div>
<div class="line"><a name="l00437"></a><span class="lineno">  437</span>&#160;  dF *= <a class="code" href="namespaceoem.html#a5572926b564f0e50c8c63ddc36f68bb1">LM</a>;</div>
<div class="line"><a name="l00438"></a><span class="lineno">  438</span>&#160;  <span class="keywordflow">if</span> (with_mirroring) {</div>
<div class="line"><a name="l00439"></a><span class="lineno">  439</span>&#160;    dF.noalias() += dFm * <a class="code" href="complex_8h.html#a428a624f5d3e190e8961223d885b44b4">conj</a>(<a class="code" href="namespaceoem.html#a5572926b564f0e50c8c63ddc36f68bb1">LM</a>);</div>
<div class="line"><a name="l00440"></a><span class="lineno">  440</span>&#160;    </div>
<div class="line"><a name="l00441"></a><span class="lineno">  441</span>&#160;    <span class="keywordflow">for</span> (<span class="keyword">auto</span> iq = 0; iq &lt; nppd; iq++) {</div>
<div class="line"><a name="l00442"></a><span class="lineno">  442</span>&#160;      <span class="keyword">const</span> <span class="keyword">auto</span>&amp; deriv = derivatives_data[derivatives_data_position[iq]];</div>
<div class="line"><a name="l00443"></a><span class="lineno">  443</span>&#160; </div>
<div class="line"><a name="l00444"></a><span class="lineno">  444</span>&#160;      <span class="keywordflow">if</span> (deriv == JacPropMatType::Temperature) {</div>
<div class="line"><a name="l00445"></a><span class="lineno">  445</span>&#160;        <span class="keyword">const</span> <span class="keyword">auto</span> c = <a class="code" href="complex_8h.html#aff1205001edf41e8e0032f18b98875e1">Complex</a>(dT.<a class="code" href="structLineShape_1_1Output.html#a60a928857c168614b0a378d0b97854ce">G</a>, -dT.<a class="code" href="structLineShape_1_1Output.html#a2ae27c5abb4edad723c2089f7edcc599">Y</a>);</div>
<div class="line"><a name="l00446"></a><span class="lineno">  446</span>&#160;        dF.col(iq).noalias() += F * c + Fm * <a class="code" href="complex_8h.html#a428a624f5d3e190e8961223d885b44b4">conj</a>(c);</div>
<div class="line"><a name="l00447"></a><span class="lineno">  447</span>&#160;      } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="jacobian_8h.html#a82162e312a2889b5c6bd494b8749e2e0">is_pressure_broadening_G</a>(deriv) and</div>
<div class="line"><a name="l00448"></a><span class="lineno">  448</span>&#160;                 <a class="code" href="namespaceAbsorption.html#a1554ecf51c40489e7f2a9f77a3314511">Absorption::id_in_line</a>(band, deriv.<a class="code" href="classAbsorption_1_1Lines.html#acadb529b972003acc1e782d855bdaa08">QuantumIdentity</a>(), line_ind))</div>
<div class="line"><a name="l00449"></a><span class="lineno">  449</span>&#160;        dF.col(iq).noalias() = F + Fm;</div>
<div class="line"><a name="l00450"></a><span class="lineno">  450</span>&#160;      <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="jacobian_8h.html#a1c038b81aa646d730aeddc8ce99fd9d5">is_pressure_broadening_Y</a>(deriv) and</div>
<div class="line"><a name="l00451"></a><span class="lineno">  451</span>&#160;               <a class="code" href="namespaceAbsorption.html#a1554ecf51c40489e7f2a9f77a3314511">Absorption::id_in_line</a>(band, deriv.<a class="code" href="classAbsorption_1_1Lines.html#acadb529b972003acc1e782d855bdaa08">QuantumIdentity</a>(), line_ind))</div>
<div class="line"><a name="l00452"></a><span class="lineno">  452</span>&#160;        dF.col(iq).noalias() = <a class="code" href="complex_8h.html#aff1205001edf41e8e0032f18b98875e1">Complex</a>(0, -1) * (F - Fm);</div>
<div class="line"><a name="l00453"></a><span class="lineno">  453</span>&#160;      <span class="keywordflow">else</span> <span class="keywordflow">if</span> (deriv == JacPropMatType::VMR and</div>
<div class="line"><a name="l00454"></a><span class="lineno">  454</span>&#160;               <a class="code" href="namespaceAbsorption.html#a1554ecf51c40489e7f2a9f77a3314511">Absorption::id_in_line</a>(band, deriv.<a class="code" href="classAbsorption_1_1Lines.html#acadb529b972003acc1e782d855bdaa08">QuantumIdentity</a>(), line_ind)) {</div>
<div class="line"><a name="l00455"></a><span class="lineno">  455</span>&#160;        <span class="keyword">const</span> <span class="keyword">auto</span> c = <a class="code" href="complex_8h.html#aff1205001edf41e8e0032f18b98875e1">Complex</a>(dVMR.<a class="code" href="structLineShape_1_1Output.html#a60a928857c168614b0a378d0b97854ce">G</a>, -dVMR.<a class="code" href="structLineShape_1_1Output.html#a2ae27c5abb4edad723c2089f7edcc599">Y</a>);</div>
<div class="line"><a name="l00456"></a><span class="lineno">  456</span>&#160;        dF.col(iq).noalias() += F * c + Fm * <a class="code" href="complex_8h.html#a428a624f5d3e190e8961223d885b44b4">conj</a>(c);</div>
<div class="line"><a name="l00457"></a><span class="lineno">  457</span>&#160;      }</div>
<div class="line"><a name="l00458"></a><span class="lineno">  458</span>&#160;    }</div>
<div class="line"><a name="l00459"></a><span class="lineno">  459</span>&#160;  } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00460"></a><span class="lineno">  460</span>&#160;    <span class="keywordflow">for</span> (<span class="keyword">auto</span> iq = 0; iq &lt; nppd; iq++) {</div>
<div class="line"><a name="l00461"></a><span class="lineno">  461</span>&#160;      <span class="keyword">const</span> <span class="keyword">auto</span>&amp; deriv = derivatives_data[derivatives_data_position[iq]];</div>
<div class="line"><a name="l00462"></a><span class="lineno">  462</span>&#160; </div>
<div class="line"><a name="l00463"></a><span class="lineno">  463</span>&#160;      <span class="keywordflow">if</span> (deriv == JacPropMatType::Temperature)</div>
<div class="line"><a name="l00464"></a><span class="lineno">  464</span>&#160;        dF.col(iq).noalias() += F * <a class="code" href="complex_8h.html#aff1205001edf41e8e0032f18b98875e1">Complex</a>(dT.<a class="code" href="structLineShape_1_1Output.html#a60a928857c168614b0a378d0b97854ce">G</a>, -dT.<a class="code" href="structLineShape_1_1Output.html#a2ae27c5abb4edad723c2089f7edcc599">Y</a>);</div>
<div class="line"><a name="l00465"></a><span class="lineno">  465</span>&#160;      <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="jacobian_8h.html#a82162e312a2889b5c6bd494b8749e2e0">is_pressure_broadening_G</a>(deriv) and</div>
<div class="line"><a name="l00466"></a><span class="lineno">  466</span>&#160;               <a class="code" href="namespaceAbsorption.html#a1554ecf51c40489e7f2a9f77a3314511">Absorption::id_in_line</a>(band, deriv.<a class="code" href="classAbsorption_1_1Lines.html#acadb529b972003acc1e782d855bdaa08">QuantumIdentity</a>(), line_ind))</div>
<div class="line"><a name="l00467"></a><span class="lineno">  467</span>&#160;        dF.col(iq).noalias() = F;</div>
<div class="line"><a name="l00468"></a><span class="lineno">  468</span>&#160;      <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="jacobian_8h.html#a1c038b81aa646d730aeddc8ce99fd9d5">is_pressure_broadening_Y</a>(deriv) and</div>
<div class="line"><a name="l00469"></a><span class="lineno">  469</span>&#160;               <a class="code" href="namespaceAbsorption.html#a1554ecf51c40489e7f2a9f77a3314511">Absorption::id_in_line</a>(band, deriv.<a class="code" href="classAbsorption_1_1Lines.html#acadb529b972003acc1e782d855bdaa08">QuantumIdentity</a>(), line_ind))</div>
<div class="line"><a name="l00470"></a><span class="lineno">  470</span>&#160;        dF.col(iq).noalias() = <a class="code" href="complex_8h.html#aff1205001edf41e8e0032f18b98875e1">Complex</a>(0, -1) * F;</div>
<div class="line"><a name="l00471"></a><span class="lineno">  471</span>&#160;      <span class="keywordflow">else</span> <span class="keywordflow">if</span> (deriv == JacPropMatType::VMR and</div>
<div class="line"><a name="l00472"></a><span class="lineno">  472</span>&#160;               <a class="code" href="namespaceAbsorption.html#a1554ecf51c40489e7f2a9f77a3314511">Absorption::id_in_line</a>(band, deriv.<a class="code" href="classAbsorption_1_1Lines.html#acadb529b972003acc1e782d855bdaa08">QuantumIdentity</a>(), line_ind))</div>
<div class="line"><a name="l00473"></a><span class="lineno">  473</span>&#160;        dF.col(iq).noalias() += F * <a class="code" href="complex_8h.html#aff1205001edf41e8e0032f18b98875e1">Complex</a>(dVMR.<a class="code" href="structLineShape_1_1Output.html#a60a928857c168614b0a378d0b97854ce">G</a>, -dVMR.<a class="code" href="structLineShape_1_1Output.html#a2ae27c5abb4edad723c2089f7edcc599">Y</a>);</div>
<div class="line"><a name="l00474"></a><span class="lineno">  474</span>&#160;    }</div>
<div class="line"><a name="l00475"></a><span class="lineno">  475</span>&#160;  }</div>
<div class="line"><a name="l00476"></a><span class="lineno">  476</span>&#160; </div>
<div class="line"><a name="l00477"></a><span class="lineno">  477</span>&#160;  F *= <a class="code" href="namespaceoem.html#a5572926b564f0e50c8c63ddc36f68bb1">LM</a>;</div>
<div class="line"><a name="l00478"></a><span class="lineno">  478</span>&#160;  <span class="keywordflow">if</span> (with_mirroring) F.noalias() += Fm * <a class="code" href="complex_8h.html#a428a624f5d3e190e8961223d885b44b4">std::conj</a>(<a class="code" href="namespaceoem.html#a5572926b564f0e50c8c63ddc36f68bb1">LM</a>);</div>
<div class="line"><a name="l00479"></a><span class="lineno">  479</span>&#160;}</div>
<div class="line"><a name="l00480"></a><span class="lineno">  480</span>&#160; </div>
<div class="line"><a name="l00481"></a><span class="lineno"><a class="line" href="namespaceLinefunctions.html#ae6818a5213b049a8a8e1464040531b7c">  481</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="namespaceLinefunctions.html#ae6818a5213b049a8a8e1464040531b7c">Linefunctions::apply_rosenkranz_quadratic_scaling</a>(</div>
<div class="line"><a name="l00482"></a><span class="lineno">  482</span>&#160;    Eigen::Ref&lt;Eigen::VectorXcd&gt; F,</div>
<div class="line"><a name="l00483"></a><span class="lineno">  483</span>&#160;    Eigen::Ref&lt;Eigen::MatrixXcd&gt; dF,</div>
<div class="line"><a name="l00484"></a><span class="lineno">  484</span>&#160;    <span class="keyword">const</span> Eigen::Ref&lt;const Eigen::VectorXd&gt; <a class="code" href="namespaceARTS_1_1Var.html#a656f34b4c40189bd3c971e2d3dbe3b95">f_grid</a>,</div>
<div class="line"><a name="l00485"></a><span class="lineno">  485</span>&#160;    <span class="keyword">const</span> <a class="code" href="matpack_8h.html#ad9a8dbb27c0bbea7271d916036122f6a">Numeric</a>&amp; <a class="code" href="arts__api__classes_8cc.html#afa1d4d1245df45b0d97cf72f5a58120d">F0</a>,</div>
<div class="line"><a name="l00486"></a><span class="lineno">  486</span>&#160;    <span class="keyword">const</span> <a class="code" href="matpack_8h.html#ad9a8dbb27c0bbea7271d916036122f6a">Numeric</a>&amp; T,</div>
<div class="line"><a name="l00487"></a><span class="lineno">  487</span>&#160;    <span class="keyword">const</span> <a class="code" href="classAbsorption_1_1Lines.html">AbsorptionLines</a>&amp; band,</div>
<div class="line"><a name="l00488"></a><span class="lineno">  488</span>&#160;    <span class="keyword">const</span> <a class="code" href="matpack_8h.html#aedca4b4670b166565b5b40c700d65a7c">Index</a>&amp; line_ind,</div>
<div class="line"><a name="l00489"></a><span class="lineno">  489</span>&#160;    <span class="keyword">const</span> <a class="code" href="classArray.html">ArrayOfRetrievalQuantity</a>&amp; derivatives_data,</div>
<div class="line"><a name="l00490"></a><span class="lineno">  490</span>&#160;    <span class="keyword">const</span> <a class="code" href="classArray.html">ArrayOfIndex</a>&amp; derivatives_data_position) {</div>
<div class="line"><a name="l00491"></a><span class="lineno">  491</span>&#160;  <span class="keyword">auto</span> nf = <a class="code" href="namespaceARTS_1_1Var.html#a656f34b4c40189bd3c971e2d3dbe3b95">f_grid</a>.size(), nppd = derivatives_data_position.<a class="code" href="classArray.html#a90ce1cf3f99646da9d0efd6e8a661369">nelem</a>();</div>
<div class="line"><a name="l00492"></a><span class="lineno">  492</span>&#160; </div>
<div class="line"><a name="l00493"></a><span class="lineno">  493</span>&#160;  <span class="keyword">const</span> <a class="code" href="matpack_8h.html#ad9a8dbb27c0bbea7271d916036122f6a">Numeric</a> invF0 = 1.0 / <a class="code" href="arts__api__classes_8cc.html#afa1d4d1245df45b0d97cf72f5a58120d">F0</a>;</div>
<div class="line"><a name="l00494"></a><span class="lineno">  494</span>&#160;  <span class="keyword">const</span> <a class="code" href="matpack_8h.html#ad9a8dbb27c0bbea7271d916036122f6a">Numeric</a> mafac =</div>
<div class="line"><a name="l00495"></a><span class="lineno">  495</span>&#160;      (Constant::h) / (2.0 * Constant::k * T) /</div>
<div class="line"><a name="l00496"></a><span class="lineno">  496</span>&#160;      std::sinh((Constant::h * <a class="code" href="arts__api__classes_8cc.html#afa1d4d1245df45b0d97cf72f5a58120d">F0</a>) / (2.0 * Constant::k * T)) * invF0;</div>
<div class="line"><a name="l00497"></a><span class="lineno">  497</span>&#160; </div>
<div class="line"><a name="l00498"></a><span class="lineno">  498</span>&#160;  <a class="code" href="matpack_8h.html#ad9a8dbb27c0bbea7271d916036122f6a">Numeric</a> dmafac_dT_div_fun = 0;</div>
<div class="line"><a name="l00499"></a><span class="lineno">  499</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="jacobian_8cc.html#a898bd3f5acba8942e94aceb11b0d1ad9">do_temperature_jacobian</a>(derivatives_data))</div>
<div class="line"><a name="l00500"></a><span class="lineno">  500</span>&#160;    dmafac_dT_div_fun =</div>
<div class="line"><a name="l00501"></a><span class="lineno">  501</span>&#160;        -(Constant::k * T -</div>
<div class="line"><a name="l00502"></a><span class="lineno">  502</span>&#160;          <a class="code" href="arts__api__classes_8cc.html#afa1d4d1245df45b0d97cf72f5a58120d">F0</a> * Constant::h /</div>
<div class="line"><a name="l00503"></a><span class="lineno">  503</span>&#160;              (2.0 * std::tanh(<a class="code" href="arts__api__classes_8cc.html#afa1d4d1245df45b0d97cf72f5a58120d">F0</a> * Constant::h / (2.0 * Constant::k * T)))) /</div>
<div class="line"><a name="l00504"></a><span class="lineno">  504</span>&#160;        (Constant::k * T * T);</div>
<div class="line"><a name="l00505"></a><span class="lineno">  505</span>&#160; </div>
<div class="line"><a name="l00506"></a><span class="lineno">  506</span>&#160;  <a class="code" href="matpack_8h.html#ad9a8dbb27c0bbea7271d916036122f6a">Numeric</a> fun;</div>
<div class="line"><a name="l00507"></a><span class="lineno">  507</span>&#160; </div>
<div class="line"><a name="l00508"></a><span class="lineno">  508</span>&#160;  <span class="keywordflow">for</span> (<span class="keyword">auto</span> iv = 0; iv &lt; nf; iv++) {</div>
<div class="line"><a name="l00509"></a><span class="lineno">  509</span>&#160;    fun = mafac * (<a class="code" href="namespaceARTS_1_1Var.html#a656f34b4c40189bd3c971e2d3dbe3b95">f_grid</a>[iv] * <a class="code" href="namespaceARTS_1_1Var.html#a656f34b4c40189bd3c971e2d3dbe3b95">f_grid</a>[iv]);</div>
<div class="line"><a name="l00510"></a><span class="lineno">  510</span>&#160;    F[iv] *= fun;</div>
<div class="line"><a name="l00511"></a><span class="lineno">  511</span>&#160; </div>
<div class="line"><a name="l00512"></a><span class="lineno">  512</span>&#160;    <span class="keywordflow">for</span> (<span class="keyword">auto</span> iq = 0; iq &lt; nppd; iq++) {</div>
<div class="line"><a name="l00513"></a><span class="lineno">  513</span>&#160;      <span class="keyword">const</span> <span class="keyword">auto</span>&amp; deriv = derivatives_data[derivatives_data_position[iq]];</div>
<div class="line"><a name="l00514"></a><span class="lineno">  514</span>&#160; </div>
<div class="line"><a name="l00515"></a><span class="lineno">  515</span>&#160;      dF(iv, iq) *= fun;</div>
<div class="line"><a name="l00516"></a><span class="lineno">  516</span>&#160;      <span class="keywordflow">if</span> (deriv == JacPropMatType::Temperature)</div>
<div class="line"><a name="l00517"></a><span class="lineno">  517</span>&#160;        dF(iv, iq) += dmafac_dT_div_fun * F[iv];</div>
<div class="line"><a name="l00518"></a><span class="lineno">  518</span>&#160;      <span class="keywordflow">else</span> <span class="keywordflow">if</span> (deriv == JacPropMatType::LineCenter and</div>
<div class="line"><a name="l00519"></a><span class="lineno">  519</span>&#160;               <a class="code" href="namespaceAbsorption.html#a1554ecf51c40489e7f2a9f77a3314511">Absorption::id_in_line</a>(band, deriv.<a class="code" href="classAbsorption_1_1Lines.html#acadb529b972003acc1e782d855bdaa08">QuantumIdentity</a>(), line_ind))</div>
<div class="line"><a name="l00520"></a><span class="lineno">  520</span>&#160;        dF(iv, iq) +=</div>
<div class="line"><a name="l00521"></a><span class="lineno">  521</span>&#160;            (-invF0 - Constant::h / (2.0 * Constant::k * T *</div>
<div class="line"><a name="l00522"></a><span class="lineno">  522</span>&#160;                                     std::tanh(<a class="code" href="arts__api__classes_8cc.html#afa1d4d1245df45b0d97cf72f5a58120d">F0</a> * Constant::h /</div>
<div class="line"><a name="l00523"></a><span class="lineno">  523</span>&#160;                                               (2.0 * Constant::k * T)))) *</div>
<div class="line"><a name="l00524"></a><span class="lineno">  524</span>&#160;            F[iv];</div>
<div class="line"><a name="l00525"></a><span class="lineno">  525</span>&#160;      <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="jacobian_8cc.html#ad59138aabb0d611ff16659b4fd93858a">is_frequency_parameter</a>(deriv))</div>
<div class="line"><a name="l00526"></a><span class="lineno">  526</span>&#160;        dF(iv, iq) += (2.0 / <a class="code" href="namespaceARTS_1_1Var.html#a656f34b4c40189bd3c971e2d3dbe3b95">f_grid</a>[iv]) * F[iv];</div>
<div class="line"><a name="l00527"></a><span class="lineno">  527</span>&#160;    }</div>
<div class="line"><a name="l00528"></a><span class="lineno">  528</span>&#160;  }</div>
<div class="line"><a name="l00529"></a><span class="lineno">  529</span>&#160;}</div>
<div class="line"><a name="l00530"></a><span class="lineno">  530</span>&#160; </div>
<div class="line"><a name="l00531"></a><span class="lineno"><a class="line" href="namespaceLinefunctions.html#ae5c4fd8eada1c26b407af64b27cc6413">  531</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="namespaceLinefunctions.html#ae5c4fd8eada1c26b407af64b27cc6413">Linefunctions::apply_VVH_scaling</a>(</div>
<div class="line"><a name="l00532"></a><span class="lineno">  532</span>&#160;    Eigen::Ref&lt;Eigen::VectorXcd&gt; F,</div>
<div class="line"><a name="l00533"></a><span class="lineno">  533</span>&#160;    Eigen::Ref&lt;Eigen::MatrixXcd&gt; dF,</div>
<div class="line"><a name="l00534"></a><span class="lineno">  534</span>&#160;    Eigen::Ref&lt;<a class="code" href="namespaceoem.html#a6dead99de47f1704cff777837f5044e9">Eigen::Matrix</a>&lt;<a class="code" href="complex_8h.html#aff1205001edf41e8e0032f18b98875e1">Complex</a>, Eigen::Dynamic, <a class="code" href="namespaceLinefunctions.html#a38c90914bad76caa9d40c7dc0053924e">ExpectedDataSize</a>()&gt;&gt; <a class="code" href="arts__api__classes_8cc.html#a126b511d17f5ccbef11bde3a65df2430">data</a>,</div>
<div class="line"><a name="l00535"></a><span class="lineno">  535</span>&#160;    <span class="keyword">const</span> Eigen::Ref&lt;const Eigen::VectorXd&gt; <a class="code" href="namespaceARTS_1_1Var.html#a656f34b4c40189bd3c971e2d3dbe3b95">f_grid</a>,</div>
<div class="line"><a name="l00536"></a><span class="lineno">  536</span>&#160;    <span class="keyword">const</span> <a class="code" href="matpack_8h.html#ad9a8dbb27c0bbea7271d916036122f6a">Numeric</a>&amp; <a class="code" href="arts__api__classes_8cc.html#afa1d4d1245df45b0d97cf72f5a58120d">F0</a>,</div>
<div class="line"><a name="l00537"></a><span class="lineno">  537</span>&#160;    <span class="keyword">const</span> <a class="code" href="matpack_8h.html#ad9a8dbb27c0bbea7271d916036122f6a">Numeric</a>&amp; T,</div>
<div class="line"><a name="l00538"></a><span class="lineno">  538</span>&#160;    <span class="keyword">const</span> <a class="code" href="classAbsorption_1_1Lines.html">AbsorptionLines</a>&amp; band,</div>
<div class="line"><a name="l00539"></a><span class="lineno">  539</span>&#160;    <span class="keyword">const</span> <a class="code" href="matpack_8h.html#aedca4b4670b166565b5b40c700d65a7c">Index</a>&amp; line_ind,</div>
<div class="line"><a name="l00540"></a><span class="lineno">  540</span>&#160;    <span class="keyword">const</span> <a class="code" href="classArray.html">ArrayOfRetrievalQuantity</a>&amp; derivatives_data,</div>
<div class="line"><a name="l00541"></a><span class="lineno">  541</span>&#160;    <span class="keyword">const</span> <a class="code" href="classArray.html">ArrayOfIndex</a>&amp; derivatives_data_position) {</div>
<div class="line"><a name="l00542"></a><span class="lineno">  542</span>&#160;  <span class="keyword">auto</span> nppd = derivatives_data_position.<a class="code" href="classArray.html#a90ce1cf3f99646da9d0efd6e8a661369">nelem</a>();</div>
<div class="line"><a name="l00543"></a><span class="lineno">  543</span>&#160; </div>
<div class="line"><a name="l00544"></a><span class="lineno">  544</span>&#160;  <span class="comment">// 2kT is constant for the loop</span></div>
<div class="line"><a name="l00545"></a><span class="lineno">  545</span>&#160;  <span class="keyword">const</span> <a class="code" href="matpack_8h.html#ad9a8dbb27c0bbea7271d916036122f6a">Numeric</a> kT = 2.0 * Constant::k * T;</div>
<div class="line"><a name="l00546"></a><span class="lineno">  546</span>&#160;  <span class="keyword">const</span> <a class="code" href="matpack_8h.html#ad9a8dbb27c0bbea7271d916036122f6a">Numeric</a> c1 = Constant::h / kT;</div>
<div class="line"><a name="l00547"></a><span class="lineno">  547</span>&#160; </div>
<div class="line"><a name="l00548"></a><span class="lineno">  548</span>&#160;  <span class="comment">// denominator is constant for the loop</span></div>
<div class="line"><a name="l00549"></a><span class="lineno">  549</span>&#160;  <span class="keyword">const</span> <a class="code" href="matpack_8h.html#ad9a8dbb27c0bbea7271d916036122f6a">Numeric</a> tanh_f0part = std::tanh(c1 * <a class="code" href="arts__api__classes_8cc.html#afa1d4d1245df45b0d97cf72f5a58120d">F0</a>);</div>
<div class="line"><a name="l00550"></a><span class="lineno">  550</span>&#160;  <span class="keyword">const</span> <a class="code" href="matpack_8h.html#ad9a8dbb27c0bbea7271d916036122f6a">Numeric</a> denom = <a class="code" href="arts__api__classes_8cc.html#afa1d4d1245df45b0d97cf72f5a58120d">F0</a> * tanh_f0part;</div>
<div class="line"><a name="l00551"></a><span class="lineno">  551</span>&#160; </div>
<div class="line"><a name="l00552"></a><span class="lineno">  552</span>&#160;  <span class="comment">// Name the data</span></div>
<div class="line"><a name="l00553"></a><span class="lineno">  553</span>&#160;  <span class="keyword">auto</span> tanh_f = <a class="code" href="arts__api__classes_8cc.html#a126b511d17f5ccbef11bde3a65df2430">data</a>.col(0);</div>
<div class="line"><a name="l00554"></a><span class="lineno">  554</span>&#160;  <span class="keyword">auto</span> ftanh_f = <a class="code" href="arts__api__classes_8cc.html#a126b511d17f5ccbef11bde3a65df2430">data</a>.col(1);</div>
<div class="line"><a name="l00555"></a><span class="lineno">  555</span>&#160; </div>
<div class="line"><a name="l00556"></a><span class="lineno">  556</span>&#160;  tanh_f.noalias() = (c1 * <a class="code" href="namespaceARTS_1_1Var.html#a656f34b4c40189bd3c971e2d3dbe3b95">f_grid</a>.array()).tanh().matrix();</div>
<div class="line"><a name="l00557"></a><span class="lineno">  557</span>&#160;  ftanh_f.noalias() = <a class="code" href="namespaceARTS_1_1Var.html#a656f34b4c40189bd3c971e2d3dbe3b95">f_grid</a>.cwiseProduct(tanh_f) / denom;</div>
<div class="line"><a name="l00558"></a><span class="lineno">  558</span>&#160;  F.array() *= ftanh_f.array();</div>
<div class="line"><a name="l00559"></a><span class="lineno">  559</span>&#160; </div>
<div class="line"><a name="l00560"></a><span class="lineno">  560</span>&#160;  dF.array().colwise() *= ftanh_f.array();</div>
<div class="line"><a name="l00561"></a><span class="lineno">  561</span>&#160;  <span class="keywordflow">for</span> (<span class="keyword">auto</span> iq = 0; iq &lt; nppd; iq++) {</div>
<div class="line"><a name="l00562"></a><span class="lineno">  562</span>&#160;    <span class="keyword">const</span> <span class="keyword">auto</span>&amp; deriv = derivatives_data[derivatives_data_position[iq]];</div>
<div class="line"><a name="l00563"></a><span class="lineno">  563</span>&#160; </div>
<div class="line"><a name="l00564"></a><span class="lineno">  564</span>&#160;    <span class="keywordflow">if</span> (deriv == JacPropMatType::Temperature)</div>
<div class="line"><a name="l00565"></a><span class="lineno">  565</span>&#160;      dF.col(iq).noalias() +=</div>
<div class="line"><a name="l00566"></a><span class="lineno">  566</span>&#160;          -c1 / T *</div>
<div class="line"><a name="l00567"></a><span class="lineno">  567</span>&#160;          ((denom - <a class="code" href="arts__api__classes_8cc.html#afa1d4d1245df45b0d97cf72f5a58120d">F0</a> / tanh_f0part) * F - denom * ftanh_f.cwiseProduct(F) +</div>
<div class="line"><a name="l00568"></a><span class="lineno">  568</span>&#160;           <a class="code" href="namespaceARTS_1_1Var.html#a656f34b4c40189bd3c971e2d3dbe3b95">f_grid</a>.cwiseProduct(F).cwiseQuotient(tanh_f));</div>
<div class="line"><a name="l00569"></a><span class="lineno">  569</span>&#160;    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="jacobian_8cc.html#ad59138aabb0d611ff16659b4fd93858a">is_frequency_parameter</a>(deriv))</div>
<div class="line"><a name="l00570"></a><span class="lineno">  570</span>&#160;      dF.col(iq).noalias() +=</div>
<div class="line"><a name="l00571"></a><span class="lineno">  571</span>&#160;          F.cwiseQuotient(<a class="code" href="namespaceARTS_1_1Var.html#a656f34b4c40189bd3c971e2d3dbe3b95">f_grid</a>) +</div>
<div class="line"><a name="l00572"></a><span class="lineno">  572</span>&#160;          c1 * (F.cwiseQuotient(tanh_f) - F.cwiseProduct(tanh_f));</div>
<div class="line"><a name="l00573"></a><span class="lineno">  573</span>&#160;    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (deriv == JacPropMatType::LineCenter and</div>
<div class="line"><a name="l00574"></a><span class="lineno">  574</span>&#160;             <a class="code" href="namespaceAbsorption.html#a1554ecf51c40489e7f2a9f77a3314511">Absorption::id_in_line</a>(band, deriv.<a class="code" href="classAbsorption_1_1Lines.html#acadb529b972003acc1e782d855bdaa08">QuantumIdentity</a>(), line_ind))</div>
<div class="line"><a name="l00575"></a><span class="lineno">  575</span>&#160;      dF.col(iq).noalias() +=</div>
<div class="line"><a name="l00576"></a><span class="lineno">  576</span>&#160;          (-1.0 / <a class="code" href="arts__api__classes_8cc.html#afa1d4d1245df45b0d97cf72f5a58120d">F0</a> + c1 * tanh_f0part - c1 / tanh_f0part) * F;</div>
<div class="line"><a name="l00577"></a><span class="lineno">  577</span>&#160;  }</div>
<div class="line"><a name="l00578"></a><span class="lineno">  578</span>&#160;}</div>
<div class="line"><a name="l00579"></a><span class="lineno">  579</span>&#160; </div>
<div class="line"><a name="l00580"></a><span class="lineno"><a class="line" href="namespaceLinefunctions.html#a5505c9892e2f020db13b06845baf639b">  580</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="namespaceLinefunctions.html#a5505c9892e2f020db13b06845baf639b">Linefunctions::apply_VVW_scaling</a>(</div>
<div class="line"><a name="l00581"></a><span class="lineno">  581</span>&#160;    Eigen::Ref&lt;Eigen::VectorXcd&gt; F,</div>
<div class="line"><a name="l00582"></a><span class="lineno">  582</span>&#160;    Eigen::Ref&lt;Eigen::MatrixXcd&gt; dF,</div>
<div class="line"><a name="l00583"></a><span class="lineno">  583</span>&#160;    <span class="keyword">const</span> Eigen::Ref&lt;const Eigen::VectorXd&gt; <a class="code" href="namespaceARTS_1_1Var.html#a656f34b4c40189bd3c971e2d3dbe3b95">f_grid</a>,</div>
<div class="line"><a name="l00584"></a><span class="lineno">  584</span>&#160;    <span class="keyword">const</span> <a class="code" href="matpack_8h.html#ad9a8dbb27c0bbea7271d916036122f6a">Numeric</a>&amp; <a class="code" href="arts__api__classes_8cc.html#afa1d4d1245df45b0d97cf72f5a58120d">F0</a>,</div>
<div class="line"><a name="l00585"></a><span class="lineno">  585</span>&#160;    <span class="keyword">const</span> <a class="code" href="classAbsorption_1_1Lines.html">AbsorptionLines</a>&amp; band,</div>
<div class="line"><a name="l00586"></a><span class="lineno">  586</span>&#160;    <span class="keyword">const</span> <a class="code" href="matpack_8h.html#aedca4b4670b166565b5b40c700d65a7c">Index</a>&amp; line_ind,</div>
<div class="line"><a name="l00587"></a><span class="lineno">  587</span>&#160;    <span class="keyword">const</span> <a class="code" href="classArray.html">ArrayOfRetrievalQuantity</a>&amp; derivatives_data,</div>
<div class="line"><a name="l00588"></a><span class="lineno">  588</span>&#160;    <span class="keyword">const</span> <a class="code" href="classArray.html">ArrayOfIndex</a>&amp; derivatives_data_position) {</div>
<div class="line"><a name="l00589"></a><span class="lineno">  589</span>&#160;  <span class="keyword">auto</span> nf = <a class="code" href="namespaceARTS_1_1Var.html#a656f34b4c40189bd3c971e2d3dbe3b95">f_grid</a>.size(), nppd = derivatives_data_position.<a class="code" href="classArray.html#a90ce1cf3f99646da9d0efd6e8a661369">nelem</a>();</div>
<div class="line"><a name="l00590"></a><span class="lineno">  590</span>&#160; </div>
<div class="line"><a name="l00591"></a><span class="lineno">  591</span>&#160;  <span class="comment">// denominator is constant for the loop</span></div>
<div class="line"><a name="l00592"></a><span class="lineno">  592</span>&#160;  <span class="keyword">const</span> <a class="code" href="matpack_8h.html#ad9a8dbb27c0bbea7271d916036122f6a">Numeric</a> invF0 = 1.0 / <a class="code" href="arts__api__classes_8cc.html#afa1d4d1245df45b0d97cf72f5a58120d">F0</a>;</div>
<div class="line"><a name="l00593"></a><span class="lineno">  593</span>&#160;  <span class="keyword">const</span> <a class="code" href="matpack_8h.html#ad9a8dbb27c0bbea7271d916036122f6a">Numeric</a> invF02 = invF0 * invF0;</div>
<div class="line"><a name="l00594"></a><span class="lineno">  594</span>&#160; </div>
<div class="line"><a name="l00595"></a><span class="lineno">  595</span>&#160;  <span class="keywordflow">for</span> (<span class="keyword">auto</span> iv = 0; iv &lt; nf; iv++) {</div>
<div class="line"><a name="l00596"></a><span class="lineno">  596</span>&#160;    <span class="comment">// Set the factor</span></div>
<div class="line"><a name="l00597"></a><span class="lineno">  597</span>&#160;    <span class="keyword">const</span> <a class="code" href="matpack_8h.html#ad9a8dbb27c0bbea7271d916036122f6a">Numeric</a> <a class="code" href="math__funcs_8cc.html#a3847133ed1eefacef21795b055b6cfff">fac</a> = <a class="code" href="namespaceARTS_1_1Var.html#a656f34b4c40189bd3c971e2d3dbe3b95">f_grid</a>[iv] * <a class="code" href="namespaceARTS_1_1Var.html#a656f34b4c40189bd3c971e2d3dbe3b95">f_grid</a>[iv] * invF02;</div>
<div class="line"><a name="l00598"></a><span class="lineno">  598</span>&#160; </div>
<div class="line"><a name="l00599"></a><span class="lineno">  599</span>&#160;    <span class="comment">// Set the line shape</span></div>
<div class="line"><a name="l00600"></a><span class="lineno">  600</span>&#160;    F[iv] *= <a class="code" href="math__funcs_8cc.html#a3847133ed1eefacef21795b055b6cfff">fac</a>;</div>
<div class="line"><a name="l00601"></a><span class="lineno">  601</span>&#160; </div>
<div class="line"><a name="l00602"></a><span class="lineno">  602</span>&#160;    <span class="keywordflow">for</span> (<span class="keyword">auto</span> iq = 0; iq &lt; nppd; iq++) {</div>
<div class="line"><a name="l00603"></a><span class="lineno">  603</span>&#160;      <span class="keyword">const</span> <span class="keyword">auto</span>&amp; deriv = derivatives_data[derivatives_data_position[iq]];</div>
<div class="line"><a name="l00604"></a><span class="lineno">  604</span>&#160; </div>
<div class="line"><a name="l00605"></a><span class="lineno">  605</span>&#160;      <span class="comment">// The factor is applied to all partial derivatives</span></div>
<div class="line"><a name="l00606"></a><span class="lineno">  606</span>&#160;      dF(iv, iq) *= <a class="code" href="math__funcs_8cc.html#a3847133ed1eefacef21795b055b6cfff">fac</a>;</div>
<div class="line"><a name="l00607"></a><span class="lineno">  607</span>&#160; </div>
<div class="line"><a name="l00608"></a><span class="lineno">  608</span>&#160;      <span class="comment">// These partial derivatives are special</span></div>
<div class="line"><a name="l00609"></a><span class="lineno">  609</span>&#160;      <span class="keywordflow">if</span> (deriv == JacPropMatType::LineCenter and</div>
<div class="line"><a name="l00610"></a><span class="lineno">  610</span>&#160;          <a class="code" href="namespaceAbsorption.html#a1554ecf51c40489e7f2a9f77a3314511">Absorption::id_in_line</a>(band, deriv.<a class="code" href="classAbsorption_1_1Lines.html#acadb529b972003acc1e782d855bdaa08">QuantumIdentity</a>(), line_ind))</div>
<div class="line"><a name="l00611"></a><span class="lineno">  611</span>&#160;        dF(iv, iq) -= 2.0 * invF0 * F[iv];</div>
<div class="line"><a name="l00612"></a><span class="lineno">  612</span>&#160;      <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="jacobian_8cc.html#ad59138aabb0d611ff16659b4fd93858a">is_frequency_parameter</a>(deriv))</div>
<div class="line"><a name="l00613"></a><span class="lineno">  613</span>&#160;        dF(iv, iq) += 2.0 / <a class="code" href="namespaceARTS_1_1Var.html#a656f34b4c40189bd3c971e2d3dbe3b95">f_grid</a>[iv] * F[iv];</div>
<div class="line"><a name="l00614"></a><span class="lineno">  614</span>&#160;    }</div>
<div class="line"><a name="l00615"></a><span class="lineno">  615</span>&#160;  }</div>
<div class="line"><a name="l00616"></a><span class="lineno">  616</span>&#160;}</div>
<div class="line"><a name="l00617"></a><span class="lineno">  617</span>&#160; </div>
<div class="line"><a name="l00618"></a><span class="lineno"><a class="line" href="namespaceLinefunctions.html#a9c4b18015e4592ce7e093c49608ba41c">  618</a></span>&#160;<a class="code" href="matpack_8h.html#ad9a8dbb27c0bbea7271d916036122f6a">Numeric</a> <a class="code" href="namespaceLinefunctions.html#a9c4b18015e4592ce7e093c49608ba41c">Linefunctions::lte_linestrength</a>(<a class="code" href="matpack_8h.html#ad9a8dbb27c0bbea7271d916036122f6a">Numeric</a> S0,</div>
<div class="line"><a name="l00619"></a><span class="lineno">  619</span>&#160;                                        <a class="code" href="matpack_8h.html#ad9a8dbb27c0bbea7271d916036122f6a">Numeric</a> <a class="code" href="arts__api__classes_8cc.html#a8d95ca35e1e2ddc693d99e2af98d32c5">E0</a>,</div>
<div class="line"><a name="l00620"></a><span class="lineno">  620</span>&#160;                                        <a class="code" href="matpack_8h.html#ad9a8dbb27c0bbea7271d916036122f6a">Numeric</a> <a class="code" href="arts__api__classes_8cc.html#afa1d4d1245df45b0d97cf72f5a58120d">F0</a>,</div>
<div class="line"><a name="l00621"></a><span class="lineno">  621</span>&#160;                                        <a class="code" href="matpack_8h.html#ad9a8dbb27c0bbea7271d916036122f6a">Numeric</a> QT0,</div>
<div class="line"><a name="l00622"></a><span class="lineno">  622</span>&#160;                                        <a class="code" href="matpack_8h.html#ad9a8dbb27c0bbea7271d916036122f6a">Numeric</a> T0,</div>
<div class="line"><a name="l00623"></a><span class="lineno">  623</span>&#160;                                        <a class="code" href="matpack_8h.html#ad9a8dbb27c0bbea7271d916036122f6a">Numeric</a> QT,</div>
<div class="line"><a name="l00624"></a><span class="lineno">  624</span>&#160;                                        <a class="code" href="matpack_8h.html#ad9a8dbb27c0bbea7271d916036122f6a">Numeric</a> T) {</div>
<div class="line"><a name="l00625"></a><span class="lineno">  625</span>&#160;  <span class="keyword">const</span> <a class="code" href="matpack_8h.html#ad9a8dbb27c0bbea7271d916036122f6a">Numeric</a> gamma = <a class="code" href="linescaling_8cc.html#a16a7ada6dba42dadd627b396720fb02a">stimulated_emission</a>(T, <a class="code" href="arts__api__classes_8cc.html#afa1d4d1245df45b0d97cf72f5a58120d">F0</a>);</div>
<div class="line"><a name="l00626"></a><span class="lineno">  626</span>&#160;  <span class="keyword">const</span> <a class="code" href="matpack_8h.html#ad9a8dbb27c0bbea7271d916036122f6a">Numeric</a> gamma_ref = <a class="code" href="linescaling_8cc.html#a16a7ada6dba42dadd627b396720fb02a">stimulated_emission</a>(T0, <a class="code" href="arts__api__classes_8cc.html#afa1d4d1245df45b0d97cf72f5a58120d">F0</a>);</div>
<div class="line"><a name="l00627"></a><span class="lineno">  627</span>&#160;  <span class="keyword">const</span> <a class="code" href="matpack_8h.html#ad9a8dbb27c0bbea7271d916036122f6a">Numeric</a> K1 = <a class="code" href="linescaling_8cc.html#a64bc2ecc08425b72e2a5d6355ed2fa1a">boltzman_ratio</a>(T, T0, <a class="code" href="arts__api__classes_8cc.html#a8d95ca35e1e2ddc693d99e2af98d32c5">E0</a>);</div>
<div class="line"><a name="l00628"></a><span class="lineno">  628</span>&#160;  <span class="keyword">const</span> <a class="code" href="matpack_8h.html#ad9a8dbb27c0bbea7271d916036122f6a">Numeric</a> K2 = <a class="code" href="linescaling_8cc.html#a1ae35d3f91bd7cc2f4e6f477b32794ea">stimulated_relative_emission</a>(gamma, gamma_ref);</div>
<div class="line"><a name="l00629"></a><span class="lineno">  629</span>&#160;  <span class="keywordflow">return</span> S0 * K1 * K2 * QT0 / QT;</div>
<div class="line"><a name="l00630"></a><span class="lineno">  630</span>&#160;}</div>
<div class="line"><a name="l00631"></a><span class="lineno">  631</span>&#160; </div>
<div class="line"><a name="l00632"></a><span class="lineno"><a class="line" href="namespaceLinefunctions.html#a92312bdbf8d958031a4b2d5806412618">  632</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="namespaceLinefunctions.html#a92312bdbf8d958031a4b2d5806412618">Linefunctions::apply_linestrength_scaling_by_lte</a>(</div>
<div class="line"><a name="l00633"></a><span class="lineno">  633</span>&#160;    Eigen::Ref&lt;Eigen::VectorXcd&gt; F,</div>
<div class="line"><a name="l00634"></a><span class="lineno">  634</span>&#160;    Eigen::Ref&lt;Eigen::MatrixXcd&gt; dF,</div>
<div class="line"><a name="l00635"></a><span class="lineno">  635</span>&#160;    Eigen::Ref&lt;Eigen::VectorXcd&gt; <a class="code" href="rng_8cc.html#a0240ac851181b84ac374872dc5434ee4">N</a>,</div>
<div class="line"><a name="l00636"></a><span class="lineno">  636</span>&#160;    Eigen::Ref&lt;Eigen::MatrixXcd&gt; dN,</div>
<div class="line"><a name="l00637"></a><span class="lineno">  637</span>&#160;    <span class="keyword">const</span> <a class="code" href="classAbsorption_1_1SingleLine.html">Absorption::SingleLine</a>&amp; line,</div>
<div class="line"><a name="l00638"></a><span class="lineno">  638</span>&#160;    <span class="keyword">const</span> <a class="code" href="matpack_8h.html#ad9a8dbb27c0bbea7271d916036122f6a">Numeric</a>&amp; T,</div>
<div class="line"><a name="l00639"></a><span class="lineno">  639</span>&#160;    <span class="keyword">const</span> <a class="code" href="matpack_8h.html#ad9a8dbb27c0bbea7271d916036122f6a">Numeric</a>&amp; T0,</div>
<div class="line"><a name="l00640"></a><span class="lineno">  640</span>&#160;    <span class="keyword">const</span> <a class="code" href="matpack_8h.html#ad9a8dbb27c0bbea7271d916036122f6a">Numeric</a>&amp; isotopic_ratio,</div>
<div class="line"><a name="l00641"></a><span class="lineno">  641</span>&#160;    <span class="keyword">const</span> <a class="code" href="matpack_8h.html#ad9a8dbb27c0bbea7271d916036122f6a">Numeric</a>&amp; QT,</div>
<div class="line"><a name="l00642"></a><span class="lineno">  642</span>&#160;    <span class="keyword">const</span> <a class="code" href="matpack_8h.html#ad9a8dbb27c0bbea7271d916036122f6a">Numeric</a>&amp; QT0,</div>
<div class="line"><a name="l00643"></a><span class="lineno">  643</span>&#160;    <span class="keyword">const</span> <a class="code" href="classAbsorption_1_1Lines.html">AbsorptionLines</a>&amp; band,</div>
<div class="line"><a name="l00644"></a><span class="lineno">  644</span>&#160;    <span class="keyword">const</span> <a class="code" href="matpack_8h.html#aedca4b4670b166565b5b40c700d65a7c">Index</a>&amp; line_ind,</div>
<div class="line"><a name="l00645"></a><span class="lineno">  645</span>&#160;    <span class="keyword">const</span> <a class="code" href="classArray.html">ArrayOfRetrievalQuantity</a>&amp; derivatives_data,</div>
<div class="line"><a name="l00646"></a><span class="lineno">  646</span>&#160;    <span class="keyword">const</span> <a class="code" href="classArray.html">ArrayOfIndex</a>&amp; derivatives_data_position,</div>
<div class="line"><a name="l00647"></a><span class="lineno">  647</span>&#160;    <span class="keyword">const</span> <a class="code" href="matpack_8h.html#ad9a8dbb27c0bbea7271d916036122f6a">Numeric</a>&amp; dQT_dT) {</div>
<div class="line"><a name="l00648"></a><span class="lineno">  648</span>&#160;  <span class="keyword">auto</span> nppd = derivatives_data_position.<a class="code" href="classArray.html#a90ce1cf3f99646da9d0efd6e8a661369">nelem</a>();</div>
<div class="line"><a name="l00649"></a><span class="lineno">  649</span>&#160; </div>
<div class="line"><a name="l00650"></a><span class="lineno">  650</span>&#160;  <span class="keyword">const</span> <a class="code" href="matpack_8h.html#ad9a8dbb27c0bbea7271d916036122f6a">Numeric</a> gamma = <a class="code" href="linescaling_8cc.html#a16a7ada6dba42dadd627b396720fb02a">stimulated_emission</a>(T, line.<a class="code" href="classAbsorption_1_1SingleLine.html#a842d8319d70a0804efb38c4d78b6123d">F0</a>());</div>
<div class="line"><a name="l00651"></a><span class="lineno">  651</span>&#160;  <span class="keyword">const</span> <a class="code" href="matpack_8h.html#ad9a8dbb27c0bbea7271d916036122f6a">Numeric</a> gamma_ref = <a class="code" href="linescaling_8cc.html#a16a7ada6dba42dadd627b396720fb02a">stimulated_emission</a>(T0, line.<a class="code" href="classAbsorption_1_1SingleLine.html#a842d8319d70a0804efb38c4d78b6123d">F0</a>());</div>
<div class="line"><a name="l00652"></a><span class="lineno">  652</span>&#160;  <span class="keyword">const</span> <a class="code" href="matpack_8h.html#ad9a8dbb27c0bbea7271d916036122f6a">Numeric</a> K1 = <a class="code" href="linescaling_8cc.html#a64bc2ecc08425b72e2a5d6355ed2fa1a">boltzman_ratio</a>(T, T0, line.<a class="code" href="classAbsorption_1_1SingleLine.html#ab4752038522340c36ddc59ac0da23924">E0</a>());</div>
<div class="line"><a name="l00653"></a><span class="lineno">  653</span>&#160;  <span class="keyword">const</span> <a class="code" href="matpack_8h.html#ad9a8dbb27c0bbea7271d916036122f6a">Numeric</a> K2 = <a class="code" href="linescaling_8cc.html#a1ae35d3f91bd7cc2f4e6f477b32794ea">stimulated_relative_emission</a>(gamma, gamma_ref);</div>
<div class="line"><a name="l00654"></a><span class="lineno">  654</span>&#160; </div>
<div class="line"><a name="l00655"></a><span class="lineno">  655</span>&#160;  <span class="keyword">const</span> <a class="code" href="matpack_8h.html#ad9a8dbb27c0bbea7271d916036122f6a">Numeric</a> invQT = 1.0 / QT;</div>
<div class="line"><a name="l00656"></a><span class="lineno">  656</span>&#160;  <span class="keyword">const</span> <a class="code" href="matpack_8h.html#ad9a8dbb27c0bbea7271d916036122f6a">Numeric</a> S = line.<a class="code" href="classAbsorption_1_1SingleLine.html#add34adc6ce90e615ed173f6f4af28058">I0</a>() * isotopic_ratio * QT0 * invQT * K1 * K2;</div>
<div class="line"><a name="l00657"></a><span class="lineno">  657</span>&#160; </div>
<div class="line"><a name="l00658"></a><span class="lineno">  658</span>&#160;  F *= S;</div>
<div class="line"><a name="l00659"></a><span class="lineno">  659</span>&#160;  dF *= S;</div>
<div class="line"><a name="l00660"></a><span class="lineno">  660</span>&#160;  <span class="keywordflow">for</span> (<span class="keyword">auto</span> iq = 0; iq &lt; nppd; iq++) {</div>
<div class="line"><a name="l00661"></a><span class="lineno">  661</span>&#160;    <span class="keyword">const</span> <span class="keyword">auto</span>&amp; deriv = derivatives_data[derivatives_data_position[iq]];</div>
<div class="line"><a name="l00662"></a><span class="lineno">  662</span>&#160; </div>
<div class="line"><a name="l00663"></a><span class="lineno">  663</span>&#160;    <span class="keywordflow">if</span> (deriv == JacPropMatType::Temperature)</div>
<div class="line"><a name="l00664"></a><span class="lineno">  664</span>&#160;      dF.col(iq).noalias() +=</div>
<div class="line"><a name="l00665"></a><span class="lineno">  665</span>&#160;      F * (<a class="code" href="linescaling_8cc.html#a11625c0ca9965f43039a4889a152c5fa">dstimulated_relative_emission_dT</a>(gamma, gamma_ref, line.<a class="code" href="classAbsorption_1_1SingleLine.html#a842d8319d70a0804efb38c4d78b6123d">F0</a>(), T) /</div>
<div class="line"><a name="l00666"></a><span class="lineno">  666</span>&#160;                   K2 +</div>
<div class="line"><a name="l00667"></a><span class="lineno">  667</span>&#160;                   <a class="code" href="linescaling_8h.html#ab02b2429fe31010a5fba44b8091a178b">dboltzman_ratio_dT_div_boltzmann_ratio</a>(T, line.<a class="code" href="classAbsorption_1_1SingleLine.html#ab4752038522340c36ddc59ac0da23924">E0</a>()) - invQT * dQT_dT);</div>
<div class="line"><a name="l00668"></a><span class="lineno">  668</span>&#160;    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (deriv == JacPropMatType::LineStrength and</div>
<div class="line"><a name="l00669"></a><span class="lineno">  669</span>&#160;             <a class="code" href="namespaceAbsorption.html#a1554ecf51c40489e7f2a9f77a3314511">Absorption::id_in_line</a>(band, deriv.<a class="code" href="classAbsorption_1_1Lines.html#acadb529b972003acc1e782d855bdaa08">QuantumIdentity</a>(), line_ind))</div>
<div class="line"><a name="l00670"></a><span class="lineno">  670</span>&#160;      dF.col(iq).noalias() = F / line.<a class="code" href="classAbsorption_1_1SingleLine.html#add34adc6ce90e615ed173f6f4af28058">I0</a>();  <span class="comment">//nb. overwrite</span></div>
<div class="line"><a name="l00671"></a><span class="lineno">  671</span>&#160;    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (deriv == JacPropMatType::LineCenter and</div>
<div class="line"><a name="l00672"></a><span class="lineno">  672</span>&#160;             <a class="code" href="namespaceAbsorption.html#a1554ecf51c40489e7f2a9f77a3314511">Absorption::id_in_line</a>(band, deriv.<a class="code" href="classAbsorption_1_1Lines.html#acadb529b972003acc1e782d855bdaa08">QuantumIdentity</a>(), line_ind))</div>
<div class="line"><a name="l00673"></a><span class="lineno">  673</span>&#160;      dF.col(iq).noalias() +=</div>
<div class="line"><a name="l00674"></a><span class="lineno">  674</span>&#160;          F *</div>
<div class="line"><a name="l00675"></a><span class="lineno">  675</span>&#160;          <a class="code" href="linescaling_8cc.html#a8412d99dfcf6379f84a2350c371e9ea4">dstimulated_relative_emission_dF0</a>(gamma, gamma_ref, T, T0) /</div>
<div class="line"><a name="l00676"></a><span class="lineno">  676</span>&#160;          K2;</div>
<div class="line"><a name="l00677"></a><span class="lineno">  677</span>&#160;  }</div>
<div class="line"><a name="l00678"></a><span class="lineno">  678</span>&#160; </div>
<div class="line"><a name="l00679"></a><span class="lineno">  679</span>&#160;  <span class="comment">// No NLTE variables</span></div>
<div class="line"><a name="l00680"></a><span class="lineno">  680</span>&#160;  <a class="code" href="rng_8cc.html#a0240ac851181b84ac374872dc5434ee4">N</a>.setZero();</div>
<div class="line"><a name="l00681"></a><span class="lineno">  681</span>&#160;  dN.setZero();</div>
<div class="line"><a name="l00682"></a><span class="lineno">  682</span>&#160;}</div>
<div class="line"><a name="l00683"></a><span class="lineno">  683</span>&#160; </div>
<div class="line"><a name="l00684"></a><span class="lineno"><a class="line" href="namespaceLinefunctions.html#a773a49a85f1c95bf6680884d28c83680">  684</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="namespaceLinefunctions.html#a773a49a85f1c95bf6680884d28c83680">Linefunctions::apply_linestrength_scaling_by_vibrational_nlte</a>(</div>
<div class="line"><a name="l00685"></a><span class="lineno">  685</span>&#160;    Eigen::Ref&lt;Eigen::VectorXcd&gt; F,</div>
<div class="line"><a name="l00686"></a><span class="lineno">  686</span>&#160;    Eigen::Ref&lt;Eigen::MatrixXcd&gt; dF,</div>
<div class="line"><a name="l00687"></a><span class="lineno">  687</span>&#160;    Eigen::Ref&lt;Eigen::VectorXcd&gt; <a class="code" href="rng_8cc.html#a0240ac851181b84ac374872dc5434ee4">N</a>,</div>
<div class="line"><a name="l00688"></a><span class="lineno">  688</span>&#160;    Eigen::Ref&lt;Eigen::MatrixXcd&gt; dN,</div>
<div class="line"><a name="l00689"></a><span class="lineno">  689</span>&#160;    <span class="keyword">const</span> <a class="code" href="classAbsorption_1_1SingleLine.html">Absorption::SingleLine</a>&amp; line,</div>
<div class="line"><a name="l00690"></a><span class="lineno">  690</span>&#160;    <span class="keyword">const</span> <a class="code" href="matpack_8h.html#ad9a8dbb27c0bbea7271d916036122f6a">Numeric</a>&amp; T,</div>
<div class="line"><a name="l00691"></a><span class="lineno">  691</span>&#160;    <span class="keyword">const</span> <a class="code" href="matpack_8h.html#ad9a8dbb27c0bbea7271d916036122f6a">Numeric</a>&amp; T0,</div>
<div class="line"><a name="l00692"></a><span class="lineno">  692</span>&#160;    <span class="keyword">const</span> <a class="code" href="matpack_8h.html#ad9a8dbb27c0bbea7271d916036122f6a">Numeric</a>&amp; Tu,</div>
<div class="line"><a name="l00693"></a><span class="lineno">  693</span>&#160;    <span class="keyword">const</span> <a class="code" href="matpack_8h.html#ad9a8dbb27c0bbea7271d916036122f6a">Numeric</a>&amp; Tl,</div>
<div class="line"><a name="l00694"></a><span class="lineno">  694</span>&#160;    <span class="keyword">const</span> <a class="code" href="matpack_8h.html#ad9a8dbb27c0bbea7271d916036122f6a">Numeric</a>&amp; Evu,</div>
<div class="line"><a name="l00695"></a><span class="lineno">  695</span>&#160;    <span class="keyword">const</span> <a class="code" href="matpack_8h.html#ad9a8dbb27c0bbea7271d916036122f6a">Numeric</a>&amp; Evl,</div>
<div class="line"><a name="l00696"></a><span class="lineno">  696</span>&#160;    <span class="keyword">const</span> <a class="code" href="matpack_8h.html#ad9a8dbb27c0bbea7271d916036122f6a">Numeric</a>&amp; isotopic_ratio,</div>
<div class="line"><a name="l00697"></a><span class="lineno">  697</span>&#160;    <span class="keyword">const</span> <a class="code" href="matpack_8h.html#ad9a8dbb27c0bbea7271d916036122f6a">Numeric</a>&amp; QT,</div>
<div class="line"><a name="l00698"></a><span class="lineno">  698</span>&#160;    <span class="keyword">const</span> <a class="code" href="matpack_8h.html#ad9a8dbb27c0bbea7271d916036122f6a">Numeric</a>&amp; QT0,</div>
<div class="line"><a name="l00699"></a><span class="lineno">  699</span>&#160;    <span class="keyword">const</span> <a class="code" href="classAbsorption_1_1Lines.html">AbsorptionLines</a>&amp; band,</div>
<div class="line"><a name="l00700"></a><span class="lineno">  700</span>&#160;    <span class="keyword">const</span> <a class="code" href="matpack_8h.html#aedca4b4670b166565b5b40c700d65a7c">Index</a>&amp; line_ind,</div>
<div class="line"><a name="l00701"></a><span class="lineno">  701</span>&#160;    <span class="keyword">const</span> <a class="code" href="classArray.html">ArrayOfRetrievalQuantity</a>&amp; derivatives_data,</div>
<div class="line"><a name="l00702"></a><span class="lineno">  702</span>&#160;    <span class="keyword">const</span> <a class="code" href="classArray.html">ArrayOfIndex</a>&amp; derivatives_data_position,</div>
<div class="line"><a name="l00703"></a><span class="lineno">  703</span>&#160;    <span class="keyword">const</span> <a class="code" href="matpack_8h.html#ad9a8dbb27c0bbea7271d916036122f6a">Numeric</a>&amp; dQT_dT) {</div>
<div class="line"><a name="l00704"></a><span class="lineno">  704</span>&#160;  <span class="keyword">auto</span> nppd = derivatives_data_position.<a class="code" href="classArray.html#a90ce1cf3f99646da9d0efd6e8a661369">nelem</a>();</div>
<div class="line"><a name="l00705"></a><span class="lineno">  705</span>&#160; </div>
<div class="line"><a name="l00706"></a><span class="lineno">  706</span>&#160;  <span class="keyword">const</span> <a class="code" href="matpack_8h.html#ad9a8dbb27c0bbea7271d916036122f6a">Numeric</a> gamma = <a class="code" href="linescaling_8cc.html#a16a7ada6dba42dadd627b396720fb02a">stimulated_emission</a>(T,line.<a class="code" href="classAbsorption_1_1SingleLine.html#a842d8319d70a0804efb38c4d78b6123d">F0</a>());</div>
<div class="line"><a name="l00707"></a><span class="lineno">  707</span>&#160;  <span class="keyword">const</span> <a class="code" href="matpack_8h.html#ad9a8dbb27c0bbea7271d916036122f6a">Numeric</a> gamma_ref = <a class="code" href="linescaling_8cc.html#a16a7ada6dba42dadd627b396720fb02a">stimulated_emission</a>(T0,line.<a class="code" href="classAbsorption_1_1SingleLine.html#a842d8319d70a0804efb38c4d78b6123d">F0</a>());</div>
<div class="line"><a name="l00708"></a><span class="lineno">  708</span>&#160;  <span class="keyword">const</span> <a class="code" href="matpack_8h.html#ad9a8dbb27c0bbea7271d916036122f6a">Numeric</a> r_low = <a class="code" href="linescaling_8cc.html#a64bc2ecc08425b72e2a5d6355ed2fa1a">boltzman_ratio</a>(Tl,T,Evl);</div>
<div class="line"><a name="l00709"></a><span class="lineno">  709</span>&#160;  <span class="keyword">const</span> <a class="code" href="matpack_8h.html#ad9a8dbb27c0bbea7271d916036122f6a">Numeric</a> r_upp = <a class="code" href="linescaling_8cc.html#a64bc2ecc08425b72e2a5d6355ed2fa1a">boltzman_ratio</a>(Tu,T,Evu);</div>
<div class="line"><a name="l00710"></a><span class="lineno">  710</span>&#160; </div>
<div class="line"><a name="l00711"></a><span class="lineno">  711</span>&#160;  <span class="keyword">const</span> <a class="code" href="matpack_8h.html#ad9a8dbb27c0bbea7271d916036122f6a">Numeric</a> K1 = <a class="code" href="linescaling_8cc.html#a64bc2ecc08425b72e2a5d6355ed2fa1a">boltzman_ratio</a>(T,T0,line.<a class="code" href="classAbsorption_1_1SingleLine.html#ab4752038522340c36ddc59ac0da23924">E0</a>());</div>
<div class="line"><a name="l00712"></a><span class="lineno">  712</span>&#160;  <span class="keyword">const</span> <a class="code" href="matpack_8h.html#ad9a8dbb27c0bbea7271d916036122f6a">Numeric</a> K2 = <a class="code" href="linescaling_8cc.html#a1ae35d3f91bd7cc2f4e6f477b32794ea">stimulated_relative_emission</a>(gamma,gamma_ref);</div>
<div class="line"><a name="l00713"></a><span class="lineno">  713</span>&#160;  <span class="keyword">const</span> <a class="code" href="matpack_8h.html#ad9a8dbb27c0bbea7271d916036122f6a">Numeric</a> K3 = <a class="code" href="linescaling_8cc.html#a9d40c23c09539b98b621b8c92af0fab5">absorption_nlte_ratio</a>(gamma,r_upp,r_low);</div>
<div class="line"><a name="l00714"></a><span class="lineno">  714</span>&#160;  <span class="keyword">const</span> <a class="code" href="matpack_8h.html#ad9a8dbb27c0bbea7271d916036122f6a">Numeric</a> K4 = r_upp;</div>
<div class="line"><a name="l00715"></a><span class="lineno">  715</span>&#160; </div>
<div class="line"><a name="l00716"></a><span class="lineno">  716</span>&#160;  <span class="keyword">const</span> <a class="code" href="matpack_8h.html#ad9a8dbb27c0bbea7271d916036122f6a">Numeric</a> invQT = 1.0 / QT;</div>
<div class="line"><a name="l00717"></a><span class="lineno">  717</span>&#160;  <span class="keyword">const</span> <a class="code" href="matpack_8h.html#ad9a8dbb27c0bbea7271d916036122f6a">Numeric</a> QT_ratio = QT0 * invQT;</div>
<div class="line"><a name="l00718"></a><span class="lineno">  718</span>&#160; </div>
<div class="line"><a name="l00719"></a><span class="lineno">  719</span>&#160;  <span class="keyword">const</span> <a class="code" href="matpack_8h.html#ad9a8dbb27c0bbea7271d916036122f6a">Numeric</a> dS_dS0_abs = isotopic_ratio * QT_ratio * K1 * K2 * K3;</div>
<div class="line"><a name="l00720"></a><span class="lineno">  720</span>&#160;  <span class="keyword">const</span> <a class="code" href="matpack_8h.html#ad9a8dbb27c0bbea7271d916036122f6a">Numeric</a> S_abs = line.<a class="code" href="classAbsorption_1_1SingleLine.html#add34adc6ce90e615ed173f6f4af28058">I0</a>() * dS_dS0_abs;</div>
<div class="line"><a name="l00721"></a><span class="lineno">  721</span>&#160;  <span class="keyword">const</span> <a class="code" href="matpack_8h.html#ad9a8dbb27c0bbea7271d916036122f6a">Numeric</a> dS_dS0_src = isotopic_ratio * QT_ratio * K1 * K2 * K4;</div>
<div class="line"><a name="l00722"></a><span class="lineno">  722</span>&#160;  <span class="keyword">const</span> <a class="code" href="matpack_8h.html#ad9a8dbb27c0bbea7271d916036122f6a">Numeric</a> S_src = line.<a class="code" href="classAbsorption_1_1SingleLine.html#add34adc6ce90e615ed173f6f4af28058">I0</a>() * dS_dS0_src;</div>
<div class="line"><a name="l00723"></a><span class="lineno">  723</span>&#160; </div>
<div class="line"><a name="l00724"></a><span class="lineno">  724</span>&#160;  dN.noalias() = dF * (S_src - S_abs);</div>
<div class="line"><a name="l00725"></a><span class="lineno">  725</span>&#160;  dF *= S_abs;</div>
<div class="line"><a name="l00726"></a><span class="lineno">  726</span>&#160;  <span class="keywordflow">for</span> (<span class="keyword">auto</span> iq = 0; iq &lt; nppd; iq++) {</div>
<div class="line"><a name="l00727"></a><span class="lineno">  727</span>&#160;    <span class="keyword">const</span> <span class="keyword">auto</span>&amp; deriv = derivatives_data[derivatives_data_position[iq]];</div>
<div class="line"><a name="l00728"></a><span class="lineno">  728</span>&#160; </div>
<div class="line"><a name="l00729"></a><span class="lineno">  729</span>&#160;    <span class="keywordflow">if</span> (deriv == JacPropMatType::Temperature) {</div>
<div class="line"><a name="l00730"></a><span class="lineno">  730</span>&#160;      <span class="keyword">const</span> <a class="code" href="matpack_8h.html#ad9a8dbb27c0bbea7271d916036122f6a">Numeric</a> dS_dT_abs =</div>
<div class="line"><a name="l00731"></a><span class="lineno">  731</span>&#160;          S_abs *</div>
<div class="line"><a name="l00732"></a><span class="lineno">  732</span>&#160;          (<a class="code" href="linescaling_8cc.html#a11625c0ca9965f43039a4889a152c5fa">dstimulated_relative_emission_dT</a>(gamma, gamma_ref, line.<a class="code" href="classAbsorption_1_1SingleLine.html#a842d8319d70a0804efb38c4d78b6123d">F0</a>(), T) /</div>
<div class="line"><a name="l00733"></a><span class="lineno">  733</span>&#160;               K2 +</div>
<div class="line"><a name="l00734"></a><span class="lineno">  734</span>&#160;               <a class="code" href="linescaling_8cc.html#a746c537f064ec9a55f83895f47ed175a">dboltzman_ratio_dT</a>(K1, T, line.<a class="code" href="classAbsorption_1_1SingleLine.html#ab4752038522340c36ddc59ac0da23924">E0</a>()) / K1 +</div>
<div class="line"><a name="l00735"></a><span class="lineno">  735</span>&#160;               <a class="code" href="linescaling_8cc.html#a2257cdd186e99595e3c0a5aaa7615496">dabsorption_nlte_rate_dT</a>(gamma, T, line.<a class="code" href="classAbsorption_1_1SingleLine.html#a842d8319d70a0804efb38c4d78b6123d">F0</a>(), Evl, Evu, K4, r_low) /</div>
<div class="line"><a name="l00736"></a><span class="lineno">  736</span>&#160;               K3 -</div>
<div class="line"><a name="l00737"></a><span class="lineno">  737</span>&#160;           invQT * dQT_dT);</div>
<div class="line"><a name="l00738"></a><span class="lineno">  738</span>&#160;      <span class="keyword">const</span> <a class="code" href="matpack_8h.html#ad9a8dbb27c0bbea7271d916036122f6a">Numeric</a> dS_dT_src =</div>
<div class="line"><a name="l00739"></a><span class="lineno">  739</span>&#160;          S_src *</div>
<div class="line"><a name="l00740"></a><span class="lineno">  740</span>&#160;          (<a class="code" href="linescaling_8cc.html#a11625c0ca9965f43039a4889a152c5fa">dstimulated_relative_emission_dT</a>(gamma, gamma_ref, line.<a class="code" href="classAbsorption_1_1SingleLine.html#a842d8319d70a0804efb38c4d78b6123d">F0</a>(), T) /</div>
<div class="line"><a name="l00741"></a><span class="lineno">  741</span>&#160;               K2 +</div>
<div class="line"><a name="l00742"></a><span class="lineno">  742</span>&#160;               <a class="code" href="linescaling_8cc.html#a746c537f064ec9a55f83895f47ed175a">dboltzman_ratio_dT</a>(K1, T, line.<a class="code" href="classAbsorption_1_1SingleLine.html#ab4752038522340c36ddc59ac0da23924">E0</a>()) / K1 -</div>
<div class="line"><a name="l00743"></a><span class="lineno">  743</span>&#160;           <a class="code" href="linescaling_8cc.html#a746c537f064ec9a55f83895f47ed175a">dboltzman_ratio_dT</a>(K4, T, Evu) / K4 - invQT * dQT_dT);</div>
<div class="line"><a name="l00744"></a><span class="lineno">  744</span>&#160; </div>
<div class="line"><a name="l00745"></a><span class="lineno">  745</span>&#160;      dN.col(iq).noalias() += F * (dS_dT_src - dS_dT_abs);</div>
<div class="line"><a name="l00746"></a><span class="lineno">  746</span>&#160;      dF.col(iq).noalias() += F * dS_dT_abs;</div>
<div class="line"><a name="l00747"></a><span class="lineno">  747</span>&#160;    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (deriv == JacPropMatType::LineStrength and</div>
<div class="line"><a name="l00748"></a><span class="lineno">  748</span>&#160;               <a class="code" href="namespaceAbsorption.html#a1554ecf51c40489e7f2a9f77a3314511">Absorption::id_in_line</a>(band, deriv.<a class="code" href="classAbsorption_1_1Lines.html#acadb529b972003acc1e782d855bdaa08">QuantumIdentity</a>(), line_ind)) {</div>
<div class="line"><a name="l00749"></a><span class="lineno">  749</span>&#160;      dF.col(iq).noalias() = F * dS_dS0_abs;</div>
<div class="line"><a name="l00750"></a><span class="lineno">  750</span>&#160;      dN.col(iq).noalias() = F * (dS_dS0_src - dS_dS0_abs);</div>
<div class="line"><a name="l00751"></a><span class="lineno">  751</span>&#160;    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (deriv == JacPropMatType::LineCenter and</div>
<div class="line"><a name="l00752"></a><span class="lineno">  752</span>&#160;               <a class="code" href="namespaceAbsorption.html#a1554ecf51c40489e7f2a9f77a3314511">Absorption::id_in_line</a>(band, deriv.<a class="code" href="classAbsorption_1_1Lines.html#acadb529b972003acc1e782d855bdaa08">QuantumIdentity</a>(), line_ind)) {</div>
<div class="line"><a name="l00753"></a><span class="lineno">  753</span>&#160;      <span class="keyword">const</span> <a class="code" href="matpack_8h.html#ad9a8dbb27c0bbea7271d916036122f6a">Numeric</a> dS_dF0_abs =</div>
<div class="line"><a name="l00754"></a><span class="lineno">  754</span>&#160;          S_abs *</div>
<div class="line"><a name="l00755"></a><span class="lineno">  755</span>&#160;          (<a class="code" href="linescaling_8cc.html#a8412d99dfcf6379f84a2350c371e9ea4">dstimulated_relative_emission_dF0</a>(gamma, gamma_ref, T, T0) /</div>
<div class="line"><a name="l00756"></a><span class="lineno">  756</span>&#160;               K2 +</div>
<div class="line"><a name="l00757"></a><span class="lineno">  757</span>&#160;           <a class="code" href="linescaling_8cc.html#a2f98f6b42a682f767144ca8556894562">dabsorption_nlte_rate_dF0</a>(gamma, T, K4, r_low) / K3);</div>
<div class="line"><a name="l00758"></a><span class="lineno">  758</span>&#160;      <span class="keyword">const</span> <a class="code" href="matpack_8h.html#ad9a8dbb27c0bbea7271d916036122f6a">Numeric</a> dS_dF0_src =</div>
<div class="line"><a name="l00759"></a><span class="lineno">  759</span>&#160;          S_src *</div>
<div class="line"><a name="l00760"></a><span class="lineno">  760</span>&#160;          <a class="code" href="linescaling_8cc.html#a8412d99dfcf6379f84a2350c371e9ea4">dstimulated_relative_emission_dF0</a>(gamma, gamma_ref, T, T0) /</div>
<div class="line"><a name="l00761"></a><span class="lineno">  761</span>&#160;          K2;</div>
<div class="line"><a name="l00762"></a><span class="lineno">  762</span>&#160; </div>
<div class="line"><a name="l00763"></a><span class="lineno">  763</span>&#160;      dN.col(iq).noalias() += F * (dS_dF0_src - dS_dF0_abs);</div>
<div class="line"><a name="l00764"></a><span class="lineno">  764</span>&#160;      dF.col(iq).noalias() += F * dS_dF0_abs;</div>
<div class="line"><a name="l00765"></a><span class="lineno">  765</span>&#160;    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (deriv == JacPropMatType::NLTE) {</div>
<div class="line"><a name="l00766"></a><span class="lineno">  766</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="namespaceAbsorption.html#a4f80c08b2de23a8eedf6b39f8620ede3">Absorption::id_in_line_lower</a>(band, deriv.<a class="code" href="classAbsorption_1_1Lines.html#acadb529b972003acc1e782d855bdaa08">QuantumIdentity</a>(), line_ind)) {</div>
<div class="line"><a name="l00767"></a><span class="lineno">  767</span>&#160;        <span class="keyword">const</span> <a class="code" href="matpack_8h.html#ad9a8dbb27c0bbea7271d916036122f6a">Numeric</a> dS_dTl_abs =</div>
<div class="line"><a name="l00768"></a><span class="lineno">  768</span>&#160;            S_abs * <a class="code" href="linescaling_8cc.html#a69facfe63c9a186bc0ed8afc9f5dab85">dabsorption_nlte_rate_dTl</a>(gamma, T, Tl, Evl, r_low) / K3;</div>
<div class="line"><a name="l00769"></a><span class="lineno">  769</span>&#160; </div>
<div class="line"><a name="l00770"></a><span class="lineno">  770</span>&#160;        dN.col(iq).noalias() = -F * dS_dTl_abs;</div>
<div class="line"><a name="l00771"></a><span class="lineno">  771</span>&#160;        dF.col(iq).noalias() = -dN.col(iq);</div>
<div class="line"><a name="l00772"></a><span class="lineno">  772</span>&#160;      } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="namespaceAbsorption.html#afffee90a9935fd674729994ae79904e1">Absorption::id_in_line_upper</a>(band, deriv.<a class="code" href="classAbsorption_1_1Lines.html#acadb529b972003acc1e782d855bdaa08">QuantumIdentity</a>(), line_ind)) {</div>
<div class="line"><a name="l00773"></a><span class="lineno">  773</span>&#160;        <span class="keyword">const</span> <a class="code" href="matpack_8h.html#ad9a8dbb27c0bbea7271d916036122f6a">Numeric</a> dS_dTu_abs =</div>
<div class="line"><a name="l00774"></a><span class="lineno">  774</span>&#160;            S_abs * <a class="code" href="linescaling_8cc.html#ab1339d4881d896f88874953b49e33680">dabsorption_nlte_rate_dTu</a>(gamma, T, Tu, Evu, K4) / K3;</div>
<div class="line"><a name="l00775"></a><span class="lineno">  775</span>&#160;        <span class="keyword">const</span> <a class="code" href="matpack_8h.html#ad9a8dbb27c0bbea7271d916036122f6a">Numeric</a> dS_dTu_src = S_src * <a class="code" href="linescaling_8cc.html#a746c537f064ec9a55f83895f47ed175a">dboltzman_ratio_dT</a>(K4, Tu, Evu) / K4;</div>
<div class="line"><a name="l00776"></a><span class="lineno">  776</span>&#160; </div>
<div class="line"><a name="l00777"></a><span class="lineno">  777</span>&#160;        dN.col(iq).noalias() = F * (dS_dTu_src - dS_dTu_abs);</div>
<div class="line"><a name="l00778"></a><span class="lineno">  778</span>&#160;        dF.col(iq).noalias() = F * dS_dTu_abs;</div>
<div class="line"><a name="l00779"></a><span class="lineno">  779</span>&#160;      }</div>
<div class="line"><a name="l00780"></a><span class="lineno">  780</span>&#160;    }</div>
<div class="line"><a name="l00781"></a><span class="lineno">  781</span>&#160;  }</div>
<div class="line"><a name="l00782"></a><span class="lineno">  782</span>&#160;  </div>
<div class="line"><a name="l00783"></a><span class="lineno">  783</span>&#160;  <a class="code" href="rng_8cc.html#a0240ac851181b84ac374872dc5434ee4">N</a>.noalias() = F * (S_src - S_abs);</div>
<div class="line"><a name="l00784"></a><span class="lineno">  784</span>&#160;  F *= S_abs;</div>
<div class="line"><a name="l00785"></a><span class="lineno">  785</span>&#160;}</div>
<div class="line"><a name="l00786"></a><span class="lineno">  786</span>&#160; </div>
<div class="line"><a name="l00787"></a><span class="lineno"><a class="line" href="namespaceLinefunctions.html#afd8834345135ba3440f4f62e5e0bf276">  787</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="namespaceLinefunctions.html#afd8834345135ba3440f4f62e5e0bf276">Linefunctions::apply_lineshapemodel_jacobian_scaling</a>(</div>
<div class="line"><a name="l00788"></a><span class="lineno">  788</span>&#160;    Eigen::Ref&lt;Eigen::MatrixXcd&gt; dF,</div>
<div class="line"><a name="l00789"></a><span class="lineno">  789</span>&#160;    <span class="keyword">const</span> <a class="code" href="classAbsorption_1_1Lines.html">AbsorptionLines</a>&amp; band,</div>
<div class="line"><a name="l00790"></a><span class="lineno">  790</span>&#160;    <span class="keyword">const</span> <a class="code" href="matpack_8h.html#aedca4b4670b166565b5b40c700d65a7c">Index</a>&amp; line_ind,</div>
<div class="line"><a name="l00791"></a><span class="lineno">  791</span>&#160;    <span class="keyword">const</span> <a class="code" href="classArray.html">ArrayOfRetrievalQuantity</a>&amp; derivatives_data,</div>
<div class="line"><a name="l00792"></a><span class="lineno">  792</span>&#160;    <span class="keyword">const</span> <a class="code" href="classArray.html">ArrayOfIndex</a>&amp; derivatives_data_position,</div>
<div class="line"><a name="l00793"></a><span class="lineno">  793</span>&#160;    <span class="keyword">const</span> <a class="code" href="matpack_8h.html#ad9a8dbb27c0bbea7271d916036122f6a">Numeric</a>&amp; T,</div>
<div class="line"><a name="l00794"></a><span class="lineno">  794</span>&#160;    <span class="keyword">const</span> <a class="code" href="matpack_8h.html#ad9a8dbb27c0bbea7271d916036122f6a">Numeric</a>&amp; P,</div>
<div class="line"><a name="l00795"></a><span class="lineno">  795</span>&#160;    <span class="keyword">const</span> <a class="code" href="classVector.html">Vector</a>&amp; <a class="code" href="namespaceLineShape.html#a4b0cfb5637fe4bfa0bded7aefc4bb437">vmrs</a>) {</div>
<div class="line"><a name="l00796"></a><span class="lineno">  796</span>&#160;  <span class="keyword">auto</span> nppd = derivatives_data_position.<a class="code" href="classArray.html#a90ce1cf3f99646da9d0efd6e8a661369">nelem</a>();</div>
<div class="line"><a name="l00797"></a><span class="lineno">  797</span>&#160; </div>
<div class="line"><a name="l00798"></a><span class="lineno">  798</span>&#160;  <span class="keywordflow">for</span> (<span class="keyword">auto</span> iq = 0; iq &lt; nppd; iq++) {</div>
<div class="line"><a name="l00799"></a><span class="lineno">  799</span>&#160;    <span class="keyword">const</span> <a class="code" href="classRetrievalQuantity.html">RetrievalQuantity</a>&amp; rt =</div>
<div class="line"><a name="l00800"></a><span class="lineno">  800</span>&#160;        derivatives_data[derivatives_data_position[iq]];</div>
<div class="line"><a name="l00801"></a><span class="lineno">  801</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="jacobian_8cc.html#a640c3636682444c1ff31daa0aceaf30a">is_lineshape_parameter</a>(rt) and</div>
<div class="line"><a name="l00802"></a><span class="lineno">  802</span>&#160;        <a class="code" href="namespaceAbsorption.html#a1554ecf51c40489e7f2a9f77a3314511">Absorption::id_in_line</a>(band, rt.<a class="code" href="classRetrievalQuantity.html#a51b340f8988eb17696b9621d03da2751">QuantumIdentity</a>(), line_ind))</div>
<div class="line"><a name="l00803"></a><span class="lineno">  803</span>&#160;      dF.col(iq) *= band.<a class="code" href="classAbsorption_1_1Lines.html#a6b65571e7669eabb2c94e847ba8cac0b">ShapeParameter_dInternal</a>(line_ind, T, P, <a class="code" href="namespaceLineShape.html#a4b0cfb5637fe4bfa0bded7aefc4bb437">vmrs</a>, rt);</div>
<div class="line"><a name="l00804"></a><span class="lineno">  804</span>&#160;  }</div>
<div class="line"><a name="l00805"></a><span class="lineno">  805</span>&#160;}</div>
<div class="line"><a name="l00806"></a><span class="lineno">  806</span>&#160; </div>
<div class="line"><a name="l00807"></a><span class="lineno"><a class="line" href="namespaceLinefunctions.html#a770118e293deb4ed5108f7a481921162">  807</a></span>&#160;<a class="code" href="matpack_8h.html#ad9a8dbb27c0bbea7271d916036122f6a">Numeric</a> <a class="code" href="namespaceLinefunctions.html#a770118e293deb4ed5108f7a481921162">Linefunctions::DopplerConstant</a>(<a class="code" href="matpack_8h.html#ad9a8dbb27c0bbea7271d916036122f6a">Numeric</a> T, <a class="code" href="matpack_8h.html#ad9a8dbb27c0bbea7271d916036122f6a">Numeric</a> mass) {</div>
<div class="line"><a name="l00808"></a><span class="lineno">  808</span>&#160;  <span class="keywordflow">return</span> <a class="code" href="rational_8h.html#a7d3b5e4723b5fa0df29f00a27a6ab8f0">std::sqrt</a>(Constant::doppler_broadening_const_squared * T / mass);</div>
<div class="line"><a name="l00809"></a><span class="lineno">  809</span>&#160;}</div>
<div class="line"><a name="l00810"></a><span class="lineno">  810</span>&#160; </div>
<div class="line"><a name="l00811"></a><span class="lineno"><a class="line" href="namespaceLinefunctions.html#a3e0ce20f6ce98dfe751eee8d6d86a2ab">  811</a></span>&#160;<a class="code" href="matpack_8h.html#ad9a8dbb27c0bbea7271d916036122f6a">Numeric</a> <a class="code" href="namespaceLinefunctions.html#a3e0ce20f6ce98dfe751eee8d6d86a2ab">Linefunctions::dDopplerConstant_dT</a>(<span class="keyword">const</span> <a class="code" href="matpack_8h.html#ad9a8dbb27c0bbea7271d916036122f6a">Numeric</a>&amp; T,</div>
<div class="line"><a name="l00812"></a><span class="lineno">  812</span>&#160;                                           <span class="keyword">const</span> <a class="code" href="matpack_8h.html#ad9a8dbb27c0bbea7271d916036122f6a">Numeric</a>&amp; dc) {</div>
<div class="line"><a name="l00813"></a><span class="lineno">  813</span>&#160;  <span class="keywordflow">return</span> dc / (2 * T);</div>
<div class="line"><a name="l00814"></a><span class="lineno">  814</span>&#160;}</div>
<div class="line"><a name="l00815"></a><span class="lineno">  815</span>&#160; </div>
<div class="line"><a name="l00816"></a><span class="lineno"><a class="line" href="namespaceLinefunctions.html#a6692d67ff28ec4a405b0a893e9584a17">  816</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="namespaceLinefunctions.html#a6692d67ff28ec4a405b0a893e9584a17">Linefunctions::find_cutoff_ranges</a>(</div>
<div class="line"><a name="l00817"></a><span class="lineno">  817</span>&#160;    <a class="code" href="matpack_8h.html#aedca4b4670b166565b5b40c700d65a7c">Index</a>&amp; start_cutoff,</div>
<div class="line"><a name="l00818"></a><span class="lineno">  818</span>&#160;    <a class="code" href="matpack_8h.html#aedca4b4670b166565b5b40c700d65a7c">Index</a>&amp; nelem_cutoff,</div>
<div class="line"><a name="l00819"></a><span class="lineno">  819</span>&#160;    <span class="keyword">const</span> Eigen::Ref&lt;const Eigen::VectorXd&gt; <a class="code" href="namespaceARTS_1_1Var.html#a656f34b4c40189bd3c971e2d3dbe3b95">f_grid</a>,</div>
<div class="line"><a name="l00820"></a><span class="lineno">  820</span>&#160;    <span class="keyword">const</span> <a class="code" href="matpack_8h.html#ad9a8dbb27c0bbea7271d916036122f6a">Numeric</a>&amp; fmin,</div>
<div class="line"><a name="l00821"></a><span class="lineno">  821</span>&#160;    <span class="keyword">const</span> <a class="code" href="matpack_8h.html#ad9a8dbb27c0bbea7271d916036122f6a">Numeric</a>&amp; fmax) {</div>
<div class="line"><a name="l00822"></a><span class="lineno">  822</span>&#160;  <span class="keyword">auto</span> nf = <a class="code" href="namespaceARTS_1_1Var.html#a656f34b4c40189bd3c971e2d3dbe3b95">f_grid</a>.size();</div>
<div class="line"><a name="l00823"></a><span class="lineno">  823</span>&#160; </div>
<div class="line"><a name="l00824"></a><span class="lineno">  824</span>&#160;  <span class="keyword">const</span> <span class="keywordtype">bool</span> need_cutoff = (fmax &gt; fmin);</div>
<div class="line"><a name="l00825"></a><span class="lineno">  825</span>&#160;  <span class="keywordflow">if</span> (need_cutoff) {</div>
<div class="line"><a name="l00826"></a><span class="lineno">  826</span>&#160;    <span class="comment">// Find range of simulations</span></div>
<div class="line"><a name="l00827"></a><span class="lineno">  827</span>&#160;    start_cutoff = 0;</div>
<div class="line"><a name="l00828"></a><span class="lineno">  828</span>&#160;    <a class="code" href="matpack_8h.html#aedca4b4670b166565b5b40c700d65a7c">Index</a> i_f_max = nf - 1;</div>
<div class="line"><a name="l00829"></a><span class="lineno">  829</span>&#160; </div>
<div class="line"><a name="l00830"></a><span class="lineno">  830</span>&#160;    <span class="comment">// Loop over positions to compute the line shape cutoff point</span></div>
<div class="line"><a name="l00831"></a><span class="lineno">  831</span>&#160;    <span class="keywordflow">while</span> (start_cutoff &lt; nf and fmin &gt; <a class="code" href="namespaceARTS_1_1Var.html#a656f34b4c40189bd3c971e2d3dbe3b95">f_grid</a>[start_cutoff])</div>
<div class="line"><a name="l00832"></a><span class="lineno">  832</span>&#160;      ++start_cutoff;</div>
<div class="line"><a name="l00833"></a><span class="lineno">  833</span>&#160;    <span class="keywordflow">while</span> (i_f_max &gt;= start_cutoff and fmax &lt; <a class="code" href="namespaceARTS_1_1Var.html#a656f34b4c40189bd3c971e2d3dbe3b95">f_grid</a>[i_f_max])</div>
<div class="line"><a name="l00834"></a><span class="lineno">  834</span>&#160;      --i_f_max;</div>
<div class="line"><a name="l00835"></a><span class="lineno">  835</span>&#160; </div>
<div class="line"><a name="l00836"></a><span class="lineno">  836</span>&#160;    <span class="comment">//  The extent is one more than the difference between the indices of interest</span></div>
<div class="line"><a name="l00837"></a><span class="lineno">  837</span>&#160;    nelem_cutoff = i_f_max - start_cutoff + 1;  <span class="comment">// min is 0, max is nf</span></div>
<div class="line"><a name="l00838"></a><span class="lineno">  838</span>&#160;  } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00839"></a><span class="lineno">  839</span>&#160;    start_cutoff = 0;</div>
<div class="line"><a name="l00840"></a><span class="lineno">  840</span>&#160;    nelem_cutoff = nf;</div>
<div class="line"><a name="l00841"></a><span class="lineno">  841</span>&#160;  }</div>
<div class="line"><a name="l00842"></a><span class="lineno">  842</span>&#160;}</div>
<div class="line"><a name="l00843"></a><span class="lineno">  843</span>&#160; </div>
<div class="line"><a name="l00844"></a><span class="lineno"><a class="line" href="namespaceLinefunctions.html#aca2a2edc63a0f046ca2cc3f9c1cd00a4">  844</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="namespaceLinefunctions.html#aca2a2edc63a0f046ca2cc3f9c1cd00a4">Linefunctions::apply_linestrength_from_nlte_level_distributions</a>(</div>
<div class="line"><a name="l00845"></a><span class="lineno">  845</span>&#160;    Eigen::Ref&lt;Eigen::VectorXcd&gt; F,</div>
<div class="line"><a name="l00846"></a><span class="lineno">  846</span>&#160;    Eigen::Ref&lt;Eigen::MatrixXcd&gt; dF,</div>
<div class="line"><a name="l00847"></a><span class="lineno">  847</span>&#160;    Eigen::Ref&lt;Eigen::VectorXcd&gt; <a class="code" href="rng_8cc.html#a0240ac851181b84ac374872dc5434ee4">N</a>,</div>
<div class="line"><a name="l00848"></a><span class="lineno">  848</span>&#160;    Eigen::Ref&lt;Eigen::MatrixXcd&gt; dN,</div>
<div class="line"><a name="l00849"></a><span class="lineno">  849</span>&#160;    <span class="keyword">const</span> <a class="code" href="matpack_8h.html#ad9a8dbb27c0bbea7271d916036122f6a">Numeric</a>&amp; r1,</div>
<div class="line"><a name="l00850"></a><span class="lineno">  850</span>&#160;    <span class="keyword">const</span> <a class="code" href="matpack_8h.html#ad9a8dbb27c0bbea7271d916036122f6a">Numeric</a>&amp; r2,</div>
<div class="line"><a name="l00851"></a><span class="lineno">  851</span>&#160;    <span class="keyword">const</span> <a class="code" href="matpack_8h.html#ad9a8dbb27c0bbea7271d916036122f6a">Numeric</a>&amp; g1,</div>
<div class="line"><a name="l00852"></a><span class="lineno">  852</span>&#160;    <span class="keyword">const</span> <a class="code" href="matpack_8h.html#ad9a8dbb27c0bbea7271d916036122f6a">Numeric</a>&amp; g2,</div>
<div class="line"><a name="l00853"></a><span class="lineno">  853</span>&#160;    <span class="keyword">const</span> <a class="code" href="matpack_8h.html#ad9a8dbb27c0bbea7271d916036122f6a">Numeric</a>&amp; A21,</div>
<div class="line"><a name="l00854"></a><span class="lineno">  854</span>&#160;    <span class="keyword">const</span> <a class="code" href="matpack_8h.html#ad9a8dbb27c0bbea7271d916036122f6a">Numeric</a>&amp; <a class="code" href="arts__api__classes_8cc.html#afa1d4d1245df45b0d97cf72f5a58120d">F0</a>,</div>
<div class="line"><a name="l00855"></a><span class="lineno">  855</span>&#160;    <span class="keyword">const</span> <a class="code" href="matpack_8h.html#ad9a8dbb27c0bbea7271d916036122f6a">Numeric</a>&amp; T,</div>
<div class="line"><a name="l00856"></a><span class="lineno">  856</span>&#160;  <span class="keyword">const</span> <a class="code" href="classAbsorption_1_1Lines.html">AbsorptionLines</a>&amp; band,</div>
<div class="line"><a name="l00857"></a><span class="lineno">  857</span>&#160;  <span class="keyword">const</span> <a class="code" href="matpack_8h.html#aedca4b4670b166565b5b40c700d65a7c">Index</a>&amp; line_ind,</div>
<div class="line"><a name="l00858"></a><span class="lineno">  858</span>&#160;    <span class="keyword">const</span> <a class="code" href="classArray.html">ArrayOfRetrievalQuantity</a>&amp; derivatives_data,</div>
<div class="line"><a name="l00859"></a><span class="lineno">  859</span>&#160;    <span class="keyword">const</span> <a class="code" href="classArray.html">ArrayOfIndex</a>&amp; derivatives_data_position) {</div>
<div class="line"><a name="l00860"></a><span class="lineno">  860</span>&#160;  <span class="comment">// Size of the problem</span></div>
<div class="line"><a name="l00861"></a><span class="lineno">  861</span>&#160;  <span class="keyword">auto</span> nppd = derivatives_data_position.<a class="code" href="classArray.html#a90ce1cf3f99646da9d0efd6e8a661369">nelem</a>();</div>
<div class="line"><a name="l00862"></a><span class="lineno">  862</span>&#160; </div>
<div class="line"><a name="l00863"></a><span class="lineno">  863</span>&#160;  <span class="comment">// Physical constants</span></div>
<div class="line"><a name="l00864"></a><span class="lineno">  864</span>&#160;  constexpr <a class="code" href="matpack_8h.html#ad9a8dbb27c0bbea7271d916036122f6a">Numeric</a> c0 = 2.0 * Constant::h / <a class="code" href="namespaceConstant.html#a7f485605d9dab3fde05d52f03ca9f36e">Constant::pow2</a>(Constant::c);</div>
<div class="line"><a name="l00865"></a><span class="lineno">  865</span>&#160;  constexpr <a class="code" href="matpack_8h.html#ad9a8dbb27c0bbea7271d916036122f6a">Numeric</a> c1 = Constant::h / (4 * Constant::pi);</div>
<div class="line"><a name="l00866"></a><span class="lineno">  866</span>&#160; </div>
<div class="line"><a name="l00867"></a><span class="lineno">  867</span>&#160;  <span class="comment">// Constants based on input</span></div>
<div class="line"><a name="l00868"></a><span class="lineno">  868</span>&#160;  <span class="keyword">const</span> <a class="code" href="matpack_8h.html#ad9a8dbb27c0bbea7271d916036122f6a">Numeric</a> c2 = c0 * <a class="code" href="arts__api__classes_8cc.html#afa1d4d1245df45b0d97cf72f5a58120d">F0</a> * <a class="code" href="arts__api__classes_8cc.html#afa1d4d1245df45b0d97cf72f5a58120d">F0</a> * <a class="code" href="arts__api__classes_8cc.html#afa1d4d1245df45b0d97cf72f5a58120d">F0</a>;</div>
<div class="line"><a name="l00869"></a><span class="lineno">  869</span>&#160;  <span class="keyword">const</span> <a class="code" href="matpack_8h.html#ad9a8dbb27c0bbea7271d916036122f6a">Numeric</a> c3 = c1 * <a class="code" href="arts__api__classes_8cc.html#afa1d4d1245df45b0d97cf72f5a58120d">F0</a>;</div>
<div class="line"><a name="l00870"></a><span class="lineno">  870</span>&#160;  <span class="keyword">const</span> <a class="code" href="matpack_8h.html#ad9a8dbb27c0bbea7271d916036122f6a">Numeric</a> <a class="code" href="namespaceARTS_1_1Var.html#aeb141694315061634800e0ddc30701ca">x</a> = g2 / g1;</div>
<div class="line"><a name="l00871"></a><span class="lineno">  871</span>&#160; </div>
<div class="line"><a name="l00872"></a><span class="lineno">  872</span>&#160;  <span class="comment">/*</span></div>
<div class="line"><a name="l00873"></a><span class="lineno">  873</span>&#160;<span class="comment">    Einstein &#39;active&#39; coefficients are as follows:</span></div>
<div class="line"><a name="l00874"></a><span class="lineno">  874</span>&#160;<span class="comment">    const Numeric B21 =  A21 / c2;</span></div>
<div class="line"><a name="l00875"></a><span class="lineno">  875</span>&#160;<span class="comment">    const Numeric B12 = x * B21;</span></div>
<div class="line"><a name="l00876"></a><span class="lineno">  876</span>&#160;<span class="comment">  */</span></div>
<div class="line"><a name="l00877"></a><span class="lineno">  877</span>&#160; </div>
<div class="line"><a name="l00878"></a><span class="lineno">  878</span>&#160;  <span class="comment">// Absorption strength</span></div>
<div class="line"><a name="l00879"></a><span class="lineno">  879</span>&#160;  <span class="keyword">const</span> <a class="code" href="matpack_8h.html#ad9a8dbb27c0bbea7271d916036122f6a">Numeric</a> k = c3 * (r1 * <a class="code" href="namespaceARTS_1_1Var.html#aeb141694315061634800e0ddc30701ca">x</a> - r2) * (A21 / c2);</div>
<div class="line"><a name="l00880"></a><span class="lineno">  880</span>&#160; </div>
<div class="line"><a name="l00881"></a><span class="lineno">  881</span>&#160;  <span class="comment">// Emission strength</span></div>
<div class="line"><a name="l00882"></a><span class="lineno">  882</span>&#160;  <span class="keyword">const</span> <a class="code" href="matpack_8h.html#ad9a8dbb27c0bbea7271d916036122f6a">Numeric</a> e = c3 * r2 * A21;</div>
<div class="line"><a name="l00883"></a><span class="lineno">  883</span>&#160; </div>
<div class="line"><a name="l00884"></a><span class="lineno">  884</span>&#160;  <span class="comment">// Planck function of this line</span></div>
<div class="line"><a name="l00885"></a><span class="lineno">  885</span>&#160;  <span class="keyword">const</span> <a class="code" href="matpack_8h.html#ad9a8dbb27c0bbea7271d916036122f6a">Numeric</a> exp_T = std::exp(Constant::h / Constant::k * <a class="code" href="arts__api__classes_8cc.html#afa1d4d1245df45b0d97cf72f5a58120d">F0</a> / T),</div>
<div class="line"><a name="l00886"></a><span class="lineno">  886</span>&#160;                b = c2 / (exp_T - 1);</div>
<div class="line"><a name="l00887"></a><span class="lineno">  887</span>&#160; </div>
<div class="line"><a name="l00888"></a><span class="lineno">  888</span>&#160;  <span class="comment">// Ratio between emission and absorption constant</span></div>
<div class="line"><a name="l00889"></a><span class="lineno">  889</span>&#160;  <span class="keyword">const</span> <a class="code" href="matpack_8h.html#ad9a8dbb27c0bbea7271d916036122f6a">Numeric</a> ratio = e / b - k;</div>
<div class="line"><a name="l00890"></a><span class="lineno">  890</span>&#160;  </div>
<div class="line"><a name="l00891"></a><span class="lineno">  891</span>&#160;  <span class="comment">// Constants ALMOST everywhere inside these loops</span></div>
<div class="line"><a name="l00892"></a><span class="lineno">  892</span>&#160;  dN.noalias() = dF * ratio;</div>
<div class="line"><a name="l00893"></a><span class="lineno">  893</span>&#160;  dF *= k;</div>
<div class="line"><a name="l00894"></a><span class="lineno">  894</span>&#160; </div>
<div class="line"><a name="l00895"></a><span class="lineno">  895</span>&#160;  <span class="comment">// Partial derivatives</span></div>
<div class="line"><a name="l00896"></a><span class="lineno">  896</span>&#160;  <span class="keywordflow">for</span> (<span class="keyword">auto</span> iq = 0; iq &lt; nppd; iq++) {</div>
<div class="line"><a name="l00897"></a><span class="lineno">  897</span>&#160;    <span class="keyword">const</span> <span class="keyword">auto</span>&amp; deriv = derivatives_data[derivatives_data_position[iq]];</div>
<div class="line"><a name="l00898"></a><span class="lineno">  898</span>&#160; </div>
<div class="line"><a name="l00899"></a><span class="lineno">  899</span>&#160;    <span class="keywordflow">if</span> (deriv == JacPropMatType::Temperature)</div>
<div class="line"><a name="l00900"></a><span class="lineno">  900</span>&#160;      dN.col(iq).noalias() +=</div>
<div class="line"><a name="l00901"></a><span class="lineno">  901</span>&#160;          F * e * Constant::h * <a class="code" href="arts__api__classes_8cc.html#afa1d4d1245df45b0d97cf72f5a58120d">F0</a> * exp_T / (c2 * Constant::k * T * T);</div>
<div class="line"><a name="l00902"></a><span class="lineno">  902</span>&#160;    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (deriv == JacPropMatType::LineCenter and</div>
<div class="line"><a name="l00903"></a><span class="lineno">  903</span>&#160;             <a class="code" href="namespaceAbsorption.html#a1554ecf51c40489e7f2a9f77a3314511">Absorption::id_in_line</a>(band, deriv.<a class="code" href="classAbsorption_1_1Lines.html#acadb529b972003acc1e782d855bdaa08">QuantumIdentity</a>(), line_ind)) {</div>
<div class="line"><a name="l00904"></a><span class="lineno">  904</span>&#160;      <a class="code" href="matpack_8h.html#ad9a8dbb27c0bbea7271d916036122f6a">Numeric</a> done_over_b_df0 =</div>
<div class="line"><a name="l00905"></a><span class="lineno">  905</span>&#160;          Constant::h * exp_T / (c2 * Constant::k * T) - 3.0 * b / <a class="code" href="arts__api__classes_8cc.html#afa1d4d1245df45b0d97cf72f5a58120d">F0</a>;</div>
<div class="line"><a name="l00906"></a><span class="lineno">  906</span>&#160;      <a class="code" href="matpack_8h.html#ad9a8dbb27c0bbea7271d916036122f6a">Numeric</a> de_df0 = c1 * r2 * A21;</div>
<div class="line"><a name="l00907"></a><span class="lineno">  907</span>&#160;      <a class="code" href="matpack_8h.html#ad9a8dbb27c0bbea7271d916036122f6a">Numeric</a> dk_df0 = c1 * (r1 * <a class="code" href="namespaceARTS_1_1Var.html#aeb141694315061634800e0ddc30701ca">x</a> - r2) * (A21 / c2) - 3.0 * k / <a class="code" href="arts__api__classes_8cc.html#afa1d4d1245df45b0d97cf72f5a58120d">F0</a>;</div>
<div class="line"><a name="l00908"></a><span class="lineno">  908</span>&#160; </div>
<div class="line"><a name="l00909"></a><span class="lineno">  909</span>&#160;      dN.col(iq).noalias() += F * (e * done_over_b_df0 + de_df0 / b - dk_df0);</div>
<div class="line"><a name="l00910"></a><span class="lineno">  910</span>&#160;      dF.col(iq).noalias() += F * dk_df0;</div>
<div class="line"><a name="l00911"></a><span class="lineno">  911</span>&#160;    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (deriv == JacPropMatType::NLTE) {</div>
<div class="line"><a name="l00912"></a><span class="lineno">  912</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="namespaceAbsorption.html#a4f80c08b2de23a8eedf6b39f8620ede3">Absorption::id_in_line_lower</a>(band, deriv.<a class="code" href="classAbsorption_1_1Lines.html#acadb529b972003acc1e782d855bdaa08">QuantumIdentity</a>(), line_ind)) {</div>
<div class="line"><a name="l00913"></a><span class="lineno">  913</span>&#160;        <span class="keyword">const</span> <a class="code" href="matpack_8h.html#ad9a8dbb27c0bbea7271d916036122f6a">Numeric</a> dk_dr2 = -c3 * A21 / c2, de_dr2 = c3 * A21,</div>
<div class="line"><a name="l00914"></a><span class="lineno">  914</span>&#160;                      dratio_dr2 = de_dr2 / b - dk_dr2;</div>
<div class="line"><a name="l00915"></a><span class="lineno">  915</span>&#160;        dN.col(iq).noalias() = F * dratio_dr2;</div>
<div class="line"><a name="l00916"></a><span class="lineno">  916</span>&#160;        dF.col(iq).noalias() = F * dk_dr2;</div>
<div class="line"><a name="l00917"></a><span class="lineno">  917</span>&#160;      } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="namespaceAbsorption.html#afffee90a9935fd674729994ae79904e1">Absorption::id_in_line_upper</a>(band, deriv.<a class="code" href="classAbsorption_1_1Lines.html#acadb529b972003acc1e782d855bdaa08">QuantumIdentity</a>(), line_ind)) {</div>
<div class="line"><a name="l00918"></a><span class="lineno">  918</span>&#160;        <span class="keyword">const</span> <a class="code" href="matpack_8h.html#ad9a8dbb27c0bbea7271d916036122f6a">Numeric</a> dk_dr1 = c3 * <a class="code" href="namespaceARTS_1_1Var.html#aeb141694315061634800e0ddc30701ca">x</a> * A21 / c2;</div>
<div class="line"><a name="l00919"></a><span class="lineno">  919</span>&#160;        dF.col(iq).noalias() = F * dk_dr1;</div>
<div class="line"><a name="l00920"></a><span class="lineno">  920</span>&#160;      }</div>
<div class="line"><a name="l00921"></a><span class="lineno">  921</span>&#160;    }</div>
<div class="line"><a name="l00922"></a><span class="lineno">  922</span>&#160;  }</div>
<div class="line"><a name="l00923"></a><span class="lineno">  923</span>&#160; </div>
<div class="line"><a name="l00924"></a><span class="lineno">  924</span>&#160;  <span class="comment">// Set source function to be the relative amount emitted by the line divided by the Planck function</span></div>
<div class="line"><a name="l00925"></a><span class="lineno">  925</span>&#160;  <a class="code" href="rng_8cc.html#a0240ac851181b84ac374872dc5434ee4">N</a>.noalias() = F * ratio;</div>
<div class="line"><a name="l00926"></a><span class="lineno">  926</span>&#160; </div>
<div class="line"><a name="l00927"></a><span class="lineno">  927</span>&#160;  <span class="comment">// Set absorption</span></div>
<div class="line"><a name="l00928"></a><span class="lineno">  928</span>&#160;  F *= k;</div>
<div class="line"><a name="l00929"></a><span class="lineno">  929</span>&#160;}</div>
<div class="line"><a name="l00930"></a><span class="lineno">  930</span>&#160; </div>
<div class="line"><a name="l00931"></a><span class="lineno"><a class="line" href="namespaceLinefunctions.html#aa63d54039a4b96c9ca7f74524c1baa73">  931</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="namespaceLinefunctions.html#aa63d54039a4b96c9ca7f74524c1baa73">Linefunctions::set_htp</a>(Eigen::Ref&lt;Eigen::VectorXcd&gt; F,</div>
<div class="line"><a name="l00932"></a><span class="lineno">  932</span>&#160;                            Eigen::Ref&lt;Eigen::MatrixXcd&gt; dF,</div>
<div class="line"><a name="l00933"></a><span class="lineno">  933</span>&#160;                            <span class="keyword">const</span> Eigen::Ref&lt;const Eigen::VectorXd&gt; <a class="code" href="namespaceARTS_1_1Var.html#a656f34b4c40189bd3c971e2d3dbe3b95">f_grid</a>,</div>
<div class="line"><a name="l00934"></a><span class="lineno">  934</span>&#160;                            <span class="keyword">const</span> <a class="code" href="matpack_8h.html#ad9a8dbb27c0bbea7271d916036122f6a">Numeric</a>&amp; zeeman_df_si,</div>
<div class="line"><a name="l00935"></a><span class="lineno">  935</span>&#160;                            <span class="keyword">const</span> <a class="code" href="matpack_8h.html#ad9a8dbb27c0bbea7271d916036122f6a">Numeric</a>&amp; magnetic_magnitude_si,</div>
<div class="line"><a name="l00936"></a><span class="lineno">  936</span>&#160;                            <span class="keyword">const</span> <a class="code" href="matpack_8h.html#ad9a8dbb27c0bbea7271d916036122f6a">Numeric</a>&amp; F0_noshift_si,</div>
<div class="line"><a name="l00937"></a><span class="lineno">  937</span>&#160;                            <span class="keyword">const</span> <a class="code" href="matpack_8h.html#ad9a8dbb27c0bbea7271d916036122f6a">Numeric</a>&amp; GD_div_F0_si,</div>
<div class="line"><a name="l00938"></a><span class="lineno">  938</span>&#160;                            <span class="keyword">const</span> <a class="code" href="structLineShape_1_1Output.html">LineShape::Output</a>&amp; lso_si,</div>
<div class="line"><a name="l00939"></a><span class="lineno">  939</span>&#160;                            <span class="keyword">const</span> <a class="code" href="classAbsorption_1_1Lines.html">AbsorptionLines</a>&amp; band,</div>
<div class="line"><a name="l00940"></a><span class="lineno">  940</span>&#160;                            <span class="keyword">const</span> <a class="code" href="matpack_8h.html#aedca4b4670b166565b5b40c700d65a7c">Index</a>&amp; line_ind,</div>
<div class="line"><a name="l00941"></a><span class="lineno">  941</span>&#160;                            <span class="keyword">const</span> <a class="code" href="classArray.html">ArrayOfRetrievalQuantity</a>&amp; derivatives_data,</div>
<div class="line"><a name="l00942"></a><span class="lineno">  942</span>&#160;                            <span class="keyword">const</span> <a class="code" href="classArray.html">ArrayOfIndex</a>&amp; derivatives_data_position,</div>
<div class="line"><a name="l00943"></a><span class="lineno">  943</span>&#160;                            <span class="keyword">const</span> <a class="code" href="matpack_8h.html#ad9a8dbb27c0bbea7271d916036122f6a">Numeric</a>&amp; dGD_div_F0_dT_si,</div>
<div class="line"><a name="l00944"></a><span class="lineno">  944</span>&#160;                            <span class="keyword">const</span> <a class="code" href="structLineShape_1_1Output.html">LineShape::Output</a>&amp; dT_si,</div>
<div class="line"><a name="l00945"></a><span class="lineno">  945</span>&#160;                            <span class="keyword">const</span> <a class="code" href="structLineShape_1_1Output.html">LineShape::Output</a>&amp; dVMR_si) {</div>
<div class="line"><a name="l00946"></a><span class="lineno">  946</span>&#160;  <span class="keyword">using</span> Constant::inv_sqrt_pi;</div>
<div class="line"><a name="l00947"></a><span class="lineno">  947</span>&#160;  <span class="keyword">using</span> Constant::pi;</div>
<div class="line"><a name="l00948"></a><span class="lineno">  948</span>&#160;  <span class="keyword">using</span> <a class="code" href="namespaceConstant.html#a7f485605d9dab3fde05d52f03ca9f36e">Constant::pow2</a>;</div>
<div class="line"><a name="l00949"></a><span class="lineno">  949</span>&#160;  <span class="keyword">using</span> <a class="code" href="namespaceConstant.html#aa415feed8b057c59bc7965f74cc1331d">Constant::pow3</a>;</div>
<div class="line"><a name="l00950"></a><span class="lineno">  950</span>&#160;  <span class="keyword">using</span> <a class="code" href="namespaceConstant.html#a9b0ce133f5cf1a3d76c2ae3dc7aca0b8">Constant::pow4</a>;</div>
<div class="line"><a name="l00951"></a><span class="lineno">  951</span>&#160;  <span class="keyword">using</span> Constant::sqrt_ln_2;</div>
<div class="line"><a name="l00952"></a><span class="lineno">  952</span>&#160;  <span class="keyword">using</span> Constant::sqrt_pi;</div>
<div class="line"><a name="l00953"></a><span class="lineno">  953</span>&#160;  <span class="keyword">using</span> <a class="code" href="namespaceConversion.html#a4f6e51bb0525fbf448c505a56d2740aa">Conversion::freq2kaycm</a>;</div>
<div class="line"><a name="l00954"></a><span class="lineno">  954</span>&#160;  <span class="keyword">using</span> <a class="code" href="legacy__continua_8cc.html#a3aa069ac3980707dae1e0530f50d59e4">std::abs</a>;</div>
<div class="line"><a name="l00955"></a><span class="lineno">  955</span>&#160;  <span class="keyword">using</span> std::imag;</div>
<div class="line"><a name="l00956"></a><span class="lineno">  956</span>&#160;  <span class="keyword">using</span> std::real;</div>
<div class="line"><a name="l00957"></a><span class="lineno">  957</span>&#160;  <span class="keyword">using</span> <a class="code" href="rational_8h.html#a7d3b5e4723b5fa0df29f00a27a6ab8f0">std::sqrt</a>;</div>
<div class="line"><a name="l00958"></a><span class="lineno">  958</span>&#160; </div>
<div class="line"><a name="l00959"></a><span class="lineno">  959</span>&#160;  <span class="comment">// Convert to CGS for using original function</span></div>
<div class="line"><a name="l00960"></a><span class="lineno">  960</span>&#160;  <span class="keyword">const</span> <a class="code" href="matpack_8h.html#ad9a8dbb27c0bbea7271d916036122f6a">Numeric</a> sg0 =</div>
<div class="line"><a name="l00961"></a><span class="lineno">  961</span>&#160;      <a class="code" href="namespaceConversion.html#a4f6e51bb0525fbf448c505a56d2740aa">freq2kaycm</a>(F0_noshift_si + zeeman_df_si * magnetic_magnitude_si);</div>
<div class="line"><a name="l00962"></a><span class="lineno">  962</span>&#160;  <span class="keyword">const</span> <a class="code" href="matpack_8h.html#ad9a8dbb27c0bbea7271d916036122f6a">Numeric</a> GamD = GD_div_F0_si * sg0 / sqrt_ln_2;</div>
<div class="line"><a name="l00963"></a><span class="lineno">  963</span>&#160;  <span class="keyword">const</span> <span class="keyword">auto</span> lso = <a class="code" href="namespaceLineShape.html#ab05b1932aed081698912bfb96466b95c">si2cgs</a>(lso_si);</div>
<div class="line"><a name="l00964"></a><span class="lineno">  964</span>&#160;  <span class="keyword">const</span> <span class="keyword">auto</span> dT = <a class="code" href="namespaceLineShape.html#ab05b1932aed081698912bfb96466b95c">si2cgs</a>(dT_si);</div>
<div class="line"><a name="l00965"></a><span class="lineno">  965</span>&#160;  <span class="keyword">const</span> <span class="keyword">auto</span> dV = <a class="code" href="namespaceLineShape.html#ab05b1932aed081698912bfb96466b95c">si2cgs</a>(dVMR_si);</div>
<div class="line"><a name="l00966"></a><span class="lineno">  966</span>&#160; </div>
<div class="line"><a name="l00967"></a><span class="lineno">  967</span>&#160;  <span class="comment">// General normalization</span></div>
<div class="line"><a name="l00968"></a><span class="lineno">  968</span>&#160;  <span class="keyword">const</span> <a class="code" href="matpack_8h.html#ad9a8dbb27c0bbea7271d916036122f6a">Numeric</a> cte = sqrt_ln_2 / GamD;</div>
<div class="line"><a name="l00969"></a><span class="lineno">  969</span>&#160;  constexpr <a class="code" href="complex_8h.html#aff1205001edf41e8e0032f18b98875e1">Complex</a> iz(0, 1);</div>
<div class="line"><a name="l00970"></a><span class="lineno">  970</span>&#160; </div>
<div class="line"><a name="l00971"></a><span class="lineno">  971</span>&#160;  <span class="comment">// Calculating the different parameters</span></div>
<div class="line"><a name="l00972"></a><span class="lineno">  972</span>&#160;  <span class="keyword">const</span> <a class="code" href="complex_8h.html#aff1205001edf41e8e0032f18b98875e1">Complex</a> c0(lso.G0, -lso.D0);</div>
<div class="line"><a name="l00973"></a><span class="lineno">  973</span>&#160;  <span class="keyword">const</span> <a class="code" href="complex_8h.html#aff1205001edf41e8e0032f18b98875e1">Complex</a> c2(lso.G2, -lso.D2);</div>
<div class="line"><a name="l00974"></a><span class="lineno">  974</span>&#160;  <span class="keyword">const</span> <a class="code" href="complex_8h.html#aff1205001edf41e8e0032f18b98875e1">Complex</a> c0t = (1 - lso.ETA) * (c0 - 1.5 * c2) + lso.FVC;</div>
<div class="line"><a name="l00975"></a><span class="lineno">  975</span>&#160;  <span class="keyword">const</span> <a class="code" href="complex_8h.html#aff1205001edf41e8e0032f18b98875e1">Complex</a> c2t = (1 - lso.ETA) * c2;</div>
<div class="line"><a name="l00976"></a><span class="lineno">  976</span>&#160;  <span class="keyword">const</span> <a class="code" href="complex_8h.html#aff1205001edf41e8e0032f18b98875e1">Complex</a> Y = <a class="code" href="namespaceConstant.html#a7f485605d9dab3fde05d52f03ca9f36e">pow2</a>(1 / (2 * cte * c2t));</div>
<div class="line"><a name="l00977"></a><span class="lineno">  977</span>&#160;  <span class="keyword">const</span> <a class="code" href="complex_8h.html#aff1205001edf41e8e0032f18b98875e1">Complex</a> sqrtY = <a class="code" href="rational_8h.html#a7d3b5e4723b5fa0df29f00a27a6ab8f0">sqrt</a>(Y);</div>
<div class="line"><a name="l00978"></a><span class="lineno">  978</span>&#160; </div>
<div class="line"><a name="l00979"></a><span class="lineno">  979</span>&#160;  <span class="comment">// For all frequencies</span></div>
<div class="line"><a name="l00980"></a><span class="lineno">  980</span>&#160;  <span class="keywordflow">for</span> (<span class="keyword">auto</span> iv = 0; iv &lt; <a class="code" href="namespaceARTS_1_1Var.html#a656f34b4c40189bd3c971e2d3dbe3b95">f_grid</a>.size(); iv++) {</div>
<div class="line"><a name="l00981"></a><span class="lineno">  981</span>&#160;    <span class="keyword">const</span> <a class="code" href="complex_8h.html#aff1205001edf41e8e0032f18b98875e1">Complex</a> X = (iz * (<a class="code" href="namespaceConversion.html#a4f6e51bb0525fbf448c505a56d2740aa">freq2kaycm</a>(<a class="code" href="namespaceARTS_1_1Var.html#a656f34b4c40189bd3c971e2d3dbe3b95">f_grid</a>[iv]) - sg0) + c0t) / c2t;</div>
<div class="line"><a name="l00982"></a><span class="lineno">  982</span>&#160;    <span class="keyword">const</span> <a class="code" href="complex_8h.html#aff1205001edf41e8e0032f18b98875e1">Complex</a> sqrtXY = <a class="code" href="rational_8h.html#a7d3b5e4723b5fa0df29f00a27a6ab8f0">sqrt</a>(X + Y);</div>
<div class="line"><a name="l00983"></a><span class="lineno">  983</span>&#160;    <span class="keyword">const</span> <a class="code" href="complex_8h.html#aff1205001edf41e8e0032f18b98875e1">Complex</a> sqrtX = <a class="code" href="rational_8h.html#a7d3b5e4723b5fa0df29f00a27a6ab8f0">sqrt</a>(X);</div>
<div class="line"><a name="l00984"></a><span class="lineno">  984</span>&#160; </div>
<div class="line"><a name="l00985"></a><span class="lineno">  985</span>&#160;    <span class="comment">// Declare terms required for the derivatives as external to the if-statement</span></div>
<div class="line"><a name="l00986"></a><span class="lineno">  986</span>&#160;    <a class="code" href="complex_8h.html#aff1205001edf41e8e0032f18b98875e1">Complex</a> Z1, Z2, Zb, W1, W2, Wb;</div>
<div class="line"><a name="l00987"></a><span class="lineno">  987</span>&#160;    <a class="code" href="complex_8h.html#aff1205001edf41e8e0032f18b98875e1">Complex</a> Aterm, Bterm;</div>
<div class="line"><a name="l00988"></a><span class="lineno">  988</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="legacy__continua_8cc.html#a3aa069ac3980707dae1e0530f50d59e4">abs</a>(c2t) ==</div>
<div class="line"><a name="l00989"></a><span class="lineno">  989</span>&#160;        0) {  <span class="comment">// If this method does not require G2, D2, or ETA==1, then FVC matters.</span></div>
<div class="line"><a name="l00990"></a><span class="lineno">  990</span>&#160;      Z1 = (iz * (<a class="code" href="namespaceConversion.html#a4f6e51bb0525fbf448c505a56d2740aa">freq2kaycm</a>(<a class="code" href="namespaceARTS_1_1Var.html#a656f34b4c40189bd3c971e2d3dbe3b95">f_grid</a>[iv]) - sg0) + c0t) * cte;</div>
<div class="line"><a name="l00991"></a><span class="lineno">  991</span>&#160;      W1 = <a class="code" href="linefunctions_8cc.html#a3b4555133ea360cd068890a3e3cefaf5">w</a>(iz * Z1);</div>
<div class="line"><a name="l00992"></a><span class="lineno">  992</span>&#160; </div>
<div class="line"><a name="l00993"></a><span class="lineno">  993</span>&#160;      Aterm = sqrt_pi * cte * W1;</div>
<div class="line"><a name="l00994"></a><span class="lineno">  994</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="legacy__continua_8cc.html#a3aa069ac3980707dae1e0530f50d59e4">abs</a>(Z1) &lt;=</div>
<div class="line"><a name="l00995"></a><span class="lineno">  995</span>&#160;          4e3)  <span class="comment">// For very large Z1 (i.e., very large broadening or very large distance from line-center</span></div>
<div class="line"><a name="l00996"></a><span class="lineno">  996</span>&#160;        Bterm = sqrt_pi * cte * ((1 - <a class="code" href="namespaceConstant.html#a7f485605d9dab3fde05d52f03ca9f36e">pow2</a>(Z1)) * W1 + Z1 * inv_sqrt_pi);</div>
<div class="line"><a name="l00997"></a><span class="lineno">  997</span>&#160;      <span class="keywordflow">else</span></div>
<div class="line"><a name="l00998"></a><span class="lineno">  998</span>&#160;        Bterm = cte * (sqrt_pi * W1 + 0.5 / Z1 - 0.75 / <a class="code" href="namespaceConstant.html#aa415feed8b057c59bc7965f74cc1331d">pow3</a>(Z1));</div>
<div class="line"><a name="l00999"></a><span class="lineno">  999</span>&#160;    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (</div>
<div class="line"><a name="l01000"></a><span class="lineno"> 1000</span>&#160;        <a class="code" href="legacy__continua_8cc.html#a3aa069ac3980707dae1e0530f50d59e4">abs</a>(X) &lt;=</div>
<div class="line"><a name="l01001"></a><span class="lineno"> 1001</span>&#160;        3e-8 *</div>
<div class="line"><a name="l01002"></a><span class="lineno"> 1002</span>&#160;            <a class="code" href="legacy__continua_8cc.html#a3aa069ac3980707dae1e0530f50d59e4">abs</a>(Y)) {  <span class="comment">// If this method is executed very close to the line center</span></div>
<div class="line"><a name="l01003"></a><span class="lineno"> 1003</span>&#160;      Z1 = (iz * (<a class="code" href="namespaceConversion.html#a4f6e51bb0525fbf448c505a56d2740aa">freq2kaycm</a>(<a class="code" href="namespaceARTS_1_1Var.html#a656f34b4c40189bd3c971e2d3dbe3b95">f_grid</a>[iv]) - sg0) + c0t) * cte;</div>
<div class="line"><a name="l01004"></a><span class="lineno"> 1004</span>&#160;      Z2 = sqrtXY + sqrtY;</div>
<div class="line"><a name="l01005"></a><span class="lineno"> 1005</span>&#160; </div>
<div class="line"><a name="l01006"></a><span class="lineno"> 1006</span>&#160;      W1 = <a class="code" href="linefunctions_8cc.html#a3b4555133ea360cd068890a3e3cefaf5">w</a>(iz * Z1);</div>
<div class="line"><a name="l01007"></a><span class="lineno"> 1007</span>&#160;      W2 = <a class="code" href="linefunctions_8cc.html#a3b4555133ea360cd068890a3e3cefaf5">w</a>(iz * Z2);</div>
<div class="line"><a name="l01008"></a><span class="lineno"> 1008</span>&#160; </div>
<div class="line"><a name="l01009"></a><span class="lineno"> 1009</span>&#160;      Aterm = sqrt_pi * cte * (W1 - W2);</div>
<div class="line"><a name="l01010"></a><span class="lineno"> 1010</span>&#160;      Bterm = (-1 + sqrt_pi / (2 * sqrtY) * (1 - <a class="code" href="namespaceConstant.html#a7f485605d9dab3fde05d52f03ca9f36e">pow2</a>(Z1)) * W1 -</div>
<div class="line"><a name="l01011"></a><span class="lineno"> 1011</span>&#160;               sqrt_pi / (2 * sqrtY) * (1 - <a class="code" href="namespaceConstant.html#a7f485605d9dab3fde05d52f03ca9f36e">pow2</a>(Z2)) * W2) /</div>
<div class="line"><a name="l01012"></a><span class="lineno"> 1012</span>&#160;              c2t;</div>
<div class="line"><a name="l01013"></a><span class="lineno"> 1013</span>&#160;    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (</div>
<div class="line"><a name="l01014"></a><span class="lineno"> 1014</span>&#160;        <a class="code" href="legacy__continua_8cc.html#a3aa069ac3980707dae1e0530f50d59e4">abs</a>(Y) &lt;=</div>
<div class="line"><a name="l01015"></a><span class="lineno"> 1015</span>&#160;        1e-15 *</div>
<div class="line"><a name="l01016"></a><span class="lineno"> 1016</span>&#160;            <a class="code" href="legacy__continua_8cc.html#a3aa069ac3980707dae1e0530f50d59e4">abs</a>(X)) {  <span class="comment">// If this method is executed very far from the line center</span></div>
<div class="line"><a name="l01017"></a><span class="lineno"> 1017</span>&#160;      Z1 = sqrtXY;</div>
<div class="line"><a name="l01018"></a><span class="lineno"> 1018</span>&#160; </div>
<div class="line"><a name="l01019"></a><span class="lineno"> 1019</span>&#160;      W1 = <a class="code" href="linefunctions_8cc.html#a3b4555133ea360cd068890a3e3cefaf5">w</a>(iz * Z1);</div>
<div class="line"><a name="l01020"></a><span class="lineno"> 1020</span>&#160; </div>
<div class="line"><a name="l01021"></a><span class="lineno"> 1021</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="legacy__continua_8cc.html#a3aa069ac3980707dae1e0530f50d59e4">abs</a>(sqrtX) &lt;= 4e3) {  <span class="comment">// If X is small still</span></div>
<div class="line"><a name="l01022"></a><span class="lineno"> 1022</span>&#160;        Zb = sqrtX;</div>
<div class="line"><a name="l01023"></a><span class="lineno"> 1023</span>&#160;        Wb = <a class="code" href="linefunctions_8cc.html#a3b4555133ea360cd068890a3e3cefaf5">w</a>(iz * Zb);</div>
<div class="line"><a name="l01024"></a><span class="lineno"> 1024</span>&#160; </div>
<div class="line"><a name="l01025"></a><span class="lineno"> 1025</span>&#160;        Aterm = (2 * sqrt_pi / c2t) * (inv_sqrt_pi - sqrtX * Wb);</div>
<div class="line"><a name="l01026"></a><span class="lineno"> 1026</span>&#160;        Bterm =</div>
<div class="line"><a name="l01027"></a><span class="lineno"> 1027</span>&#160;            (1 / c2t) *</div>
<div class="line"><a name="l01028"></a><span class="lineno"> 1028</span>&#160;            (-1 + 2 * sqrt_pi * (1 - X - 2 * Y) * (inv_sqrt_pi - sqrtX * Wb) +</div>
<div class="line"><a name="l01029"></a><span class="lineno"> 1029</span>&#160;             2 * sqrt_pi * sqrtXY * W1);</div>
<div class="line"><a name="l01030"></a><span class="lineno"> 1030</span>&#160;      } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l01031"></a><span class="lineno"> 1031</span>&#160;        Aterm = (1 / c2t) * (1 / X - 1.5 / <a class="code" href="namespaceConstant.html#a7f485605d9dab3fde05d52f03ca9f36e">pow2</a>(X));</div>
<div class="line"><a name="l01032"></a><span class="lineno"> 1032</span>&#160;        Bterm = (1 / c2t) * (-1 + (1 - X - 2 * Y) * (1 / X - 1.5 / <a class="code" href="namespaceConstant.html#a7f485605d9dab3fde05d52f03ca9f36e">pow2</a>(X)) +</div>
<div class="line"><a name="l01033"></a><span class="lineno"> 1033</span>&#160;                             2 * sqrt_pi * sqrtXY * W1);</div>
<div class="line"><a name="l01034"></a><span class="lineno"> 1034</span>&#160;      }</div>
<div class="line"><a name="l01035"></a><span class="lineno"> 1035</span>&#160;    } <span class="keywordflow">else</span> {  <span class="comment">// General calculations</span></div>
<div class="line"><a name="l01036"></a><span class="lineno"> 1036</span>&#160;      Z1 = sqrtXY - sqrtY;</div>
<div class="line"><a name="l01037"></a><span class="lineno"> 1037</span>&#160;      Z2 = Z1 + 2 * sqrtY;</div>
<div class="line"><a name="l01038"></a><span class="lineno"> 1038</span>&#160; </div>
<div class="line"><a name="l01039"></a><span class="lineno"> 1039</span>&#160;      <span class="comment">// NOTE: the region of w might matter according to original code!  So this might need changing...</span></div>
<div class="line"><a name="l01040"></a><span class="lineno"> 1040</span>&#160;      W1 = <a class="code" href="linefunctions_8cc.html#a3b4555133ea360cd068890a3e3cefaf5">w</a>(iz * Z1);</div>
<div class="line"><a name="l01041"></a><span class="lineno"> 1041</span>&#160;      W2 = <a class="code" href="linefunctions_8cc.html#a3b4555133ea360cd068890a3e3cefaf5">w</a>(iz * Z2);</div>
<div class="line"><a name="l01042"></a><span class="lineno"> 1042</span>&#160; </div>
<div class="line"><a name="l01043"></a><span class="lineno"> 1043</span>&#160;      Aterm = sqrt_pi * cte * (W1 - W2);</div>
<div class="line"><a name="l01044"></a><span class="lineno"> 1044</span>&#160;      Bterm = (-1 + sqrt_pi / (2 * sqrtY) * (1 - <a class="code" href="namespaceConstant.html#a7f485605d9dab3fde05d52f03ca9f36e">pow2</a>(Z1)) * W1 -</div>
<div class="line"><a name="l01045"></a><span class="lineno"> 1045</span>&#160;               sqrt_pi / (2 * sqrtY) * (1 - <a class="code" href="namespaceConstant.html#a7f485605d9dab3fde05d52f03ca9f36e">pow2</a>(Z2)) * W2) /</div>
<div class="line"><a name="l01046"></a><span class="lineno"> 1046</span>&#160;              c2t;</div>
<div class="line"><a name="l01047"></a><span class="lineno"> 1047</span>&#160;    }</div>
<div class="line"><a name="l01048"></a><span class="lineno"> 1048</span>&#160; </div>
<div class="line"><a name="l01049"></a><span class="lineno"> 1049</span>&#160;    F(iv) = Aterm / (pi * (((c0 - 1.5 * c2) * lso.ETA - lso.FVC) * Aterm +</div>
<div class="line"><a name="l01050"></a><span class="lineno"> 1050</span>&#160;                           Bterm * c2 * lso.ETA + 1));</div>
<div class="line"><a name="l01051"></a><span class="lineno"> 1051</span>&#160; </div>
<div class="line"><a name="l01052"></a><span class="lineno"> 1052</span>&#160;    <span class="keywordflow">for</span> (<span class="keyword">auto</span> iq = 0; iq &lt; derivatives_data_position.<a class="code" href="classArray.html#a90ce1cf3f99646da9d0efd6e8a661369">nelem</a>(); iq++) {</div>
<div class="line"><a name="l01053"></a><span class="lineno"> 1053</span>&#160;      <span class="keyword">const</span> <a class="code" href="classRetrievalQuantity.html">RetrievalQuantity</a>&amp; rt =</div>
<div class="line"><a name="l01054"></a><span class="lineno"> 1054</span>&#160;          derivatives_data[derivatives_data_position[iq]];</div>
<div class="line"><a name="l01055"></a><span class="lineno"> 1055</span>&#160; </div>
<div class="line"><a name="l01056"></a><span class="lineno"> 1056</span>&#160;      <a class="code" href="matpack_8h.html#ad9a8dbb27c0bbea7271d916036122f6a">Numeric</a> dcte = 0;</div>
<div class="line"><a name="l01057"></a><span class="lineno"> 1057</span>&#160;      <a class="code" href="complex_8h.html#aff1205001edf41e8e0032f18b98875e1">Complex</a> dc0 = 0, dc2 = 0, dc0t = 0, dc2t = 0;</div>
<div class="line"><a name="l01058"></a><span class="lineno"> 1058</span>&#160;      <span class="keywordflow">if</span> (rt == JacPropMatType::Temperature) {</div>
<div class="line"><a name="l01059"></a><span class="lineno"> 1059</span>&#160;        dcte = (-(dGD_div_F0_dT_si * sg0 / Constant::sqrt_ln_2) / GamD) *</div>
<div class="line"><a name="l01060"></a><span class="lineno"> 1060</span>&#160;               cte;                    <span class="comment">// for T</span></div>
<div class="line"><a name="l01061"></a><span class="lineno"> 1061</span>&#160;        dc0 = <a class="code" href="complex_8h.html#aff1205001edf41e8e0032f18b98875e1">Complex</a>(dT.G0, -dT.D0);  <span class="comment">// for T</span></div>
<div class="line"><a name="l01062"></a><span class="lineno"> 1062</span>&#160;        dc2 = <a class="code" href="complex_8h.html#aff1205001edf41e8e0032f18b98875e1">Complex</a>(dT.G2, -dT.D2);  <span class="comment">// for T</span></div>
<div class="line"><a name="l01063"></a><span class="lineno"> 1063</span>&#160;        dc0t = (-(c0 - 1.5 * c2) * dT.ETA + dT.FVC) +</div>
<div class="line"><a name="l01064"></a><span class="lineno"> 1064</span>&#160;               ((1 - lso.ETA) * (dc0 - 1.5 * dc2));     <span class="comment">// for T</span></div>
<div class="line"><a name="l01065"></a><span class="lineno"> 1065</span>&#160;        dc2t = (-c2 * dT.ETA) + ((1 - lso.ETA) * dc2);  <span class="comment">// for T</span></div>
<div class="line"><a name="l01066"></a><span class="lineno"> 1066</span>&#160;      } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (rt == JacPropMatType::VMR and</div>
<div class="line"><a name="l01067"></a><span class="lineno"> 1067</span>&#160;                 <a class="code" href="namespaceAbsorption.html#a1554ecf51c40489e7f2a9f77a3314511">Absorption::id_in_line</a>(band, rt.<a class="code" href="classRetrievalQuantity.html#a51b340f8988eb17696b9621d03da2751">QuantumIdentity</a>(), line_ind)) {</div>
<div class="line"><a name="l01068"></a><span class="lineno"> 1068</span>&#160;        dc0 = <a class="code" href="complex_8h.html#aff1205001edf41e8e0032f18b98875e1">Complex</a>(dV.G0, -dV.D0);  <span class="comment">// for VMR</span></div>
<div class="line"><a name="l01069"></a><span class="lineno"> 1069</span>&#160;        dc2 = <a class="code" href="complex_8h.html#aff1205001edf41e8e0032f18b98875e1">Complex</a>(dV.G2, -dV.D2);  <span class="comment">// for VMR</span></div>
<div class="line"><a name="l01070"></a><span class="lineno"> 1070</span>&#160;        dc0t = (-(c0 - 1.5 * c2) * dV.ETA + dV.FVC) +</div>
<div class="line"><a name="l01071"></a><span class="lineno"> 1071</span>&#160;               ((1 - lso.ETA) * (dc0 - 1.5 * dc2));     <span class="comment">// for VMR</span></div>
<div class="line"><a name="l01072"></a><span class="lineno"> 1072</span>&#160;        dc2t = (-c2 * dV.ETA) + ((1 - lso.ETA) * dc2);  <span class="comment">// for VMR</span></div>
<div class="line"><a name="l01073"></a><span class="lineno"> 1073</span>&#160;      } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="jacobian_8h.html#a9fc78900dc39e948c57047d4f960cd91">is_pressure_broadening_G2</a>(rt) and</div>
<div class="line"><a name="l01074"></a><span class="lineno"> 1074</span>&#160;                 <a class="code" href="namespaceAbsorption.html#a1554ecf51c40489e7f2a9f77a3314511">Absorption::id_in_line</a>(band, rt.<a class="code" href="classRetrievalQuantity.html#a51b340f8988eb17696b9621d03da2751">QuantumIdentity</a>(), line_ind)) {</div>
<div class="line"><a name="l01075"></a><span class="lineno"> 1075</span>&#160;        dc2 =</div>
<div class="line"><a name="l01076"></a><span class="lineno"> 1076</span>&#160;            1;  <span class="comment">// for Gam2(T, VMR) and for Shift2(T, VMR), the derivative is wrt c2 for later computations</span></div>
<div class="line"><a name="l01077"></a><span class="lineno"> 1077</span>&#160;        dc0t = ((1 - lso.ETA) * (dc0 - 1.5 * dc2));</div>
<div class="line"><a name="l01078"></a><span class="lineno"> 1078</span>&#160;        dc2t = ((1 - lso.ETA) * dc2);</div>
<div class="line"><a name="l01079"></a><span class="lineno"> 1079</span>&#160;      } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="jacobian_8h.html#a7325f3320449b86e8cbc6e4c2c1e9e36">is_pressure_broadening_D2</a>(rt) and</div>
<div class="line"><a name="l01080"></a><span class="lineno"> 1080</span>&#160;                 <a class="code" href="namespaceAbsorption.html#a1554ecf51c40489e7f2a9f77a3314511">Absorption::id_in_line</a>(band, rt.<a class="code" href="classRetrievalQuantity.html#a51b340f8988eb17696b9621d03da2751">QuantumIdentity</a>(), line_ind)) {</div>
<div class="line"><a name="l01081"></a><span class="lineno"> 1081</span>&#160;        dc2 =</div>
<div class="line"><a name="l01082"></a><span class="lineno"> 1082</span>&#160;            -iz;  <span class="comment">// for Gam2(T, VMR) and for Shift2(T, VMR), the derivative is wrt c2 for later computations</span></div>
<div class="line"><a name="l01083"></a><span class="lineno"> 1083</span>&#160;        dc0t = ((1 - lso.ETA) * (dc0 - 1.5 * dc2));</div>
<div class="line"><a name="l01084"></a><span class="lineno"> 1084</span>&#160;        dc2t = ((1 - lso.ETA) * dc2);</div>
<div class="line"><a name="l01085"></a><span class="lineno"> 1085</span>&#160;      } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="jacobian_8h.html#a4bea1e519152d28026876d006f372ac4">is_pressure_broadening_G0</a>(rt) and</div>
<div class="line"><a name="l01086"></a><span class="lineno"> 1086</span>&#160;                 <a class="code" href="namespaceAbsorption.html#a1554ecf51c40489e7f2a9f77a3314511">Absorption::id_in_line</a>(band, rt.<a class="code" href="classRetrievalQuantity.html#a51b340f8988eb17696b9621d03da2751">QuantumIdentity</a>(), line_ind)) {</div>
<div class="line"><a name="l01087"></a><span class="lineno"> 1087</span>&#160;        dc0 =</div>
<div class="line"><a name="l01088"></a><span class="lineno"> 1088</span>&#160;            1;  <span class="comment">// for Gam0(T, VMR) and for Shift0(T, VMR), the derivative is wrt c0 for later computations</span></div>
<div class="line"><a name="l01089"></a><span class="lineno"> 1089</span>&#160;        dc0t = ((1 - lso.ETA) * (dc0 - 1.5 * dc2));</div>
<div class="line"><a name="l01090"></a><span class="lineno"> 1090</span>&#160;      } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="jacobian_8h.html#a10cc5eb98e966a4d466ae1f56a7356a4">is_pressure_broadening_D0</a>(rt) and</div>
<div class="line"><a name="l01091"></a><span class="lineno"> 1091</span>&#160;                 <a class="code" href="namespaceAbsorption.html#a1554ecf51c40489e7f2a9f77a3314511">Absorption::id_in_line</a>(band, rt.<a class="code" href="classRetrievalQuantity.html#a51b340f8988eb17696b9621d03da2751">QuantumIdentity</a>(), line_ind)) {</div>
<div class="line"><a name="l01092"></a><span class="lineno"> 1092</span>&#160;        dc0 =</div>
<div class="line"><a name="l01093"></a><span class="lineno"> 1093</span>&#160;            -iz;  <span class="comment">// for Gam0(T, VMR) and for Shift0(T, VMR), the derivative is wrt c0 for later computations</span></div>
<div class="line"><a name="l01094"></a><span class="lineno"> 1094</span>&#160;        dc0t = ((1 - lso.ETA) * (dc0 - 1.5 * dc2));</div>
<div class="line"><a name="l01095"></a><span class="lineno"> 1095</span>&#160;      } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="jacobian_8h.html#a518d816c30fe86ca604993a18a8e213a">is_pressure_broadening_FVC</a>(rt) and</div>
<div class="line"><a name="l01096"></a><span class="lineno"> 1096</span>&#160;                 <a class="code" href="namespaceAbsorption.html#a1554ecf51c40489e7f2a9f77a3314511">Absorption::id_in_line</a>(band, rt.<a class="code" href="classRetrievalQuantity.html#a51b340f8988eb17696b9621d03da2751">QuantumIdentity</a>(), line_ind)) {</div>
<div class="line"><a name="l01097"></a><span class="lineno"> 1097</span>&#160;        dc0t = (1);  <span class="comment">// for FVC(T, VMR)</span></div>
<div class="line"><a name="l01098"></a><span class="lineno"> 1098</span>&#160;      } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="jacobian_8h.html#aa9ed0864b0bf1c68796bae61e1319aa9">is_pressure_broadening_ETA</a>(rt) and</div>
<div class="line"><a name="l01099"></a><span class="lineno"> 1099</span>&#160;                 <a class="code" href="namespaceAbsorption.html#a1554ecf51c40489e7f2a9f77a3314511">Absorption::id_in_line</a>(band, rt.<a class="code" href="classRetrievalQuantity.html#a51b340f8988eb17696b9621d03da2751">QuantumIdentity</a>(), line_ind)) {</div>
<div class="line"><a name="l01100"></a><span class="lineno"> 1100</span>&#160;        dc0t = (-c0 + 1.5 * c2);  <span class="comment">// for eta(T, VMR)</span></div>
<div class="line"><a name="l01101"></a><span class="lineno"> 1101</span>&#160;        dc2t = (-c2);             <span class="comment">// for eta(T, VMR)</span></div>
<div class="line"><a name="l01102"></a><span class="lineno"> 1102</span>&#160;      }</div>
<div class="line"><a name="l01103"></a><span class="lineno"> 1103</span>&#160; </div>
<div class="line"><a name="l01104"></a><span class="lineno"> 1104</span>&#160;      <span class="keyword">const</span> <a class="code" href="complex_8h.html#aff1205001edf41e8e0032f18b98875e1">Complex</a> dY = (-2 * dcte / cte - 2 * dc2t / c2t) * Y;  <span class="comment">// for all</span></div>
<div class="line"><a name="l01105"></a><span class="lineno"> 1105</span>&#160; </div>
<div class="line"><a name="l01106"></a><span class="lineno"> 1106</span>&#160;      <a class="code" href="complex_8h.html#aff1205001edf41e8e0032f18b98875e1">Complex</a> dX;</div>
<div class="line"><a name="l01107"></a><span class="lineno"> 1107</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="jacobian_8cc.html#a5ad6fcd20dc6e691e408d497934760d8">is_magnetic_parameter</a>(rt))</div>
<div class="line"><a name="l01108"></a><span class="lineno"> 1108</span>&#160;        dX = -iz * <a class="code" href="namespaceConversion.html#a4f6e51bb0525fbf448c505a56d2740aa">freq2kaycm</a>(zeeman_df_si) / c2t;  <span class="comment">// for H</span></div>
<div class="line"><a name="l01109"></a><span class="lineno"> 1109</span>&#160;      <span class="keywordflow">else</span> <span class="keywordflow">if</span> (rt == JacPropMatType::LineCenter and</div>
<div class="line"><a name="l01110"></a><span class="lineno"> 1110</span>&#160;               <a class="code" href="namespaceAbsorption.html#a1554ecf51c40489e7f2a9f77a3314511">Absorption::id_in_line</a>(band, rt.<a class="code" href="classRetrievalQuantity.html#a51b340f8988eb17696b9621d03da2751">QuantumIdentity</a>(), line_ind))</div>
<div class="line"><a name="l01111"></a><span class="lineno"> 1111</span>&#160;        dX = -iz / c2t;  <span class="comment">// for sg0</span></div>
<div class="line"><a name="l01112"></a><span class="lineno"> 1112</span>&#160;      <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="jacobian_8cc.html#ad59138aabb0d611ff16659b4fd93858a">is_frequency_parameter</a>(rt))</div>
<div class="line"><a name="l01113"></a><span class="lineno"> 1113</span>&#160;        dX = iz / c2t;  <span class="comment">// for sg</span></div>
<div class="line"><a name="l01114"></a><span class="lineno"> 1114</span>&#160;      <span class="keywordflow">else</span></div>
<div class="line"><a name="l01115"></a><span class="lineno"> 1115</span>&#160;        dX =</div>
<div class="line"><a name="l01116"></a><span class="lineno"> 1116</span>&#160;            (-(iz * (<a class="code" href="namespaceConversion.html#a4f6e51bb0525fbf448c505a56d2740aa">freq2kaycm</a>(<a class="code" href="namespaceARTS_1_1Var.html#a656f34b4c40189bd3c971e2d3dbe3b95">f_grid</a>[iv]) - sg0) + c0t) * dc2t + c2t * dc0t) /</div>
<div class="line"><a name="l01117"></a><span class="lineno"> 1117</span>&#160;            <a class="code" href="namespaceConstant.html#a7f485605d9dab3fde05d52f03ca9f36e">pow2</a>(c2t);  <span class="comment">// for c0t and c2t</span></div>
<div class="line"><a name="l01118"></a><span class="lineno"> 1118</span>&#160; </div>
<div class="line"><a name="l01119"></a><span class="lineno"> 1119</span>&#160;      <a class="code" href="complex_8h.html#aff1205001edf41e8e0032f18b98875e1">Complex</a> dAterm, dBterm;</div>
<div class="line"><a name="l01120"></a><span class="lineno"> 1120</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="legacy__continua_8cc.html#a3aa069ac3980707dae1e0530f50d59e4">abs</a>(c2t) == 0) {</div>
<div class="line"><a name="l01121"></a><span class="lineno"> 1121</span>&#160;        <a class="code" href="complex_8h.html#aff1205001edf41e8e0032f18b98875e1">Complex</a> dZ1;</div>
<div class="line"><a name="l01122"></a><span class="lineno"> 1122</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="jacobian_8cc.html#a5ad6fcd20dc6e691e408d497934760d8">is_magnetic_parameter</a>(rt))</div>
<div class="line"><a name="l01123"></a><span class="lineno"> 1123</span>&#160;          dZ1 = -iz * cte * <a class="code" href="namespaceConversion.html#a4f6e51bb0525fbf448c505a56d2740aa">freq2kaycm</a>(zeeman_df_si);  <span class="comment">// for H</span></div>
<div class="line"><a name="l01124"></a><span class="lineno"> 1124</span>&#160;        <span class="keywordflow">else</span> <span class="keywordflow">if</span> (rt == JacPropMatType::LineCenter and</div>
<div class="line"><a name="l01125"></a><span class="lineno"> 1125</span>&#160;                 <a class="code" href="namespaceAbsorption.html#a1554ecf51c40489e7f2a9f77a3314511">Absorption::id_in_line</a>(band, rt.<a class="code" href="classRetrievalQuantity.html#a51b340f8988eb17696b9621d03da2751">QuantumIdentity</a>(), line_ind))</div>
<div class="line"><a name="l01126"></a><span class="lineno"> 1126</span>&#160;          dZ1 = -iz * cte;  <span class="comment">// for sg0</span></div>
<div class="line"><a name="l01127"></a><span class="lineno"> 1127</span>&#160;        <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="jacobian_8cc.html#ad59138aabb0d611ff16659b4fd93858a">is_frequency_parameter</a>(rt))</div>
<div class="line"><a name="l01128"></a><span class="lineno"> 1128</span>&#160;          dZ1 = iz * cte;  <span class="comment">// for sg</span></div>
<div class="line"><a name="l01129"></a><span class="lineno"> 1129</span>&#160;        <span class="keywordflow">else</span></div>
<div class="line"><a name="l01130"></a><span class="lineno"> 1130</span>&#160;          dZ1 = (iz * (<a class="code" href="namespaceConversion.html#a4f6e51bb0525fbf448c505a56d2740aa">freq2kaycm</a>(<a class="code" href="namespaceARTS_1_1Var.html#a656f34b4c40189bd3c971e2d3dbe3b95">f_grid</a>[iv]) - sg0) + c0t) * dcte +</div>
<div class="line"><a name="l01131"></a><span class="lineno"> 1131</span>&#160;                cte * dc0t;  <span class="comment">// for c0t</span></div>
<div class="line"><a name="l01132"></a><span class="lineno"> 1132</span>&#160; </div>
<div class="line"><a name="l01133"></a><span class="lineno"> 1133</span>&#160;        <span class="keyword">const</span> <a class="code" href="complex_8h.html#aff1205001edf41e8e0032f18b98875e1">Complex</a> dW1 = iz * dZ1 * <a class="code" href="linefunctions_8cc.html#a08f2b520b433833c0d7ca264f305380e">dw</a>(Z1, W1);  <span class="comment">// NEED TO CHECK DW!</span></div>
<div class="line"><a name="l01134"></a><span class="lineno"> 1134</span>&#160; </div>
<div class="line"><a name="l01135"></a><span class="lineno"> 1135</span>&#160;        dAterm = sqrt_pi * (W1 * dcte + cte * dW1);  <span class="comment">// for all</span></div>
<div class="line"><a name="l01136"></a><span class="lineno"> 1136</span>&#160; </div>
<div class="line"><a name="l01137"></a><span class="lineno"> 1137</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="legacy__continua_8cc.html#a3aa069ac3980707dae1e0530f50d59e4">abs</a>(Z1) &lt;= 4e3)</div>
<div class="line"><a name="l01138"></a><span class="lineno"> 1138</span>&#160;          dBterm =</div>
<div class="line"><a name="l01139"></a><span class="lineno"> 1139</span>&#160;              -(sqrt_pi * ((<a class="code" href="namespaceConstant.html#a7f485605d9dab3fde05d52f03ca9f36e">pow2</a>(Z1) - 1) * dW1 + 2 * W1 * Z1 * dZ1) - dZ1) *</div>
<div class="line"><a name="l01140"></a><span class="lineno"> 1140</span>&#160;                  cte -</div>
<div class="line"><a name="l01141"></a><span class="lineno"> 1141</span>&#160;              (sqrt_pi * (<a class="code" href="namespaceConstant.html#a7f485605d9dab3fde05d52f03ca9f36e">pow2</a>(Z1) - 1) * W1 - Z1) * dcte;  <span class="comment">// for all</span></div>
<div class="line"><a name="l01142"></a><span class="lineno"> 1142</span>&#160;        <span class="keywordflow">else</span></div>
<div class="line"><a name="l01143"></a><span class="lineno"> 1143</span>&#160;          dBterm =</div>
<div class="line"><a name="l01144"></a><span class="lineno"> 1144</span>&#160;              ((sqrt_pi * W1 * <a class="code" href="namespaceConstant.html#aa415feed8b057c59bc7965f74cc1331d">pow3</a>(Z1) + 0.5 * <a class="code" href="namespaceConstant.html#a7f485605d9dab3fde05d52f03ca9f36e">pow2</a>(Z1) - 0.75) * Z1 * dcte +</div>
<div class="line"><a name="l01145"></a><span class="lineno"> 1145</span>&#160;               (sqrt_pi * <a class="code" href="namespaceConstant.html#a9b0ce133f5cf1a3d76c2ae3dc7aca0b8">pow4</a>(Z1) * dW1 - 0.5 * <a class="code" href="namespaceConstant.html#a7f485605d9dab3fde05d52f03ca9f36e">pow2</a>(Z1) * dZ1 + 2.25 * dZ1) *</div>
<div class="line"><a name="l01146"></a><span class="lineno"> 1146</span>&#160;                   cte) /</div>
<div class="line"><a name="l01147"></a><span class="lineno"> 1147</span>&#160;              <a class="code" href="namespaceConstant.html#a9b0ce133f5cf1a3d76c2ae3dc7aca0b8">pow4</a>(Z1);  <span class="comment">// for all</span></div>
<div class="line"><a name="l01148"></a><span class="lineno"> 1148</span>&#160;      } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="legacy__continua_8cc.html#a3aa069ac3980707dae1e0530f50d59e4">abs</a>(X) &lt;= 3e-8 * <a class="code" href="legacy__continua_8cc.html#a3aa069ac3980707dae1e0530f50d59e4">abs</a>(Y)) {</div>
<div class="line"><a name="l01149"></a><span class="lineno"> 1149</span>&#160;        <a class="code" href="complex_8h.html#aff1205001edf41e8e0032f18b98875e1">Complex</a> dZ1;</div>
<div class="line"><a name="l01150"></a><span class="lineno"> 1150</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="jacobian_8cc.html#a5ad6fcd20dc6e691e408d497934760d8">is_magnetic_parameter</a>(rt))</div>
<div class="line"><a name="l01151"></a><span class="lineno"> 1151</span>&#160;          dZ1 = -iz * cte * <a class="code" href="namespaceConversion.html#a4f6e51bb0525fbf448c505a56d2740aa">freq2kaycm</a>(zeeman_df_si);  <span class="comment">// for H</span></div>
<div class="line"><a name="l01152"></a><span class="lineno"> 1152</span>&#160;        <span class="keywordflow">else</span> <span class="keywordflow">if</span> (rt == JacPropMatType::LineCenter and</div>
<div class="line"><a name="l01153"></a><span class="lineno"> 1153</span>&#160;                 <a class="code" href="namespaceAbsorption.html#a1554ecf51c40489e7f2a9f77a3314511">Absorption::id_in_line</a>(band, rt.<a class="code" href="classRetrievalQuantity.html#a51b340f8988eb17696b9621d03da2751">QuantumIdentity</a>(), line_ind))</div>
<div class="line"><a name="l01154"></a><span class="lineno"> 1154</span>&#160;          dZ1 = -iz * cte;  <span class="comment">// for sg0</span></div>
<div class="line"><a name="l01155"></a><span class="lineno"> 1155</span>&#160;        <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="jacobian_8cc.html#ad59138aabb0d611ff16659b4fd93858a">is_frequency_parameter</a>(rt))</div>
<div class="line"><a name="l01156"></a><span class="lineno"> 1156</span>&#160;          dZ1 = iz * cte;  <span class="comment">// for sg</span></div>
<div class="line"><a name="l01157"></a><span class="lineno"> 1157</span>&#160;        <span class="keywordflow">else</span></div>
<div class="line"><a name="l01158"></a><span class="lineno"> 1158</span>&#160;          dZ1 = (iz * (<a class="code" href="namespaceConversion.html#a4f6e51bb0525fbf448c505a56d2740aa">freq2kaycm</a>(<a class="code" href="namespaceARTS_1_1Var.html#a656f34b4c40189bd3c971e2d3dbe3b95">f_grid</a>[iv]) - sg0) + c0t) * dcte +</div>
<div class="line"><a name="l01159"></a><span class="lineno"> 1159</span>&#160;                cte * dc0t;  <span class="comment">// for c0t</span></div>
<div class="line"><a name="l01160"></a><span class="lineno"> 1160</span>&#160; </div>
<div class="line"><a name="l01161"></a><span class="lineno"> 1161</span>&#160;        <span class="keyword">const</span> <a class="code" href="complex_8h.html#aff1205001edf41e8e0032f18b98875e1">Complex</a> dZ2 = dY / (2 * sqrtY) + dX / (2 * sqrtXY) +</div>
<div class="line"><a name="l01162"></a><span class="lineno"> 1162</span>&#160;                            dY / (2 * sqrtXY);  <span class="comment">// for all</span></div>
<div class="line"><a name="l01163"></a><span class="lineno"> 1163</span>&#160; </div>
<div class="line"><a name="l01164"></a><span class="lineno"> 1164</span>&#160;        <span class="keyword">const</span> <a class="code" href="complex_8h.html#aff1205001edf41e8e0032f18b98875e1">Complex</a> dW1 = iz * dZ1 * <a class="code" href="linefunctions_8cc.html#a08f2b520b433833c0d7ca264f305380e">dw</a>(Z1, W1);  <span class="comment">// NEED TO CHECK DW!</span></div>
<div class="line"><a name="l01165"></a><span class="lineno"> 1165</span>&#160;        <span class="keyword">const</span> <a class="code" href="complex_8h.html#aff1205001edf41e8e0032f18b98875e1">Complex</a> dW2 = iz * dZ2 * <a class="code" href="linefunctions_8cc.html#a08f2b520b433833c0d7ca264f305380e">dw</a>(Z2, W2);  <span class="comment">// NEED TO CHECK DW!</span></div>
<div class="line"><a name="l01166"></a><span class="lineno"> 1166</span>&#160; </div>
<div class="line"><a name="l01167"></a><span class="lineno"> 1167</span>&#160;        dAterm = sqrt_pi * ((W1 - W2) * dcte + (dW1 - dW2) * cte);  <span class="comment">// for all</span></div>
<div class="line"><a name="l01168"></a><span class="lineno"> 1168</span>&#160; </div>
<div class="line"><a name="l01169"></a><span class="lineno"> 1169</span>&#160;        dBterm = (sqrt_pi *</div>
<div class="line"><a name="l01170"></a><span class="lineno"> 1170</span>&#160;                      (((<a class="code" href="namespaceConstant.html#a7f485605d9dab3fde05d52f03ca9f36e">pow2</a>(Z1) - 1) * W1 - (<a class="code" href="namespaceConstant.html#a7f485605d9dab3fde05d52f03ca9f36e">pow2</a>(Z2) - 1) * W2) * dY +</div>
<div class="line"><a name="l01171"></a><span class="lineno"> 1171</span>&#160;                       2 *</div>
<div class="line"><a name="l01172"></a><span class="lineno"> 1172</span>&#160;                           (-(<a class="code" href="namespaceConstant.html#a7f485605d9dab3fde05d52f03ca9f36e">pow2</a>(Z1) - 1) * dW1 + (<a class="code" href="namespaceConstant.html#a7f485605d9dab3fde05d52f03ca9f36e">pow2</a>(Z2) - 1) * dW2 -</div>
<div class="line"><a name="l01173"></a><span class="lineno"> 1173</span>&#160;                            2 * W1 * Z1 * dZ1 + 2 * W2 * Z2 * dZ2) *</div>
<div class="line"><a name="l01174"></a><span class="lineno"> 1174</span>&#160;                           Y) *</div>
<div class="line"><a name="l01175"></a><span class="lineno"> 1175</span>&#160;                      c2t +</div>
<div class="line"><a name="l01176"></a><span class="lineno"> 1176</span>&#160;                  2 *</div>
<div class="line"><a name="l01177"></a><span class="lineno"> 1177</span>&#160;                      (sqrt_pi * (<a class="code" href="namespaceConstant.html#a7f485605d9dab3fde05d52f03ca9f36e">pow2</a>(Z1) - 1) * W1 -</div>
<div class="line"><a name="l01178"></a><span class="lineno"> 1178</span>&#160;                       sqrt_pi * (<a class="code" href="namespaceConstant.html#a7f485605d9dab3fde05d52f03ca9f36e">pow2</a>(Z2) - 1) * W2 + 2 * sqrtY) *</div>
<div class="line"><a name="l01179"></a><span class="lineno"> 1179</span>&#160;                      Y * dc2t) /</div>
<div class="line"><a name="l01180"></a><span class="lineno"> 1180</span>&#160;                 (4 * Y * sqrtY * <a class="code" href="namespaceConstant.html#a7f485605d9dab3fde05d52f03ca9f36e">pow2</a>(c2t));  <span class="comment">// for all</span></div>
<div class="line"><a name="l01181"></a><span class="lineno"> 1181</span>&#160;      } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="legacy__continua_8cc.html#a3aa069ac3980707dae1e0530f50d59e4">abs</a>(Y) &lt;= 1e-15 * <a class="code" href="legacy__continua_8cc.html#a3aa069ac3980707dae1e0530f50d59e4">abs</a>(X)) {</div>
<div class="line"><a name="l01182"></a><span class="lineno"> 1182</span>&#160;        <span class="keyword">const</span> <a class="code" href="complex_8h.html#aff1205001edf41e8e0032f18b98875e1">Complex</a> dZ1 = (dX + dY) / (2 * sqrtXY);  <span class="comment">// for all</span></div>
<div class="line"><a name="l01183"></a><span class="lineno"> 1183</span>&#160;        <span class="keyword">const</span> <a class="code" href="complex_8h.html#aff1205001edf41e8e0032f18b98875e1">Complex</a> dW1 = iz * dZ1 * <a class="code" href="linefunctions_8cc.html#a08f2b520b433833c0d7ca264f305380e">dw</a>(Z1, W1);     <span class="comment">// NEED TO CHECK DW!</span></div>
<div class="line"><a name="l01184"></a><span class="lineno"> 1184</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="legacy__continua_8cc.html#a3aa069ac3980707dae1e0530f50d59e4">abs</a>(sqrtX) &lt;= 4e3) {</div>
<div class="line"><a name="l01185"></a><span class="lineno"> 1185</span>&#160;          <span class="keyword">const</span> <a class="code" href="complex_8h.html#aff1205001edf41e8e0032f18b98875e1">Complex</a> dZb = dX / (2 * sqrtX);       <span class="comment">// for all</span></div>
<div class="line"><a name="l01186"></a><span class="lineno"> 1186</span>&#160;          <span class="keyword">const</span> <a class="code" href="complex_8h.html#aff1205001edf41e8e0032f18b98875e1">Complex</a> dWb = iz * dZb * <a class="code" href="linefunctions_8cc.html#a08f2b520b433833c0d7ca264f305380e">dw</a>(Zb, Wb);  <span class="comment">// NEED TO CHECK DW!</span></div>
<div class="line"><a name="l01187"></a><span class="lineno"> 1187</span>&#160; </div>
<div class="line"><a name="l01188"></a><span class="lineno"> 1188</span>&#160;          dAterm = (-sqrt_pi * (Wb * dX + 2 * X * dWb) * c2t +</div>
<div class="line"><a name="l01189"></a><span class="lineno"> 1189</span>&#160;                    2 * (sqrt_pi * Wb * sqrtX - 1) * sqrtX * dc2t) /</div>
<div class="line"><a name="l01190"></a><span class="lineno"> 1190</span>&#160;                   (sqrtX * <a class="code" href="namespaceConstant.html#a7f485605d9dab3fde05d52f03ca9f36e">pow2</a>(c2t));  <span class="comment">// for all</span></div>
<div class="line"><a name="l01191"></a><span class="lineno"> 1191</span>&#160; </div>
<div class="line"><a name="l01192"></a><span class="lineno"> 1192</span>&#160;          dBterm =</div>
<div class="line"><a name="l01193"></a><span class="lineno"> 1193</span>&#160;              (-sqrtXY *</div>
<div class="line"><a name="l01194"></a><span class="lineno"> 1194</span>&#160;                   (2 * (sqrt_pi * Wb * sqrtX - 1) * (X + 2 * Y - 1) +</div>
<div class="line"><a name="l01195"></a><span class="lineno"> 1195</span>&#160;                    2 * sqrt_pi * sqrtXY * W1 - 1) *</div>
<div class="line"><a name="l01196"></a><span class="lineno"> 1196</span>&#160;                   sqrtX * dc2t +</div>
<div class="line"><a name="l01197"></a><span class="lineno"> 1197</span>&#160;               (2 *</div>
<div class="line"><a name="l01198"></a><span class="lineno"> 1198</span>&#160;                    ((sqrt_pi * Wb * sqrtX - 1) * (dX + 2 * dY) +</div>
<div class="line"><a name="l01199"></a><span class="lineno"> 1199</span>&#160;                     sqrt_pi * sqrtXY * dW1) *</div>
<div class="line"><a name="l01200"></a><span class="lineno"> 1200</span>&#160;                    sqrtXY * sqrtX +</div>
<div class="line"><a name="l01201"></a><span class="lineno"> 1201</span>&#160;                sqrt_pi * (Wb * dX + 2 * X * dWb) * sqrtXY * (X + 2 * Y - 1) +</div>
<div class="line"><a name="l01202"></a><span class="lineno"> 1202</span>&#160;                sqrt_pi * (dX + dY) * W1 * sqrtX) *</div>
<div class="line"><a name="l01203"></a><span class="lineno"> 1203</span>&#160;                   c2t) /</div>
<div class="line"><a name="l01204"></a><span class="lineno"> 1204</span>&#160;              (sqrtXY * sqrtX * <a class="code" href="namespaceConstant.html#a7f485605d9dab3fde05d52f03ca9f36e">pow2</a>(c2t));  <span class="comment">// for all</span></div>
<div class="line"><a name="l01205"></a><span class="lineno"> 1205</span>&#160;        } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l01206"></a><span class="lineno"> 1206</span>&#160;          dAterm = ((-X + 3.0) * c2t * dX - (X - 1.5) * X * dc2t) /</div>
<div class="line"><a name="l01207"></a><span class="lineno"> 1207</span>&#160;                   (<a class="code" href="namespaceConstant.html#aa415feed8b057c59bc7965f74cc1331d">pow3</a>(X) * <a class="code" href="namespaceConstant.html#a7f485605d9dab3fde05d52f03ca9f36e">pow2</a>(c2t));  <span class="comment">// for all</span></div>
<div class="line"><a name="l01208"></a><span class="lineno"> 1208</span>&#160; </div>
<div class="line"><a name="l01209"></a><span class="lineno"> 1209</span>&#160;          dBterm = (((-2 * sqrt_pi * sqrtXY * W1 + 1) * <a class="code" href="namespaceConstant.html#a7f485605d9dab3fde05d52f03ca9f36e">pow2</a>(X) +</div>
<div class="line"><a name="l01210"></a><span class="lineno"> 1210</span>&#160;                     (X - 1.5) * (X + 2 * Y - 1)) *</div>
<div class="line"><a name="l01211"></a><span class="lineno"> 1211</span>&#160;                        sqrtXY * X * dc2t +</div>
<div class="line"><a name="l01212"></a><span class="lineno"> 1212</span>&#160;                    ((X - 3.0) * sqrtXY * (X + 2 * Y - 1) * dX -</div>
<div class="line"><a name="l01213"></a><span class="lineno"> 1213</span>&#160;                     (X - 1.5) * sqrtXY * (dX + 2 * dY) * X +</div>
<div class="line"><a name="l01214"></a><span class="lineno"> 1214</span>&#160;                     2 * sqrt_pi * (X + Y) * <a class="code" href="namespaceConstant.html#aa415feed8b057c59bc7965f74cc1331d">pow3</a>(X) * dW1 +</div>
<div class="line"><a name="l01215"></a><span class="lineno"> 1215</span>&#160;                     sqrt_pi * (dX + dY) * W1 * <a class="code" href="namespaceConstant.html#aa415feed8b057c59bc7965f74cc1331d">pow3</a>(X)) *</div>
<div class="line"><a name="l01216"></a><span class="lineno"> 1216</span>&#160;                        c2t) /</div>
<div class="line"><a name="l01217"></a><span class="lineno"> 1217</span>&#160;                   (sqrtXY * <a class="code" href="namespaceConstant.html#aa415feed8b057c59bc7965f74cc1331d">pow3</a>(X) * <a class="code" href="namespaceConstant.html#a7f485605d9dab3fde05d52f03ca9f36e">pow2</a>(c2t));  <span class="comment">// for all</span></div>
<div class="line"><a name="l01218"></a><span class="lineno"> 1218</span>&#160;        }</div>
<div class="line"><a name="l01219"></a><span class="lineno"> 1219</span>&#160;      } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l01220"></a><span class="lineno"> 1220</span>&#160;        <span class="keyword">const</span> <a class="code" href="complex_8h.html#aff1205001edf41e8e0032f18b98875e1">Complex</a> dZ1 = -dY / (2 * sqrtY) + dX / (2 * sqrtXY) +</div>
<div class="line"><a name="l01221"></a><span class="lineno"> 1221</span>&#160;                            dY / (2 * sqrtXY);  <span class="comment">// for all</span></div>
<div class="line"><a name="l01222"></a><span class="lineno"> 1222</span>&#160;        <span class="keyword">const</span> <a class="code" href="complex_8h.html#aff1205001edf41e8e0032f18b98875e1">Complex</a> dZ2 = dY / (2 * sqrtY) + dX / (2 * sqrtXY) +</div>
<div class="line"><a name="l01223"></a><span class="lineno"> 1223</span>&#160;                            dY / (2 * sqrtXY);  <span class="comment">// for all</span></div>
<div class="line"><a name="l01224"></a><span class="lineno"> 1224</span>&#160; </div>
<div class="line"><a name="l01225"></a><span class="lineno"> 1225</span>&#160;        <span class="keyword">const</span> <a class="code" href="complex_8h.html#aff1205001edf41e8e0032f18b98875e1">Complex</a> dW1 = iz * dZ1 * <a class="code" href="linefunctions_8cc.html#a08f2b520b433833c0d7ca264f305380e">dw</a>(Z1, W1);  <span class="comment">// NEED TO CHECK DW!</span></div>
<div class="line"><a name="l01226"></a><span class="lineno"> 1226</span>&#160;        <span class="keyword">const</span> <a class="code" href="complex_8h.html#aff1205001edf41e8e0032f18b98875e1">Complex</a> dW2 = iz * dZ2 * <a class="code" href="linefunctions_8cc.html#a08f2b520b433833c0d7ca264f305380e">dw</a>(Z2, W2);  <span class="comment">// NEED TO CHECK DW!</span></div>
<div class="line"><a name="l01227"></a><span class="lineno"> 1227</span>&#160; </div>
<div class="line"><a name="l01228"></a><span class="lineno"> 1228</span>&#160;        dAterm = sqrt_pi * ((W1 - W2) * dcte + (dW1 - dW2) * cte);  <span class="comment">// for all</span></div>
<div class="line"><a name="l01229"></a><span class="lineno"> 1229</span>&#160; </div>
<div class="line"><a name="l01230"></a><span class="lineno"> 1230</span>&#160;        dBterm = (sqrt_pi *</div>
<div class="line"><a name="l01231"></a><span class="lineno"> 1231</span>&#160;                      (((<a class="code" href="namespaceConstant.html#a7f485605d9dab3fde05d52f03ca9f36e">pow2</a>(Z1) - 1) * W1 - (<a class="code" href="namespaceConstant.html#a7f485605d9dab3fde05d52f03ca9f36e">pow2</a>(Z2) - 1) * W2) * dY +</div>
<div class="line"><a name="l01232"></a><span class="lineno"> 1232</span>&#160;                       2 *</div>
<div class="line"><a name="l01233"></a><span class="lineno"> 1233</span>&#160;                           (-(<a class="code" href="namespaceConstant.html#a7f485605d9dab3fde05d52f03ca9f36e">pow2</a>(Z1) - 1) * dW1 + (<a class="code" href="namespaceConstant.html#a7f485605d9dab3fde05d52f03ca9f36e">pow2</a>(Z2) - 1) * dW2 -</div>
<div class="line"><a name="l01234"></a><span class="lineno"> 1234</span>&#160;                            2 * W1 * Z1 * dZ1 + 2 * W2 * Z2 * dZ2) *</div>
<div class="line"><a name="l01235"></a><span class="lineno"> 1235</span>&#160;                           Y) *</div>
<div class="line"><a name="l01236"></a><span class="lineno"> 1236</span>&#160;                      c2t +</div>
<div class="line"><a name="l01237"></a><span class="lineno"> 1237</span>&#160;                  2 *</div>
<div class="line"><a name="l01238"></a><span class="lineno"> 1238</span>&#160;                      (sqrt_pi * (<a class="code" href="namespaceConstant.html#a7f485605d9dab3fde05d52f03ca9f36e">pow2</a>(Z1) - 1) * W1 -</div>
<div class="line"><a name="l01239"></a><span class="lineno"> 1239</span>&#160;                       sqrt_pi * (<a class="code" href="namespaceConstant.html#a7f485605d9dab3fde05d52f03ca9f36e">pow2</a>(Z2) - 1) * W2 + 2 * sqrtY) *</div>
<div class="line"><a name="l01240"></a><span class="lineno"> 1240</span>&#160;                      Y * dc2t) /</div>
<div class="line"><a name="l01241"></a><span class="lineno"> 1241</span>&#160;                 (4 * Y * sqrtY * <a class="code" href="namespaceConstant.html#a7f485605d9dab3fde05d52f03ca9f36e">pow2</a>(c2t));  <span class="comment">// for all</span></div>
<div class="line"><a name="l01242"></a><span class="lineno"> 1242</span>&#160;      }</div>
<div class="line"><a name="l01243"></a><span class="lineno"> 1243</span>&#160; </div>
<div class="line"><a name="l01244"></a><span class="lineno"> 1244</span>&#160;      <a class="code" href="matpack_8h.html#ad9a8dbb27c0bbea7271d916036122f6a">Numeric</a> dFVC = 0, dETA = 0;</div>
<div class="line"><a name="l01245"></a><span class="lineno"> 1245</span>&#160;      <span class="keywordflow">if</span> (rt == JacPropMatType::Temperature) {</div>
<div class="line"><a name="l01246"></a><span class="lineno"> 1246</span>&#160;        dETA = dT.ETA;</div>
<div class="line"><a name="l01247"></a><span class="lineno"> 1247</span>&#160;        dFVC = dT.FVC;</div>
<div class="line"><a name="l01248"></a><span class="lineno"> 1248</span>&#160;      } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (rt == JacPropMatType::VMR) {</div>
<div class="line"><a name="l01249"></a><span class="lineno"> 1249</span>&#160;        dETA = dV.ETA;</div>
<div class="line"><a name="l01250"></a><span class="lineno"> 1250</span>&#160;        dFVC = dV.FVC;</div>
<div class="line"><a name="l01251"></a><span class="lineno"> 1251</span>&#160;      } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="jacobian_8h.html#aa9ed0864b0bf1c68796bae61e1319aa9">is_pressure_broadening_ETA</a>(rt) and</div>
<div class="line"><a name="l01252"></a><span class="lineno"> 1252</span>&#160;                 <a class="code" href="namespaceAbsorption.html#a1554ecf51c40489e7f2a9f77a3314511">Absorption::id_in_line</a>(band, rt.<a class="code" href="classRetrievalQuantity.html#a51b340f8988eb17696b9621d03da2751">QuantumIdentity</a>(), line_ind))</div>
<div class="line"><a name="l01253"></a><span class="lineno"> 1253</span>&#160;        dETA = 1;</div>
<div class="line"><a name="l01254"></a><span class="lineno"> 1254</span>&#160;      <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="jacobian_8h.html#a518d816c30fe86ca604993a18a8e213a">is_pressure_broadening_FVC</a>(rt) and</div>
<div class="line"><a name="l01255"></a><span class="lineno"> 1255</span>&#160;               <a class="code" href="namespaceAbsorption.html#a1554ecf51c40489e7f2a9f77a3314511">Absorption::id_in_line</a>(band, rt.<a class="code" href="classRetrievalQuantity.html#a51b340f8988eb17696b9621d03da2751">QuantumIdentity</a>(), line_ind))</div>
<div class="line"><a name="l01256"></a><span class="lineno"> 1256</span>&#160;        dFVC = 1;</div>
<div class="line"><a name="l01257"></a><span class="lineno"> 1257</span>&#160; </div>
<div class="line"><a name="l01258"></a><span class="lineno"> 1258</span>&#160;      dF.col(iq)(iv) =</div>
<div class="line"><a name="l01259"></a><span class="lineno"> 1259</span>&#160;          ((((c0 - 1.5 * c2) * lso.ETA - lso.FVC) * Aterm + Bterm * c2 * lso.ETA +</div>
<div class="line"><a name="l01260"></a><span class="lineno"> 1260</span>&#160;            1) *</div>
<div class="line"><a name="l01261"></a><span class="lineno"> 1261</span>&#160;               dAterm -</div>
<div class="line"><a name="l01262"></a><span class="lineno"> 1262</span>&#160;           (((c0 - 1.5 * c2) * lso.ETA - lso.FVC) * dAterm +</div>
<div class="line"><a name="l01263"></a><span class="lineno"> 1263</span>&#160;            ((c0 - 1.5 * c2) * dETA + (dc0 - 1.5 * dc2) * lso.ETA - dFVC) *</div>
<div class="line"><a name="l01264"></a><span class="lineno"> 1264</span>&#160;                Aterm +</div>
<div class="line"><a name="l01265"></a><span class="lineno"> 1265</span>&#160;            Bterm * c2 * dETA + Bterm * lso.ETA * dc2 + c2 * lso.ETA * dBterm) *</div>
<div class="line"><a name="l01266"></a><span class="lineno"> 1266</span>&#160;               Aterm) /</div>
<div class="line"><a name="l01267"></a><span class="lineno"> 1267</span>&#160;          (pi * <a class="code" href="namespaceConstant.html#a7f485605d9dab3fde05d52f03ca9f36e">pow2</a>(((c0 - 1.5 * c2) * lso.ETA - lso.FVC) * Aterm +</div>
<div class="line"><a name="l01268"></a><span class="lineno"> 1268</span>&#160;                     Bterm * c2 * lso.ETA + 1));  <span class="comment">// for all</span></div>
<div class="line"><a name="l01269"></a><span class="lineno"> 1269</span>&#160;    }</div>
<div class="line"><a name="l01270"></a><span class="lineno"> 1270</span>&#160;  }</div>
<div class="line"><a name="l01271"></a><span class="lineno"> 1271</span>&#160; </div>
<div class="line"><a name="l01272"></a><span class="lineno"> 1272</span>&#160;  <span class="comment">// Convert back to ARTS</span></div>
<div class="line"><a name="l01273"></a><span class="lineno"> 1273</span>&#160;  F = F.unaryExpr(&amp;<a class="code" href="linefunctions_8cc.html#aac6918584a4f0ae9c7b2ff900eb047a4">pCqSDHC_to_arts</a>);</div>
<div class="line"><a name="l01274"></a><span class="lineno"> 1274</span>&#160;  <span class="keywordflow">for</span> (<span class="keyword">auto</span> iq = 0; iq &lt; derivatives_data_position.<a class="code" href="classArray.html#a90ce1cf3f99646da9d0efd6e8a661369">nelem</a>(); iq++) {</div>
<div class="line"><a name="l01275"></a><span class="lineno"> 1275</span>&#160;    <span class="keyword">const</span> <a class="code" href="classRetrievalQuantity.html">RetrievalQuantity</a>&amp; rt =</div>
<div class="line"><a name="l01276"></a><span class="lineno"> 1276</span>&#160;        derivatives_data[derivatives_data_position[iq]];</div>
<div class="line"><a name="l01277"></a><span class="lineno"> 1277</span>&#160; </div>
<div class="line"><a name="l01278"></a><span class="lineno"> 1278</span>&#160;    <span class="keywordflow">if</span> (rt == JacPropMatType::LineCenter or <a class="code" href="jacobian_8cc.html#ad59138aabb0d611ff16659b4fd93858a">is_frequency_parameter</a>(rt) or</div>
<div class="line"><a name="l01279"></a><span class="lineno"> 1279</span>&#160;        <a class="code" href="jacobian_8h.html#a4bea1e519152d28026876d006f372ac4">is_pressure_broadening_G0</a>(rt) or <a class="code" href="jacobian_8h.html#a10cc5eb98e966a4d466ae1f56a7356a4">is_pressure_broadening_D0</a>(rt) or</div>
<div class="line"><a name="l01280"></a><span class="lineno"> 1280</span>&#160;        <a class="code" href="jacobian_8h.html#a518d816c30fe86ca604993a18a8e213a">is_pressure_broadening_FVC</a>(rt))</div>
<div class="line"><a name="l01281"></a><span class="lineno"> 1281</span>&#160;      dF.col(iq) = dF.col(iq).unaryExpr(&amp;<a class="code" href="linefunctions_8cc.html#a9e4c2622d7fda9ecb3bd1ed9a074c756">pCqSDHC_to_arts_freq_deriv</a>);</div>
<div class="line"><a name="l01282"></a><span class="lineno"> 1282</span>&#160;    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="jacobian_8h.html#a9fc78900dc39e948c57047d4f960cd91">is_pressure_broadening_G2</a>(rt))</div>
<div class="line"><a name="l01283"></a><span class="lineno"> 1283</span>&#160;      dF.col(iq) = dF.col(iq).unaryExpr(&amp;<a class="code" href="linefunctions_8cc.html#a691ec5192a5f391467f8c39cb05559fd">pCqSDHC_to_arts_G2_deriv</a>);</div>
<div class="line"><a name="l01284"></a><span class="lineno"> 1284</span>&#160;    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="jacobian_8h.html#a7325f3320449b86e8cbc6e4c2c1e9e36">is_pressure_broadening_D2</a>(rt))</div>
<div class="line"><a name="l01285"></a><span class="lineno"> 1285</span>&#160;      dF.col(iq) = dF.col(iq).unaryExpr(&amp;<a class="code" href="linefunctions_8cc.html#aab6895ad5809bc8a42a1ae2eab7e61d2">pCqSDHC_to_arts_D2_deriv</a>);</div>
<div class="line"><a name="l01286"></a><span class="lineno"> 1286</span>&#160;    <span class="keywordflow">else</span></div>
<div class="line"><a name="l01287"></a><span class="lineno"> 1287</span>&#160;      dF.col(iq) = dF.col(iq).unaryExpr(&amp;<a class="code" href="linefunctions_8cc.html#aac6918584a4f0ae9c7b2ff900eb047a4">pCqSDHC_to_arts</a>);</div>
<div class="line"><a name="l01288"></a><span class="lineno"> 1288</span>&#160;  }</div>
<div class="line"><a name="l01289"></a><span class="lineno"> 1289</span>&#160;}</div>
<div class="line"><a name="l01290"></a><span class="lineno"> 1290</span>&#160; </div>
<div class="line"><a name="l01291"></a><span class="lineno"><a class="line" href="namespaceLinefunctions.html#aa8288ab4c09cddb5e3c3a28a96a64463"> 1291</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="namespaceLinefunctions.html#aa8288ab4c09cddb5e3c3a28a96a64463">Linefunctions::set_cross_section_of_band</a>(</div>
<div class="line"><a name="l01292"></a><span class="lineno"> 1292</span>&#160;    <a class="code" href="classLinefunctions_1_1InternalData.html">InternalData</a>&amp; scratch,</div>
<div class="line"><a name="l01293"></a><span class="lineno"> 1293</span>&#160;    <a class="code" href="classLinefunctions_1_1InternalData.html">InternalData</a>&amp; sum,</div>
<div class="line"><a name="l01294"></a><span class="lineno"> 1294</span>&#160;    <span class="keyword">const</span> <a class="code" href="classConstVectorView.html">ConstVectorView</a> <a class="code" href="namespaceARTS_1_1Var.html#a656f34b4c40189bd3c971e2d3dbe3b95">f_grid</a>,</div>
<div class="line"><a name="l01295"></a><span class="lineno"> 1295</span>&#160;    <span class="keyword">const</span> <a class="code" href="classAbsorption_1_1Lines.html">AbsorptionLines</a>&amp; band,</div>
<div class="line"><a name="l01296"></a><span class="lineno"> 1296</span>&#160;    <span class="keyword">const</span> <a class="code" href="classArray.html">ArrayOfRetrievalQuantity</a>&amp; derivatives_data,</div>
<div class="line"><a name="l01297"></a><span class="lineno"> 1297</span>&#160;    <span class="keyword">const</span> <a class="code" href="classArray.html">ArrayOfIndex</a>&amp; derivatives_data_active,</div>
<div class="line"><a name="l01298"></a><span class="lineno"> 1298</span>&#160;    <span class="keyword">const</span> <a class="code" href="classVector.html">Vector</a>&amp; <a class="code" href="namespaceLineShape.html#a4b0cfb5637fe4bfa0bded7aefc4bb437">vmrs</a>,</div>
<div class="line"><a name="l01299"></a><span class="lineno"> 1299</span>&#160;    <span class="keyword">const</span> <a class="code" href="classEnergyLevelMap.html">EnergyLevelMap</a>&amp; nlte,</div>
<div class="line"><a name="l01300"></a><span class="lineno"> 1300</span>&#160;    <span class="keyword">const</span> <a class="code" href="matpack_8h.html#ad9a8dbb27c0bbea7271d916036122f6a">Numeric</a>&amp; P,</div>
<div class="line"><a name="l01301"></a><span class="lineno"> 1301</span>&#160;    <span class="keyword">const</span> <a class="code" href="matpack_8h.html#ad9a8dbb27c0bbea7271d916036122f6a">Numeric</a>&amp; T,</div>
<div class="line"><a name="l01302"></a><span class="lineno"> 1302</span>&#160;    <span class="keyword">const</span> <a class="code" href="matpack_8h.html#ad9a8dbb27c0bbea7271d916036122f6a">Numeric</a>&amp; isot_ratio,</div>
<div class="line"><a name="l01303"></a><span class="lineno"> 1303</span>&#160;    <span class="keyword">const</span> <a class="code" href="matpack_8h.html#ad9a8dbb27c0bbea7271d916036122f6a">Numeric</a>&amp; H,</div>
<div class="line"><a name="l01304"></a><span class="lineno"> 1304</span>&#160;    <span class="keyword">const</span> <a class="code" href="matpack_8h.html#ad9a8dbb27c0bbea7271d916036122f6a">Numeric</a>&amp; DC,</div>
<div class="line"><a name="l01305"></a><span class="lineno"> 1305</span>&#160;    <span class="keyword">const</span> <a class="code" href="matpack_8h.html#ad9a8dbb27c0bbea7271d916036122f6a">Numeric</a>&amp; dDCdT,</div>
<div class="line"><a name="l01306"></a><span class="lineno"> 1306</span>&#160;    <span class="keyword">const</span> <a class="code" href="matpack_8h.html#ad9a8dbb27c0bbea7271d916036122f6a">Numeric</a>&amp; QT,</div>
<div class="line"><a name="l01307"></a><span class="lineno"> 1307</span>&#160;    <span class="keyword">const</span> <a class="code" href="matpack_8h.html#ad9a8dbb27c0bbea7271d916036122f6a">Numeric</a>&amp; dQTdT,</div>
<div class="line"><a name="l01308"></a><span class="lineno"> 1308</span>&#160;    <span class="keyword">const</span> <a class="code" href="matpack_8h.html#ad9a8dbb27c0bbea7271d916036122f6a">Numeric</a>&amp; QT0,</div>
<div class="line"><a name="l01309"></a><span class="lineno"> 1309</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">bool</span> no_negatives,</div>
<div class="line"><a name="l01310"></a><span class="lineno"> 1310</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">bool</span> zeeman,</div>
<div class="line"><a name="l01311"></a><span class="lineno"> 1311</span>&#160;    <span class="keyword">const</span> <a class="code" href="namespaceZeeman.html#a12f398a6c84854a865975552bc660073">Zeeman::Polarization</a> zeeman_polarization)</div>
<div class="line"><a name="l01312"></a><span class="lineno"> 1312</span>&#160;{</div>
<div class="line"><a name="l01313"></a><span class="lineno"> 1313</span>&#160;  <span class="keyword">const</span> <a class="code" href="matpack_8h.html#aedca4b4670b166565b5b40c700d65a7c">Index</a> nj = derivatives_data_active.<a class="code" href="classArray.html#a90ce1cf3f99646da9d0efd6e8a661369">nelem</a>();</div>
<div class="line"><a name="l01314"></a><span class="lineno"> 1314</span>&#160;  <span class="keyword">const</span> <span class="keywordtype">bool</span> do_temperature = <a class="code" href="jacobian_8cc.html#a898bd3f5acba8942e94aceb11b0d1ad9">do_temperature_jacobian</a>(derivatives_data);</div>
<div class="line"><a name="l01315"></a><span class="lineno"> 1315</span>&#160;  </div>
<div class="line"><a name="l01316"></a><span class="lineno"> 1316</span>&#160;  <span class="comment">// Sum up variable reset</span></div>
<div class="line"><a name="l01317"></a><span class="lineno"> 1317</span>&#160;  sum.<a class="code" href="classLinefunctions_1_1InternalData.html#ad06ef67cf684a1a1eed19bd0392299bc">SetZero</a>();</div>
<div class="line"><a name="l01318"></a><span class="lineno"> 1318</span>&#160;  </div>
<div class="line"><a name="l01319"></a><span class="lineno"> 1319</span>&#160;  <span class="keywordflow">if</span> (band.<a class="code" href="classAbsorption_1_1Lines.html#a6c31f06cb7594581da15971eb5af93f4">NumLines</a>() == 0 or (<a class="code" href="namespaceAbsorption.html#a2f0c3dd49d97196162df0c84e0d9b782">Absorption::relaxationtype_relmat</a>(band.<a class="code" href="classAbsorption_1_1Lines.html#a645e900f27278b50a3ecda524f868a06">Population</a>()) and band.<a class="code" href="classAbsorption_1_1Lines.html#aeb82ce42bb7d2b1066604e2bc491e08a">LinemixingLimit</a>() &gt; P)) {</div>
<div class="line"><a name="l01320"></a><span class="lineno"> 1320</span>&#160;    <span class="keywordflow">return</span>;  <span class="comment">// No line-by-line computations required/wanted</span></div>
<div class="line"><a name="l01321"></a><span class="lineno"> 1321</span>&#160;  }</div>
<div class="line"><a name="l01322"></a><span class="lineno"> 1322</span>&#160;  </div>
<div class="line"><a name="l01323"></a><span class="lineno"> 1323</span>&#160;  <span class="comment">// Cutoff for Eigen-library types</span></div>
<div class="line"><a name="l01324"></a><span class="lineno"> 1324</span>&#160;  Eigen::Matrix&lt;Numeric, 1, 1&gt; fc;</div>
<div class="line"><a name="l01325"></a><span class="lineno"> 1325</span>&#160;  <span class="keyword">auto</span>&amp; Fc = scratch.<a class="code" href="classLinefunctions_1_1InternalData.html#aaa3ff7b7e0b54271a3bf076a66239346">Fc</a>;</div>
<div class="line"><a name="l01326"></a><span class="lineno"> 1326</span>&#160;  <span class="keyword">auto</span>&amp; Nc = scratch.<a class="code" href="classLinefunctions_1_1InternalData.html#a28fd6d40dd8a9832a253114ac31090ba">Nc</a>;</div>
<div class="line"><a name="l01327"></a><span class="lineno"> 1327</span>&#160;  <span class="keyword">auto</span>&amp; dFc = scratch.<a class="code" href="classLinefunctions_1_1InternalData.html#a4b37c31bf8abcc7b5775ae7079089508">dFc</a>;</div>
<div class="line"><a name="l01328"></a><span class="lineno"> 1328</span>&#160;  <span class="keyword">auto</span>&amp; dNc = scratch.<a class="code" href="classLinefunctions_1_1InternalData.html#ae6d374f29d96218f4bda249324f19140">dNc</a>;</div>
<div class="line"><a name="l01329"></a><span class="lineno"> 1329</span>&#160;  <span class="keyword">auto</span>&amp; datac = scratch.<a class="code" href="classLinefunctions_1_1InternalData.html#aa2b34cb671b2e32f28f659054813f97f">datac</a>;</div>
<div class="line"><a name="l01330"></a><span class="lineno"> 1330</span>&#160;  </div>
<div class="line"><a name="l01331"></a><span class="lineno"> 1331</span>&#160;  <span class="comment">// Frequency grid as Eigen type</span></div>
<div class="line"><a name="l01332"></a><span class="lineno"> 1332</span>&#160;  <span class="keyword">const</span> <span class="keyword">auto</span> f_full = <a class="code" href="complex_8cc.html#a79a18b72864daf76c36f123c0ca626b4">MapToEigen</a>(<a class="code" href="namespaceARTS_1_1Var.html#a656f34b4c40189bd3c971e2d3dbe3b95">f_grid</a>);</div>
<div class="line"><a name="l01333"></a><span class="lineno"> 1333</span>&#160;  </div>
<div class="line"><a name="l01334"></a><span class="lineno"> 1334</span>&#160;  <span class="comment">// Cut off range</span></div>
<div class="line"><a name="l01335"></a><span class="lineno"> 1335</span>&#160;  <span class="keyword">const</span> <a class="code" href="matpack_8h.html#ad9a8dbb27c0bbea7271d916036122f6a">Numeric</a> fmean = (band.<a class="code" href="classAbsorption_1_1Lines.html#aa00fcb592ca7e1101db4cfc30d1e559b">Cutoff</a>() == <a class="code" href="namespaceAbsorption.html#a671f397d421fb6ed148c3b8efa88f8d2a6adf97f83acf6453d4a6a4b1070f3754">Absorption::CutoffType::BandFixedFrequency</a>) ? band.<a class="code" href="classAbsorption_1_1Lines.html#af7f4040db9606085cbe5f1ab4fb17b6b">F_mean</a>() : 0;</div>
<div class="line"><a name="l01336"></a><span class="lineno"> 1336</span>&#160;  <a class="code" href="matpack_8h.html#ad9a8dbb27c0bbea7271d916036122f6a">Numeric</a> fcut_upp, fcut_low;</div>
<div class="line"><a name="l01337"></a><span class="lineno"> 1337</span>&#160;  <a class="code" href="matpack_8h.html#aedca4b4670b166565b5b40c700d65a7c">Index</a> <a class="code" href="namespaceZeeman.html#a5a24367cfa454aeb6730983395042ecf">start</a>, <a class="code" href="namespaceAbsorption.html#a5694bacde9aa335dc5ec69d50f201992">nelem</a>;</div>
<div class="line"><a name="l01338"></a><span class="lineno"> 1338</span>&#160;  fcut_upp = band.<a class="code" href="classAbsorption_1_1Lines.html#a55ea49ee3498c6145ecbb2807a585a7e">CutoffFreq</a>(0);</div>
<div class="line"><a name="l01339"></a><span class="lineno"> 1339</span>&#160;  fcut_low = band.<a class="code" href="classAbsorption_1_1Lines.html#abd6edd8862aa3cfa6934c2abc918143e">CutoffFreqMinus</a>(0, fmean);</div>
<div class="line"><a name="l01340"></a><span class="lineno"> 1340</span>&#160;  <a class="code" href="namespaceLinefunctions.html#a6692d67ff28ec4a405b0a893e9584a17">find_cutoff_ranges</a>(<a class="code" href="namespaceZeeman.html#a5a24367cfa454aeb6730983395042ecf">start</a>, <a class="code" href="namespaceAbsorption.html#a5694bacde9aa335dc5ec69d50f201992">nelem</a>, f_full, fcut_low, fcut_upp);</div>
<div class="line"><a name="l01341"></a><span class="lineno"> 1341</span>&#160;  fc[0] = fcut_upp;</div>
<div class="line"><a name="l01342"></a><span class="lineno"> 1342</span>&#160;  </div>
<div class="line"><a name="l01343"></a><span class="lineno"> 1343</span>&#160;  <span class="comment">// VMR Jacobian check</span></div>
<div class="line"><a name="l01344"></a><span class="lineno"> 1344</span>&#160;  <span class="keyword">auto</span> do_vmr = <a class="code" href="jacobian_8cc.html#addaa9fa44dc639fdff8a8bd58248853c">do_vmr_jacobian</a>(derivatives_data, band.<a class="code" href="classAbsorption_1_1Lines.html#acadb529b972003acc1e782d855bdaa08">QuantumIdentity</a>());</div>
<div class="line"><a name="l01345"></a><span class="lineno"> 1345</span>&#160;  </div>
<div class="line"><a name="l01346"></a><span class="lineno"> 1346</span>&#160;  <span class="comment">// Placeholder nothingness</span></div>
<div class="line"><a name="l01347"></a><span class="lineno"> 1347</span>&#160;  constexpr <a class="code" href="structLineShape_1_1Output.html">LineShape::Output</a> empty_output = {0, 0, 0, 0, 0, 0, 0, 0, 0};</div>
<div class="line"><a name="l01348"></a><span class="lineno"> 1348</span>&#160;  </div>
<div class="line"><a name="l01349"></a><span class="lineno"> 1349</span>&#160;  <span class="keywordflow">for</span> (<a class="code" href="matpack_8h.html#aedca4b4670b166565b5b40c700d65a7c">Index</a> i=0; i&lt;band.<a class="code" href="classAbsorption_1_1Lines.html#a6c31f06cb7594581da15971eb5af93f4">NumLines</a>(); i++) {</div>
<div class="line"><a name="l01350"></a><span class="lineno"> 1350</span>&#160;    </div>
<div class="line"><a name="l01351"></a><span class="lineno"> 1351</span>&#160;    <span class="comment">// Select the range of cutoff if different for each line</span></div>
<div class="line"><a name="l01352"></a><span class="lineno"> 1352</span>&#160;    <span class="keywordflow">if</span> (band.<a class="code" href="classAbsorption_1_1Lines.html#aa00fcb592ca7e1101db4cfc30d1e559b">Cutoff</a>() == Absorption::CutoffType::LineByLineOffset and i&gt;0) {</div>
<div class="line"><a name="l01353"></a><span class="lineno"> 1353</span>&#160;      fcut_upp = band.<a class="code" href="classAbsorption_1_1Lines.html#a55ea49ee3498c6145ecbb2807a585a7e">CutoffFreq</a>(i);</div>
<div class="line"><a name="l01354"></a><span class="lineno"> 1354</span>&#160;      fcut_low = band.<a class="code" href="classAbsorption_1_1Lines.html#abd6edd8862aa3cfa6934c2abc918143e">CutoffFreqMinus</a>(i, fmean);</div>
<div class="line"><a name="l01355"></a><span class="lineno"> 1355</span>&#160;      <a class="code" href="namespaceLinefunctions.html#a6692d67ff28ec4a405b0a893e9584a17">find_cutoff_ranges</a>(<a class="code" href="namespaceZeeman.html#a5a24367cfa454aeb6730983395042ecf">start</a>, <a class="code" href="namespaceAbsorption.html#a5694bacde9aa335dc5ec69d50f201992">nelem</a>, f_full, fcut_low, fcut_upp);</div>
<div class="line"><a name="l01356"></a><span class="lineno"> 1356</span>&#160;      fc[0] = fcut_upp;</div>
<div class="line"><a name="l01357"></a><span class="lineno"> 1357</span>&#160;    }</div>
<div class="line"><a name="l01358"></a><span class="lineno"> 1358</span>&#160;    </div>
<div class="line"><a name="l01359"></a><span class="lineno"> 1359</span>&#160;    <span class="comment">// Relevant range FIXME: By Band and no-cutoff does not need this...</span></div>
<div class="line"><a name="l01360"></a><span class="lineno"> 1360</span>&#160;    <span class="keyword">auto</span> F = scratch.<a class="code" href="classLinefunctions_1_1InternalData.html#ab601be0a3533006883949c8b234e9bb5">F</a>.segment(<a class="code" href="namespaceZeeman.html#a5a24367cfa454aeb6730983395042ecf">start</a>, <a class="code" href="namespaceAbsorption.html#a5694bacde9aa335dc5ec69d50f201992">nelem</a>);</div>
<div class="line"><a name="l01361"></a><span class="lineno"> 1361</span>&#160;    <span class="keyword">auto</span> <a class="code" href="rng_8cc.html#a0240ac851181b84ac374872dc5434ee4">N</a> = scratch.<a class="code" href="classLinefunctions_1_1InternalData.html#a735b02efcebad384f279b8d7c7d24c42">N</a>.segment(<a class="code" href="namespaceZeeman.html#a5a24367cfa454aeb6730983395042ecf">start</a>, <a class="code" href="namespaceAbsorption.html#a5694bacde9aa335dc5ec69d50f201992">nelem</a>);</div>
<div class="line"><a name="l01362"></a><span class="lineno"> 1362</span>&#160;    <span class="keyword">auto</span> dF = scratch.<a class="code" href="classLinefunctions_1_1InternalData.html#a6899ae6ba5f3eddbcda5dedd8f6898e8">dF</a>.middleRows(<a class="code" href="namespaceZeeman.html#a5a24367cfa454aeb6730983395042ecf">start</a>, <a class="code" href="namespaceAbsorption.html#a5694bacde9aa335dc5ec69d50f201992">nelem</a>);</div>
<div class="line"><a name="l01363"></a><span class="lineno"> 1363</span>&#160;    <span class="keyword">auto</span> dN = scratch.<a class="code" href="classLinefunctions_1_1InternalData.html#a9fd5e8a8fb10337cf83b0744081a1268">dN</a>.middleRows(<a class="code" href="namespaceZeeman.html#a5a24367cfa454aeb6730983395042ecf">start</a>, <a class="code" href="namespaceAbsorption.html#a5694bacde9aa335dc5ec69d50f201992">nelem</a>);</div>
<div class="line"><a name="l01364"></a><span class="lineno"> 1364</span>&#160;    <span class="keyword">auto</span> <a class="code" href="arts__api__classes_8cc.html#a126b511d17f5ccbef11bde3a65df2430">data</a> = scratch.<a class="code" href="classLinefunctions_1_1InternalData.html#ad3fa2a3f1d0d14722ec03dd3749acd9d">data</a>.middleRows(<a class="code" href="namespaceZeeman.html#a5a24367cfa454aeb6730983395042ecf">start</a>, <a class="code" href="namespaceAbsorption.html#a5694bacde9aa335dc5ec69d50f201992">nelem</a>);</div>
<div class="line"><a name="l01365"></a><span class="lineno"> 1365</span>&#160;    <span class="keyword">const</span> <span class="keyword">auto</span> f = f_full.middleRows(<a class="code" href="namespaceZeeman.html#a5a24367cfa454aeb6730983395042ecf">start</a>, <a class="code" href="namespaceAbsorption.html#a5694bacde9aa335dc5ec69d50f201992">nelem</a>);</div>
<div class="line"><a name="l01366"></a><span class="lineno"> 1366</span>&#160;    </div>
<div class="line"><a name="l01367"></a><span class="lineno"> 1367</span>&#160;    <span class="comment">// Pressure broadening and line mixing terms</span></div>
<div class="line"><a name="l01368"></a><span class="lineno"> 1368</span>&#160;    <span class="keyword">const</span> <span class="keyword">auto</span> X = band.<a class="code" href="classAbsorption_1_1Lines.html#a8fa59980e5eca1b7814cb539f133dd08">ShapeParameters</a>(i, T, P, <a class="code" href="namespaceLineShape.html#a4b0cfb5637fe4bfa0bded7aefc4bb437">vmrs</a>);</div>
<div class="line"><a name="l01369"></a><span class="lineno"> 1369</span>&#160;    </div>
<div class="line"><a name="l01370"></a><span class="lineno"> 1370</span>&#160;    <span class="comment">// Partial derivatives for temperature</span></div>
<div class="line"><a name="l01371"></a><span class="lineno"> 1371</span>&#160;    <span class="keyword">const</span> <span class="keyword">auto</span> dXdT = do_temperature ?</div>
<div class="line"><a name="l01372"></a><span class="lineno"> 1372</span>&#160;      band.<a class="code" href="classAbsorption_1_1Lines.html#a3bb9f7dc512e65720d9959621508d3b5">ShapeParameters_dT</a>(i, T, P, <a class="code" href="namespaceLineShape.html#a4b0cfb5637fe4bfa0bded7aefc4bb437">vmrs</a>) : empty_output;</div>
<div class="line"><a name="l01373"></a><span class="lineno"> 1373</span>&#160;    </div>
<div class="line"><a name="l01374"></a><span class="lineno"> 1374</span>&#160;    <span class="comment">// Partial derivatives for VMR of self (function works for any species but only do self for now)</span></div>
<div class="line"><a name="l01375"></a><span class="lineno"> 1375</span>&#160;    <span class="keyword">const</span> <span class="keyword">auto</span> dXdVMR = do_vmr.test ?</div>
<div class="line"><a name="l01376"></a><span class="lineno"> 1376</span>&#160;      band.<a class="code" href="classAbsorption_1_1Lines.html#a5d2aa58a7b34908ee861b9773b86ccce">ShapeParameters_dVMR</a>(i, T, P, do_vmr.qid) : empty_output;</div>
<div class="line"><a name="l01377"></a><span class="lineno"> 1377</span>&#160;    </div>
<div class="line"><a name="l01378"></a><span class="lineno"> 1378</span>&#160;    <span class="comment">// Zeeman lines if necessary</span></div>
<div class="line"><a name="l01379"></a><span class="lineno"> 1379</span>&#160;    <span class="keyword">const</span> <a class="code" href="matpack_8h.html#aedca4b4670b166565b5b40c700d65a7c">Index</a> nz = zeeman ?</div>
<div class="line"><a name="l01380"></a><span class="lineno"> 1380</span>&#160;      band.<a class="code" href="classAbsorption_1_1Lines.html#ad73eb5a6d1933d65ab16711079e6f29d">ZeemanCount</a>(i, zeeman_polarization) : 1;</div>
<div class="line"><a name="l01381"></a><span class="lineno"> 1381</span>&#160;    </div>
<div class="line"><a name="l01382"></a><span class="lineno"> 1382</span>&#160;    <span class="keywordflow">for</span> (<a class="code" href="matpack_8h.html#aedca4b4670b166565b5b40c700d65a7c">Index</a> iz=0; iz&lt;nz; iz++) {</div>
<div class="line"><a name="l01383"></a><span class="lineno"> 1383</span>&#160;      </div>
<div class="line"><a name="l01384"></a><span class="lineno"> 1384</span>&#160;      <span class="comment">// Zeeman values for this sub-line</span></div>
<div class="line"><a name="l01385"></a><span class="lineno"> 1385</span>&#160;      <span class="keyword">const</span> <a class="code" href="matpack_8h.html#ad9a8dbb27c0bbea7271d916036122f6a">Numeric</a> Sz = zeeman ?</div>
<div class="line"><a name="l01386"></a><span class="lineno"> 1386</span>&#160;        band.<a class="code" href="classAbsorption_1_1Lines.html#af2e50adfc3fe1939a6f2932a38ec5800">ZeemanStrength</a>(i, zeeman_polarization, iz) : 1;</div>
<div class="line"><a name="l01387"></a><span class="lineno"> 1387</span>&#160;      <span class="keyword">const</span> <a class="code" href="matpack_8h.html#ad9a8dbb27c0bbea7271d916036122f6a">Numeric</a> dfdH = zeeman ?</div>
<div class="line"><a name="l01388"></a><span class="lineno"> 1388</span>&#160;        band.<a class="code" href="classAbsorption_1_1Lines.html#a165f7afc463f207b22c8a04a99c24f74">ZeemanSplitting</a>(i, zeeman_polarization, iz) : 0;</div>
<div class="line"><a name="l01389"></a><span class="lineno"> 1389</span>&#160;      </div>
<div class="line"><a name="l01390"></a><span class="lineno"> 1390</span>&#160;      <span class="comment">// Set the line shape and its derivatives</span></div>
<div class="line"><a name="l01391"></a><span class="lineno"> 1391</span>&#160;      <span class="keywordflow">switch</span> (band.<a class="code" href="classAbsorption_1_1Lines.html#a4d734374f0e291dbaf217523870c395d">LineShapeType</a>()) {</div>
<div class="line"><a name="l01392"></a><span class="lineno"> 1392</span>&#160;        <span class="keywordflow">case</span> LineShape::Type::DP:</div>
<div class="line"><a name="l01393"></a><span class="lineno"> 1393</span>&#160;          <a class="code" href="namespaceLinefunctions.html#a5f38e52b80fafd947d2df8d1a3f082ef">set_doppler</a>(F, dF, <a class="code" href="arts__api__classes_8cc.html#a126b511d17f5ccbef11bde3a65df2430">data</a>, f, dfdH, H, band.<a class="code" href="classAbsorption_1_1Lines.html#a5a7426e8540191c3fa2ed256aee17509">F0</a>(i), DC, band, i, derivatives_data, derivatives_data_active, dDCdT);</div>
<div class="line"><a name="l01394"></a><span class="lineno"> 1394</span>&#160;          <span class="keywordflow">if</span> (band.<a class="code" href="classAbsorption_1_1Lines.html#aa00fcb592ca7e1101db4cfc30d1e559b">Cutoff</a>() not_eq Absorption::CutoffType::None)</div>
<div class="line"><a name="l01395"></a><span class="lineno"> 1395</span>&#160;            <a class="code" href="namespaceLinefunctions.html#a5f38e52b80fafd947d2df8d1a3f082ef">set_doppler</a>(Fc, dFc, datac, fc, dfdH, H, band.<a class="code" href="classAbsorption_1_1Lines.html#a5a7426e8540191c3fa2ed256aee17509">F0</a>(i), DC, band, i, derivatives_data, derivatives_data_active, dDCdT);</div>
<div class="line"><a name="l01396"></a><span class="lineno"> 1396</span>&#160;          <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l01397"></a><span class="lineno"> 1397</span>&#160;        <span class="keywordflow">case</span> <a class="code" href="namespaceLineShape.html#a14ae23ee5f35836ee9ca4d3d90c4e14dae2fca8135c2fadca093abd79a6b1c0d2">LineShape::Type::HTP</a>:</div>
<div class="line"><a name="l01398"></a><span class="lineno"> 1398</span>&#160;        <span class="keywordflow">case</span> LineShape::Type::SDVP:</div>
<div class="line"><a name="l01399"></a><span class="lineno"> 1399</span>&#160;          <a class="code" href="namespaceLinefunctions.html#aa63d54039a4b96c9ca7f74524c1baa73">set_htp</a>(F, dF, f, dfdH, H, band.<a class="code" href="classAbsorption_1_1Lines.html#a5a7426e8540191c3fa2ed256aee17509">F0</a>(i), DC, X, band, i, derivatives_data, derivatives_data_active, dDCdT, dXdT, dXdVMR);</div>
<div class="line"><a name="l01400"></a><span class="lineno"> 1400</span>&#160;          <span class="keywordflow">if</span> (band.<a class="code" href="classAbsorption_1_1Lines.html#aa00fcb592ca7e1101db4cfc30d1e559b">Cutoff</a>() not_eq Absorption::CutoffType::None)</div>
<div class="line"><a name="l01401"></a><span class="lineno"> 1401</span>&#160;            <a class="code" href="namespaceLinefunctions.html#aa63d54039a4b96c9ca7f74524c1baa73">set_htp</a>(Fc, dFc, fc, dfdH, H, band.<a class="code" href="classAbsorption_1_1Lines.html#a5a7426e8540191c3fa2ed256aee17509">F0</a>(i), DC, X, band, i, derivatives_data, derivatives_data_active, dDCdT, dXdT, dXdVMR);</div>
<div class="line"><a name="l01402"></a><span class="lineno"> 1402</span>&#160;          <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l01403"></a><span class="lineno"> 1403</span>&#160;        <span class="keywordflow">case</span> LineShape::Type::LP:</div>
<div class="line"><a name="l01404"></a><span class="lineno"> 1404</span>&#160;          <a class="code" href="namespaceLinefunctions.html#a21f46f004118c4c6c1b41e87ade1ed3c">set_lorentz</a>(F, dF, <a class="code" href="arts__api__classes_8cc.html#a126b511d17f5ccbef11bde3a65df2430">data</a>, f, dfdH, H, band.<a class="code" href="classAbsorption_1_1Lines.html#a5a7426e8540191c3fa2ed256aee17509">F0</a>(i), X, band, i, derivatives_data, derivatives_data_active, dXdT, dXdVMR);</div>
<div class="line"><a name="l01405"></a><span class="lineno"> 1405</span>&#160;          <span class="keywordflow">if</span> (band.<a class="code" href="classAbsorption_1_1Lines.html#aa00fcb592ca7e1101db4cfc30d1e559b">Cutoff</a>() not_eq Absorption::CutoffType::None)</div>
<div class="line"><a name="l01406"></a><span class="lineno"> 1406</span>&#160;            <a class="code" href="namespaceLinefunctions.html#a21f46f004118c4c6c1b41e87ade1ed3c">set_lorentz</a>(Fc, dFc, datac, fc, dfdH, H, band.<a class="code" href="classAbsorption_1_1Lines.html#a5a7426e8540191c3fa2ed256aee17509">F0</a>(i), X, band, i, derivatives_data, derivatives_data_active, dXdT, dXdVMR);</div>
<div class="line"><a name="l01407"></a><span class="lineno"> 1407</span>&#160;          <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l01408"></a><span class="lineno"> 1408</span>&#160;        <span class="keywordflow">case</span> LineShape::Type::VP:</div>
<div class="line"><a name="l01409"></a><span class="lineno"> 1409</span>&#160;          <a class="code" href="namespaceLinefunctions.html#a9bab2edaa2740b7379fb568376859121">set_voigt</a>(F, dF, <a class="code" href="arts__api__classes_8cc.html#a126b511d17f5ccbef11bde3a65df2430">data</a>, f, dfdH, H, band.<a class="code" href="classAbsorption_1_1Lines.html#a5a7426e8540191c3fa2ed256aee17509">F0</a>(i), DC, X, band, i, derivatives_data, derivatives_data_active, dDCdT, dXdT, dXdVMR);</div>
<div class="line"><a name="l01410"></a><span class="lineno"> 1410</span>&#160;          <span class="keywordflow">if</span> (band.<a class="code" href="classAbsorption_1_1Lines.html#aa00fcb592ca7e1101db4cfc30d1e559b">Cutoff</a>() not_eq Absorption::CutoffType::None)</div>
<div class="line"><a name="l01411"></a><span class="lineno"> 1411</span>&#160;            <a class="code" href="namespaceLinefunctions.html#a9bab2edaa2740b7379fb568376859121">set_voigt</a>(Fc, dFc, datac, fc, dfdH, H, band.<a class="code" href="classAbsorption_1_1Lines.html#a5a7426e8540191c3fa2ed256aee17509">F0</a>(i), DC, X, band, i, derivatives_data, derivatives_data_active, dDCdT, dXdT, dXdVMR);</div>
<div class="line"><a name="l01412"></a><span class="lineno"> 1412</span>&#160;          <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l01413"></a><span class="lineno"> 1413</span>&#160;      }</div>
<div class="line"><a name="l01414"></a><span class="lineno"> 1414</span>&#160;      </div>
<div class="line"><a name="l01415"></a><span class="lineno"> 1415</span>&#160;      <span class="comment">// Remove the cutoff values</span></div>
<div class="line"><a name="l01416"></a><span class="lineno"> 1416</span>&#160;      <span class="keywordflow">if</span> (band.<a class="code" href="classAbsorption_1_1Lines.html#aa00fcb592ca7e1101db4cfc30d1e559b">Cutoff</a>() not_eq Absorption::CutoffType::None) {</div>
<div class="line"><a name="l01417"></a><span class="lineno"> 1417</span>&#160;        F.array() -= Fc[0];</div>
<div class="line"><a name="l01418"></a><span class="lineno"> 1418</span>&#160;        <span class="keywordflow">for</span> (<a class="code" href="matpack_8h.html#aedca4b4670b166565b5b40c700d65a7c">Index</a> ij = 0; ij &lt; nj; ij++) {</div>
<div class="line"><a name="l01419"></a><span class="lineno"> 1419</span>&#160;          dF.col(ij).array() -= dFc[ij];</div>
<div class="line"><a name="l01420"></a><span class="lineno"> 1420</span>&#160;        }</div>
<div class="line"><a name="l01421"></a><span class="lineno"> 1421</span>&#160;      }</div>
<div class="line"><a name="l01422"></a><span class="lineno"> 1422</span>&#160; </div>
<div class="line"><a name="l01423"></a><span class="lineno"> 1423</span>&#160;      <span class="comment">// Set the mirrored line shape</span></div>
<div class="line"><a name="l01424"></a><span class="lineno"> 1424</span>&#160;      <span class="keyword">const</span> <span class="keywordtype">bool</span> with_mirroring =</div>
<div class="line"><a name="l01425"></a><span class="lineno"> 1425</span>&#160;      band.<a class="code" href="classAbsorption_1_1Lines.html#a42d231e9deba3c8f064389bb01632438">Mirroring</a>() not_eq Absorption::MirroringType::None and</div>
<div class="line"><a name="l01426"></a><span class="lineno"> 1426</span>&#160;      band.<a class="code" href="classAbsorption_1_1Lines.html#a42d231e9deba3c8f064389bb01632438">Mirroring</a>() not_eq <a class="code" href="namespaceAbsorption.html#a5141982a7f8f641008a0b481aedeefcda6adf97f83acf6453d4a6a4b1070f3754">Absorption::MirroringType::Manual</a>;</div>
<div class="line"><a name="l01427"></a><span class="lineno"> 1427</span>&#160;      <span class="keywordflow">switch</span> (band.<a class="code" href="classAbsorption_1_1Lines.html#a42d231e9deba3c8f064389bb01632438">Mirroring</a>()) {</div>
<div class="line"><a name="l01428"></a><span class="lineno"> 1428</span>&#160;        <span class="keywordflow">case</span> Absorption::MirroringType::None:</div>
<div class="line"><a name="l01429"></a><span class="lineno"> 1429</span>&#160;        <span class="keywordflow">case</span> <a class="code" href="namespaceAbsorption.html#a5141982a7f8f641008a0b481aedeefcda6adf97f83acf6453d4a6a4b1070f3754">Absorption::MirroringType::Manual</a>:</div>
<div class="line"><a name="l01430"></a><span class="lineno"> 1430</span>&#160;          <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l01431"></a><span class="lineno"> 1431</span>&#160;        <span class="keywordflow">case</span> Absorption::MirroringType::Lorentz:</div>
<div class="line"><a name="l01432"></a><span class="lineno"> 1432</span>&#160;          <a class="code" href="namespaceLinefunctions.html#a21f46f004118c4c6c1b41e87ade1ed3c">set_lorentz</a>(<a class="code" href="rng_8cc.html#a0240ac851181b84ac374872dc5434ee4">N</a>, dN, <a class="code" href="arts__api__classes_8cc.html#a126b511d17f5ccbef11bde3a65df2430">data</a>, f, -dfdH, H, -band.<a class="code" href="classAbsorption_1_1Lines.html#a5a7426e8540191c3fa2ed256aee17509">F0</a>(i), <a class="code" href="namespaceLineShape.html#a26c4f90566ac48b736e82edb6625880b">LineShape::mirroredOutput</a>(X), band, i, derivatives_data, derivatives_data_active, do_temperature ? <a class="code" href="namespaceLineShape.html#a26c4f90566ac48b736e82edb6625880b">LineShape::mirroredOutput</a>(dXdT) : empty_output, do_vmr.test ? <a class="code" href="namespaceLineShape.html#a26c4f90566ac48b736e82edb6625880b">LineShape::mirroredOutput</a>(dXdVMR) : empty_output);</div>
<div class="line"><a name="l01433"></a><span class="lineno"> 1433</span>&#160;          <span class="keywordflow">if</span> (band.<a class="code" href="classAbsorption_1_1Lines.html#aa00fcb592ca7e1101db4cfc30d1e559b">Cutoff</a>() not_eq Absorption::CutoffType::None)</div>
<div class="line"><a name="l01434"></a><span class="lineno"> 1434</span>&#160;            <a class="code" href="namespaceLinefunctions.html#a21f46f004118c4c6c1b41e87ade1ed3c">set_lorentz</a>(Nc, dNc, datac, fc, -dfdH, H, -band.<a class="code" href="classAbsorption_1_1Lines.html#a5a7426e8540191c3fa2ed256aee17509">F0</a>(i), <a class="code" href="namespaceLineShape.html#a26c4f90566ac48b736e82edb6625880b">LineShape::mirroredOutput</a>(X), band, i, derivatives_data, derivatives_data_active, do_temperature ? <a class="code" href="namespaceLineShape.html#a26c4f90566ac48b736e82edb6625880b">LineShape::mirroredOutput</a>(dXdT) : empty_output, do_vmr.test ? <a class="code" href="namespaceLineShape.html#a26c4f90566ac48b736e82edb6625880b">LineShape::mirroredOutput</a>(dXdVMR) : empty_output);</div>
<div class="line"><a name="l01435"></a><span class="lineno"> 1435</span>&#160;          <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l01436"></a><span class="lineno"> 1436</span>&#160;        <span class="keywordflow">case</span> Absorption::MirroringType::SameAsLineShape:</div>
<div class="line"><a name="l01437"></a><span class="lineno"> 1437</span>&#160;          <span class="keywordflow">switch</span> (band.<a class="code" href="classAbsorption_1_1Lines.html#a4d734374f0e291dbaf217523870c395d">LineShapeType</a>()) {</div>
<div class="line"><a name="l01438"></a><span class="lineno"> 1438</span>&#160;            <span class="keywordflow">case</span> LineShape::Type::DP:</div>
<div class="line"><a name="l01439"></a><span class="lineno"> 1439</span>&#160;              <a class="code" href="namespaceLinefunctions.html#a5f38e52b80fafd947d2df8d1a3f082ef">set_doppler</a>(<a class="code" href="rng_8cc.html#a0240ac851181b84ac374872dc5434ee4">N</a>, dN, <a class="code" href="arts__api__classes_8cc.html#a126b511d17f5ccbef11bde3a65df2430">data</a>, f, -dfdH, H, -band.<a class="code" href="classAbsorption_1_1Lines.html#a5a7426e8540191c3fa2ed256aee17509">F0</a>(i), -DC, band, i, derivatives_data, derivatives_data_active, -dDCdT);</div>
<div class="line"><a name="l01440"></a><span class="lineno"> 1440</span>&#160;              <span class="keywordflow">if</span> (band.<a class="code" href="classAbsorption_1_1Lines.html#aa00fcb592ca7e1101db4cfc30d1e559b">Cutoff</a>() not_eq Absorption::CutoffType::None)</div>
<div class="line"><a name="l01441"></a><span class="lineno"> 1441</span>&#160;                <a class="code" href="namespaceLinefunctions.html#a5f38e52b80fafd947d2df8d1a3f082ef">set_doppler</a>(Nc, dNc, datac, fc, -dfdH, H, -band.<a class="code" href="classAbsorption_1_1Lines.html#a5a7426e8540191c3fa2ed256aee17509">F0</a>(i), -DC, band, i, derivatives_data, derivatives_data_active, -dDCdT);</div>
<div class="line"><a name="l01442"></a><span class="lineno"> 1442</span>&#160;              <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l01443"></a><span class="lineno"> 1443</span>&#160;            <span class="keywordflow">case</span> LineShape::Type::LP:</div>
<div class="line"><a name="l01444"></a><span class="lineno"> 1444</span>&#160;              <a class="code" href="namespaceLinefunctions.html#a21f46f004118c4c6c1b41e87ade1ed3c">set_lorentz</a>(<a class="code" href="rng_8cc.html#a0240ac851181b84ac374872dc5434ee4">N</a>, dN, <a class="code" href="arts__api__classes_8cc.html#a126b511d17f5ccbef11bde3a65df2430">data</a>, f, -dfdH, H, -band.<a class="code" href="classAbsorption_1_1Lines.html#a5a7426e8540191c3fa2ed256aee17509">F0</a>(i), <a class="code" href="namespaceLineShape.html#a26c4f90566ac48b736e82edb6625880b">LineShape::mirroredOutput</a>(X), band, i, derivatives_data, derivatives_data_active, do_temperature ? <a class="code" href="namespaceLineShape.html#a26c4f90566ac48b736e82edb6625880b">LineShape::mirroredOutput</a>(dXdT) : empty_output, do_vmr.test ? <a class="code" href="namespaceLineShape.html#a26c4f90566ac48b736e82edb6625880b">LineShape::mirroredOutput</a>(dXdVMR) : empty_output);</div>
<div class="line"><a name="l01445"></a><span class="lineno"> 1445</span>&#160;              <span class="keywordflow">if</span> (band.<a class="code" href="classAbsorption_1_1Lines.html#aa00fcb592ca7e1101db4cfc30d1e559b">Cutoff</a>() not_eq Absorption::CutoffType::None)</div>
<div class="line"><a name="l01446"></a><span class="lineno"> 1446</span>&#160;                <a class="code" href="namespaceLinefunctions.html#a21f46f004118c4c6c1b41e87ade1ed3c">set_lorentz</a>(Nc, dNc, datac, fc, -dfdH, H, -band.<a class="code" href="classAbsorption_1_1Lines.html#a5a7426e8540191c3fa2ed256aee17509">F0</a>(i), <a class="code" href="namespaceLineShape.html#a26c4f90566ac48b736e82edb6625880b">LineShape::mirroredOutput</a>(X), band, i, derivatives_data, derivatives_data_active, do_temperature ? <a class="code" href="namespaceLineShape.html#a26c4f90566ac48b736e82edb6625880b">LineShape::mirroredOutput</a>(dXdT) : empty_output, do_vmr.test ? <a class="code" href="namespaceLineShape.html#a26c4f90566ac48b736e82edb6625880b">LineShape::mirroredOutput</a>(dXdVMR) : empty_output);</div>
<div class="line"><a name="l01447"></a><span class="lineno"> 1447</span>&#160;              <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l01448"></a><span class="lineno"> 1448</span>&#160;            <span class="keywordflow">case</span> LineShape::Type::VP:</div>
<div class="line"><a name="l01449"></a><span class="lineno"> 1449</span>&#160;              <a class="code" href="namespaceLinefunctions.html#a9bab2edaa2740b7379fb568376859121">set_voigt</a>(<a class="code" href="rng_8cc.html#a0240ac851181b84ac374872dc5434ee4">N</a>, dN, <a class="code" href="arts__api__classes_8cc.html#a126b511d17f5ccbef11bde3a65df2430">data</a>, f, -dfdH, H, -band.<a class="code" href="classAbsorption_1_1Lines.html#a5a7426e8540191c3fa2ed256aee17509">F0</a>(i), -DC, <a class="code" href="namespaceLineShape.html#a26c4f90566ac48b736e82edb6625880b">LineShape::mirroredOutput</a>(X), band, i, derivatives_data, derivatives_data_active, -dDCdT, do_temperature ? <a class="code" href="namespaceLineShape.html#a26c4f90566ac48b736e82edb6625880b">LineShape::mirroredOutput</a>(dXdT) : empty_output, do_vmr.test ? <a class="code" href="namespaceLineShape.html#a26c4f90566ac48b736e82edb6625880b">LineShape::mirroredOutput</a>(dXdVMR) : empty_output);</div>
<div class="line"><a name="l01450"></a><span class="lineno"> 1450</span>&#160;              <span class="keywordflow">if</span> (band.<a class="code" href="classAbsorption_1_1Lines.html#aa00fcb592ca7e1101db4cfc30d1e559b">Cutoff</a>() not_eq Absorption::CutoffType::None)</div>
<div class="line"><a name="l01451"></a><span class="lineno"> 1451</span>&#160;                <a class="code" href="namespaceLinefunctions.html#a9bab2edaa2740b7379fb568376859121">set_voigt</a>(Nc, dNc, datac, fc, -dfdH, H, -band.<a class="code" href="classAbsorption_1_1Lines.html#a5a7426e8540191c3fa2ed256aee17509">F0</a>(i), -DC, <a class="code" href="namespaceLineShape.html#a26c4f90566ac48b736e82edb6625880b">LineShape::mirroredOutput</a>(X), band, i, derivatives_data, derivatives_data_active, -dDCdT, do_temperature ? <a class="code" href="namespaceLineShape.html#a26c4f90566ac48b736e82edb6625880b">LineShape::mirroredOutput</a>(dXdT) : empty_output, do_vmr.test ? <a class="code" href="namespaceLineShape.html#a26c4f90566ac48b736e82edb6625880b">LineShape::mirroredOutput</a>(dXdVMR) : empty_output);</div>
<div class="line"><a name="l01452"></a><span class="lineno"> 1452</span>&#160;              <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l01453"></a><span class="lineno"> 1453</span>&#160;            <span class="keywordflow">case</span> <a class="code" href="namespaceLineShape.html#a14ae23ee5f35836ee9ca4d3d90c4e14dae2fca8135c2fadca093abd79a6b1c0d2">LineShape::Type::HTP</a>:</div>
<div class="line"><a name="l01454"></a><span class="lineno"> 1454</span>&#160;            <span class="keywordflow">case</span> LineShape::Type::SDVP:</div>
<div class="line"><a name="l01455"></a><span class="lineno"> 1455</span>&#160;              <span class="comment">// WARNING: This mirroring is not tested and it might require, e.g., FVC to be treated differently</span></div>
<div class="line"><a name="l01456"></a><span class="lineno"> 1456</span>&#160;              <a class="code" href="namespaceLinefunctions.html#aa63d54039a4b96c9ca7f74524c1baa73">set_htp</a>(<a class="code" href="rng_8cc.html#a0240ac851181b84ac374872dc5434ee4">N</a>, dN, f, -dfdH, H, -band.<a class="code" href="classAbsorption_1_1Lines.html#a5a7426e8540191c3fa2ed256aee17509">F0</a>(i), -DC, <a class="code" href="namespaceLineShape.html#a26c4f90566ac48b736e82edb6625880b">LineShape::mirroredOutput</a>(X), band, i, derivatives_data, derivatives_data_active, -dDCdT, do_temperature ? <a class="code" href="namespaceLineShape.html#a26c4f90566ac48b736e82edb6625880b">LineShape::mirroredOutput</a>(dXdT) : empty_output, do_vmr.test ? <a class="code" href="namespaceLineShape.html#a26c4f90566ac48b736e82edb6625880b">LineShape::mirroredOutput</a>(dXdVMR) : empty_output);</div>
<div class="line"><a name="l01457"></a><span class="lineno"> 1457</span>&#160;              <span class="keywordflow">if</span> (band.<a class="code" href="classAbsorption_1_1Lines.html#aa00fcb592ca7e1101db4cfc30d1e559b">Cutoff</a>() not_eq Absorption::CutoffType::None)</div>
<div class="line"><a name="l01458"></a><span class="lineno"> 1458</span>&#160;                <a class="code" href="namespaceLinefunctions.html#aa63d54039a4b96c9ca7f74524c1baa73">set_htp</a>(Nc, dNc, fc, -dfdH, H, -band.<a class="code" href="classAbsorption_1_1Lines.html#a5a7426e8540191c3fa2ed256aee17509">F0</a>(i), -DC, <a class="code" href="namespaceLineShape.html#a26c4f90566ac48b736e82edb6625880b">LineShape::mirroredOutput</a>(X), band, i, derivatives_data, derivatives_data_active, -dDCdT, do_temperature ? <a class="code" href="namespaceLineShape.html#a26c4f90566ac48b736e82edb6625880b">LineShape::mirroredOutput</a>(dXdT) : empty_output, do_vmr.test ? <a class="code" href="namespaceLineShape.html#a26c4f90566ac48b736e82edb6625880b">LineShape::mirroredOutput</a>(dXdVMR) : empty_output);</div>
<div class="line"><a name="l01459"></a><span class="lineno"> 1459</span>&#160;              <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l01460"></a><span class="lineno"> 1460</span>&#160;          }</div>
<div class="line"><a name="l01461"></a><span class="lineno"> 1461</span>&#160;          <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l01462"></a><span class="lineno"> 1462</span>&#160;      }</div>
<div class="line"><a name="l01463"></a><span class="lineno"> 1463</span>&#160;      </div>
<div class="line"><a name="l01464"></a><span class="lineno"> 1464</span>&#160;      <span class="comment">// Remove the mirrored cutoff values</span></div>
<div class="line"><a name="l01465"></a><span class="lineno"> 1465</span>&#160;      <span class="keywordflow">if</span> (band.<a class="code" href="classAbsorption_1_1Lines.html#aa00fcb592ca7e1101db4cfc30d1e559b">Cutoff</a>() not_eq Absorption::CutoffType::None and with_mirroring) {</div>
<div class="line"><a name="l01466"></a><span class="lineno"> 1466</span>&#160;        <a class="code" href="rng_8cc.html#a0240ac851181b84ac374872dc5434ee4">N</a>.array() -= Nc[0];</div>
<div class="line"><a name="l01467"></a><span class="lineno"> 1467</span>&#160;        <span class="keywordflow">for</span> (<a class="code" href="matpack_8h.html#aedca4b4670b166565b5b40c700d65a7c">Index</a> ij = 0; ij &lt; nj; ij++) {</div>
<div class="line"><a name="l01468"></a><span class="lineno"> 1468</span>&#160;          dN.col(ij).array() -= dNc[ij];</div>
<div class="line"><a name="l01469"></a><span class="lineno"> 1469</span>&#160;        }</div>
<div class="line"><a name="l01470"></a><span class="lineno"> 1470</span>&#160;      }</div>
<div class="line"><a name="l01471"></a><span class="lineno"> 1471</span>&#160; </div>
<div class="line"><a name="l01472"></a><span class="lineno"> 1472</span>&#160;      <span class="comment">// Mirror and and line mixing is added together (because of conjugate)</span></div>
<div class="line"><a name="l01473"></a><span class="lineno"> 1473</span>&#160;      <span class="keywordflow">if</span> (band.<a class="code" href="classAbsorption_1_1Lines.html#a4d734374f0e291dbaf217523870c395d">LineShapeType</a>() not_eq LineShape::Type::DP) {</div>
<div class="line"><a name="l01474"></a><span class="lineno"> 1474</span>&#160;        <a class="code" href="namespaceLinefunctions.html#a22f91962a7c5766ac5e07b245ad04577">apply_linemixing_scaling_and_mirroring</a>(F, dF, <a class="code" href="rng_8cc.html#a0240ac851181b84ac374872dc5434ee4">N</a>, dN, X, with_mirroring, band, i, derivatives_data, derivatives_data_active, dXdT, dXdVMR);</div>
<div class="line"><a name="l01475"></a><span class="lineno"> 1475</span>&#160; </div>
<div class="line"><a name="l01476"></a><span class="lineno"> 1476</span>&#160;        <span class="comment">// Apply line mixing and pressure broadening partial derivatives</span></div>
<div class="line"><a name="l01477"></a><span class="lineno"> 1477</span>&#160;        <a class="code" href="namespaceLinefunctions.html#afd8834345135ba3440f4f62e5e0bf276">apply_lineshapemodel_jacobian_scaling</a>(dF, band, i, derivatives_data, derivatives_data_active, T, P, <a class="code" href="namespaceLineShape.html#a4b0cfb5637fe4bfa0bded7aefc4bb437">vmrs</a>);</div>
<div class="line"><a name="l01478"></a><span class="lineno"> 1478</span>&#160;      }</div>
<div class="line"><a name="l01479"></a><span class="lineno"> 1479</span>&#160; </div>
<div class="line"><a name="l01480"></a><span class="lineno"> 1480</span>&#160;      <span class="comment">// Normalize the lines</span></div>
<div class="line"><a name="l01481"></a><span class="lineno"> 1481</span>&#160;      <span class="keywordflow">switch</span> (band.<a class="code" href="classAbsorption_1_1Lines.html#a61b5b500cfa4ac584c3a59c67119cff3">Normalization</a>()) {</div>
<div class="line"><a name="l01482"></a><span class="lineno"> 1482</span>&#160;        <span class="keywordflow">case</span> Absorption::NormalizationType::None:</div>
<div class="line"><a name="l01483"></a><span class="lineno"> 1483</span>&#160;          <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l01484"></a><span class="lineno"> 1484</span>&#160;        <span class="keywordflow">case</span> Absorption::NormalizationType::VVH:</div>
<div class="line"><a name="l01485"></a><span class="lineno"> 1485</span>&#160;          <a class="code" href="namespaceLinefunctions.html#ae5c4fd8eada1c26b407af64b27cc6413">apply_VVH_scaling</a>(F, dF, <a class="code" href="arts__api__classes_8cc.html#a126b511d17f5ccbef11bde3a65df2430">data</a>, f, band.<a class="code" href="classAbsorption_1_1Lines.html#a5a7426e8540191c3fa2ed256aee17509">F0</a>(i), T, band, i, derivatives_data, derivatives_data_active);</div>
<div class="line"><a name="l01486"></a><span class="lineno"> 1486</span>&#160;          <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l01487"></a><span class="lineno"> 1487</span>&#160;        <span class="keywordflow">case</span> Absorption::NormalizationType::VVW:</div>
<div class="line"><a name="l01488"></a><span class="lineno"> 1488</span>&#160;          <a class="code" href="namespaceLinefunctions.html#a5505c9892e2f020db13b06845baf639b">apply_VVW_scaling</a>(F, dF, f, band.<a class="code" href="classAbsorption_1_1Lines.html#a5a7426e8540191c3fa2ed256aee17509">F0</a>(i), band, i, derivatives_data, derivatives_data_active);</div>
<div class="line"><a name="l01489"></a><span class="lineno"> 1489</span>&#160;          <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l01490"></a><span class="lineno"> 1490</span>&#160;        <span class="keywordflow">case</span> <a class="code" href="namespaceAbsorption.html#ae579c0918cccbeb83040cf46fad87965a6adf97f83acf6453d4a6a4b1070f3754">Absorption::NormalizationType::RosenkranzQuadratic</a>:</div>
<div class="line"><a name="l01491"></a><span class="lineno"> 1491</span>&#160;          <a class="code" href="namespaceLinefunctions.html#ae6818a5213b049a8a8e1464040531b7c">apply_rosenkranz_quadratic_scaling</a>(F, dF, f, band.<a class="code" href="classAbsorption_1_1Lines.html#a5a7426e8540191c3fa2ed256aee17509">F0</a>(i), T, band, i, derivatives_data, derivatives_data_active);</div>
<div class="line"><a name="l01492"></a><span class="lineno"> 1492</span>&#160;          <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l01493"></a><span class="lineno"> 1493</span>&#160;      }</div>
<div class="line"><a name="l01494"></a><span class="lineno"> 1494</span>&#160; </div>
<div class="line"><a name="l01495"></a><span class="lineno"> 1495</span>&#160;      <span class="comment">// Apply line strength by whatever method is necessary</span></div>
<div class="line"><a name="l01496"></a><span class="lineno"> 1496</span>&#160;      <span class="keywordflow">switch</span> (band.<a class="code" href="classAbsorption_1_1Lines.html#a645e900f27278b50a3ecda524f868a06">Population</a>()) {</div>
<div class="line"><a name="l01497"></a><span class="lineno"> 1497</span>&#160;        <span class="keywordflow">case</span> <a class="code" href="namespaceAbsorption.html#a209c1a7ed727935e9195e709518cb6e2a22518c7ac1f6e1a2be04bd6f5ad71c6b">Absorption::PopulationType::ByHITRANFullRelmat</a>:</div>
<div class="line"><a name="l01498"></a><span class="lineno"> 1498</span>&#160;        <span class="keywordflow">case</span> Absorption::PopulationType::ByHITRANRosenkranzRelmat:</div>
<div class="line"><a name="l01499"></a><span class="lineno"> 1499</span>&#160;        <span class="keywordflow">case</span> Absorption::PopulationType::ByLTE:</div>
<div class="line"><a name="l01500"></a><span class="lineno"> 1500</span>&#160;          <a class="code" href="namespaceLinefunctions.html#a92312bdbf8d958031a4b2d5806412618">apply_linestrength_scaling_by_lte</a>(F, dF, <a class="code" href="rng_8cc.html#a0240ac851181b84ac374872dc5434ee4">N</a>, dN, band.<a class="code" href="classAbsorption_1_1Lines.html#a61cff0453b23dd599c98fe7b6536cb00">Line</a>(i), T, band.<a class="code" href="classAbsorption_1_1Lines.html#a810c25d0831147858c34d1e8ae9a5c2c">T0</a>(), isot_ratio, QT, QT0, band, i, derivatives_data, derivatives_data_active, dQTdT);</div>
<div class="line"><a name="l01501"></a><span class="lineno"> 1501</span>&#160;          <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l01502"></a><span class="lineno"> 1502</span>&#160;        <span class="keywordflow">case</span> Absorption::PopulationType::ByNLTEVibrationalTemperatures: {</div>
<div class="line"><a name="l01503"></a><span class="lineno"> 1503</span>&#160;          <span class="keyword">auto</span> nlte_data = nlte.<a class="code" href="classEnergyLevelMap.html#a5c40840984715099d4bf4b45c702156c">get_vibtemp_params</a>(band, i, T);</div>
<div class="line"><a name="l01504"></a><span class="lineno"> 1504</span>&#160;          <a class="code" href="namespaceLinefunctions.html#a773a49a85f1c95bf6680884d28c83680">apply_linestrength_scaling_by_vibrational_nlte</a>(F, dF, <a class="code" href="rng_8cc.html#a0240ac851181b84ac374872dc5434ee4">N</a>, dN, band.<a class="code" href="classAbsorption_1_1Lines.html#a61cff0453b23dd599c98fe7b6536cb00">Line</a>(i), T, band.<a class="code" href="classAbsorption_1_1Lines.html#a810c25d0831147858c34d1e8ae9a5c2c">T0</a>(), nlte_data.T_upp, nlte_data.T_low, nlte_data.E_upp, nlte_data.E_low, isot_ratio, QT, QT0, band, i, derivatives_data, derivatives_data_active, dQTdT);</div>
<div class="line"><a name="l01505"></a><span class="lineno"> 1505</span>&#160;        } <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l01506"></a><span class="lineno"> 1506</span>&#160;        <span class="keywordflow">case</span> Absorption::PopulationType::ByNLTEPopulationDistribution: {</div>
<div class="line"><a name="l01507"></a><span class="lineno"> 1507</span>&#160;          <span class="keyword">auto</span> nlte_data = nlte.<a class="code" href="classEnergyLevelMap.html#a68245e1871f5c1e3866049bef7abdcbc">get_ratio_params</a>(band, i);</div>
<div class="line"><a name="l01508"></a><span class="lineno"> 1508</span>&#160;          <a class="code" href="namespaceLinefunctions.html#aca2a2edc63a0f046ca2cc3f9c1cd00a4">apply_linestrength_from_nlte_level_distributions</a>(F, dF, <a class="code" href="rng_8cc.html#a0240ac851181b84ac374872dc5434ee4">N</a>, dN, nlte_data.r_low, nlte_data.r_upp, band.<a class="code" href="classAbsorption_1_1Lines.html#a1c4e1805db9079465d30613ebde0681d">g_low</a>(i), band.<a class="code" href="classAbsorption_1_1Lines.html#ab3d179380bf6e649c6be680bf8454376">g_upp</a>(i), band.<a class="code" href="classAbsorption_1_1Lines.html#afc0fb606b01495dd8d38e7e0795a89d4">A</a>(i), band.<a class="code" href="classAbsorption_1_1Lines.html#a5a7426e8540191c3fa2ed256aee17509">F0</a>(i), T, band, i, derivatives_data, derivatives_data_active);</div>
<div class="line"><a name="l01509"></a><span class="lineno"> 1509</span>&#160;        } <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l01510"></a><span class="lineno"> 1510</span>&#160;      }</div>
<div class="line"><a name="l01511"></a><span class="lineno"> 1511</span>&#160;      </div>
<div class="line"><a name="l01512"></a><span class="lineno"> 1512</span>&#160;      <span class="comment">// Zeeman-adjusted strength</span></div>
<div class="line"><a name="l01513"></a><span class="lineno"> 1513</span>&#160;      <span class="keywordflow">if</span> (zeeman) {</div>
<div class="line"><a name="l01514"></a><span class="lineno"> 1514</span>&#160;        F *= Sz;</div>
<div class="line"><a name="l01515"></a><span class="lineno"> 1515</span>&#160;        <a class="code" href="rng_8cc.html#a0240ac851181b84ac374872dc5434ee4">N</a> *= Sz;</div>
<div class="line"><a name="l01516"></a><span class="lineno"> 1516</span>&#160;        dF *= Sz;</div>
<div class="line"><a name="l01517"></a><span class="lineno"> 1517</span>&#160;        dN *= Sz;</div>
<div class="line"><a name="l01518"></a><span class="lineno"> 1518</span>&#160;      }</div>
<div class="line"><a name="l01519"></a><span class="lineno"> 1519</span>&#160;      </div>
<div class="line"><a name="l01520"></a><span class="lineno"> 1520</span>&#160;      <span class="comment">// Sum up the contributions</span></div>
<div class="line"><a name="l01521"></a><span class="lineno"> 1521</span>&#160;      sum.<a class="code" href="classLinefunctions_1_1InternalData.html#ab601be0a3533006883949c8b234e9bb5">F</a>.segment(<a class="code" href="namespaceZeeman.html#a5a24367cfa454aeb6730983395042ecf">start</a>, <a class="code" href="namespaceAbsorption.html#a5694bacde9aa335dc5ec69d50f201992">nelem</a>).noalias() += F;</div>
<div class="line"><a name="l01522"></a><span class="lineno"> 1522</span>&#160;      sum.<a class="code" href="classLinefunctions_1_1InternalData.html#a735b02efcebad384f279b8d7c7d24c42">N</a>.segment(<a class="code" href="namespaceZeeman.html#a5a24367cfa454aeb6730983395042ecf">start</a>, <a class="code" href="namespaceAbsorption.html#a5694bacde9aa335dc5ec69d50f201992">nelem</a>).noalias() += <a class="code" href="rng_8cc.html#a0240ac851181b84ac374872dc5434ee4">N</a>;</div>
<div class="line"><a name="l01523"></a><span class="lineno"> 1523</span>&#160;      sum.<a class="code" href="classLinefunctions_1_1InternalData.html#a6899ae6ba5f3eddbcda5dedd8f6898e8">dF</a>.middleRows(<a class="code" href="namespaceZeeman.html#a5a24367cfa454aeb6730983395042ecf">start</a>, <a class="code" href="namespaceAbsorption.html#a5694bacde9aa335dc5ec69d50f201992">nelem</a>).noalias() += dF;</div>
<div class="line"><a name="l01524"></a><span class="lineno"> 1524</span>&#160;      sum.<a class="code" href="classLinefunctions_1_1InternalData.html#a9fd5e8a8fb10337cf83b0744081a1268">dN</a>.middleRows(<a class="code" href="namespaceZeeman.html#a5a24367cfa454aeb6730983395042ecf">start</a>, <a class="code" href="namespaceAbsorption.html#a5694bacde9aa335dc5ec69d50f201992">nelem</a>).noalias() += dN;</div>
<div class="line"><a name="l01525"></a><span class="lineno"> 1525</span>&#160;    }</div>
<div class="line"><a name="l01526"></a><span class="lineno"> 1526</span>&#160;  }</div>
<div class="line"><a name="l01527"></a><span class="lineno"> 1527</span>&#160;  </div>
<div class="line"><a name="l01528"></a><span class="lineno"> 1528</span>&#160;  <span class="comment">// Set negative values to zero incase this is requested</span></div>
<div class="line"><a name="l01529"></a><span class="lineno"> 1529</span>&#160;  <span class="keywordflow">if</span> (no_negatives) {</div>
<div class="line"><a name="l01530"></a><span class="lineno"> 1530</span>&#160;    <span class="keyword">auto</span> reset_zeroes = (sum.<a class="code" href="classLinefunctions_1_1InternalData.html#ab601be0a3533006883949c8b234e9bb5">F</a>.array().real() &lt; 0);</div>
<div class="line"><a name="l01531"></a><span class="lineno"> 1531</span>&#160;    </div>
<div class="line"><a name="l01532"></a><span class="lineno"> 1532</span>&#160;    sum.<a class="code" href="classLinefunctions_1_1InternalData.html#a735b02efcebad384f279b8d7c7d24c42">N</a> = reset_zeroes.select(<a class="code" href="complex_8h.html#aff1205001edf41e8e0032f18b98875e1">Complex</a>(0, 0), sum.<a class="code" href="classLinefunctions_1_1InternalData.html#a735b02efcebad384f279b8d7c7d24c42">N</a>);</div>
<div class="line"><a name="l01533"></a><span class="lineno"> 1533</span>&#160;    <span class="keywordflow">for</span> (<a class="code" href="matpack_8h.html#aedca4b4670b166565b5b40c700d65a7c">Index</a> ij=0; ij&lt;nj; ij++)</div>
<div class="line"><a name="l01534"></a><span class="lineno"> 1534</span>&#160;      sum.<a class="code" href="classLinefunctions_1_1InternalData.html#a6899ae6ba5f3eddbcda5dedd8f6898e8">dF</a>.col(ij) = reset_zeroes.select(<a class="code" href="complex_8h.html#aff1205001edf41e8e0032f18b98875e1">Complex</a>(0, 0), sum.<a class="code" href="classLinefunctions_1_1InternalData.html#a6899ae6ba5f3eddbcda5dedd8f6898e8">dF</a>.col(ij));</div>
<div class="line"><a name="l01535"></a><span class="lineno"> 1535</span>&#160;    <span class="keywordflow">for</span> (<a class="code" href="matpack_8h.html#aedca4b4670b166565b5b40c700d65a7c">Index</a> ij=0; ij&lt;nj; ij++)</div>
<div class="line"><a name="l01536"></a><span class="lineno"> 1536</span>&#160;      sum.<a class="code" href="classLinefunctions_1_1InternalData.html#a9fd5e8a8fb10337cf83b0744081a1268">dN</a>.col(ij) = reset_zeroes.select(<a class="code" href="complex_8h.html#aff1205001edf41e8e0032f18b98875e1">Complex</a>(0, 0), sum.<a class="code" href="classLinefunctions_1_1InternalData.html#a9fd5e8a8fb10337cf83b0744081a1268">dN</a>.col(ij));</div>
<div class="line"><a name="l01537"></a><span class="lineno"> 1537</span>&#160;    sum.<a class="code" href="classLinefunctions_1_1InternalData.html#ab601be0a3533006883949c8b234e9bb5">F</a> = reset_zeroes.select(<a class="code" href="complex_8h.html#aff1205001edf41e8e0032f18b98875e1">Complex</a>(0, 0), sum.<a class="code" href="classLinefunctions_1_1InternalData.html#ab601be0a3533006883949c8b234e9bb5">F</a>);</div>
<div class="line"><a name="l01538"></a><span class="lineno"> 1538</span>&#160;  }</div>
<div class="line"><a name="l01539"></a><span class="lineno"> 1539</span>&#160;}</div>
</div><!-- fragment --></div><!-- contents -->
</div><!-- doc-content -->
<div class="ttc" id="aclassLinefunctions_1_1InternalData_html_a6899ae6ba5f3eddbcda5dedd8f6898e8"><div class="ttname"><a href="classLinefunctions_1_1InternalData.html#a6899ae6ba5f3eddbcda5dedd8f6898e8">Linefunctions::InternalData::dF</a></div><div class="ttdeci">Eigen::MatrixXcd dF</div><div class="ttdef"><b>Definition:</b> <a href="linefunctions_8h_source.html#l00522">linefunctions.h:522</a></div></div>
<div class="ttc" id="ajacobian_8cc_html_addaa9fa44dc639fdff8a8bd58248853c"><div class="ttname"><a href="jacobian_8cc.html#addaa9fa44dc639fdff8a8bd58248853c">do_vmr_jacobian</a></div><div class="ttdeci">jacobianVMRcheck do_vmr_jacobian(const ArrayOfRetrievalQuantity &amp;js, const QuantumIdentifier &amp;line_qid) noexcept</div><div class="ttdoc">Returns the required info for VMR Jacobian.</div><div class="ttdef"><b>Definition:</b> <a href="jacobian_8cc_source.html#l01283">jacobian.cc:1283</a></div></div>
<div class="ttc" id="aclassAbsorption_1_1Lines_html_aa00fcb592ca7e1101db4cfc30d1e559b"><div class="ttname"><a href="classAbsorption_1_1Lines.html#aa00fcb592ca7e1101db4cfc30d1e559b">Absorption::Lines::Cutoff</a></div><div class="ttdeci">CutoffType Cutoff() const noexcept</div><div class="ttdoc">Returns cutoff style.</div><div class="ttdef"><b>Definition:</b> <a href="absorptionlines_8h_source.html#l01128">absorptionlines.h:1128</a></div></div>
<div class="ttc" id="aclassLinefunctions_1_1InternalData_html_aa2b34cb671b2e32f28f659054813f97f"><div class="ttname"><a href="classLinefunctions_1_1InternalData.html#aa2b34cb671b2e32f28f659054813f97f">Linefunctions::InternalData::datac</a></div><div class="ttdeci">Eigen::Matrix&lt; Complex, 1, Linefunctions::ExpectedDataSize()&gt; datac</div><div class="ttdef"><b>Definition:</b> <a href="linefunctions_8h_source.html#l00531">linefunctions.h:531</a></div></div>
<div class="ttc" id="aclassEnergyLevelMap_html_a68245e1871f5c1e3866049bef7abdcbc"><div class="ttname"><a href="classEnergyLevelMap.html#a68245e1871f5c1e3866049bef7abdcbc">EnergyLevelMap::get_ratio_params</a></div><div class="ttdeci">Output2 get_ratio_params(const AbsorptionLines &amp;band, const Index &amp;line_index) const</div><div class="ttdoc">Get the output required for Population::NLTE.</div><div class="ttdef"><b>Definition:</b> <a href="energylevelmap_8cc_source.html#l00031">energylevelmap.cc:31</a></div></div>
<div class="ttc" id="amath__funcs_8cc_html_a3847133ed1eefacef21795b055b6cfff"><div class="ttname"><a href="math__funcs_8cc.html#a3847133ed1eefacef21795b055b6cfff">fac</a></div><div class="ttdeci">Numeric fac(const Index n)</div><div class="ttdoc">fac</div><div class="ttdef"><b>Definition:</b> <a href="math__funcs_8cc_source.html#l00063">math_funcs.cc:63</a></div></div>
<div class="ttc" id="aclassAbsorption_1_1Lines_html_a1c4e1805db9079465d30613ebde0681d"><div class="ttname"><a href="classAbsorption_1_1Lines.html#a1c4e1805db9079465d30613ebde0681d">Absorption::Lines::g_low</a></div><div class="ttdeci">Numeric g_low(size_t k) const noexcept</div><div class="ttdoc">Lower level statistical weight.</div><div class="ttdef"><b>Definition:</b> <a href="absorptionlines_8h_source.html#l01052">absorptionlines.h:1052</a></div></div>
<div class="ttc" id="ajacobian_8h_html_a1c038b81aa646d730aeddc8ce99fd9d5"><div class="ttname"><a href="jacobian_8h.html#a1c038b81aa646d730aeddc8ce99fd9d5">is_pressure_broadening_Y</a></div><div class="ttdeci">bool is_pressure_broadening_Y(const RetrievalQuantity &amp;t) noexcept</div><div class="ttdoc">Returns if the Retrieval quantity is a Y derivative.</div></div>
<div class="ttc" id="aclassAbsorption_1_1SingleLine_html_a842d8319d70a0804efb38c4d78b6123d"><div class="ttname"><a href="classAbsorption_1_1SingleLine.html#a842d8319d70a0804efb38c4d78b6123d">Absorption::SingleLine::F0</a></div><div class="ttdeci">Numeric F0() const noexcept</div><div class="ttdoc">Central frequency.</div><div class="ttdef"><b>Definition:</b> <a href="absorptionlines_8h_source.html#l00342">absorptionlines.h:342</a></div></div>
<div class="ttc" id="aclassEnergyLevelMap_html_a5c40840984715099d4bf4b45c702156c"><div class="ttname"><a href="classEnergyLevelMap.html#a5c40840984715099d4bf4b45c702156c">EnergyLevelMap::get_vibtemp_params</a></div><div class="ttdeci">Output4 get_vibtemp_params(const AbsorptionLines &amp;band, const Index &amp;line_index, const Numeric T) const</div><div class="ttdoc">Get the output required for Population::NLTE-VibrationalTemperatures.</div><div class="ttdef"><b>Definition:</b> <a href="energylevelmap_8cc_source.html#l00058">energylevelmap.cc:58</a></div></div>
<div class="ttc" id="anamespaceLinefunctions_html_ae6818a5213b049a8a8e1464040531b7c"><div class="ttname"><a href="namespaceLinefunctions.html#ae6818a5213b049a8a8e1464040531b7c">Linefunctions::apply_rosenkranz_quadratic_scaling</a></div><div class="ttdeci">void apply_rosenkranz_quadratic_scaling(Eigen::Ref&lt; Eigen::VectorXcd &gt; F, Eigen::Ref&lt; Eigen::MatrixXcd &gt; dF, const Eigen::Ref&lt; const Eigen::VectorXd &gt; f_grid, const Numeric &amp;F0, const Numeric &amp;T, const AbsorptionLines &amp;band=AbsorptionLines(), const Index &amp;line_ind=0, const ArrayOfRetrievalQuantity &amp;derivatives_data=ArrayOfRetrievalQuantity(), const ArrayOfIndex &amp;derivatives_data_position=ArrayOfIndex())</div><div class="ttdoc">Applies Rosenkranz quadratic normalization to already set line shape.</div><div class="ttdef"><b>Definition:</b> <a href="linefunctions_8cc_source.html#l00481">linefunctions.cc:481</a></div></div>
<div class="ttc" id="anamespaceLinefunctions_html_ae5c4fd8eada1c26b407af64b27cc6413"><div class="ttname"><a href="namespaceLinefunctions.html#ae5c4fd8eada1c26b407af64b27cc6413">Linefunctions::apply_VVH_scaling</a></div><div class="ttdeci">void apply_VVH_scaling(Eigen::Ref&lt; Eigen::VectorXcd &gt; F, Eigen::Ref&lt; Eigen::MatrixXcd &gt; dF, Eigen::Ref&lt; Eigen::Matrix&lt; Complex, Eigen::Dynamic, ExpectedDataSize()&gt;&gt; data, const Eigen::Ref&lt; const Eigen::VectorXd &gt; f_grid, const Numeric &amp;F0, const Numeric &amp;T, const AbsorptionLines &amp;band=AbsorptionLines(), const Index &amp;line_ind=0, const ArrayOfRetrievalQuantity &amp;derivatives_data=ArrayOfRetrievalQuantity(), const ArrayOfIndex &amp;derivatives_data_position=ArrayOfIndex())</div><div class="ttdoc">Applies Van Vleck and Huber normalization to already set line shape.</div><div class="ttdef"><b>Definition:</b> <a href="linefunctions_8cc_source.html#l00531">linefunctions.cc:531</a></div></div>
<div class="ttc" id="acomplex_8h_html_a428a624f5d3e190e8961223d885b44b4"><div class="ttname"><a href="complex_8h.html#a428a624f5d3e190e8961223d885b44b4">conj</a></div><div class="ttdeci">constexpr Complex conj(Complex c)</div><div class="ttdoc">the conjugate of c</div><div class="ttdef"><b>Definition:</b> <a href="complex_8h_source.html#l00065">complex.h:65</a></div></div>
<div class="ttc" id="alinefunctions_8cc_html_a3b4555133ea360cd068890a3e3cefaf5"><div class="ttname"><a href="linefunctions_8cc.html#a3b4555133ea360cd068890a3e3cefaf5">w</a></div><div class="ttdeci">Complex w(Complex z) noexcept</div><div class="ttdoc">The Faddeeva function.</div><div class="ttdef"><b>Definition:</b> <a href="linefunctions_8cc_source.html#l00042">linefunctions.cc:42</a></div></div>
<div class="ttc" id="aclassAbsorption_1_1Lines_html_a4d734374f0e291dbaf217523870c395d"><div class="ttname"><a href="classAbsorption_1_1Lines.html#a4d734374f0e291dbaf217523870c395d">Absorption::Lines::LineShapeType</a></div><div class="ttdeci">LineShape::Type LineShapeType() const noexcept</div><div class="ttdoc">Returns lineshapetype style.</div><div class="ttdef"><b>Definition:</b> <a href="absorptionlines_8h_source.html#l01180">absorptionlines.h:1180</a></div></div>
<div class="ttc" id="aclassAbsorption_1_1Lines_html_af7f4040db9606085cbe5f1ab4fb17b6b"><div class="ttname"><a href="classAbsorption_1_1Lines.html#af7f4040db9606085cbe5f1ab4fb17b6b">Absorption::Lines::F_mean</a></div><div class="ttdeci">Numeric F_mean() const noexcept</div><div class="ttdoc">Mean frequency by weight of line strengt.</div><div class="ttdef"><b>Definition:</b> <a href="absorptionlines_8h_source.html#l00983">absorptionlines.h:983</a></div></div>
<div class="ttc" id="aclassAbsorption_1_1SingleLine_html_add34adc6ce90e615ed173f6f4af28058"><div class="ttname"><a href="classAbsorption_1_1SingleLine.html#add34adc6ce90e615ed173f6f4af28058">Absorption::SingleLine::I0</a></div><div class="ttdeci">Numeric I0() const noexcept</div><div class="ttdoc">Reference line strength.</div><div class="ttdef"><b>Definition:</b> <a href="absorptionlines_8h_source.html#l00348">absorptionlines.h:348</a></div></div>
<div class="ttc" id="aclassLinefunctions_1_1InternalData_html_a735b02efcebad384f279b8d7c7d24c42"><div class="ttname"><a href="classLinefunctions_1_1InternalData.html#a735b02efcebad384f279b8d7c7d24c42">Linefunctions::InternalData::N</a></div><div class="ttdeci">Eigen::VectorXcd N</div><div class="ttdef"><b>Definition:</b> <a href="linefunctions_8h_source.html#l00521">linefunctions.h:521</a></div></div>
<div class="ttc" id="aclassAbsorption_1_1Lines_html_a6c31f06cb7594581da15971eb5af93f4"><div class="ttname"><a href="classAbsorption_1_1Lines.html#a6c31f06cb7594581da15971eb5af93f4">Absorption::Lines::NumLines</a></div><div class="ttdeci">Index NumLines() const noexcept</div><div class="ttdoc">Number of lines.</div><div class="ttdef"><b>Definition:</b> <a href="absorptionlines_8h_source.html#l00852">absorptionlines.h:852</a></div></div>
<div class="ttc" id="anamespaceLinefunctions_html_a22f91962a7c5766ac5e07b245ad04577"><div class="ttname"><a href="namespaceLinefunctions.html#a22f91962a7c5766ac5e07b245ad04577">Linefunctions::apply_linemixing_scaling_and_mirroring</a></div><div class="ttdeci">void apply_linemixing_scaling_and_mirroring(Eigen::Ref&lt; Eigen::VectorXcd &gt; F, Eigen::Ref&lt; Eigen::MatrixXcd &gt; dF, const Eigen::Ref&lt; Eigen::VectorXcd &gt; Fm, const Eigen::Ref&lt; Eigen::MatrixXcd &gt; dFm, const LineShape::Output &amp;lso, const bool with_mirroring, const AbsorptionLines &amp;band=AbsorptionLines(), const Index &amp;line_ind=0, const ArrayOfRetrievalQuantity &amp;derivatives_data=ArrayOfRetrievalQuantity(), const ArrayOfIndex &amp;derivatives_data_position=ArrayOfIndex(), const LineShape::Output &amp;dT={0, 0, 0, 0, 0, 0, 0, 0, 0}, const LineShape::Output &amp;dVMR={0, 0, 0, 0, 0, 0, 0, 0, 0})</div><div class="ttdoc">Applies line mixing scaling to already set lineshape and line mirror.</div><div class="ttdef"><b>Definition:</b> <a href="linefunctions_8cc_source.html#l00420">linefunctions.cc:420</a></div></div>
<div class="ttc" id="anamespaceAbsorption_html_a1554ecf51c40489e7f2a9f77a3314511"><div class="ttname"><a href="namespaceAbsorption.html#a1554ecf51c40489e7f2a9f77a3314511">Absorption::id_in_line</a></div><div class="ttdeci">bool id_in_line(const Lines &amp;band, const QuantumIdentifier &amp;id, size_t line_index)</div><div class="ttdoc">Checks if the external quantum identifier match a line's ID.</div><div class="ttdef"><b>Definition:</b> <a href="absorptionlines_8cc_source.html#l02840">absorptionlines.cc:2840</a></div></div>
<div class="ttc" id="anamespaceLinefunctions_html_aa8288ab4c09cddb5e3c3a28a96a64463"><div class="ttname"><a href="namespaceLinefunctions.html#aa8288ab4c09cddb5e3c3a28a96a64463">Linefunctions::set_cross_section_of_band</a></div><div class="ttdeci">void set_cross_section_of_band(InternalData &amp;scratch, InternalData &amp;sum, const ConstVectorView f_grid, const AbsorptionLines &amp;band, const ArrayOfRetrievalQuantity &amp;derivatives_data, const ArrayOfIndex &amp;derivatives_data_active, const Vector &amp;vmrs, const EnergyLevelMap &amp;nlte, const Numeric &amp;P, const Numeric &amp;T, const Numeric &amp;isot_ratio, const Numeric &amp;H, const Numeric &amp;DC, const Numeric &amp;dDCdT, const Numeric &amp;QT, const Numeric &amp;dQTdT, const Numeric &amp;QT0, const bool no_negatives=false, const bool zeeman=false, const Zeeman::Polarization zeeman_polarization=Zeeman::Polarization::Pi)</div><div class="ttdoc">Computes the cross-section of an absorption band.</div><div class="ttdef"><b>Definition:</b> <a href="linefunctions_8cc_source.html#l01291">linefunctions.cc:1291</a></div></div>
<div class="ttc" id="aclassLinefunctions_1_1InternalData_html_ad06ef67cf684a1a1eed19bd0392299bc"><div class="ttname"><a href="classLinefunctions_1_1InternalData.html#ad06ef67cf684a1a1eed19bd0392299bc">Linefunctions::InternalData::SetZero</a></div><div class="ttdeci">void SetZero()</div><div class="ttdef"><b>Definition:</b> <a href="linefunctions_8h_source.html#l00547">linefunctions.h:547</a></div></div>
<div class="ttc" id="aclassRetrievalQuantity_html_a51b340f8988eb17696b9621d03da2751"><div class="ttname"><a href="classRetrievalQuantity.html#a51b340f8988eb17696b9621d03da2751">RetrievalQuantity::QuantumIdentity</a></div><div class="ttdeci">const QuantumIdentifier &amp; QuantumIdentity() const</div><div class="ttdoc">Returns the identity of this Jacobian.</div><div class="ttdef"><b>Definition:</b> <a href="jacobian_8h_source.html#l00311">jacobian.h:311</a></div></div>
<div class="ttc" id="aclassAbsorption_1_1Lines_html_a810c25d0831147858c34d1e8ae9a5c2c"><div class="ttname"><a href="classAbsorption_1_1Lines.html#a810c25d0831147858c34d1e8ae9a5c2c">Absorption::Lines::T0</a></div><div class="ttdeci">Numeric T0() const noexcept</div><div class="ttdoc">Returns reference temperature.</div><div class="ttdef"><b>Definition:</b> <a href="absorptionlines_8h_source.html#l01311">absorptionlines.h:1311</a></div></div>
<div class="ttc" id="aclassAbsorption_1_1Lines_html_a165f7afc463f207b22c8a04a99c24f74"><div class="ttname"><a href="classAbsorption_1_1Lines.html#a165f7afc463f207b22c8a04a99c24f74">Absorption::Lines::ZeemanSplitting</a></div><div class="ttdeci">Numeric ZeemanSplitting(size_t k, Zeeman::Polarization type, Index i) const noexcept</div><div class="ttdoc">Returns the splitting of a Zeeman split line.</div><div class="ttdef"><b>Definition:</b> <a href="absorptionlines_8h_source.html#l00947">absorptionlines.h:947</a></div></div>
<div class="ttc" id="alinescaling_8cc_html_a2257cdd186e99595e3c0a5aaa7615496"><div class="ttname"><a href="linescaling_8cc.html#a2257cdd186e99595e3c0a5aaa7615496">dabsorption_nlte_rate_dT</a></div><div class="ttdeci">Numeric dabsorption_nlte_rate_dT(const Numeric &amp;gamma, const Numeric &amp;T, const Numeric &amp;F0, const Numeric &amp;El, const Numeric &amp;Eu, const Numeric &amp;r_upp, const Numeric &amp;r_low)</div><div class="ttdoc">Computes temperature derivatives of (r_low - r_upp * gamma) / (1 - gamma)</div><div class="ttdef"><b>Definition:</b> <a href="linescaling_8cc_source.html#l00201">linescaling.cc:201</a></div></div>
<div class="ttc" id="alinefunctions_8h_html"><div class="ttname"><a href="linefunctions_8h.html">linefunctions.h</a></div><div class="ttdoc">Stuff related to lineshape functions.</div></div>
<div class="ttc" id="anamespaceLineShape_html_a14ae23ee5f35836ee9ca4d3d90c4e14dae2fca8135c2fadca093abd79a6b1c0d2"><div class="ttname"><a href="namespaceLineShape.html#a14ae23ee5f35836ee9ca4d3d90c4e14dae2fca8135c2fadca093abd79a6b1c0d2">LineShape::Type::DP</a></div><div class="ttdeci">@ DP</div></div>
<div class="ttc" id="anamespaceoem_html_a6dead99de47f1704cff777837f5044e9"><div class="ttname"><a href="namespaceoem.html#a6dead99de47f1704cff777837f5044e9">oem::Matrix</a></div><div class="ttdeci">invlib::Matrix&lt; ArtsMatrix &gt; Matrix</div><div class="ttdoc">invlib wrapper type for ARTS matrices.</div><div class="ttdef"><b>Definition:</b> <a href="oem_8h_source.html#l00034">oem.h:34</a></div></div>
<div class="ttc" id="anamespaceLinefunctions_html_a38c90914bad76caa9d40c7dc0053924e"><div class="ttname"><a href="namespaceLinefunctions.html#a38c90914bad76caa9d40c7dc0053924e">Linefunctions::ExpectedDataSize</a></div><div class="ttdeci">constexpr Index ExpectedDataSize()</div><div class="ttdoc">Size required for data buffer.</div><div class="ttdef"><b>Definition:</b> <a href="linefunctions_8h_source.html#l00042">linefunctions.h:42</a></div></div>
<div class="ttc" id="alegacy__continua_8cc_html_a3aa069ac3980707dae1e0530f50d59e4"><div class="ttname"><a href="legacy__continua_8cc.html#a3aa069ac3980707dae1e0530f50d59e4">abs</a></div><div class="ttdeci">#define abs(x)</div><div class="ttdef"><b>Definition:</b> <a href="legacy__continua_8cc_source.html#l20626">legacy_continua.cc:20626</a></div></div>
<div class="ttc" id="anamespaceAbsorption_html_ae579c0918cccbeb83040cf46fad87965"><div class="ttname"><a href="namespaceAbsorption.html#ae579c0918cccbeb83040cf46fad87965">Absorption::NormalizationType</a></div><div class="ttdeci">NormalizationType</div><div class="ttdoc">Describes the type of normalization line effects.</div><div class="ttdef"><b>Definition:</b> <a href="absorptionlines_8h_source.html#l00097">absorptionlines.h:97</a></div></div>
<div class="ttc" id="aclassAbsorption_1_1Lines_html_a55ea49ee3498c6145ecbb2807a585a7e"><div class="ttname"><a href="classAbsorption_1_1Lines.html#a55ea49ee3498c6145ecbb2807a585a7e">Absorption::Lines::CutoffFreq</a></div><div class="ttdeci">Numeric CutoffFreq(size_t k) const noexcept</div><div class="ttdoc">Returns cutoff frequency or maximum value.</div><div class="ttdef"><b>Definition:</b> <a href="absorptionlines_8h_source.html#l01281">absorptionlines.h:1281</a></div></div>
<div class="ttc" id="anamespaceConversion_html_a4f6e51bb0525fbf448c505a56d2740aa"><div class="ttname"><a href="namespaceConversion.html#a4f6e51bb0525fbf448c505a56d2740aa">Conversion::freq2kaycm</a></div><div class="ttdeci">constexpr Numeric freq2kaycm(T x)</div><div class="ttdef"><b>Definition:</b> <a href="constants_8h_source.html#l00387">constants.h:387</a></div></div>
<div class="ttc" id="aclassAbsorption_1_1Lines_html_a61b5b500cfa4ac584c3a59c67119cff3"><div class="ttname"><a href="classAbsorption_1_1Lines.html#a61b5b500cfa4ac584c3a59c67119cff3">Absorption::Lines::Normalization</a></div><div class="ttdeci">NormalizationType Normalization() const noexcept</div><div class="ttdoc">Returns normalization style.</div><div class="ttdef"><b>Definition:</b> <a href="absorptionlines_8h_source.html#l01102">absorptionlines.h:1102</a></div></div>
<div class="ttc" id="anamespaceLinefunctions_html_a9c4b18015e4592ce7e093c49608ba41c"><div class="ttname"><a href="namespaceLinefunctions.html#a9c4b18015e4592ce7e093c49608ba41c">Linefunctions::lte_linestrength</a></div><div class="ttdeci">Numeric lte_linestrength(Numeric S0, Numeric E0, Numeric F0, Numeric QT0, Numeric T0, Numeric QT, Numeric T)</div><div class="ttdoc">Gets the local thermodynamic equilibrium line strength.</div><div class="ttdef"><b>Definition:</b> <a href="linefunctions_8cc_source.html#l00618">linefunctions.cc:618</a></div></div>
<div class="ttc" id="aclassLinefunctions_1_1InternalData_html_aaa3ff7b7e0b54271a3bf076a66239346"><div class="ttname"><a href="classLinefunctions_1_1InternalData.html#aaa3ff7b7e0b54271a3bf076a66239346">Linefunctions::InternalData::Fc</a></div><div class="ttdeci">Eigen::Matrix&lt; Complex, 1, 1 &gt; Fc</div><div class="ttdef"><b>Definition:</b> <a href="linefunctions_8h_source.html#l00525">linefunctions.h:525</a></div></div>
<div class="ttc" id="alinefunctions_8cc_html_a691ec5192a5f391467f8c39cb05559fd"><div class="ttname"><a href="linefunctions_8cc.html#a691ec5192a5f391467f8c39cb05559fd">pCqSDHC_to_arts_G2_deriv</a></div><div class="ttdeci">constexpr Complex pCqSDHC_to_arts_G2_deriv(Complex x) noexcept</div><div class="ttdoc">Conversion from CGS-style lineshape to ARTS G2 derivative.</div><div class="ttdef"><b>Definition:</b> <a href="linefunctions_8cc_source.html#l00068">linefunctions.cc:68</a></div></div>
<div class="ttc" id="alinescaling_8cc_html_a746c537f064ec9a55f83895f47ed175a"><div class="ttname"><a href="linescaling_8cc.html#a746c537f064ec9a55f83895f47ed175a">dboltzman_ratio_dT</a></div><div class="ttdeci">Numeric dboltzman_ratio_dT(const Numeric &amp;boltzmann_ratio, const Numeric &amp;T, const Numeric &amp;E0)</div><div class="ttdoc">Computes temperature derivatives exp(E0/k (T - T0) / (T * T0))</div><div class="ttdef"><b>Definition:</b> <a href="linescaling_8cc_source.html#l00166">linescaling.cc:166</a></div></div>
<div class="ttc" id="aclassLinefunctions_1_1InternalData_html_ae6d374f29d96218f4bda249324f19140"><div class="ttname"><a href="classLinefunctions_1_1InternalData.html#ae6d374f29d96218f4bda249324f19140">Linefunctions::InternalData::dNc</a></div><div class="ttdeci">Eigen::Matrix&lt; Complex, 1, Eigen::Dynamic &gt; dNc</div><div class="ttdef"><b>Definition:</b> <a href="linefunctions_8h_source.html#l00528">linefunctions.h:528</a></div></div>
<div class="ttc" id="ajacobian_8h_html_a518d816c30fe86ca604993a18a8e213a"><div class="ttname"><a href="jacobian_8h.html#a518d816c30fe86ca604993a18a8e213a">is_pressure_broadening_FVC</a></div><div class="ttdeci">bool is_pressure_broadening_FVC(const RetrievalQuantity &amp;t) noexcept</div><div class="ttdoc">Returns if the Retrieval quantity is a FVC derivative.</div></div>
<div class="ttc" id="aarts__api__classes_8cc_html_a126b511d17f5ccbef11bde3a65df2430"><div class="ttname"><a href="arts__api__classes_8cc.html#a126b511d17f5ccbef11bde3a65df2430">data</a></div><div class="ttdeci">G0 G2 FVC Y DV Numeric Numeric Numeric Zeeman LowerQuantumNumbers void * data</div><div class="ttdef"><b>Definition:</b> <a href="arts__api__classes_8cc_source.html#l00232">arts_api_classes.cc:232</a></div></div>
<div class="ttc" id="aclassLinefunctions_1_1InternalData_html"><div class="ttname"><a href="classLinefunctions_1_1InternalData.html">Linefunctions::InternalData</a></div><div class="ttdef"><b>Definition:</b> <a href="linefunctions_8h_source.html#l00518">linefunctions.h:518</a></div></div>
<div class="ttc" id="anamespaceLinefunctions_html_afd8834345135ba3440f4f62e5e0bf276"><div class="ttname"><a href="namespaceLinefunctions.html#afd8834345135ba3440f4f62e5e0bf276">Linefunctions::apply_lineshapemodel_jacobian_scaling</a></div><div class="ttdeci">void apply_lineshapemodel_jacobian_scaling(Eigen::Ref&lt; Eigen::MatrixXcd &gt; dF, const AbsorptionLines &amp;band, const Index &amp;line_ind, const ArrayOfRetrievalQuantity &amp;derivatives_data, const ArrayOfIndex &amp;derivatives_data_position, const Numeric &amp;T, const Numeric &amp;P, const Vector &amp;vmrs)</div><div class="ttdoc">Applies the line-by-line pressure broadening jacobian for the matching lines.</div><div class="ttdef"><b>Definition:</b> <a href="linefunctions_8cc_source.html#l00787">linefunctions.cc:787</a></div></div>
<div class="ttc" id="anamespaceAbsorption_html_a4f80c08b2de23a8eedf6b39f8620ede3"><div class="ttname"><a href="namespaceAbsorption.html#a4f80c08b2de23a8eedf6b39f8620ede3">Absorption::id_in_line_lower</a></div><div class="ttdeci">bool id_in_line_lower(const Lines &amp;band, const QuantumIdentifier &amp;id, size_t line_index)</div><div class="ttdoc">Checks if the external quantum identifier match a line's ID.</div><div class="ttdef"><b>Definition:</b> <a href="absorptionlines_8cc_source.html#l02904">absorptionlines.cc:2904</a></div></div>
<div class="ttc" id="ajacobian_8h_html_a3474c8d090490d53760e68212355300e"><div class="ttname"><a href="jacobian_8h.html#a3474c8d090490d53760e68212355300e">is_pressure_broadening_DV</a></div><div class="ttdeci">bool is_pressure_broadening_DV(const RetrievalQuantity &amp;t) noexcept</div><div class="ttdoc">Returns if the Retrieval quantity is a DV derivative.</div></div>
<div class="ttc" id="ajacobian_8cc_html_a898bd3f5acba8942e94aceb11b0d1ad9"><div class="ttname"><a href="jacobian_8cc.html#a898bd3f5acba8942e94aceb11b0d1ad9">do_temperature_jacobian</a></div><div class="ttdeci">bool do_temperature_jacobian(const ArrayOfRetrievalQuantity &amp;js) noexcept</div><div class="ttdoc">Returns if the array wants the temperature derivative.</div><div class="ttdef"><b>Definition:</b> <a href="jacobian_8cc_source.html#l01279">jacobian.cc:1279</a></div></div>
<div class="ttc" id="anamespaceLinefunctions_html_a5f38e52b80fafd947d2df8d1a3f082ef"><div class="ttname"><a href="namespaceLinefunctions.html#a5f38e52b80fafd947d2df8d1a3f082ef">Linefunctions::set_doppler</a></div><div class="ttdeci">void set_doppler(Eigen::Ref&lt; Eigen::VectorXcd &gt; F, Eigen::Ref&lt; Eigen::MatrixXcd &gt; dF, Eigen::Ref&lt; Eigen::Matrix&lt; Complex, Eigen::Dynamic, ExpectedDataSize()&gt;&gt; data, const Eigen::Ref&lt; const Eigen::VectorXd &gt; f_grid, const Numeric &amp;zeeman_df, const Numeric &amp;magnetic_magnitude, const Numeric &amp;F0_noshift, const Numeric &amp;GD_div_F0, const AbsorptionLines &amp;band=AbsorptionLines(), const Index &amp;line_ind=0, const ArrayOfRetrievalQuantity &amp;derivatives_data=ArrayOfRetrievalQuantity(), const ArrayOfIndex &amp;derivatives_data_position=ArrayOfIndex(), const Numeric &amp;dGD_div_F0_dT=0.0)</div><div class="ttdoc">Sets the Doppler line shape.</div><div class="ttdef"><b>Definition:</b> <a href="linefunctions_8cc_source.html#l00375">linefunctions.cc:375</a></div></div>
<div class="ttc" id="aclassAbsorption_1_1SingleLine_html"><div class="ttname"><a href="classAbsorption_1_1SingleLine.html">Absorption::SingleLine</a></div><div class="ttdoc">Computations and data for a single absorption line.</div><div class="ttdef"><b>Definition:</b> <a href="absorptionlines_8h_source.html#l00246">absorptionlines.h:246</a></div></div>
<div class="ttc" id="anamespaceAbsorption_html_afffee90a9935fd674729994ae79904e1"><div class="ttname"><a href="namespaceAbsorption.html#afffee90a9935fd674729994ae79904e1">Absorption::id_in_line_upper</a></div><div class="ttdeci">bool id_in_line_upper(const Lines &amp;band, const QuantumIdentifier &amp;id, size_t line_index)</div><div class="ttdoc">Checks if the external quantum identifier match a line's ID.</div><div class="ttdef"><b>Definition:</b> <a href="absorptionlines_8cc_source.html#l02877">absorptionlines.cc:2877</a></div></div>
<div class="ttc" id="anamespaceAbsorption_html_ae579c0918cccbeb83040cf46fad87965a6adf97f83acf6453d4a6a4b1070f3754"><div class="ttname"><a href="namespaceAbsorption.html#ae579c0918cccbeb83040cf46fad87965a6adf97f83acf6453d4a6a4b1070f3754">Absorption::NormalizationType::None</a></div><div class="ttdeci">@ None</div></div>
<div class="ttc" id="acomplex_8h_html_aff1205001edf41e8e0032f18b98875e1"><div class="ttname"><a href="complex_8h.html#aff1205001edf41e8e0032f18b98875e1">Complex</a></div><div class="ttdeci">std::complex&lt; Numeric &gt; Complex</div><div class="ttdef"><b>Definition:</b> <a href="complex_8h_source.html#l00033">complex.h:33</a></div></div>
<div class="ttc" id="alinescaling_8cc_html_a2f98f6b42a682f767144ca8556894562"><div class="ttname"><a href="linescaling_8cc.html#a2f98f6b42a682f767144ca8556894562">dabsorption_nlte_rate_dF0</a></div><div class="ttdeci">Numeric dabsorption_nlte_rate_dF0(const Numeric &amp;gamma, const Numeric &amp;T, const Numeric &amp;r_upp, const Numeric &amp;r_low)</div><div class="ttdoc">Computes frequency derivative of (r_low - r_upp * gamma) / (1 - gamma)</div><div class="ttdef"><b>Definition:</b> <a href="linescaling_8cc_source.html#l00228">linescaling.cc:228</a></div></div>
<div class="ttc" id="anamespaceLinefunctions_html_a5505c9892e2f020db13b06845baf639b"><div class="ttname"><a href="namespaceLinefunctions.html#a5505c9892e2f020db13b06845baf639b">Linefunctions::apply_VVW_scaling</a></div><div class="ttdeci">void apply_VVW_scaling(Eigen::Ref&lt; Eigen::VectorXcd &gt; F, Eigen::Ref&lt; Eigen::MatrixXcd &gt; dF, const Eigen::Ref&lt; const Eigen::VectorXd &gt; f_grid, const Numeric &amp;F0, const AbsorptionLines &amp;band=AbsorptionLines(), const Index &amp;line_ind=0, const ArrayOfRetrievalQuantity &amp;derivatives_data=ArrayOfRetrievalQuantity(), const ArrayOfIndex &amp;derivatives_data_position=ArrayOfIndex())</div><div class="ttdoc">Applies Van Vleck and Weiskopf normalization to already set line shape.</div><div class="ttdef"><b>Definition:</b> <a href="linefunctions_8cc_source.html#l00580">linefunctions.cc:580</a></div></div>
<div class="ttc" id="aclassAbsorption_1_1Lines_html_a6b65571e7669eabb2c94e847ba8cac0b"><div class="ttname"><a href="classAbsorption_1_1Lines.html#a6b65571e7669eabb2c94e847ba8cac0b">Absorption::Lines::ShapeParameter_dInternal</a></div><div class="ttdeci">Numeric ShapeParameter_dInternal(size_t k, Numeric T, Numeric P, const Vector &amp;vmrs, const RetrievalQuantity &amp;derivative) const noexcept</div><div class="ttdoc">Line shape parameter internal derivative.</div><div class="ttdef"><b>Definition:</b> <a href="absorptionlines_8cc_source.html#l00131">absorptionlines.cc:131</a></div></div>
<div class="ttc" id="alinescaling_8cc_html_a9d40c23c09539b98b621b8c92af0fab5"><div class="ttname"><a href="linescaling_8cc.html#a9d40c23c09539b98b621b8c92af0fab5">absorption_nlte_ratio</a></div><div class="ttdeci">Numeric absorption_nlte_ratio(const Numeric &amp;gamma, const Numeric &amp;r_upp, const Numeric &amp;r_low)</div><div class="ttdoc">Computes (r_low - r_upp * gamma) / (1 - gamma)</div><div class="ttdef"><b>Definition:</b> <a href="linescaling_8cc_source.html#l00195">linescaling.cc:195</a></div></div>
<div class="ttc" id="aclassAbsorption_1_1Lines_html_abd6edd8862aa3cfa6934c2abc918143e"><div class="ttname"><a href="classAbsorption_1_1Lines.html#abd6edd8862aa3cfa6934c2abc918143e">Absorption::Lines::CutoffFreqMinus</a></div><div class="ttdeci">Numeric CutoffFreqMinus(size_t k, Numeric fmean) const noexcept</div><div class="ttdoc">Returns negative cutoff frequency or lowest value.</div><div class="ttdef"><b>Definition:</b> <a href="absorptionlines_8h_source.html#l01298">absorptionlines.h:1298</a></div></div>
<div class="ttc" id="arational_8h_html_a7d3b5e4723b5fa0df29f00a27a6ab8f0"><div class="ttname"><a href="rational_8h.html#a7d3b5e4723b5fa0df29f00a27a6ab8f0">sqrt</a></div><div class="ttdeci">Numeric sqrt(const Rational r)</div><div class="ttdoc">Square root.</div><div class="ttdef"><b>Definition:</b> <a href="rational_8h_source.html#l00620">rational.h:620</a></div></div>
<div class="ttc" id="anamespaceLinefunctions_html_a9bab2edaa2740b7379fb568376859121"><div class="ttname"><a href="namespaceLinefunctions.html#a9bab2edaa2740b7379fb568376859121">Linefunctions::set_voigt</a></div><div class="ttdeci">void set_voigt(Eigen::Ref&lt; Eigen::VectorXcd &gt; F, Eigen::Ref&lt; Eigen::MatrixXcd &gt; dF, Eigen::Ref&lt; Eigen::Matrix&lt; Complex, Eigen::Dynamic, ExpectedDataSize()&gt;&gt; data, const Eigen::Ref&lt; const Eigen::VectorXd &gt; f_grid, const Numeric &amp;zeeman_df, const Numeric &amp;magnetic_magnitude, const Numeric &amp;F0_noshift, const Numeric &amp;GD_div_F0, const LineShape::Output &amp;lso, const AbsorptionLines &amp;band=AbsorptionLines(), const Index &amp;line_ind=0, const ArrayOfRetrievalQuantity &amp;derivatives_data=ArrayOfRetrievalQuantity(), const ArrayOfIndex &amp;derivatives_data_position=ArrayOfIndex(), const Numeric &amp;dGD_div_F0_dT=0.0, const LineShape::Output &amp;dT={0, 0, 0, 0, 0, 0, 0, 0, 0}, const LineShape::Output &amp;dVMR={0, 0, 0, 0, 0, 0, 0, 0, 0})</div><div class="ttdoc">Sets the Voigt line shape.</div><div class="ttdef"><b>Definition:</b> <a href="linefunctions_8cc_source.html#l00298">linefunctions.cc:298</a></div></div>
<div class="ttc" id="ajacobian_8h_html_a10cc5eb98e966a4d466ae1f56a7356a4"><div class="ttname"><a href="jacobian_8h.html#a10cc5eb98e966a4d466ae1f56a7356a4">is_pressure_broadening_D0</a></div><div class="ttdeci">bool is_pressure_broadening_D0(const RetrievalQuantity &amp;t) noexcept</div><div class="ttdoc">Returns if the Retrieval quantity is a D0 derivative.</div></div>
<div class="ttc" id="ajacobian_8h_html_a4bea1e519152d28026876d006f372ac4"><div class="ttname"><a href="jacobian_8h.html#a4bea1e519152d28026876d006f372ac4">is_pressure_broadening_G0</a></div><div class="ttdeci">bool is_pressure_broadening_G0(const RetrievalQuantity &amp;t) noexcept</div><div class="ttdoc">Returns if the Retrieval quantity is a G0 derivative.</div></div>
<div class="ttc" id="aclassArray_html"><div class="ttname"><a href="classArray.html">Array</a></div><div class="ttdoc">This can be used to make arrays out of anything.</div><div class="ttdef"><b>Definition:</b> <a href="array_8h_source.html#l00108">array.h:108</a></div></div>
<div class="ttc" id="anamespaceAbsorption_html_a5694bacde9aa335dc5ec69d50f201992"><div class="ttname"><a href="namespaceAbsorption.html#a5694bacde9aa335dc5ec69d50f201992">Absorption::nelem</a></div><div class="ttdeci">Index nelem(const Lines &amp;l)</div><div class="ttdoc">Number of lines.</div><div class="ttdef"><b>Definition:</b> <a href="absorptionlines_8h_source.html#l01820">absorptionlines.h:1820</a></div></div>
<div class="ttc" id="anamespaceConstant_html_a9b0ce133f5cf1a3d76c2ae3dc7aca0b8"><div class="ttname"><a href="namespaceConstant.html#a9b0ce133f5cf1a3d76c2ae3dc7aca0b8">Constant::pow4</a></div><div class="ttdeci">constexpr T pow4(T x)</div><div class="ttdoc">power of four</div><div class="ttdef"><b>Definition:</b> <a href="constants_8h_source.html#l00076">constants.h:76</a></div></div>
<div class="ttc" id="acomplex_8cc_html_a79a18b72864daf76c36f123c0ca626b4"><div class="ttname"><a href="complex_8cc.html#a79a18b72864daf76c36f123c0ca626b4">MapToEigen</a></div><div class="ttdeci">ComplexConstMatrixViewMap MapToEigen(const ConstComplexMatrixView &amp;A)</div><div class="ttdef"><b>Definition:</b> <a href="complex_8cc_source.html#l01655">complex.cc:1655</a></div></div>
<div class="ttc" id="alinescaling_8h_html_ab02b2429fe31010a5fba44b8091a178b"><div class="ttname"><a href="linescaling_8h.html#ab02b2429fe31010a5fba44b8091a178b">dboltzman_ratio_dT_div_boltzmann_ratio</a></div><div class="ttdeci">constexpr Numeric dboltzman_ratio_dT_div_boltzmann_ratio(Numeric T, Numeric E0)</div><div class="ttdoc">Computes temperature derivatives exp(E0/k (T - T0) / (T * T0)) / exp(E0/c (T - T0) / (T * T0))</div><div class="ttdef"><b>Definition:</b> <a href="linescaling_8h_source.html#l00159">linescaling.h:159</a></div></div>
<div class="ttc" id="anamespaceAbsorption_html_a671f397d421fb6ed148c3b8efa88f8d2a6adf97f83acf6453d4a6a4b1070f3754"><div class="ttname"><a href="namespaceAbsorption.html#a671f397d421fb6ed148c3b8efa88f8d2a6adf97f83acf6453d4a6a4b1070f3754">Absorption::CutoffType::None</a></div><div class="ttdeci">@ None</div></div>
<div class="ttc" id="alinefunctions_8cc_html_a08f2b520b433833c0d7ca264f305380e"><div class="ttname"><a href="linefunctions_8cc.html#a08f2b520b433833c0d7ca264f305380e">dw</a></div><div class="ttdeci">constexpr Complex dw(Complex z, Complex w) noexcept</div><div class="ttdoc">The Faddeeva function partial derivative.</div><div class="ttdef"><b>Definition:</b> <a href="linefunctions_8cc_source.html#l00045">linefunctions.cc:45</a></div></div>
<div class="ttc" id="ajacobian_8cc_html_a5ad6fcd20dc6e691e408d497934760d8"><div class="ttname"><a href="jacobian_8cc.html#a5ad6fcd20dc6e691e408d497934760d8">is_magnetic_parameter</a></div><div class="ttdeci">bool is_magnetic_parameter(const RetrievalQuantity &amp;t) noexcept</div><div class="ttdoc">Returns if the Retrieval quantity is a magnetic parameter.</div><div class="ttdef"><b>Definition:</b> <a href="jacobian_8cc_source.html#l01128">jacobian.cc:1128</a></div></div>
<div class="ttc" id="anamespaceConversion_html_ab3b90aebe088aed47dd11985613b3799"><div class="ttname"><a href="namespaceConversion.html#ab3b90aebe088aed47dd11985613b3799">Conversion::hitran2arts_linestrength</a></div><div class="ttdeci">constexpr T hitran2arts_linestrength(T x)</div><div class="ttdef"><b>Definition:</b> <a href="constants_8h_source.html#l00462">constants.h:462</a></div></div>
<div class="ttc" id="aclassAbsorption_1_1Lines_html_a42d231e9deba3c8f064389bb01632438"><div class="ttname"><a href="classAbsorption_1_1Lines.html#a42d231e9deba3c8f064389bb01632438">Absorption::Lines::Mirroring</a></div><div class="ttdeci">MirroringType Mirroring() const noexcept</div><div class="ttdoc">Returns mirroring style.</div><div class="ttdef"><b>Definition:</b> <a href="absorptionlines_8h_source.html#l01076">absorptionlines.h:1076</a></div></div>
<div class="ttc" id="aclassLinefunctions_1_1InternalData_html_a4b37c31bf8abcc7b5775ae7079089508"><div class="ttname"><a href="classLinefunctions_1_1InternalData.html#a4b37c31bf8abcc7b5775ae7079089508">Linefunctions::InternalData::dFc</a></div><div class="ttdeci">Eigen::Matrix&lt; Complex, 1, Eigen::Dynamic &gt; dFc</div><div class="ttdef"><b>Definition:</b> <a href="linefunctions_8h_source.html#l00527">linefunctions.h:527</a></div></div>
<div class="ttc" id="aclassAbsorption_1_1Lines_html_a5d2aa58a7b34908ee861b9773b86ccce"><div class="ttname"><a href="classAbsorption_1_1Lines.html#a5d2aa58a7b34908ee861b9773b86ccce">Absorption::Lines::ShapeParameters_dVMR</a></div><div class="ttdeci">LineShape::Output ShapeParameters_dVMR(size_t k, Numeric T, Numeric P, const QuantumIdentifier &amp;vmr_qid) const noexcept</div><div class="ttdoc">Line shape parameters vmr derivative.</div><div class="ttdef"><b>Definition:</b> <a href="absorptionlines_8cc_source.html#l00102">absorptionlines.cc:102</a></div></div>
<div class="ttc" id="anamespaceLinefunctions_html_a92312bdbf8d958031a4b2d5806412618"><div class="ttname"><a href="namespaceLinefunctions.html#a92312bdbf8d958031a4b2d5806412618">Linefunctions::apply_linestrength_scaling_by_lte</a></div><div class="ttdeci">void apply_linestrength_scaling_by_lte(Eigen::Ref&lt; Eigen::VectorXcd &gt; F, Eigen::Ref&lt; Eigen::MatrixXcd &gt; dF, Eigen::Ref&lt; Eigen::VectorXcd &gt; N, Eigen::Ref&lt; Eigen::MatrixXcd &gt; dN, const Absorption::SingleLine &amp;line, const Numeric &amp;T, const Numeric &amp;T0, const Numeric &amp;isotopic_ratio, const Numeric &amp;QT, const Numeric &amp;QT0, const AbsorptionLines &amp;band=AbsorptionLines(), const Index &amp;line_ind=0, const ArrayOfRetrievalQuantity &amp;derivatives_data=ArrayOfRetrievalQuantity(), const ArrayOfIndex &amp;derivatives_data_position=ArrayOfIndex(), const Numeric &amp;dQT_dT=0.0)</div><div class="ttdoc">Applies linestrength to already set line shape by LTE population type.</div><div class="ttdef"><b>Definition:</b> <a href="linefunctions_8cc_source.html#l00632">linefunctions.cc:632</a></div></div>
<div class="ttc" id="aclassAbsorption_1_1SingleLine_html_ab4752038522340c36ddc59ac0da23924"><div class="ttname"><a href="classAbsorption_1_1SingleLine.html#ab4752038522340c36ddc59ac0da23924">Absorption::SingleLine::E0</a></div><div class="ttdeci">Numeric E0() const noexcept</div><div class="ttdoc">Lower level energy.</div><div class="ttdef"><b>Definition:</b> <a href="absorptionlines_8h_source.html#l00345">absorptionlines.h:345</a></div></div>
<div class="ttc" id="aclassAbsorption_1_1Lines_html_a8fa59980e5eca1b7814cb539f133dd08"><div class="ttname"><a href="classAbsorption_1_1Lines.html#a8fa59980e5eca1b7814cb539f133dd08">Absorption::Lines::ShapeParameters</a></div><div class="ttdeci">LineShape::Output ShapeParameters(size_t k, Numeric T, Numeric P, const Vector &amp;vmrs) const noexcept</div><div class="ttdoc">Line shape parameters.</div><div class="ttdef"><b>Definition:</b> <a href="absorptionlines_8cc_source.html#l00068">absorptionlines.cc:68</a></div></div>
<div class="ttc" id="anamespaceLineShape_html_a26c4f90566ac48b736e82edb6625880b"><div class="ttname"><a href="namespaceLineShape.html#a26c4f90566ac48b736e82edb6625880b">LineShape::mirroredOutput</a></div><div class="ttdeci">constexpr Output mirroredOutput(Output x) noexcept</div><div class="ttdoc">Output to be used by mirroring calls.</div><div class="ttdef"><b>Definition:</b> <a href="lineshapemodel_8h_source.html#l00895">lineshapemodel.h:895</a></div></div>
<div class="ttc" id="amatpack_8h_html_ad9a8dbb27c0bbea7271d916036122f6a"><div class="ttname"><a href="matpack_8h.html#ad9a8dbb27c0bbea7271d916036122f6a">Numeric</a></div><div class="ttdeci">NUMERIC Numeric</div><div class="ttdoc">The type to use for all floating point numbers.</div><div class="ttdef"><b>Definition:</b> <a href="matpack_8h_source.html#l00033">matpack.h:33</a></div></div>
<div class="ttc" id="aclassLinefunctions_1_1InternalData_html_a28fd6d40dd8a9832a253114ac31090ba"><div class="ttname"><a href="classLinefunctions_1_1InternalData.html#a28fd6d40dd8a9832a253114ac31090ba">Linefunctions::InternalData::Nc</a></div><div class="ttdeci">Eigen::Matrix&lt; Complex, 1, 1 &gt; Nc</div><div class="ttdef"><b>Definition:</b> <a href="linefunctions_8h_source.html#l00526">linefunctions.h:526</a></div></div>
<div class="ttc" id="alinescaling_8cc_html_a64bc2ecc08425b72e2a5d6355ed2fa1a"><div class="ttname"><a href="linescaling_8cc.html#a64bc2ecc08425b72e2a5d6355ed2fa1a">boltzman_ratio</a></div><div class="ttdeci">Numeric boltzman_ratio(const Numeric &amp;T, const Numeric &amp;T0, const Numeric &amp;E0)</div><div class="ttdoc">Computes exp(E0/c (T - T0) / (T * T0))</div><div class="ttdef"><b>Definition:</b> <a href="linescaling_8cc_source.html#l00159">linescaling.cc:159</a></div></div>
<div class="ttc" id="anamespaceLinefunctions_html_aa63d54039a4b96c9ca7f74524c1baa73"><div class="ttname"><a href="namespaceLinefunctions.html#aa63d54039a4b96c9ca7f74524c1baa73">Linefunctions::set_htp</a></div><div class="ttdeci">void set_htp(Eigen::Ref&lt; Eigen::VectorXcd &gt; F, Eigen::Ref&lt; Eigen::MatrixXcd &gt; dF, const Eigen::Ref&lt; const Eigen::VectorXd &gt; f_grid, const Numeric &amp;zeeman_df, const Numeric &amp;magnetic_magnitude, const Numeric &amp;F0_noshift, const Numeric &amp;GD_div_F0, const LineShape::Output &amp;lso, const AbsorptionLines &amp;band=AbsorptionLines(), const Index &amp;line_ind=0, const ArrayOfRetrievalQuantity &amp;derivatives_data=ArrayOfRetrievalQuantity(), const ArrayOfIndex &amp;derivatives_data_position=ArrayOfIndex(), const Numeric &amp;dGD_div_F0_dT=0.0, const LineShape::Output &amp;dT={0, 0, 0, 0, 0, 0, 0, 0, 0}, const LineShape::Output &amp;dVMR={0, 0, 0, 0, 0, 0, 0, 0, 0})</div><div class="ttdoc">Sets the HTP line shape.</div><div class="ttdef"><b>Definition:</b> <a href="linefunctions_8cc_source.html#l00931">linefunctions.cc:931</a></div></div>
<div class="ttc" id="anamespaceLinefunctions_html_a3e0ce20f6ce98dfe751eee8d6d86a2ab"><div class="ttname"><a href="namespaceLinefunctions.html#a3e0ce20f6ce98dfe751eee8d6d86a2ab">Linefunctions::dDopplerConstant_dT</a></div><div class="ttdeci">Numeric dDopplerConstant_dT(const Numeric &amp;T, const Numeric &amp;dc)</div><div class="ttdoc">Returns the temperature derivative of the frequency-independent part of the Doppler broadening.</div><div class="ttdef"><b>Definition:</b> <a href="linefunctions_8cc_source.html#l00811">linefunctions.cc:811</a></div></div>
<div class="ttc" id="alinefunctions_8cc_html_aac6918584a4f0ae9c7b2ff900eb047a4"><div class="ttname"><a href="linefunctions_8cc.html#aac6918584a4f0ae9c7b2ff900eb047a4">pCqSDHC_to_arts</a></div><div class="ttdeci">constexpr Complex pCqSDHC_to_arts(Complex x) noexcept</div><div class="ttdoc">Conversion from CGS-style lineshape to ARTS.</div><div class="ttdef"><b>Definition:</b> <a href="linefunctions_8cc_source.html#l00050">linefunctions.cc:50</a></div></div>
<div class="ttc" id="astructLineShape_1_1Output_html_a2ae27c5abb4edad723c2089f7edcc599"><div class="ttname"><a href="structLineShape_1_1Output.html#a2ae27c5abb4edad723c2089f7edcc599">LineShape::Output::Y</a></div><div class="ttdeci">Numeric Y</div><div class="ttdef"><b>Definition:</b> <a href="lineshapemodel_8h_source.html#l00882">lineshapemodel.h:882</a></div></div>
<div class="ttc" id="alinescaling_8cc_html_a1ae35d3f91bd7cc2f4e6f477b32794ea"><div class="ttname"><a href="linescaling_8cc.html#a1ae35d3f91bd7cc2f4e6f477b32794ea">stimulated_relative_emission</a></div><div class="ttdeci">Numeric stimulated_relative_emission(const Numeric &amp;gamma, const Numeric &amp;gamma_ref)</div><div class="ttdoc">Computes (1 - gamma) / (1 - gamma_ref)</div><div class="ttdef"><b>Definition:</b> <a href="linescaling_8cc_source.html#l00128">linescaling.cc:128</a></div></div>
<div class="ttc" id="alinefunctions_8cc_html_a9e4c2622d7fda9ecb3bd1ed9a074c756"><div class="ttname"><a href="linefunctions_8cc.html#a9e4c2622d7fda9ecb3bd1ed9a074c756">pCqSDHC_to_arts_freq_deriv</a></div><div class="ttdeci">constexpr Complex pCqSDHC_to_arts_freq_deriv(Complex x) noexcept</div><div class="ttdoc">Conversion from CGS-style lineshape to ARTS for frequncy derivatives.</div><div class="ttdef"><b>Definition:</b> <a href="linefunctions_8cc_source.html#l00059">linefunctions.cc:59</a></div></div>
<div class="ttc" id="anamespaceAbsorption_html_a5141982a7f8f641008a0b481aedeefcd"><div class="ttname"><a href="namespaceAbsorption.html#a5141982a7f8f641008a0b481aedeefcd">Absorption::MirroringType</a></div><div class="ttdeci">MirroringType</div><div class="ttdoc">Describes the type of mirroring line effects.</div><div class="ttdef"><b>Definition:</b> <a href="absorptionlines_8h_source.html#l00049">absorptionlines.h:49</a></div></div>
<div class="ttc" id="anamespaceARTS_1_1Var_html_a656f34b4c40189bd3c971e2d3dbe3b95"><div class="ttname"><a href="namespaceARTS_1_1Var.html#a656f34b4c40189bd3c971e2d3dbe3b95">ARTS::Var::f_grid</a></div><div class="ttdeci">Vector f_grid(Workspace &amp;ws) noexcept</div><div class="ttdef"><b>Definition:</b> <a href="autoarts_8h_source.html#l03449">autoarts.h:3449</a></div></div>
<div class="ttc" id="aclassAbsorption_1_1Lines_html"><div class="ttname"><a href="classAbsorption_1_1Lines.html">Absorption::Lines</a></div><div class="ttdef"><b>Definition:</b> <a href="absorptionlines_8h_source.html#l00547">absorptionlines.h:547</a></div></div>
<div class="ttc" id="aclassEnergyLevelMap_html"><div class="ttname"><a href="classEnergyLevelMap.html">EnergyLevelMap</a></div><div class="ttdef"><b>Definition:</b> <a href="energylevelmap_8h_source.html#l00060">energylevelmap.h:60</a></div></div>
<div class="ttc" id="anamespaceAbsorption_html_a5141982a7f8f641008a0b481aedeefcda6adf97f83acf6453d4a6a4b1070f3754"><div class="ttname"><a href="namespaceAbsorption.html#a5141982a7f8f641008a0b481aedeefcda6adf97f83acf6453d4a6a4b1070f3754">Absorption::MirroringType::None</a></div><div class="ttdeci">@ None</div></div>
<div class="ttc" id="aclassAbsorption_1_1Lines_html_a5a7426e8540191c3fa2ed256aee17509"><div class="ttname"><a href="classAbsorption_1_1Lines.html#a5a7426e8540191c3fa2ed256aee17509">Absorption::Lines::F0</a></div><div class="ttdeci">Numeric F0(size_t k) const noexcept</div><div class="ttdoc">Central frequency.</div><div class="ttdef"><b>Definition:</b> <a href="absorptionlines_8h_source.html#l00970">absorptionlines.h:970</a></div></div>
<div class="ttc" id="ajacobian_8h_html_a82162e312a2889b5c6bd494b8749e2e0"><div class="ttname"><a href="jacobian_8h.html#a82162e312a2889b5c6bd494b8749e2e0">is_pressure_broadening_G</a></div><div class="ttdeci">bool is_pressure_broadening_G(const RetrievalQuantity &amp;t) noexcept</div><div class="ttdoc">Returns if the Retrieval quantity is a G derivative.</div></div>
<div class="ttc" id="anamespaceLineShape_html_a14ae23ee5f35836ee9ca4d3d90c4e14d"><div class="ttname"><a href="namespaceLineShape.html#a14ae23ee5f35836ee9ca4d3d90c4e14d">LineShape::Type</a></div><div class="ttdeci">Type</div><div class="ttdoc">Type of line shape to compute.</div><div class="ttdef"><b>Definition:</b> <a href="lineshapemodel_8h_source.html#l00788">lineshapemodel.h:788</a></div></div>
<div class="ttc" id="aclassLinefunctions_1_1InternalData_html_a9fd5e8a8fb10337cf83b0744081a1268"><div class="ttname"><a href="classLinefunctions_1_1InternalData.html#a9fd5e8a8fb10337cf83b0744081a1268">Linefunctions::InternalData::dN</a></div><div class="ttdeci">Eigen::MatrixXcd dN</div><div class="ttdef"><b>Definition:</b> <a href="linefunctions_8h_source.html#l00523">linefunctions.h:523</a></div></div>
<div class="ttc" id="alinefunctions_8cc_html_aab6895ad5809bc8a42a1ae2eab7e61d2"><div class="ttname"><a href="linefunctions_8cc.html#aab6895ad5809bc8a42a1ae2eab7e61d2">pCqSDHC_to_arts_D2_deriv</a></div><div class="ttdeci">constexpr Complex pCqSDHC_to_arts_D2_deriv(Complex x) noexcept</div><div class="ttdoc">Conversion from CGS-style lineshape to ARTS D2 derivative.</div><div class="ttdef"><b>Definition:</b> <a href="linefunctions_8cc_source.html#l00078">linefunctions.cc:78</a></div></div>
<div class="ttc" id="ajacobian_8h_html_a7325f3320449b86e8cbc6e4c2c1e9e36"><div class="ttname"><a href="jacobian_8h.html#a7325f3320449b86e8cbc6e4c2c1e9e36">is_pressure_broadening_D2</a></div><div class="ttdeci">bool is_pressure_broadening_D2(const RetrievalQuantity &amp;t) noexcept</div><div class="ttdoc">Returns if the Retrieval quantity is a D2 derivative.</div></div>
<div class="ttc" id="aclassAbsorption_1_1Lines_html_a645e900f27278b50a3ecda524f868a06"><div class="ttname"><a href="classAbsorption_1_1Lines.html#a645e900f27278b50a3ecda524f868a06">Absorption::Lines::Population</a></div><div class="ttdeci">PopulationType Population() const noexcept</div><div class="ttdoc">Returns population style.</div><div class="ttdef"><b>Definition:</b> <a href="absorptionlines_8h_source.html#l01152">absorptionlines.h:1152</a></div></div>
<div class="ttc" id="astructLineShape_1_1Output_html"><div class="ttname"><a href="structLineShape_1_1Output.html">LineShape::Output</a></div><div class="ttdoc">Main output of Model.</div><div class="ttdef"><b>Definition:</b> <a href="lineshapemodel_8h_source.html#l00875">lineshapemodel.h:875</a></div></div>
<div class="ttc" id="aclassAbsorption_1_1Lines_html_a3bb9f7dc512e65720d9959621508d3b5"><div class="ttname"><a href="classAbsorption_1_1Lines.html#a3bb9f7dc512e65720d9959621508d3b5">Absorption::Lines::ShapeParameters_dT</a></div><div class="ttdeci">LineShape::Output ShapeParameters_dT(size_t k, Numeric T, Numeric P, const Vector &amp;vmrs) const noexcept</div><div class="ttdoc">Line shape parameters temperature derivatives.</div><div class="ttdef"><b>Definition:</b> <a href="absorptionlines_8cc_source.html#l00076">absorptionlines.cc:76</a></div></div>
<div class="ttc" id="aclassAbsorption_1_1Lines_html_a61cff0453b23dd599c98fe7b6536cb00"><div class="ttname"><a href="classAbsorption_1_1Lines.html#a61cff0453b23dd599c98fe7b6536cb00">Absorption::Lines::Line</a></div><div class="ttdeci">SingleLine &amp; Line(Index) noexcept</div><div class="ttdoc">Returns a single line.</div><div class="ttdef"><b>Definition:</b> <a href="absorptionlines_8cc_source.html#l02709">absorptionlines.cc:2709</a></div></div>
<div class="ttc" id="arng_8cc_html_a0240ac851181b84ac374872dc5434ee4"><div class="ttname"><a href="rng_8cc.html#a0240ac851181b84ac374872dc5434ee4">N</a></div><div class="ttdeci">#define N</div><div class="ttdef"><b>Definition:</b> <a href="rng_8cc_source.html#l00164">rng.cc:164</a></div></div>
<div class="ttc" id="astructLineShape_1_1Output_html_a60a928857c168614b0a378d0b97854ce"><div class="ttname"><a href="structLineShape_1_1Output.html#a60a928857c168614b0a378d0b97854ce">LineShape::Output::G</a></div><div class="ttdeci">Numeric G</div><div class="ttdef"><b>Definition:</b> <a href="lineshapemodel_8h_source.html#l00883">lineshapemodel.h:883</a></div></div>
<div class="ttc" id="aclassAbsorption_1_1Lines_html_ab3d179380bf6e649c6be680bf8454376"><div class="ttname"><a href="classAbsorption_1_1Lines.html#ab3d179380bf6e649c6be680bf8454376">Absorption::Lines::g_upp</a></div><div class="ttdeci">Numeric g_upp(size_t k) const noexcept</div><div class="ttdoc">Upper level statistical weight.</div><div class="ttdef"><b>Definition:</b> <a href="absorptionlines_8h_source.html#l01066">absorptionlines.h:1066</a></div></div>
<div class="ttc" id="aclassAbsorption_1_1Lines_html_af2e50adfc3fe1939a6f2932a38ec5800"><div class="ttname"><a href="classAbsorption_1_1Lines.html#af2e50adfc3fe1939a6f2932a38ec5800">Absorption::Lines::ZeemanStrength</a></div><div class="ttdeci">Numeric ZeemanStrength(size_t k, Zeeman::Polarization type, Index i) const noexcept</div><div class="ttdoc">Returns the strength of a Zeeman split line.</div><div class="ttdef"><b>Definition:</b> <a href="absorptionlines_8h_source.html#l00929">absorptionlines.h:929</a></div></div>
<div class="ttc" id="alinescaling_8cc_html_a69facfe63c9a186bc0ed8afc9f5dab85"><div class="ttname"><a href="linescaling_8cc.html#a69facfe63c9a186bc0ed8afc9f5dab85">dabsorption_nlte_rate_dTl</a></div><div class="ttdeci">Numeric dabsorption_nlte_rate_dTl(const Numeric &amp;gamma, const Numeric &amp;T, const Numeric &amp;Tl, const Numeric &amp;El, const Numeric &amp;r_low)</div><div class="ttdoc">Computes lower state temperature derivative of (r_low - r_upp * gamma) / (1 - gamma)</div><div class="ttdef"><b>Definition:</b> <a href="linescaling_8cc_source.html#l00239">linescaling.cc:239</a></div></div>
<div class="ttc" id="alinescaling_8cc_html_a11625c0ca9965f43039a4889a152c5fa"><div class="ttname"><a href="linescaling_8cc.html#a11625c0ca9965f43039a4889a152c5fa">dstimulated_relative_emission_dT</a></div><div class="ttdeci">Numeric dstimulated_relative_emission_dT(const Numeric &amp;gamma, const Numeric &amp;gamma_ref, const Numeric &amp;F0, const Numeric &amp;T)</div><div class="ttdoc">Computes temperature derivative of (1 - gamma) / (1 - gamma_ref)</div><div class="ttdef"><b>Definition:</b> <a href="linescaling_8cc_source.html#l00133">linescaling.cc:133</a></div></div>
<div class="ttc" id="alinescaling_8cc_html_a8412d99dfcf6379f84a2350c371e9ea4"><div class="ttname"><a href="linescaling_8cc.html#a8412d99dfcf6379f84a2350c371e9ea4">dstimulated_relative_emission_dF0</a></div><div class="ttdeci">Numeric dstimulated_relative_emission_dF0(const Numeric &amp;gamma, const Numeric &amp;gamma_ref, const Numeric &amp;T, const Numeric &amp;T0)</div><div class="ttdoc">Computes frequency derivative of (1 - gamma) / (1 - gamma_ref)</div><div class="ttdef"><b>Definition:</b> <a href="linescaling_8cc_source.html#l00144">linescaling.cc:144</a></div></div>
<div class="ttc" id="astructLineShape_1_1Output_html_aa05967f3fcfed19e4136b4b08ce4f3d9"><div class="ttname"><a href="structLineShape_1_1Output.html#aa05967f3fcfed19e4136b4b08ce4f3d9">LineShape::Output::DV</a></div><div class="ttdeci">Numeric DV</div><div class="ttdef"><b>Definition:</b> <a href="lineshapemodel_8h_source.html#l00884">lineshapemodel.h:884</a></div></div>
<div class="ttc" id="anamespaceConstant_html_aa415feed8b057c59bc7965f74cc1331d"><div class="ttname"><a href="namespaceConstant.html#aa415feed8b057c59bc7965f74cc1331d">Constant::pow3</a></div><div class="ttdeci">constexpr T pow3(T x)</div><div class="ttdoc">power of three</div><div class="ttdef"><b>Definition:</b> <a href="constants_8h_source.html#l00070">constants.h:70</a></div></div>
<div class="ttc" id="ajacobian_8h_html_a9fc78900dc39e948c57047d4f960cd91"><div class="ttname"><a href="jacobian_8h.html#a9fc78900dc39e948c57047d4f960cd91">is_pressure_broadening_G2</a></div><div class="ttdeci">bool is_pressure_broadening_G2(const RetrievalQuantity &amp;t) noexcept</div><div class="ttdoc">Returns if the Retrieval quantity is a G0 derivative.</div></div>
<div class="ttc" id="anamespaceLinefunctions_html_a770118e293deb4ed5108f7a481921162"><div class="ttname"><a href="namespaceLinefunctions.html#a770118e293deb4ed5108f7a481921162">Linefunctions::DopplerConstant</a></div><div class="ttdeci">Numeric DopplerConstant(Numeric T, Numeric mass)</div><div class="ttdoc">Returns the frequency-independent part of the Doppler broadening.</div><div class="ttdef"><b>Definition:</b> <a href="linefunctions_8cc_source.html#l00807">linefunctions.cc:807</a></div></div>
<div class="ttc" id="aconstants_8h_html"><div class="ttname"><a href="constants_8h.html">constants.h</a></div><div class="ttdoc">Constants of physical expressions as constexpr.</div></div>
<div class="ttc" id="anamespaceLinefunctions_html_a6692d67ff28ec4a405b0a893e9584a17"><div class="ttname"><a href="namespaceLinefunctions.html#a6692d67ff28ec4a405b0a893e9584a17">Linefunctions::find_cutoff_ranges</a></div><div class="ttdeci">void find_cutoff_ranges(Index &amp;start_cutoff, Index &amp;nelem_cutoff, const Eigen::Ref&lt; const Eigen::VectorXd &gt; f_grid, const Numeric &amp;fmin, const Numeric &amp;fmax)</div><div class="ttdoc">Sets cutoff frequency indices.</div><div class="ttdef"><b>Definition:</b> <a href="linefunctions_8cc_source.html#l00816">linefunctions.cc:816</a></div></div>
<div class="ttc" id="anamespaceZeeman_html_a5a24367cfa454aeb6730983395042ecf"><div class="ttname"><a href="namespaceZeeman.html#a5a24367cfa454aeb6730983395042ecf">Zeeman::start</a></div><div class="ttdeci">constexpr Rational start(Rational Ju, Rational Jl, Polarization type) noexcept</div><div class="ttdoc">Gives the lowest M for a polarization type of this transition.</div><div class="ttdef"><b>Definition:</b> <a href="zeemandata_8h_source.html#l00077">zeemandata.h:77</a></div></div>
<div class="ttc" id="anamespaceLinefunctions_html_a773a49a85f1c95bf6680884d28c83680"><div class="ttname"><a href="namespaceLinefunctions.html#a773a49a85f1c95bf6680884d28c83680">Linefunctions::apply_linestrength_scaling_by_vibrational_nlte</a></div><div class="ttdeci">void apply_linestrength_scaling_by_vibrational_nlte(Eigen::Ref&lt; Eigen::VectorXcd &gt; F, Eigen::Ref&lt; Eigen::MatrixXcd &gt; dF, Eigen::Ref&lt; Eigen::VectorXcd &gt; N, Eigen::Ref&lt; Eigen::MatrixXcd &gt; dN, const Absorption::SingleLine &amp;line, const Numeric &amp;T, const Numeric &amp;T0, const Numeric &amp;Tu, const Numeric &amp;Tl, const Numeric &amp;Evu, const Numeric &amp;Evl, const Numeric &amp;isotopic_ratio, const Numeric &amp;QT, const Numeric &amp;QT0, const AbsorptionLines &amp;band=AbsorptionLines(), const Index &amp;line_ind=0, const ArrayOfRetrievalQuantity &amp;derivatives_data=ArrayOfRetrievalQuantity(), const ArrayOfIndex &amp;derivatives_data_position=ArrayOfIndex(), const Numeric &amp;dQT_dT=0.0)</div><div class="ttdoc">Applies linestrength to already set line shape by vibrational level temperatures.</div><div class="ttdef"><b>Definition:</b> <a href="linefunctions_8cc_source.html#l00684">linefunctions.cc:684</a></div></div>
<div class="ttc" id="alinescaling_8h_html"><div class="ttname"><a href="linescaling_8h.html">linescaling.h</a></div><div class="ttdoc">Constains various line scaling functions.</div></div>
<div class="ttc" id="aclassAbsorption_1_1Lines_html_acadb529b972003acc1e782d855bdaa08"><div class="ttname"><a href="classAbsorption_1_1Lines.html#acadb529b972003acc1e782d855bdaa08">Absorption::Lines::QuantumIdentity</a></div><div class="ttdeci">const QuantumIdentifier &amp; QuantumIdentity() const noexcept</div><div class="ttdoc">Returns identity status.</div><div class="ttdef"><b>Definition:</b> <a href="absorptionlines_8h_source.html#l01381">absorptionlines.h:1381</a></div></div>
<div class="ttc" id="alinescaling_8cc_html_ab1339d4881d896f88874953b49e33680"><div class="ttname"><a href="linescaling_8cc.html#ab1339d4881d896f88874953b49e33680">dabsorption_nlte_rate_dTu</a></div><div class="ttdeci">Numeric dabsorption_nlte_rate_dTu(const Numeric &amp;gamma, const Numeric &amp;T, const Numeric &amp;Tu, const Numeric &amp;Eu, const Numeric &amp;r_upp)</div><div class="ttdoc">Computes upper state temperature derivative of (r_low - r_upp * gamma) / (1 - gamma)</div><div class="ttdef"><b>Definition:</b> <a href="linescaling_8cc_source.html#l00252">linescaling.cc:252</a></div></div>
<div class="ttc" id="anamespaceAbsorption_html_a2f0c3dd49d97196162df0c84e0d9b782"><div class="ttname"><a href="namespaceAbsorption.html#a2f0c3dd49d97196162df0c84e0d9b782">Absorption::relaxationtype_relmat</a></div><div class="ttdeci">bool relaxationtype_relmat(PopulationType in)</div><div class="ttdef"><b>Definition:</b> <a href="absorptionlines_8h_source.html#l00201">absorptionlines.h:201</a></div></div>
<div class="ttc" id="aclassAbsorption_1_1Lines_html_ad73eb5a6d1933d65ab16711079e6f29d"><div class="ttname"><a href="classAbsorption_1_1Lines.html#ad73eb5a6d1933d65ab16711079e6f29d">Absorption::Lines::ZeemanCount</a></div><div class="ttdeci">Index ZeemanCount(size_t k, Zeeman::Polarization type) const noexcept</div><div class="ttdoc">Returns the number of Zeeman split lines.</div><div class="ttdef"><b>Definition:</b> <a href="absorptionlines_8h_source.html#l00911">absorptionlines.h:911</a></div></div>
<div class="ttc" id="anamespaceLinefunctions_html_a5968ad913cffc2a38859e107aa8e43d6"><div class="ttname"><a href="namespaceLinefunctions.html#a5968ad913cffc2a38859e107aa8e43d6">Linefunctions::set_lineshape</a></div><div class="ttdeci">void set_lineshape(Eigen::Ref&lt; Eigen::VectorXcd &gt; F, const Eigen::Ref&lt; const Eigen::VectorXd &gt; f_grid, const Absorption::SingleLine &amp;line, const Numeric &amp;temperature, const Numeric &amp;zeeman_df, const Numeric &amp;magnetic_magnitude, const Numeric &amp;doppler_constant, const LineShape::Output &amp;lso, const LineShape::Type lineshape_type, const Absorption::MirroringType mirroring_type, const Absorption::NormalizationType norm_type)</div><div class="ttdoc">Sets the lineshape normalized to unity.</div><div class="ttdef"><b>Definition:</b> <a href="linefunctions_8cc_source.html#l00087">linefunctions.cc:87</a></div></div>
<div class="ttc" id="anamespaceConstant_html_a7f485605d9dab3fde05d52f03ca9f36e"><div class="ttname"><a href="namespaceConstant.html#a7f485605d9dab3fde05d52f03ca9f36e">Constant::pow2</a></div><div class="ttdeci">constexpr T pow2(T x)</div><div class="ttdoc">power of two</div><div class="ttdef"><b>Definition:</b> <a href="constants_8h_source.html#l00064">constants.h:64</a></div></div>
<div class="ttc" id="astructLineShape_1_1Output_html_a54962db9fb1d03de52eb33fe6fbc4bce"><div class="ttname"><a href="structLineShape_1_1Output.html#a54962db9fb1d03de52eb33fe6fbc4bce">LineShape::Output::G0</a></div><div class="ttdeci">Numeric G0</div><div class="ttdef"><b>Definition:</b> <a href="lineshapemodel_8h_source.html#l00876">lineshapemodel.h:876</a></div></div>
<div class="ttc" id="anamespaceARTS_1_1Var_html_aeb141694315061634800e0ddc30701ca"><div class="ttname"><a href="namespaceARTS_1_1Var.html#aeb141694315061634800e0ddc30701ca">ARTS::Var::x</a></div><div class="ttdeci">Vector x(Workspace &amp;ws) noexcept</div><div class="ttdef"><b>Definition:</b> <a href="autoarts_8h_source.html#l07346">autoarts.h:7346</a></div></div>
<div class="ttc" id="amatpack_8h_html_aedca4b4670b166565b5b40c700d65a7c"><div class="ttname"><a href="matpack_8h.html#aedca4b4670b166565b5b40c700d65a7c">Index</a></div><div class="ttdeci">INDEX Index</div><div class="ttdoc">The type to use for all integer numbers and indices.</div><div class="ttdef"><b>Definition:</b> <a href="matpack_8h_source.html#l00039">matpack.h:39</a></div></div>
<div class="ttc" id="aclassAbsorption_1_1Lines_html_aeb82ce42bb7d2b1066604e2bc491e08a"><div class="ttname"><a href="classAbsorption_1_1Lines.html#aeb82ce42bb7d2b1066604e2bc491e08a">Absorption::Lines::LinemixingLimit</a></div><div class="ttdeci">Numeric LinemixingLimit() const noexcept</div><div class="ttdoc">Returns line mixing limit.</div><div class="ttdef"><b>Definition:</b> <a href="absorptionlines_8h_source.html#l01331">absorptionlines.h:1331</a></div></div>
<div class="ttc" id="aarts__api__classes_8cc_html_afa1d4d1245df45b0d97cf72f5a58120d"><div class="ttname"><a href="arts__api__classes_8cc.html#afa1d4d1245df45b0d97cf72f5a58120d">F0</a></div><div class="ttdeci">G0 G2 FVC Y DV F0</div><div class="ttdef"><b>Definition:</b> <a href="arts__api__classes_8cc_source.html#l00218">arts_api_classes.cc:218</a></div></div>
<div class="ttc" id="aclassRetrievalQuantity_html"><div class="ttname"><a href="classRetrievalQuantity.html">RetrievalQuantity</a></div><div class="ttdoc">Deals with internal derivatives, Jacobian definition, and OEM calculations.</div><div class="ttdef"><b>Definition:</b> <a href="jacobian_8h_source.html#l00120">jacobian.h:120</a></div></div>
<div class="ttc" id="anamespaceLinefunctions_html_aca2a2edc63a0f046ca2cc3f9c1cd00a4"><div class="ttname"><a href="namespaceLinefunctions.html#aca2a2edc63a0f046ca2cc3f9c1cd00a4">Linefunctions::apply_linestrength_from_nlte_level_distributions</a></div><div class="ttdeci">void apply_linestrength_from_nlte_level_distributions(Eigen::Ref&lt; Eigen::VectorXcd &gt; F, Eigen::Ref&lt; Eigen::MatrixXcd &gt; dF, Eigen::Ref&lt; Eigen::VectorXcd &gt; N, Eigen::Ref&lt; Eigen::MatrixXcd &gt; dN, const Numeric &amp;r1, const Numeric &amp;r2, const Numeric &amp;g1, const Numeric &amp;g2, const Numeric &amp;A21, const Numeric &amp;F0, const Numeric &amp;T, const AbsorptionLines &amp;band=AbsorptionLines(), const Index &amp;line_ind=0, const ArrayOfRetrievalQuantity &amp;derivatives_data=ArrayOfRetrievalQuantity(), const ArrayOfIndex &amp;derivatives_data_position=ArrayOfIndex())</div><div class="ttdoc">Applies non-lte linestrength to already set line shape.</div><div class="ttdef"><b>Definition:</b> <a href="linefunctions_8cc_source.html#l00844">linefunctions.cc:844</a></div></div>
<div class="ttc" id="astructLineShape_1_1Output_html_a27e680e79ddf308a7fd460fb6fa4260b"><div class="ttname"><a href="structLineShape_1_1Output.html#a27e680e79ddf308a7fd460fb6fa4260b">LineShape::Output::D0</a></div><div class="ttdeci">Numeric D0</div><div class="ttdef"><b>Definition:</b> <a href="lineshapemodel_8h_source.html#l00877">lineshapemodel.h:877</a></div></div>
<div class="ttc" id="anamespaceLinefunctions_html_a21f46f004118c4c6c1b41e87ade1ed3c"><div class="ttname"><a href="namespaceLinefunctions.html#a21f46f004118c4c6c1b41e87ade1ed3c">Linefunctions::set_lorentz</a></div><div class="ttdeci">void set_lorentz(Eigen::Ref&lt; Eigen::VectorXcd &gt; F, Eigen::Ref&lt; Eigen::MatrixXcd &gt; dF, Eigen::Ref&lt; Eigen::Matrix&lt; Complex, Eigen::Dynamic, ExpectedDataSize()&gt;&gt; data, const Eigen::Ref&lt; const Eigen::VectorXd &gt; f_grid, const Numeric &amp;zeeman_df, const Numeric &amp;magnetic_magnitude, const Numeric &amp;F0_noshift, const LineShape::Output &amp;lso, const AbsorptionLines &amp;band=AbsorptionLines(), const Index &amp;line_ind=0, const ArrayOfRetrievalQuantity &amp;derivatives_data=ArrayOfRetrievalQuantity(), const ArrayOfIndex &amp;derivatives_data_position=ArrayOfIndex(), const LineShape::Output &amp;dT={0, 0, 0, 0, 0, 0, 0, 0, 0}, const LineShape::Output &amp;dVMR={0, 0, 0, 0, 0, 0, 0, 0, 0})</div><div class="ttdoc">Sets the Lorentz line shape.</div><div class="ttdef"><b>Definition:</b> <a href="linefunctions_8cc_source.html#l00234">linefunctions.cc:234</a></div></div>
<div class="ttc" id="anamespaceoem_html_a5572926b564f0e50c8c63ddc36f68bb1"><div class="ttname"><a href="namespaceoem.html#a5572926b564f0e50c8c63ddc36f68bb1">oem::LM</a></div><div class="ttdeci">invlib::LevenbergMarquardt&lt; Numeric, CovarianceMatrix, Std &gt; LM</div><div class="ttdoc">Levenberg-Marquardt (LM) optimization using normed ARTS QR solver.</div><div class="ttdef"><b>Definition:</b> <a href="oem_8h_source.html#l00173">oem.h:173</a></div></div>
<div class="ttc" id="aclassVector_html"><div class="ttname"><a href="classVector.html">Vector</a></div><div class="ttdoc">The Vector class.</div><div class="ttdef"><b>Definition:</b> <a href="matpackI_8h_source.html#l00860">matpackI.h:860</a></div></div>
<div class="ttc" id="ajacobian_8cc_html_ad59138aabb0d611ff16659b4fd93858a"><div class="ttname"><a href="jacobian_8cc.html#ad59138aabb0d611ff16659b4fd93858a">is_frequency_parameter</a></div><div class="ttdeci">bool is_frequency_parameter(const RetrievalQuantity &amp;t) noexcept</div><div class="ttdoc">Returns if the Retrieval quantity is a frequency parameter in propagation matrix calculations.</div><div class="ttdef"><b>Definition:</b> <a href="jacobian_8cc_source.html#l01120">jacobian.cc:1120</a></div></div>
<div class="ttc" id="aclassAbsorption_1_1Lines_html_afc0fb606b01495dd8d38e7e0795a89d4"><div class="ttname"><a href="classAbsorption_1_1Lines.html#afc0fb606b01495dd8d38e7e0795a89d4">Absorption::Lines::A</a></div><div class="ttdeci">Numeric A(size_t k) const noexcept</div><div class="ttdoc">Einstein spontaneous emission.</div><div class="ttdef"><b>Definition:</b> <a href="absorptionlines_8h_source.html#l01038">absorptionlines.h:1038</a></div></div>
<div class="ttc" id="alinescaling_8cc_html_a16a7ada6dba42dadd627b396720fb02a"><div class="ttname"><a href="linescaling_8cc.html#a16a7ada6dba42dadd627b396720fb02a">stimulated_emission</a></div><div class="ttdeci">Numeric stimulated_emission(Numeric T, Numeric F0)</div><div class="ttdoc">Computes exp(-hf/kT)</div><div class="ttdef"><b>Definition:</b> <a href="linescaling_8cc_source.html#l00110">linescaling.cc:110</a></div></div>
<div class="ttc" id="aclassConstVectorView_html"><div class="ttname"><a href="classConstVectorView.html">ConstVectorView</a></div><div class="ttdoc">A constant view of a Vector.</div><div class="ttdef"><b>Definition:</b> <a href="matpackI_8h_source.html#l00476">matpackI.h:476</a></div></div>
<div class="ttc" id="ajacobian_8h_html_aa9ed0864b0bf1c68796bae61e1319aa9"><div class="ttname"><a href="jacobian_8h.html#aa9ed0864b0bf1c68796bae61e1319aa9">is_pressure_broadening_ETA</a></div><div class="ttdeci">bool is_pressure_broadening_ETA(const RetrievalQuantity &amp;t) noexcept</div><div class="ttdoc">Returns if the Retrieval quantity is a ETA derivative.</div></div>
<div class="ttc" id="aclassArray_html_a90ce1cf3f99646da9d0efd6e8a661369"><div class="ttname"><a href="classArray.html#a90ce1cf3f99646da9d0efd6e8a661369">Array::nelem</a></div><div class="ttdeci">Index nelem() const</div><div class="ttdoc">Number of elements.</div><div class="ttdef"><b>Definition:</b> <a href="array_8h_source.html#l00195">array.h:195</a></div></div>
<div class="ttc" id="ajacobian_8cc_html_a640c3636682444c1ff31daa0aceaf30a"><div class="ttname"><a href="jacobian_8cc.html#a640c3636682444c1ff31daa0aceaf30a">is_lineshape_parameter</a></div><div class="ttdeci">bool is_lineshape_parameter(const RetrievalQuantity &amp;t) noexcept</div><div class="ttdoc">Returns if the Retrieval quantity is a G0, D0, G2, D2, ETA, FVC, Y, G, DV derivative.</div><div class="ttdef"><b>Definition:</b> <a href="jacobian_8cc_source.html#l01187">jacobian.cc:1187</a></div></div>
<div class="ttc" id="anamespaceAbsorption_html_a209c1a7ed727935e9195e709518cb6e2a22518c7ac1f6e1a2be04bd6f5ad71c6b"><div class="ttname"><a href="namespaceAbsorption.html#a209c1a7ed727935e9195e709518cb6e2a22518c7ac1f6e1a2be04bd6f5ad71c6b">Absorption::PopulationType::ByLTE</a></div><div class="ttdeci">@ ByLTE</div></div>
<div class="ttc" id="anamespaceZeeman_html_a12f398a6c84854a865975552bc660073"><div class="ttname"><a href="namespaceZeeman.html#a12f398a6c84854a865975552bc660073">Zeeman::Polarization</a></div><div class="ttdeci">Polarization</div><div class="ttdoc">Zeeman polarization selection.</div><div class="ttdef"><b>Definition:</b> <a href="zeemandata_8h_source.html#l00043">zeemandata.h:43</a></div></div>
<div class="ttc" id="aclassLinefunctions_1_1InternalData_html_ab601be0a3533006883949c8b234e9bb5"><div class="ttname"><a href="classLinefunctions_1_1InternalData.html#ab601be0a3533006883949c8b234e9bb5">Linefunctions::InternalData::F</a></div><div class="ttdeci">Eigen::VectorXcd F</div><div class="ttdef"><b>Definition:</b> <a href="linefunctions_8h_source.html#l00520">linefunctions.h:520</a></div></div>
<div class="ttc" id="aclassLinefunctions_1_1InternalData_html_ad3fa2a3f1d0d14722ec03dd3749acd9d"><div class="ttname"><a href="classLinefunctions_1_1InternalData.html#ad3fa2a3f1d0d14722ec03dd3749acd9d">Linefunctions::InternalData::data</a></div><div class="ttdeci">Eigen::Matrix&lt; Complex, Eigen::Dynamic, Linefunctions::ExpectedDataSize()&gt; data</div><div class="ttdef"><b>Definition:</b> <a href="linefunctions_8h_source.html#l00530">linefunctions.h:530</a></div></div>
<div class="ttc" id="aarts__api__classes_8cc_html_a8d95ca35e1e2ddc693d99e2af98d32c5"><div class="ttname"><a href="arts__api__classes_8cc.html#a8d95ca35e1e2ddc693d99e2af98d32c5">E0</a></div><div class="ttdeci">G0 G2 FVC Y DV Numeric E0</div><div class="ttdef"><b>Definition:</b> <a href="arts__api__classes_8cc_source.html#l00220">arts_api_classes.cc:220</a></div></div>
<div class="ttc" id="anamespaceLineShape_html_ab05b1932aed081698912bfb96466b95c"><div class="ttname"><a href="namespaceLineShape.html#ab05b1932aed081698912bfb96466b95c">LineShape::si2cgs</a></div><div class="ttdeci">constexpr Output si2cgs(Output x) noexcept</div><div class="ttdoc">Output turned from SI to CGS units.</div><div class="ttdef"><b>Definition:</b> <a href="lineshapemodel_8h_source.html#l00905">lineshapemodel.h:905</a></div></div>
<div class="ttc" id="anamespaceLineShape_html_a4b0cfb5637fe4bfa0bded7aefc4bb437"><div class="ttname"><a href="namespaceLineShape.html#a4b0cfb5637fe4bfa0bded7aefc4bb437">LineShape::vmrs</a></div><div class="ttdeci">Vector vmrs(const ConstVectorView &amp;atmospheric_vmrs, const ArrayOfArrayOfSpeciesTag &amp;atmospheric_species, const QuantumIdentifier &amp;self, const ArrayOfSpeciesTag &amp;lineshape_species, bool self_in_list, bool bath_in_list, Type type)</div><div class="ttdoc">Returns a VMR vector for this model's main calculations.</div><div class="ttdef"><b>Definition:</b> <a href="lineshapemodel_8cc_source.html#l00474">lineshapemodel.cc:474</a></div></div>
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="dir_68267d1309a1af8e8297ef4c3efbcdba.html">src</a></li><li class="navelem"><a class="el" href="linefunctions_8cc.html">linefunctions.cc</a></li>
    <li class="footer">Generated on Thu Oct 15 2020 08:53:03 for ARTS by <a href="http://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.8.20 </li>
  </ul>
</div>
</body>
</html>
